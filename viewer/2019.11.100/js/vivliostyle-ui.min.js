/*! For license information please see vivliostyle-ui.min.js.LICENSE */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["vivliostyle-ui"]=t():e["vivliostyle-ui"]=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){var i,o,s;!function(r){var a=this||(0,eval)("this"),l=a.document,c=a.navigator,h=a.jQuery,u=a.JSON;h||"undefined"==typeof jQuery||(h=jQuery),function(r){o=[t,n],void 0===(s="function"==typeof(i=r)?i.apply(t,o):i)||(e.exports=s)}((function(e,t){function n(e,t){return(null===e||typeof e in S)&&e===t}function i(e,t){var n;return function(){n||(n=y.a.setTimeout((function(){n=r,e()}),t))}}function o(e,t){var n;return function(){clearTimeout(n),n=y.a.setTimeout(e,t)}}function s(e,t){t&&"change"!==t?"beforeChange"===t?this.pc(e):this.gb(e,t):this.qc(e)}function d(e,t){null!==t&&t.s&&t.s()}function p(e,t){var n=this.qd,i=n[x];i.ra||(this.Qb&&this.mb[t]?(n.uc(t,e,this.mb[t]),this.mb[t]=null,--this.Qb):i.I[t]||n.uc(t,e,i.J?{da:e}:n.$c(e)),e.Ja&&e.gd())}var f,g,m,b,w,E,y=void 0!==e?e:{};y.b=function(e,t){for(var n=e.split("."),i=y,o=0;o<n.length-1;o++)i=i[n[o]];i[n[n.length-1]]=t},y.L=function(e,t,n){e[t]=n},y.version="3.5.1",y.b("version",y.version),y.options={deferUpdates:!1,useOnlyNativeEvents:!1,foreachHidesDestroyed:!1},y.a=function(){function e(e,t){for(var n in e)o.call(e,n)&&t(n,e[n])}function t(e,t){if(t)for(var n in t)o.call(t,n)&&(e[n]=t[n]);return e}function n(e,t){return e.__proto__=t,e}function i(e,t,n,i){var o=e[t].match(w)||[];y.a.D(n.match(w),(function(e){y.a.Na(o,e,i)})),e[t]=o.join(" ")}var o=Object.prototype.hasOwnProperty,s={__proto__:[]}instanceof Array,d="function"==typeof Symbol,p={},f={};p[c&&/Firefox\/2/i.test(c.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],p.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),e(p,(function(e,t){if(t.length)for(var n=0,i=t.length;n<i;n++)f[t[n]]=e}));var g,m={propertychange:!0},b=l&&function(){for(var e=3,t=l.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return 4<e?e:r}(),w=/\S+/g;return{Jc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],D:function(e,t,n){for(var i=0,o=e.length;i<o;i++)t.call(n,e[i],i,e)},A:"function"==typeof Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t)}:function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},Lb:function(e,t,n){for(var i=0,o=e.length;i<o;i++)if(t.call(n,e[i],i,e))return e[i];return r},Pa:function(e,t){var n=y.a.A(e,t);0<n?e.splice(n,1):0===n&&e.shift()},wc:function(e){var t=[];return e&&y.a.D(e,(function(e){0>y.a.A(t,e)&&t.push(e)})),t},Mb:function(e,t,n){var i=[];if(e)for(var o=0,s=e.length;o<s;o++)i.push(t.call(n,e[o],o));return i},jb:function(e,t,n){var i=[];if(e)for(var o=0,s=e.length;o<s;o++)t.call(n,e[o],o)&&i.push(e[o]);return i},Nb:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,i=t.length;n<i;n++)e.push(t[n]);return e},Na:function(e,t,n){var i=y.a.A(y.a.bc(e),t);0>i?n&&e.push(t):n||e.splice(i,1)},Ba:s,extend:t,setPrototypeOf:n,Ab:s?n:t,P:e,Ga:function(e,t,n){if(!e)return e;var i,s={};for(i in e)o.call(e,i)&&(s[i]=t.call(n,e[i],i,e));return s},Tb:function(e){for(;e.firstChild;)y.removeNode(e.firstChild)},Yb:function(e){for(var t=((e=y.a.la(e))[0]&&e[0].ownerDocument||l).createElement("div"),n=0,i=e.length;n<i;n++)t.appendChild(y.oa(e[n]));return t},Ca:function(e,t){for(var n=0,i=e.length,o=[];n<i;n++){var s=e[n].cloneNode(!0);o.push(t?y.oa(s):s)}return o},va:function(e,t){if(y.a.Tb(e),t)for(var n=0,i=t.length;n<i;n++)e.appendChild(t[n])},Xc:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var i=n[0],o=i.parentNode,s=0,r=t.length;s<r;s++)o.insertBefore(t[s],i);for(s=0,r=n.length;s<r;s++)y.removeNode(n[s])}},Ua:function(e,t){if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)e.length--;if(1<e.length){var n=e[0],i=e[e.length-1];for(e.length=0;n!==i;)e.push(n),n=n.nextSibling;e.push(i)}}return e},Zc:function(e,t){7>b?e.setAttribute("selected",t):e.selected=t},Db:function(e){return null===e||e===r?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Ud:function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},vd:function(e,t){if(e===t)return!0;if(11===e.nodeType)return!1;if(t.contains)return t.contains(1!==e.nodeType?e.parentNode:e);if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;e&&e!=t;)e=e.parentNode;return!!e},Sb:function(e){return y.a.vd(e,e.ownerDocument.documentElement)},kd:function(e){return!!y.a.Lb(e,y.a.Sb)},R:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},Ac:function(e){return y.onError?function(){try{return e.apply(this,arguments)}catch(e){throw y.onError&&y.onError(e),e}}:e},setTimeout:function(e,t){return setTimeout(y.a.Ac(e),t)},Gc:function(e){setTimeout((function(){throw y.onError&&y.onError(e),e}),0)},B:function(e,t,n){var i=y.a.Ac(n);if(n=m[t],y.options.useOnlyNativeEvents||n||!h)if(n||"function"!=typeof e.addEventListener){if(void 0===e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var o=function(t){i.call(e,t)},s="on"+t;e.attachEvent(s,o),y.a.K.za(e,(function(){e.detachEvent(s,o)}))}else e.addEventListener(t,i,!1);else g||(g="function"==typeof h(e).on?"on":"bind"),h(e)[g](t,i)},Fb:function(e,t){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var n;if(n=!("input"!==y.a.R(e)||!e.type||"click"!=t.toLowerCase())&&("checkbox"==(n=e.type)||"radio"==n),y.options.useOnlyNativeEvents||!h||n)if("function"==typeof l.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");(n=l.createEvent(f[t]||"HTMLEvents")).initEvent(t,!0,!0,a,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(n)}else if(n&&e.click)e.click();else{if(void 0===e.fireEvent)throw Error("Browser doesn't support triggering events");e.fireEvent("on"+t)}else h(e).trigger(t)},f:function(e){return y.O(e)?e():e},bc:function(e){return y.O(e)?e.v():e},Eb:function(e,t,n){var o;t&&("object"==typeof e.classList?(o=e.classList[n?"add":"remove"],y.a.D(t.match(w),(function(t){o.call(e.classList,t)}))):"string"==typeof e.className.baseVal?i(e.className,"baseVal",t,n):i(e,"className",t,n))},Bb:function(e,t){var n=y.a.f(t);null!==n&&n!==r||(n="");var i=y.h.firstChild(e);!i||3!=i.nodeType||y.h.nextSibling(i)?y.h.va(e,[e.ownerDocument.createTextNode(n)]):i.data=n,y.a.Ad(e)},Yc:function(e,t){if(e.name=t,7>=b)try{var n=e.name.replace(/[&<>'"]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}));e.mergeAttributes(l.createElement("<input name='"+n+"'/>"),!1)}catch(e){}},Ad:function(e){9<=b&&(e=1==e.nodeType?e:e.parentNode).style&&(e.style.zoom=e.style.zoom)},wd:function(e){if(b){var t=e.style.width;e.style.width=0,e.style.width=t}},Pd:function(e,t){e=y.a.f(e),t=y.a.f(t);for(var n=[],i=e;i<=t;i++)n.push(i);return n},la:function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},Da:function(e){return d?Symbol(e):e},Zd:6===b,$d:7===b,W:b,Lc:function(e,t){for(var n=y.a.la(e.getElementsByTagName("input")).concat(y.a.la(e.getElementsByTagName("textarea"))),i="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},o=[],s=n.length-1;0<=s;s--)i(n[s])&&o.push(n[s]);return o},Nd:function(e){return"string"==typeof e&&(e=y.a.Db(e))?u&&u.parse?u.parse(e):new Function("return "+e)():null},hc:function(e,t,n){if(!u||!u.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return u.stringify(y.a.f(e),t,n)},Od:function(t,n,i){var o=(i=i||{}).params||{},s=i.includeFields||this.Jc,r=t;if("object"==typeof t&&"form"===y.a.R(t)){r=t.action;for(var a=s.length-1;0<=a;a--)for(var c=y.a.Lc(t,s[a]),h=c.length-1;0<=h;h--)o[c[h].name]=c[h].value}n=y.a.f(n);var u=l.createElement("form");for(var d in u.style.display="none",u.action=r,u.method="post",n)(t=l.createElement("input")).type="hidden",t.name=d,t.value=y.a.hc(y.a.f(n[d])),u.appendChild(t);e(o,(function(e,t){var n=l.createElement("input");n.type="hidden",n.name=e,n.value=t,u.appendChild(n)})),l.body.appendChild(u),i.submitter?i.submitter(u):u.submit(),setTimeout((function(){u.parentNode.removeChild(u)}),0)}}}(),y.b("utils",y.a),y.b("utils.arrayForEach",y.a.D),y.b("utils.arrayFirst",y.a.Lb),y.b("utils.arrayFilter",y.a.jb),y.b("utils.arrayGetDistinctValues",y.a.wc),y.b("utils.arrayIndexOf",y.a.A),y.b("utils.arrayMap",y.a.Mb),y.b("utils.arrayPushAll",y.a.Nb),y.b("utils.arrayRemoveItem",y.a.Pa),y.b("utils.cloneNodes",y.a.Ca),y.b("utils.createSymbolOrString",y.a.Da),y.b("utils.extend",y.a.extend),y.b("utils.fieldsIncludedWithJsonPost",y.a.Jc),y.b("utils.getFormFields",y.a.Lc),y.b("utils.objectMap",y.a.Ga),y.b("utils.peekObservable",y.a.bc),y.b("utils.postJson",y.a.Od),y.b("utils.parseJson",y.a.Nd),y.b("utils.registerEventHandler",y.a.B),y.b("utils.stringifyJson",y.a.hc),y.b("utils.range",y.a.Pd),y.b("utils.toggleDomNodeCssClass",y.a.Eb),y.b("utils.triggerEvent",y.a.Fb),y.b("utils.unwrapObservable",y.a.f),y.b("utils.objectForEach",y.a.P),y.b("utils.addOrRemoveItem",y.a.Na),y.b("utils.setTextContent",y.a.Bb),y.b("unwrap",y.a.f),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(1===arguments.length)return function(){return t.apply(e,arguments)};var n=Array.prototype.slice.call(arguments,1);return function(){var i=n.slice(0);return i.push.apply(i,arguments),t.apply(e,i)}}),y.a.g=new function(){var e,t,n=0,i="__ko__"+(new Date).getTime(),o={};return y.a.W?(e=function(e,t){var s=e[i];if(!s||"null"===s||!o[s]){if(!t)return r;s=e[i]="ko"+n++,o[s]={}}return o[s]},t=function(e){var t=e[i];return!!t&&(delete o[t],e[i]=null,!0)}):(e=function(e,t){var n=e[i];return!n&&t&&(n=e[i]={}),n},t=function(e){return!!e[i]&&(delete e[i],!0)}),{get:function(t,n){var i=e(t,!1);return i&&i[n]},set:function(t,n,i){(t=e(t,i!==r))&&(t[n]=i)},Ub:function(t,n,i){return(t=e(t,!0))[n]||(t[n]=i)},clear:t,Z:function(){return n+++i}}},y.b("utils.domData",y.a.g),y.b("utils.domData.clear",y.a.g.clear),y.a.K=new function(){function e(e,t){var n=y.a.g.get(e,i);return n===r&&t&&(n=[],y.a.g.set(e,i,n)),n}function t(t){if(i=e(t,!1))for(var i=i.slice(0),o=0;o<i.length;o++)i[o](t);y.a.g.clear(t),y.a.K.cleanExternalData(t),s[t.nodeType]&&n(t.childNodes,!0)}function n(e,n){for(var i,o=[],s=0;s<e.length;s++)if((!n||8===e[s].nodeType)&&(t(o[o.length]=i=e[s]),e[s]!==i))for(;s--&&-1==y.a.A(o,e[s]););}var i=y.a.g.Z(),o={1:!0,8:!0,9:!0},s={1:!0,9:!0};return{za:function(t,n){if("function"!=typeof n)throw Error("Callback must be a function");e(t,!0).push(n)},yb:function(t,n){var o=e(t,!1);o&&(y.a.Pa(o,n),0==o.length&&y.a.g.set(t,i,r))},oa:function(e){return y.u.G((function(){o[e.nodeType]&&(t(e),s[e.nodeType]&&n(e.getElementsByTagName("*")))})),e},removeNode:function(e){y.oa(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){h&&"function"==typeof h.cleanData&&h.cleanData([e])}}},y.oa=y.a.K.oa,y.removeNode=y.a.K.removeNode,y.b("cleanNode",y.oa),y.b("removeNode",y.removeNode),y.b("utils.domNodeDisposal",y.a.K),y.b("utils.domNodeDisposal.addDisposeCallback",y.a.K.za),y.b("utils.domNodeDisposal.removeDisposeCallback",y.a.K.yb),f=[0,"",""],w={thead:g=[1,"<table>","</table>"],tbody:g,tfoot:g,tr:[2,"<table><tbody>","</tbody></table>"],td:m=[3,"<table><tbody><tr>","</tr></tbody></table>"],th:m,option:b=[1,"<select multiple='multiple'>","</select>"],optgroup:b},E=8>=y.a.W,y.a.ua=function(e,t){var n;if(h){if(h.parseHTML)n=h.parseHTML(e,t)||[];else if((n=h.clean([e],t))&&n[0]){for(var i=n[0];i.parentNode&&11!==i.parentNode.nodeType;)i=i.parentNode;i.parentNode&&i.parentNode.removeChild(i)}}else{(n=t)||(n=l),i=n.parentWindow||n.defaultView||a;var o,s=y.a.Db(e).toLowerCase(),r=n.createElement("div");for(o=(s=s.match(/^(?:\x3c!--.*?--\x3e\s*?)*?<([a-z]+)[\s>]/))&&w[s[1]]||f,s=o[0],o="ignored<div>"+o[1]+e+o[2]+"</div>","function"==typeof i.innerShiv?r.appendChild(i.innerShiv(o)):(E&&n.body.appendChild(r),r.innerHTML=o,E&&r.parentNode.removeChild(r));s--;)r=r.lastChild;n=y.a.la(r.lastChild.childNodes)}return n},y.a.Md=function(e,t){var n=y.a.ua(e,t);return n.length&&n[0].parentElement||y.a.Yb(n)},y.a.fc=function(e,t){if(y.a.Tb(e),null!==(t=y.a.f(t))&&t!==r)if("string"!=typeof t&&(t=t.toString()),h)h(e).html(t);else for(var n=y.a.ua(t,e.ownerDocument),i=0;i<n.length;i++)e.appendChild(n[i])},y.b("utils.parseHtmlFragment",y.a.ua),y.b("utils.setHtml",y.a.fc),y.aa=function(){var e={};return{Xb:function(t){if("function"!=typeof t)throw Error("You can only pass a function to ko.memoization.memoize()");var n=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return e[n]=t,"\x3c!--[ko_memo:"+n+"]--\x3e"},bd:function(t,n){var i=e[t];if(i===r)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return i.apply(null,n||[]),!0}finally{delete e[t]}},cd:function(e,t){var n=[];!function e(t,n){if(t)if(8==t.nodeType)null!=(i=y.aa.Uc(t.nodeValue))&&n.push({ud:t,Kd:i});else if(1==t.nodeType)for(var i=0,o=t.childNodes,s=o.length;i<s;i++)e(o[i],n)}(e,n);for(var i=0,o=n.length;i<o;i++){var s=n[i].ud,r=[s];t&&y.a.Nb(r,t),y.aa.bd(n[i].Kd,r),s.nodeValue="",s.parentNode&&s.parentNode.removeChild(s)}},Uc:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),y.b("memoization",y.aa),y.b("memoization.memoize",y.aa.Xb),y.b("memoization.unmemoize",y.aa.bd),y.b("memoization.parseMemoText",y.aa.Uc),y.b("memoization.unmemoizeDomNodeAndDescendants",y.aa.cd),y.na=function(){function e(){if(i)for(var e,t=i,o=0;s<i;)if(e=n[s++]){if(s>t){if(5e3<=++o){s=i,y.a.Gc(Error("'Too much recursion' after processing "+o+" task groups."));break}t=i}try{e()}catch(e){y.a.Gc(e)}}}function t(){e(),s=i=n.length=0}var n=[],i=0,o=1,s=0;return{scheduler:a.MutationObserver?function(e){var t=l.createElement("div");return new MutationObserver(e).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(t):l&&"onreadystatechange"in l.createElement("script")?function(e){var t=l.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,l.documentElement.removeChild(t),t=null,e()},l.documentElement.appendChild(t)}:function(e){setTimeout(e,0)},zb:function(e){return i||y.na.scheduler(t),n[i++]=e,o++},cancel:function(e){(e-=o-i)>=s&&e<i&&(n[e]=null)},resetForTesting:function(){var e=i-s;return s=i=n.length=0,e},Sd:e}}(),y.b("tasks",y.na),y.b("tasks.schedule",y.na.zb),y.b("tasks.runEarly",y.na.Sd),y.Ta={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return y.$({read:e,write:function(i){clearTimeout(n),n=y.a.setTimeout((function(){e(i)}),t)}})},rateLimit:function(e,t){var n,s,r;"number"==typeof t?n=t:(n=t.timeout,s=t.method),e.Hb=!1,r="function"==typeof s?s:"notifyWhenChangesStop"==s?o:i,e.ub((function(e){return r(e,n,t)}))},deferred:function(e,t){if(!0!==t)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");e.Hb||(e.Hb=!0,e.ub((function(t){var n,i=!1;return function(){if(!i){y.na.cancel(n),n=y.na.zb(t);try{i=!0,e.notifySubscribers(r,"dirty")}finally{i=!1}}}})))},notify:function(e,t){e.equalityComparer="always"==t?null:n}};var S={undefined:1,boolean:1,number:1,string:1};y.b("extenders",y.Ta),y.ic=function(e,t,n){this.da=e,this.lc=t,this.mc=n,this.Ib=!1,this.fb=this.Jb=null,y.L(this,"dispose",this.s),y.L(this,"disposeWhenNodeIsRemoved",this.l)},y.ic.prototype.s=function(){this.Ib||(this.fb&&y.a.K.yb(this.Jb,this.fb),this.Ib=!0,this.mc(),this.da=this.lc=this.mc=this.Jb=this.fb=null)},y.ic.prototype.l=function(e){this.Jb=e,y.a.K.za(e,this.fb=this.s.bind(this))},y.T=function(){y.a.Ab(this,N),N.qb(this)};var N={qb:function(e){e.U={change:[]},e.sc=1},subscribe:function(e,t,n){var i=this;n=n||"change";var o=new y.ic(i,t?e.bind(t):e,(function(){y.a.Pa(i.U[n],o),i.hb&&i.hb(n)}));return i.Qa&&i.Qa(n),i.U[n]||(i.U[n]=[]),i.U[n].push(o),o},notifySubscribers:function(e,t){if("change"===(t=t||"change")&&this.Gb(),this.Wa(t)){var n="change"===t&&this.ed||this.U[t].slice(0);try{y.u.xc();for(var i,o=0;i=n[o];++o)i.Ib||i.lc(e)}finally{y.u.end()}}},ob:function(){return this.sc},Dd:function(e){return this.ob()!==e},Gb:function(){++this.sc},ub:function(e){var t,n,i,o,r,a=this,l=y.O(a);a.gb||(a.gb=a.notifySubscribers,a.notifySubscribers=s);var c=e((function(){a.Ja=!1,l&&o===a&&(o=a.nc?a.nc():a());var e=n||r&&a.sb(i,o);r=n=t=!1,e&&a.gb(i=o)}));a.qc=function(e,n){n&&a.Ja||(r=!n),a.ed=a.U.change.slice(0),a.Ja=t=!0,o=e,c()},a.pc=function(e){t||(i=e,a.gb(e,"beforeChange"))},a.rc=function(){r=!0},a.gd=function(){a.sb(i,a.v(!0))&&(n=!0)}},Wa:function(e){return this.U[e]&&this.U[e].length},Bd:function(e){if(e)return this.U[e]&&this.U[e].length||0;var t=0;return y.a.P(this.U,(function(e,n){"dirty"!==e&&(t+=n.length)})),t},sb:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},toString:function(){return"[object Object]"},extend:function(e){var t=this;return e&&y.a.P(e,(function(e,n){var i=y.Ta[e];"function"==typeof i&&(t=i(t,n)||t)})),t}};y.L(N,"init",N.qb),y.L(N,"subscribe",N.subscribe),y.L(N,"extend",N.extend),y.L(N,"getSubscriptionsCount",N.Bd),y.a.Ba&&y.a.setPrototypeOf(N,Function.prototype),y.T.fn=N,y.Qc=function(e){return null!=e&&"function"==typeof e.subscribe&&"function"==typeof e.notifySubscribers},y.b("subscribable",y.T),y.b("isSubscribable",y.Qc),y.S=y.u=function(){function e(e){i.push(n),n=e}function t(){n=i.pop()}var n,i=[],o=0;return{xc:e,end:t,cc:function(e){if(n){if(!y.Qc(e))throw Error("Only subscribable things can act as dependencies");n.od.call(n.pd,e,e.fd||(e.fd=++o))}},G:function(n,i,o){try{return e(),n.apply(i,o||[])}finally{t()}},qa:function(){if(n)return n.o.qa()},Va:function(){if(n)return n.o.Va()},Ya:function(){if(n)return n.Ya},o:function(){if(n)return n.o}}}(),y.b("computedContext",y.S),y.b("computedContext.getDependenciesCount",y.S.qa),y.b("computedContext.getDependencies",y.S.Va),y.b("computedContext.isInitial",y.S.Ya),y.b("computedContext.registerDependency",y.S.cc),y.b("ignoreDependencies",y.Yd=y.u.G);var C=y.a.Da("_latestValue");y.ta=function(e){function t(){return 0<arguments.length?(t.sb(t[C],arguments[0])&&(t.ya(),t[C]=arguments[0],t.xa()),this):(y.u.cc(t),t[C])}return t[C]=e,y.a.Ba||y.a.extend(t,y.T.fn),y.T.fn.qb(t),y.a.Ab(t,v),y.options.deferUpdates&&y.Ta.deferred(t,!0),t};var v={equalityComparer:n,v:function(){return this[C]},xa:function(){this.notifySubscribers(this[C],"spectate"),this.notifySubscribers(this[C])},ya:function(){this.notifySubscribers(this[C],"beforeChange")}};y.a.Ba&&y.a.setPrototypeOf(v,y.T.fn);var T=y.ta.Ma="__ko_proto__";v[T]=y.ta,y.O=function(e){if((e="function"==typeof e&&e[T])&&e!==v[T]&&e!==y.o.fn[T])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},y.Za=function(e){return"function"==typeof e&&(e[T]===v[T]||e[T]===y.o.fn[T]&&e.Nc)},y.b("observable",y.ta),y.b("isObservable",y.O),y.b("isWriteableObservable",y.Za),y.b("isWritableObservable",y.Za),y.b("observable.fn",v),y.L(v,"peek",v.v),y.L(v,"valueHasMutated",v.xa),y.L(v,"valueWillMutate",v.ya),y.Ha=function(e){if("object"!=typeof(e=e||[])||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=y.ta(e),y.a.Ab(e,y.Ha.fn),e.extend({trackArrayChanges:!0})},y.Ha.fn={remove:function(e){for(var t=this.v(),n=[],i="function"!=typeof e||y.O(e)?function(t){return t===e}:e,o=0;o<t.length;o++){var s=t[o];if(i(s)){if(0===n.length&&this.ya(),t[o]!==s)throw Error("Array modified during remove; cannot remove item");n.push(s),t.splice(o,1),o--}}return n.length&&this.xa(),n},removeAll:function(e){if(e===r){var t=this.v(),n=t.slice(0);return this.ya(),t.splice(0,t.length),this.xa(),n}return e?this.remove((function(t){return 0<=y.a.A(e,t)})):[]},destroy:function(e){var t=this.v(),n="function"!=typeof e||y.O(e)?function(t){return t===e}:e;this.ya();for(var i=t.length-1;0<=i;i--){var o=t[i];n(o)&&(o._destroy=!0)}this.xa()},destroyAll:function(e){return e===r?this.destroy((function(){return!0})):e?this.destroy((function(t){return 0<=y.a.A(e,t)})):[]},indexOf:function(e){var t=this();return y.a.A(t,e)},replace:function(e,t){var n=this.indexOf(e);0<=n&&(this.ya(),this.v()[n]=t,this.xa())},sorted:function(e){var t=this().slice(0);return e?t.sort(e):t.sort()},reversed:function(){return this().slice(0).reverse()}},y.a.Ba&&y.a.setPrototypeOf(y.Ha.fn,y.ta.fn),y.a.D("pop push reverse shift sort splice unshift".split(" "),(function(e){y.Ha.fn[e]=function(){var t=this.v();this.ya(),this.zc(t,e,arguments);var n=t[e].apply(t,arguments);return this.xa(),n===t?this:n}})),y.a.D(["slice"],(function(e){y.Ha.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}})),y.Pc=function(e){return y.O(e)&&"function"==typeof e.remove&&"function"==typeof e.push},y.b("observableArray",y.Ha),y.b("isObservableArray",y.Pc),y.Ta.trackArrayChanges=function(e,t){function n(){function t(){if(c){var t,n=[].concat(e.v()||[]);e.Wa("arrayChange")&&((!l||1<c)&&(l=y.a.Pb(s,n,e.Ob)),t=l),s=n,l=null,c=0,t&&t.length&&e.notifySubscribers(t,"arrayChange")}}a?t():(a=!0,o=e.subscribe((function(){++c}),null,"spectate"),s=[].concat(e.v()||[]),l=null,i=e.subscribe(t))}if(e.Ob={},t&&"object"==typeof t&&y.a.extend(e.Ob,t),e.Ob.sparse=!0,!e.zc){var i,o,s,a=!1,l=null,c=0,h=e.Qa,u=e.hb;e.Qa=function(t){h&&h.call(e,t),"arrayChange"===t&&n()},e.hb=function(t){u&&u.call(e,t),"arrayChange"!==t||e.Wa("arrayChange")||(i&&i.s(),o&&o.s(),o=i=null,a=!1,s=r)},e.zc=function(e,t,n){function i(e,t,n){return o[o.length]={status:e,value:t,index:n}}if(a&&!c){var o=[],s=e.length,r=n.length,h=0;switch(t){case"push":h=s;case"unshift":for(t=0;t<r;t++)i("added",n[t],h+t);break;case"pop":h=s-1;case"shift":s&&i("deleted",e[h],h);break;case"splice":t=Math.min(Math.max(0,0>n[0]?s+n[0]:n[0]),s),s=1===r?s:Math.min(t+(n[1]||0),s),r=t+r-2,h=Math.max(s,r);for(var u=[],d=[],p=2;t<h;++t,++p)t<s&&d.push(i("deleted",e[t],t)),t<r&&u.push(i("added",n[p],t));y.a.Kc(d,u);break;default:return}l=o}}}};var x=y.a.Da("_state");y.o=y.$=function(e,t,n){function i(){if(0<arguments.length){if("function"!=typeof o)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return o.apply(s.nb,arguments),this}return s.ra||y.u.cc(i),(s.ka||s.J&&i.Xa())&&i.ha(),s.X}if("object"==typeof e?n=e:(n=n||{},e&&(n.read=e)),"function"!=typeof n.read)throw Error("Pass a function that returns the value of the ko.computed");var o=n.write,s={X:r,sa:!0,ka:!0,rb:!1,jc:!1,ra:!1,wb:!1,J:!1,Wc:n.read,nb:t||n.owner,l:n.disposeWhenNodeIsRemoved||n.l||null,Sa:n.disposeWhen||n.Sa,Rb:null,I:{},V:0,Ic:null};return i[x]=s,i.Nc="function"==typeof o,y.a.Ba||y.a.extend(i,y.T.fn),y.T.fn.qb(i),y.a.Ab(i,I),n.pure?(s.wb=!0,s.J=!0,y.a.extend(i,P)):n.deferEvaluation&&y.a.extend(i,A),y.options.deferUpdates&&y.Ta.deferred(i,!0),s.l&&(s.jc=!0,s.l.nodeType||(s.l=null)),s.J||n.deferEvaluation||i.ha(),s.l&&i.ja()&&y.a.K.za(s.l,s.Rb=function(){i.s()}),i};var I={equalityComparer:n,qa:function(){return this[x].V},Va:function(){var e=[];return y.a.P(this[x].I,(function(t,n){e[n.Ka]=n.da})),e},Vb:function(e){if(!this[x].V)return!1;var t=this.Va();return-1!==y.a.A(t,e)||!!y.a.Lb(t,(function(t){return t.Vb&&t.Vb(e)}))},uc:function(e,t,n){if(this[x].wb&&t===this)throw Error("A 'pure' computed must not be called recursively");this[x].I[e]=n,n.Ka=this[x].V++,n.La=t.ob()},Xa:function(){var e,t,n=this[x].I;for(e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&(t=n[e],this.Ia&&t.da.Ja||t.da.Dd(t.La)))return!0},Jd:function(){this.Ia&&!this[x].rb&&this.Ia(!1)},ja:function(){var e=this[x];return e.ka||0<e.V},Rd:function(){this.Ja?this[x].ka&&(this[x].sa=!0):this.Hc()},$c:function(e){if(e.Hb){var t=e.subscribe(this.Jd,this,"dirty"),n=e.subscribe(this.Rd,this);return{da:e,s:function(){t.s(),n.s()}}}return e.subscribe(this.Hc,this)},Hc:function(){var e=this,t=e.throttleEvaluation;t&&0<=t?(clearTimeout(this[x].Ic),this[x].Ic=y.a.setTimeout((function(){e.ha(!0)}),t)):e.Ia?e.Ia(!0):e.ha(!0)},ha:function(e){var t=this[x],n=t.Sa,i=!1;if(!t.rb&&!t.ra){if(t.l&&!y.a.Sb(t.l)||n&&n()){if(!t.jc)return void this.s()}else t.jc=!1;t.rb=!0;try{i=this.zd(e)}finally{t.rb=!1}return i}},zd:function(e){var t=this[x],n=!1,i=t.wb?r:!t.V;n={qd:this,mb:t.I,Qb:t.V},y.u.xc({pd:n,od:p,o:this,Ya:i}),t.I={},t.V=0;var o=this.yd(t,n);return t.V?n=this.sb(t.X,o):(this.s(),n=!0),n&&(t.J?this.Gb():this.notifySubscribers(t.X,"beforeChange"),t.X=o,this.notifySubscribers(t.X,"spectate"),!t.J&&e&&this.notifySubscribers(t.X),this.rc&&this.rc()),i&&this.notifySubscribers(t.X,"awake"),n},yd:function(e,t){try{var n=e.Wc;return e.nb?n.call(e.nb):n()}finally{y.u.end(),t.Qb&&!e.J&&y.a.P(t.mb,d),e.sa=e.ka=!1}},v:function(e){var t=this[x];return(t.ka&&(e||!t.V)||t.J&&this.Xa())&&this.ha(),t.X},ub:function(e){y.T.fn.ub.call(this,e),this.nc=function(){return this[x].J||(this[x].sa?this.ha():this[x].ka=!1),this[x].X},this.Ia=function(e){this.pc(this[x].X),this[x].ka=!0,e&&(this[x].sa=!0),this.qc(this,!e)}},s:function(){var e=this[x];!e.J&&e.I&&y.a.P(e.I,(function(e,t){t.s&&t.s()})),e.l&&e.Rb&&y.a.K.yb(e.l,e.Rb),e.I=r,e.V=0,e.ra=!0,e.sa=!1,e.ka=!1,e.J=!1,e.l=r,e.Sa=r,e.Wc=r,this.Nc||(e.nb=r)}},P={Qa:function(e){var t=this,n=t[x];if(!n.ra&&n.J&&"change"==e){if(n.J=!1,n.sa||t.Xa())n.I=null,n.V=0,t.ha()&&t.Gb();else{var i=[];y.a.P(n.I,(function(e,t){i[t.Ka]=e})),y.a.D(i,(function(e,i){var o=n.I[e],s=t.$c(o.da);s.Ka=i,s.La=o.La,n.I[e]=s})),t.Xa()&&t.ha()&&t.Gb()}n.ra||t.notifySubscribers(n.X,"awake")}},hb:function(e){var t=this[x];t.ra||"change"!=e||this.Wa("change")||(y.a.P(t.I,(function(e,n){n.s&&(t.I[e]={da:n.da,Ka:n.Ka,La:n.La},n.s())})),t.J=!0,this.notifySubscribers(r,"asleep"))},ob:function(){var e=this[x];return e.J&&(e.sa||this.Xa())&&this.ha(),y.T.fn.ob.call(this)}},A={Qa:function(e){"change"!=e&&"beforeChange"!=e||this.v()}};y.a.Ba&&y.a.setPrototypeOf(I,y.T.fn);var O=y.ta.Ma;I[O]=y.o,y.Oc=function(e){return"function"==typeof e&&e[O]===I[O]},y.Fd=function(e){return y.Oc(e)&&e[x]&&e[x].wb},y.b("computed",y.o),y.b("dependentObservable",y.o),y.b("isComputed",y.Oc),y.b("isPureComputed",y.Fd),y.b("computed.fn",I),y.L(I,"peek",I.v),y.L(I,"dispose",I.s),y.L(I,"isActive",I.ja),y.L(I,"getDependenciesCount",I.qa),y.L(I,"getDependencies",I.Va),y.xb=function(e,t){return"function"==typeof e?y.o(e,t,{pure:!0}):((e=y.a.extend({},e)).pure=!0,y.o(e,t))},y.b("pureComputed",y.xb),function(){function e(n,i,o){if(o=o||new t,"object"!=typeof(n=i(n))||null===n||n===r||n instanceof RegExp||n instanceof Date||n instanceof String||n instanceof Number||n instanceof Boolean)return n;var s=n instanceof Array?[]:{};return o.save(n,s),function(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(n in e)t(n)}(n,(function(t){var a=i(n[t]);switch(typeof a){case"boolean":case"number":case"string":case"function":s[t]=a;break;case"object":case"undefined":var l=o.get(a);s[t]=l!==r?l:e(a,i,o)}})),s}function t(){this.keys=[],this.values=[]}y.ad=function(t){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return e(t,(function(e){for(var t=0;y.O(e)&&10>t;t++)e=e();return e}))},y.toJSON=function(e,t,n){return e=y.ad(e),y.a.hc(e,t,n)},t.prototype={constructor:t,save:function(e,t){var n=y.a.A(this.keys,e);0<=n?this.values[n]=t:(this.keys.push(e),this.values.push(t))},get:function(e){return 0<=(e=y.a.A(this.keys,e))?this.values[e]:r}}}(),y.b("toJS",y.ad),y.b("toJSON",y.toJSON),y.Wd=function(e,t,n){function i(t){var i=y.xb(e,n).extend({ma:"always"}),o=i.subscribe((function(e){e&&(o.s(),t(e))}));return i.notifySubscribers(i.v()),o}return"function"!=typeof Promise||t?i(t.bind(n)):new Promise(i)},y.b("when",y.Wd),y.w={M:function(e){switch(y.a.R(e)){case"option":return!0===e.__ko__hasDomDataOptionValue__?y.a.g.get(e,y.c.options.$b):7>=y.a.W?e.getAttributeNode("value")&&e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return 0<=e.selectedIndex?y.w.M(e.options[e.selectedIndex]):r;default:return e.value}},cb:function(e,t,n){switch(y.a.R(e)){case"option":"string"==typeof t?(y.a.g.set(e,y.c.options.$b,r),"__ko__hasDomDataOptionValue__"in e&&delete e.__ko__hasDomDataOptionValue__,e.value=t):(y.a.g.set(e,y.c.options.$b,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:"");break;case"select":""!==t&&null!==t||(t=r);for(var i,o=-1,s=0,a=e.options.length;s<a;++s)if((i=y.w.M(e.options[s]))==t||""===i&&t===r){o=s;break}(n||0<=o||t===r&&1<e.size)&&(e.selectedIndex=o,6===y.a.W&&y.a.setTimeout((function(){e.selectedIndex=o}),0));break;default:null!==t&&t!==r||(t=""),e.value=t}}},y.b("selectExtensions",y.w),y.b("selectExtensions.readValue",y.w.M),y.b("selectExtensions.writeValue",y.w.cb),y.m=function(){function e(e){123===(e=y.a.Db(e)).charCodeAt(0)&&(e=e.slice(1,-1));var t,n=[],r=(e+="\n,").match(i),a=[],l=0;if(1<r.length){for(var c,h=0;c=r[h];++h){var u=c.charCodeAt(0);if(44===u){if(0>=l){n.push(t&&a.length?{key:t,value:a.join("")}:{unknown:t||a.join("")}),t=l=0,a=[];continue}}else if(58===u){if(!l&&!t&&1===a.length){t=a.pop();continue}}else{if(47===u&&1<c.length&&(47===c.charCodeAt(1)||42===c.charCodeAt(1)))continue;47===u&&h&&1<c.length?(u=r[h-1].match(o))&&!s[u[0]]&&(r=(e=e.substr(e.indexOf(c)+1)).match(i),h=-1,c="/"):40===u||123===u||91===u?++l:41===u||125===u||93===u?--l:t||a.length||34!==u&&39!==u||(c=c.slice(1,-1))}a.push(c)}if(0<l)throw Error("Unbalanced parentheses, braces, or brackets")}return n}var t=["true","false","null","undefined"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,i=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),o=/[\])"'A-Za-z0-9_$]+$/,s={in:1,return:1,typeof:1},r={};return{Ra:[],wa:r,ac:e,vb:function(i,o){function s(e,i){var o;if(!h){var u=y.getBindingHandler(e);if(u&&u.preprocess&&!(i=u.preprocess(i,e,s)))return;(u=r[e])&&(o=i,0<=y.a.A(t,o)?o=!1:(u=o.match(n),o=null!==u&&(u[1]?"Object("+u[1]+")"+u[2]:o)),u=o),u&&l.push("'"+("string"==typeof r[e]?r[e]:e)+"':function(_z){"+o+"=_z}")}c&&(i="function(){return "+i+" }"),a.push("'"+e+"':"+i)}var a=[],l=[],c=(o=o||{}).valueAccessors,h=o.bindingParams,u="string"==typeof i?e(i):i;return y.a.D(u,(function(e){s(e.key||e.unknown,e.value)})),l.length&&s("_ko_property_writers","{"+l.join(",")+" }"),a.join(",")},Id:function(e,t){for(var n=0;n<e.length;n++)if(e[n].key==t)return!0;return!1},eb:function(e,t,n,i,o){e&&y.O(e)?!y.Za(e)||o&&e.v()===i||e(i):(e=t.get("_ko_property_writers"))&&e[n]&&e[n](i)}}}(),y.b("expressionRewriting",y.m),y.b("expressionRewriting.bindingRewriteValidators",y.m.Ra),y.b("expressionRewriting.parseObjectLiteral",y.m.ac),y.b("expressionRewriting.preProcessBindings",y.m.vb),y.b("expressionRewriting._twoWayBindings",y.m.wa),y.b("jsonExpressionRewriting",y.m),y.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",y.m.vb),function(){function e(e){return 8==e.nodeType&&s.test(o?e.text:e.nodeValue)}function t(e){return 8==e.nodeType&&r.test(o?e.text:e.nodeValue)}function n(n,i){for(var o=n,s=1,r=[];o=o.nextSibling;){if(t(o)&&(y.a.g.set(o,c,!0),0==--s))return r;r.push(o),e(o)&&s++}if(!i)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function i(e,t){var i=n(e,t);return i?0<i.length?i[i.length-1].nextSibling:e.nextSibling:null}var o=l&&"\x3c!--test--\x3e"===l.createComment("test").text,s=o?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,r=o?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,a={ul:!0,ol:!0},c="__ko_matchedEndComment__";y.h={ea:{},childNodes:function(t){return e(t)?n(t):t.childNodes},Ea:function(t){if(e(t))for(var n=0,i=(t=y.h.childNodes(t)).length;n<i;n++)y.removeNode(t[n]);else y.a.Tb(t)},va:function(t,n){if(e(t)){y.h.Ea(t);for(var i=t.nextSibling,o=0,s=n.length;o<s;o++)i.parentNode.insertBefore(n[o],i)}else y.a.va(t,n)},Vc:function(t,n){var i;e(t)?(i=t.nextSibling,t=t.parentNode):i=t.firstChild,i?n!==i&&t.insertBefore(n,i):t.appendChild(n)},Wb:function(t,n,i){i?(i=i.nextSibling,e(t)&&(t=t.parentNode),i?n!==i&&t.insertBefore(n,i):t.appendChild(n)):y.h.Vc(t,n)},firstChild:function(n){if(e(n))return!n.nextSibling||t(n.nextSibling)?null:n.nextSibling;if(n.firstChild&&t(n.firstChild))throw Error("Found invalid end comment, as the first child of "+n);return n.firstChild},nextSibling:function(n){if(e(n)&&(n=i(n)),n.nextSibling&&t(n.nextSibling)){var o=n.nextSibling;if(t(o)&&!y.a.g.get(o,c))throw Error("Found end comment without a matching opening comment, as child of "+n);return null}return n.nextSibling},Cd:e,Vd:function(e){return(e=(o?e.text:e.nodeValue).match(s))?e[1]:null},Sc:function(n){if(a[y.a.R(n)]){var o=n.firstChild;if(o)do{if(1===o.nodeType){var s,r=null;if(s=o.firstChild)do{if(r)r.push(s);else if(e(s)){var l=i(s,!0);l?s=l:r=[s]}else t(s)&&(r=[s])}while(s=s.nextSibling);if(s=r)for(r=o.nextSibling,l=0;l<s.length;l++)r?n.insertBefore(s[l],r):n.appendChild(s[l])}}while(o=o.nextSibling)}}}}(),y.b("virtualElements",y.h),y.b("virtualElements.allowedBindings",y.h.ea),y.b("virtualElements.emptyNode",y.h.Ea),y.b("virtualElements.insertAfter",y.h.Wb),y.b("virtualElements.prepend",y.h.Vc),y.b("virtualElements.setDomNodeChildren",y.h.va),y.ga=function(){this.nd={}},y.a.extend(y.ga.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind")||y.j.getComponentNameForNode(e);case 8:return y.h.Cd(e);default:return!1}},getBindings:function(e,t){var n=(n=this.getBindingsString(e,t))?this.parseBindingsString(n,t,e):null;return y.j.tc(n,e,t,!1)},getBindingAccessors:function(e,t){var n=(n=this.getBindingsString(e,t))?this.parseBindingsString(n,t,e,{valueAccessors:!0}):null;return y.j.tc(n,e,t,!0)},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return y.h.Vd(e);default:return null}},parseBindingsString:function(e,t,n,i){try{var o,s=this.nd,r=e+(i&&i.valueAccessors||"");if(!(o=s[r])){var a,l="with($context){with($data||{}){return{"+y.m.vb(e,i)+"}}}";a=new Function("$context","$element",l),o=s[r]=a}return o(t,n)}catch(t){throw t.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+t.message,t}}}),y.ga.instance=new y.ga,y.b("bindingProvider",y.ga),function(){function e(e){var t=(e=y.a.g.get(e,S))&&e.N;t&&(e.N=null,t.Tc())}function t(t,n,i){this.node=t,this.yc=n,this.kb=[],this.H=!1,n.N||y.a.K.za(t,e),i&&i.N&&(i.N.kb.push(t),this.Kb=i)}function n(e){return function(){return e}}function i(e){return e()}function o(e){return y.a.Ga(y.u.G(e),(function(t,n){return function(){return e()[n]}}))}function s(e,t,i){return"function"==typeof e?o(e.bind(null,t,i)):y.a.Ga(e,n)}function c(e,t){return o(this.getBindings.bind(this,e,t))}function u(e,t){var n=y.h.firstChild(t);if(n){var i,o=y.ga.instance,s=o.preprocessNode;if(s){for(;i=n;)n=y.h.nextSibling(i),s.call(o,i);n=y.h.firstChild(t)}for(;i=n;)n=y.h.nextSibling(i),d(e,i)}y.i.ma(t,y.i.H)}function d(e,t){var n=e,i=1===t.nodeType;i&&y.h.Sc(t),(i||y.ga.instance.nodeHasBindings(t))&&(n=p(t,null,e).bindingContextForDescendants),n&&!w[y.a.R(t)]&&u(n,t)}function p(e,t,n){var o,s=y.a.g.Ub(e,S,{}),a=s.hd;if(!t){if(a)throw Error("You cannot apply bindings multiple times to the same element.");s.hd=!0}if(a||(s.context=n),s.Zb||(s.Zb={}),t&&"function"!=typeof t)o=t;else{var l=y.ga.instance,h=l.getBindingAccessors||c,u=y.$((function(){return(o=t?t(n,e):h.call(l,e,n))&&(n[g]&&n[g](),n[b]&&n[b]()),o}),null,{l:e});o&&u.ja()||(u=null)}var d,p=n;if(o){var f=function(){return y.a.Ga(u?u():o,i)},m=u?function(e){return function(){return i(u()[e])}}:function(e){return o[e]};f.get=function(e){return o[e]&&i(m(e))},f.has=function(e){return e in o},y.i.H in o&&y.i.subscribe(e,y.i.H,(function(){var t=(0,o[y.i.H])();if(t){var n=y.h.childNodes(e);n.length&&t(n,y.Ec(n[0]))}})),y.i.pa in o&&(p=y.i.Cb(e,n),y.i.subscribe(e,y.i.pa,(function(){var t=(0,o[y.i.pa])();t&&y.h.firstChild(e)&&t(e)}))),s=function(e){var t=[],n={},i=[];return y.a.P(e,(function o(s){if(!n[s]){var r=y.getBindingHandler(s);r&&(r.after&&(i.push(s),y.a.D(r.after,(function(t){if(e[t]){if(-1!==y.a.A(i,t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+i.join(", "));o(t)}})),i.length--),t.push({key:s,Mc:r})),n[s]=!0}})),t}(o),y.a.D(s,(function(t){var n=t.Mc.init,i=t.Mc.update,s=t.key;if(8===e.nodeType&&!y.h.ea[s])throw Error("The binding '"+s+"' cannot be used with virtual elements");try{"function"==typeof n&&y.u.G((function(){var t=n(e,m(s),f,p.$data,p);if(t&&t.controlsDescendantBindings){if(d!==r)throw Error("Multiple bindings ("+d+" and "+s+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");d=s}})),"function"==typeof i&&y.$((function(){i(e,m(s),f,p.$data,p)}),null,{l:e})}catch(e){throw e.message='Unable to process binding "'+s+": "+o[s]+'"\nMessage: '+e.message,e}}))}return{shouldBindDescendants:s=d===r,bindingContextForDescendants:s&&p}}function f(e,t){return e&&e instanceof y.fa?e:new y.fa(e,r,r,t)}var g=y.a.Da("_subscribable"),m=y.a.Da("_ancestorBindingInfo"),b=y.a.Da("_dataDependency");y.c={};var w={script:!0,textarea:!0,template:!0};y.getBindingHandler=function(e){return y.c[e]};var E={};y.fa=function(e,t,n,i,o){function s(){var e=u?h():h,o=y.a.f(e);return t?(y.a.extend(l,t),m in t&&(l[m]=t[m])):(l.$parents=[],l.$root=o,l.ko=y),l[g]=a,c?o=l.$data:(l.$rawData=e,l.$data=o),n&&(l[n]=o),i&&i(l,t,o),t&&t[g]&&!y.S.o().Vb(t[g])&&t[g](),d&&(l[b]=d),l.$data}var a,l=this,c=e===E,h=c?r:e,u="function"==typeof h&&!y.O(h),d=o&&o.dataDependency;o&&o.exportDependencies?s():((a=y.xb(s)).v(),a.ja()?a.equalityComparer=null:l[g]=r)},y.fa.prototype.createChildContext=function(e,t,n,i){if(!i&&t&&"object"==typeof t&&(t=(i=t).as,n=i.extend),t&&i&&i.noChildContext){var o="function"==typeof e&&!y.O(e);return new y.fa(E,this,null,(function(i){n&&n(i),i[t]=o?e():e}),i)}return new y.fa(e,this,t,(function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),n&&n(e)}),i)},y.fa.prototype.extend=function(e,t){return new y.fa(E,this,null,(function(t){y.a.extend(t,"function"==typeof e?e(t):e)}),t)};var S=y.a.g.Z();t.prototype.Tc=function(){this.Kb&&this.Kb.N&&this.Kb.N.sd(this.node)},t.prototype.sd=function(e){y.a.Pa(this.kb,e),!this.kb.length&&this.H&&this.Cc()},t.prototype.Cc=function(){this.H=!0,this.yc.N&&!this.kb.length&&(this.yc.N=null,y.a.K.yb(this.node,e),y.i.ma(this.node,y.i.pa),this.Tc())},y.i={H:"childrenComplete",pa:"descendantsComplete",subscribe:function(e,t,n,i,o){var s=y.a.g.Ub(e,S,{});return s.Fa||(s.Fa=new y.T),o&&o.notifyImmediately&&s.Zb[t]&&y.u.G(n,i,[e]),s.Fa.subscribe(n,i,t)},ma:function(e,t){var n=y.a.g.get(e,S);if(n&&(n.Zb[t]=!0,n.Fa&&n.Fa.notifySubscribers(e,t),t==y.i.H))if(n.N)n.N.Cc();else if(n.N===r&&n.Fa&&n.Fa.Wa(y.i.pa))throw Error("descendantsComplete event not supported for bindings on this node")},Cb:function(e,n){var i=y.a.g.Ub(e,S,{});return i.N||(i.N=new t(e,i,n[m])),n[m]==i?n:n.extend((function(e){e[m]=i}))}},y.Td=function(e){return(e=y.a.g.get(e,S))&&e.context},y.ib=function(e,t,n){return 1===e.nodeType&&y.h.Sc(e),p(e,t,f(n))},y.ld=function(e,t,n){return n=f(n),y.ib(e,s(t,n,e),n)},y.Oa=function(e,t){1!==t.nodeType&&8!==t.nodeType||u(f(e),t)},y.vc=function(e,t,n){if(!h&&a.jQuery&&(h=a.jQuery),2>arguments.length){if(!(t=l.body))throw Error("ko.applyBindings: could not find document.body; has the document been loaded?")}else if(!t||1!==t.nodeType&&8!==t.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");d(f(e,n),t)},y.Dc=function(e){return!e||1!==e.nodeType&&8!==e.nodeType?r:y.Td(e)},y.Ec=function(e){return(e=y.Dc(e))?e.$data:r},y.b("bindingHandlers",y.c),y.b("bindingEvent",y.i),y.b("bindingEvent.subscribe",y.i.subscribe),y.b("bindingEvent.startPossiblyAsyncContentBinding",y.i.Cb),y.b("applyBindings",y.vc),y.b("applyBindingsToDescendants",y.Oa),y.b("applyBindingAccessorsToNode",y.ib),y.b("applyBindingsToNode",y.ld),y.b("contextFor",y.Dc),y.b("dataFor",y.Ec)}(),function(e){function t(t,i){var r,a=Object.prototype.hasOwnProperty.call(o,t)?o[t]:e;a?a.subscribe(i):((a=o[t]=new y.T).subscribe(i),n(t,(function(e,n){var i=!(!n||!n.synchronous);s[t]={definition:e,Gd:i},delete o[t],r||i?a.notifySubscribers(e):y.na.zb((function(){a.notifySubscribers(e)}))})),r=!0)}function n(e,t){i("getConfig",[e],(function(n){n?i("loadComponent",[e,n],(function(e){t(e,n)})):t(null,null)}))}function i(t,n,o,s){s||(s=y.j.loaders.slice(0));var r=s.shift();if(r){var a=r[t];if(a){var l=!1;if(a.apply(r,n.concat((function(e){l?o(null):null!==e?o(e):i(t,n,o,s)})))!==e&&(l=!0,!r.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else i(t,n,o,s)}else o(null)}var o={},s={};y.j={get:function(n,i){var o=Object.prototype.hasOwnProperty.call(s,n)?s[n]:e;o?o.Gd?y.u.G((function(){i(o.definition)})):y.na.zb((function(){i(o.definition)})):t(n,i)},Bc:function(e){delete s[e]},oc:i},y.j.loaders=[],y.b("components",y.j),y.b("components.get",y.j.get),y.b("components.clearCachedDefinition",y.j.Bc)}(),function(){function e(e,t,n,i){function s(){0==--a&&i(r)}var r={},a=2,l=n.template;n=n.viewModel,l?o(t,l,(function(t){y.j.oc("loadTemplate",[e,t],(function(e){r.template=e,s()}))})):s(),n?o(t,n,(function(t){y.j.oc("loadViewModel",[e,t],(function(e){r[c]=e,s()}))})):s()}function n(e){switch(y.a.R(e)){case"script":return y.a.ua(e.text);case"textarea":return y.a.ua(e.value);case"template":if(i(e.content))return y.a.Ca(e.content.childNodes)}return y.a.Ca(e.childNodes)}function i(e){return a.DocumentFragment?e instanceof DocumentFragment:e&&11===e.nodeType}function o(e,n,i){"string"==typeof n.require?t||a.require?(t||a.require)([n.require],(function(e){e&&"object"==typeof e&&e.Xd&&e.default&&(e=e.default),i(e)})):e("Uses require, but no AMD loader is present"):i(n)}function s(e){return function(t){throw Error("Component '"+e+"': "+t)}}var r={};y.j.register=function(e,t){if(!t)throw Error("Invalid configuration for "+e);if(y.j.tb(e))throw Error("Component "+e+" is already registered");r[e]=t},y.j.tb=function(e){return Object.prototype.hasOwnProperty.call(r,e)},y.j.unregister=function(e){delete r[e],y.j.Bc(e)},y.j.Fc={getConfig:function(e,t){t(y.j.tb(e)?r[e]:null)},loadComponent:function(t,n,i){var r=s(t);o(r,n,(function(n){e(t,r,n,i)}))},loadTemplate:function(e,t,o){if(e=s(e),"string"==typeof t)o(y.a.ua(t));else if(t instanceof Array)o(t);else if(i(t))o(y.a.la(t.childNodes));else if(t.element)if(t=t.element,a.HTMLElement?t instanceof HTMLElement:t&&t.tagName&&1===t.nodeType)o(n(t));else if("string"==typeof t){var r=l.getElementById(t);r?o(n(r)):e("Cannot find element with ID "+t)}else e("Unknown element type: "+t);else e("Unknown template value: "+t)},loadViewModel:function(e,t,n){!function e(t,n,i){if("function"==typeof n)i((function(e){return new n(e)}));else if("function"==typeof n[c])i(n[c]);else if("instance"in n){var o=n.instance;i((function(){return o}))}else"viewModel"in n?e(t,n.viewModel,i):t("Unknown viewModel value: "+n)}(s(e),t,n)}};var c="createViewModel";y.b("components.register",y.j.register),y.b("components.isRegistered",y.j.tb),y.b("components.unregister",y.j.unregister),y.b("components.defaultLoader",y.j.Fc),y.j.loaders.push(y.j.Fc),y.j.dd=r}(),function(){function e(e,n){if(i=e.getAttribute("params")){var i=t.parseBindingsString(i,n,e,{valueAccessors:!0,bindingParams:!0}),o=(i=y.a.Ga(i,(function(t){return y.o(t,null,{l:e})})),y.a.Ga(i,(function(t){var n=t.v();return t.ja()?y.o({read:function(){return y.a.f(t())},write:y.Za(n)&&function(e){t()(e)},l:e}):n})));return Object.prototype.hasOwnProperty.call(o,"$raw")||(o.$raw=i),o}return{$raw:{}}}y.j.getComponentNameForNode=function(e){var t=y.a.R(e);if(y.j.tb(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+e||8>=y.a.W&&e.tagName===t))return t},y.j.tc=function(t,n,i,o){if(1===n.nodeType){var s=y.j.getComponentNameForNode(n);if(s){if((t=t||{}).component)throw Error('Cannot use the "component" binding on a custom element matching a component');var r={name:s,params:e(n,i)};t.component=o?function(){return r}:r}}return t};var t=new y.ga;9>y.a.W&&(y.j.register=function(e){return function(t){return e.apply(this,arguments)}}(y.j.register),l.createDocumentFragment=function(e){return function(){var t,n=e(),i=y.j.dd;for(t in i);return n}}(l.createDocumentFragment))}(),function(){var e=0;y.c.component={init:function(t,n,i,o,s){function r(){var e=a&&a.dispose;"function"==typeof e&&e.call(a),c&&c.s(),l=a=c=null}var a,l,c,h=y.a.la(y.h.childNodes(t));return y.h.Ea(t),y.a.K.za(t,r),y.o((function(){var i,o,u=y.a.f(n());if("string"==typeof u?i=u:(i=y.a.f(u.name),o=y.a.f(u.params)),!i)throw Error("No component name specified");var d=y.i.Cb(t,s),p=l=++e;y.j.get(i,(function(e){if(l===p){if(r(),!e)throw Error("Unknown component '"+i+"'");!function(e,t,n){if(!(t=t.template))throw Error("Component '"+e+"' has no template");e=y.a.Ca(t),y.h.va(n,e)}(i,e,t);var n=function(e,t,n){var i=e.createViewModel;return i?i.call(e,t,n):t}(e,o,{element:t,templateNodes:h});e=d.createChildContext(n,{extend:function(e){e.$component=n,e.$componentTemplateNodes=h}}),n&&n.koDescendantsComplete&&(c=y.i.subscribe(t,y.i.pa,n.koDescendantsComplete,n)),a=n,y.Oa(e,t)}}))}),null,{l:t}),{controlsDescendantBindings:!0}}},y.h.ea.component=!0}();var k={class:"className",for:"htmlFor"};y.c.attr={update:function(e,t){var n=y.a.f(t())||{};y.a.P(n,(function(t,n){n=y.a.f(n);var i=t.indexOf(":"),o=(i="lookupNamespaceURI"in e&&0<i&&e.lookupNamespaceURI(t.substr(0,i)),!1===n||null===n||n===r);o?i?e.removeAttributeNS(i,t):e.removeAttribute(t):n=n.toString(),8>=y.a.W&&t in k?(t=k[t],o?e.removeAttribute(t):e[t]=n):o||(i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)),"name"===t&&y.a.Yc(e,o?"":n)}))}},y.c.checked={after:["value","attr"],init:function(e,t,n){function i(){var i=e.checked,l=o();if(!y.S.Ya()&&(i||!a&&!y.S.qa())){var u=y.u.G(t);if(c){var p=h?u.v():u,f=d;d=l,f!==l?i&&(y.a.Na(p,l,!0),y.a.Na(p,f,!1)):y.a.Na(p,l,i),h&&y.Za(u)&&u(p)}else s&&(l===r?l=i:i||(l=r)),y.m.eb(u,n,"checked",l,!0)}}var o=y.xb((function(){return n.has("checkedValue")?y.a.f(n.get("checkedValue")):u?n.has("value")?y.a.f(n.get("value")):e.value:void 0})),s="checkbox"==e.type,a="radio"==e.type;if(s||a){var l=t(),c=s&&y.a.f(l)instanceof Array,h=!(c&&l.push&&l.splice),u=a||c,d=c?o():r;a&&!e.name&&y.c.uniqueName.init(e,(function(){return!0})),y.o(i,null,{l:e}),y.a.B(e,"click",i),y.o((function(){var n=y.a.f(t()),i=o();c?(e.checked=0<=y.a.A(n,i),d=i):e.checked=s&&i===r?!!n:o()===n}),null,{l:e}),l=r}}},y.m.wa.checked=!0,y.c.checkedValue={update:function(e,t){e.value=y.a.f(t())}},y.c.class={update:function(e,t){var n=y.a.Db(y.a.f(t()));y.a.Eb(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,y.a.Eb(e,n,!0)}},y.c.css={update:function(e,t){var n=y.a.f(t());null!==n&&"object"==typeof n?y.a.P(n,(function(t,n){n=y.a.f(n),y.a.Eb(e,t,n)})):y.c.class.update(e,t)}},y.c.enable={update:function(e,t){var n=y.a.f(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},y.c.disable={update:function(e,t){y.c.enable.update(e,(function(){return!y.a.f(t())}))}},y.c.event={init:function(e,t,n,i,o){var s=t()||{};y.a.P(s,(function(s){"string"==typeof s&&y.a.B(e,s,(function(e){var r,a=t()[s];if(a){try{var l=y.a.la(arguments);i=o.$data,l.unshift(i),r=a.apply(i,l)}finally{!0!==r&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===n.get(s+"Bubble")&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}}))}))}},y.c.foreach={Rc:function(e){return function(){var t=e(),n=y.a.bc(t);return n&&"number"!=typeof n.length?(y.a.f(t),{foreach:n.data,as:n.as,noChildContext:n.noChildContext,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:y.ba.Ma}):{foreach:t,templateEngine:y.ba.Ma}}},init:function(e,t){return y.c.template.init(e,y.c.foreach.Rc(t))},update:function(e,t,n,i,o){return y.c.template.update(e,y.c.foreach.Rc(t),n,i,o)}},y.m.Ra.foreach=!1,y.h.ea.foreach=!0,y.c.hasfocus={init:function(e,t,n){function i(i){e.__ko_hasfocusUpdating=!0;var o=e.ownerDocument;if("activeElement"in o){var s;try{s=o.activeElement}catch(e){s=o.body}i=s===e}o=t(),y.m.eb(o,n,"hasfocus",i,!0),e.__ko_hasfocusLastValue=i,e.__ko_hasfocusUpdating=!1}var o=i.bind(null,!0),s=i.bind(null,!1);y.a.B(e,"focus",o),y.a.B(e,"focusin",o),y.a.B(e,"blur",s),y.a.B(e,"focusout",s),e.__ko_hasfocusLastValue=!1},update:function(e,t){var n=!!y.a.f(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===n||(n?e.focus():e.blur(),!n&&e.__ko_hasfocusLastValue&&e.ownerDocument.body.focus(),y.u.G(y.a.Fb,null,[e,n?"focusin":"focusout"]))}},y.m.wa.hasfocus=!0,y.c.hasFocus=y.c.hasfocus,y.m.wa.hasFocus="hasfocus",y.c.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){y.a.fc(e,t())}},function(){function e(e,t,n){y.c[e]={init:function(e,i,o,s,r){var a,l,c,h,u,d={};if(t){s=o.get("as");var p=o.get("noChildContext");d={as:s,noChildContext:p,exportDependencies:u=!(s&&p)}}return h=(c="render"==o.get("completeOn"))||o.has(y.i.pa),y.o((function(){var o,s=y.a.f(i()),p=!n!=!s,f=!l;(u||p!==a)&&(h&&(r=y.i.Cb(e,r)),p&&(t&&!u||(d.dataDependency=y.S.o()),o=t?r.createChildContext("function"==typeof s?s:i,d):y.S.qa()?r.extend(null,d):r),f&&y.S.qa()&&(l=y.a.Ca(y.h.childNodes(e),!0)),p?(f||y.h.va(e,y.a.Ca(l)),y.Oa(o,e)):(y.h.Ea(e),c||y.i.ma(e,y.i.H)),a=p)}),null,{l:e}),{controlsDescendantBindings:!0}}},y.m.Ra[e]=!1,y.h.ea[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)}(),y.c.let={init:function(e,t,n,i,o){return t=o.extend(t),y.Oa(t,e),{controlsDescendantBindings:!0}}},y.h.ea.let=!0;var R={};y.c.options={init:function(e){if("select"!==y.a.R(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(e,t,n){function i(){return y.a.jb(e.options,(function(e){return e.selected}))}function o(e,t,n){var i=typeof t;return"function"==i?t(e):"string"==i?e[t]:n}function s(t,n){if(f&&h)y.i.ma(e,y.i.H);else if(p.length){var i=0<=y.a.A(p,y.w.M(n[0]));y.a.Zc(n[0],i),f&&!i&&y.u.G(y.a.Fb,null,[e,"change"])}}var a=e.multiple,l=0!=e.length&&a?e.scrollTop:null,c=y.a.f(t()),h=n.get("valueAllowUnset")&&n.has("value"),u=n.get("optionsIncludeDestroyed");t={};var d,p=[];h||(a?p=y.a.Mb(i(),y.w.M):0<=e.selectedIndex&&p.push(y.w.M(e.options[e.selectedIndex]))),c&&(void 0===c.length&&(c=[c]),d=y.a.jb(c,(function(e){return u||e===r||null===e||!y.a.f(e._destroy)})),n.has("optionsCaption")&&null!==(c=y.a.f(n.get("optionsCaption")))&&c!==r&&d.unshift(R));var f=!1;t.beforeRemove=function(t){e.removeChild(t)},c=s,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(c=function(e,t){s(0,t),y.u.G(n.get("optionsAfterRender"),null,[t[0],e!==R?e:r])}),y.a.ec(e,d,(function(t,i,s){return s.length&&(p=!h&&s[0].selected?[y.w.M(s[0])]:[],f=!0),i=e.ownerDocument.createElement("option"),t===R?(y.a.Bb(i,n.get("optionsCaption")),y.w.cb(i,r)):(s=o(t,n.get("optionsValue"),t),y.w.cb(i,y.a.f(s)),t=o(t,n.get("optionsText"),s),y.a.Bb(i,t)),[i]}),t,c),h||(a?p.length&&i().length<p.length:p.length&&0<=e.selectedIndex?y.w.M(e.options[e.selectedIndex])!==p[0]:p.length||0<=e.selectedIndex)&&y.u.G(y.a.Fb,null,[e,"change"]),(h||y.S.Ya())&&y.i.ma(e,y.i.H),y.a.wd(e),l&&20<Math.abs(l-e.scrollTop)&&(e.scrollTop=l)}},y.c.options.$b=y.a.g.Z(),y.c.selectedOptions={init:function(e,t,n){function i(){var i=t(),o=[];y.a.D(e.getElementsByTagName("option"),(function(e){e.selected&&o.push(y.w.M(e))})),y.m.eb(i,n,"selectedOptions",o)}function o(){var n=y.a.f(t()),i=e.scrollTop;n&&"number"==typeof n.length&&y.a.D(e.getElementsByTagName("option"),(function(e){var t=0<=y.a.A(n,y.w.M(e));e.selected!=t&&y.a.Zc(e,t)})),e.scrollTop=i}if("select"!=y.a.R(e))throw Error("selectedOptions binding applies only to SELECT elements");var s;y.i.subscribe(e,y.i.H,(function(){s?i():(y.a.B(e,"change",i),s=y.o(o,null,{l:e}))}),null,{notifyImmediately:!0})},update:function(){}},y.m.wa.selectedOptions=!0,y.c.style={update:function(e,t){var n=y.a.f(t()||{});y.a.P(n,(function(t,n){if(null!==(n=y.a.f(n))&&n!==r&&!1!==n||(n=""),h)h(e).css(t,n);else if(/^--/.test(t))e.style.setProperty(t,n);else{t=t.replace(/-(\w)/g,(function(e,t){return t.toUpperCase()}));var i=e.style[t];e.style[t]=n,n===i||e.style[t]!=i||isNaN(n)||(e.style[t]=n+"px")}}))}},y.c.submit={init:function(e,t,n,i,o){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");y.a.B(e,"submit",(function(n){var i,s=t();try{i=s.call(o.$data,e)}finally{!0!==i&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}}))}},y.c.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){y.a.Bb(e,t())}},y.h.ea.text=!0,function(){if(a&&a.navigator){var e,t,n,i,o,s=function(e){if(e)return parseFloat(e[1])},l=a.navigator.userAgent;(e=a.opera&&a.opera.version&&parseInt(a.opera.version()))||(o=s(l.match(/Edge\/([^ ]+)$/)))||s(l.match(/Chrome\/([^ ]+)/))||(t=s(l.match(/Version\/([^ ]+) Safari/)))||(n=s(l.match(/Firefox\/([^ ]+)/)))||(i=y.a.W||s(l.match(/MSIE ([^ ]+)/)))||(i=s(l.match(/rv:([^ )]+)/)))}if(8<=i&&10>i)var c=y.a.g.Z(),h=y.a.g.Z(),u=function(e){var t=this.activeElement;(t=t&&y.a.g.get(t,h))&&t(e)},d=function(e,t){var n=e.ownerDocument;y.a.g.get(n,c)||(y.a.g.set(n,c,!0),y.a.B(n,"selectionchange",u)),y.a.g.set(e,h,t)};y.c.textInput={init:function(s,a,l){function c(e,t){y.a.B(s,e,t)}function h(){p||(f=s.value,p=y.a.setTimeout(u,4))}function u(){clearTimeout(p),f=p=r;var e=s.value;g!==e&&(g=e,y.m.eb(a(),l,"textInput",e))}var p,f,g=s.value,m=9==y.a.W?h:u,b=!1;i&&c("keypress",u),11>i&&c("propertychange",(function(e){b||"value"!==e.propertyName||m(e)})),8==i&&(c("keyup",u),c("keydown",u)),d&&(d(s,m),c("dragend",h)),(!i||9<=i)&&c("input",m),5>t&&"textarea"===y.a.R(s)?(c("keydown",h),c("paste",h),c("cut",h)):11>e?c("keydown",h):4>n?(c("DOMAutoComplete",u),c("dragdrop",u),c("drop",u)):o&&"number"===s.type&&c("keydown",h),c("change",u),c("blur",u),y.o((function e(){var t=y.a.f(a());null!==t&&t!==r||(t=""),f!==r&&t===f?y.a.setTimeout(e,4):s.value!==t&&(b=!0,s.value=t,b=!1,g=s.value)}),null,{l:s})}},y.m.wa.textInput=!0,y.c.textinput={preprocess:function(e,t,n){n("textInput",e)}}}(),y.c.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++y.c.uniqueName.rd;y.a.Yc(e,n)}}},y.c.uniqueName.rd=0,y.c.using={init:function(e,t,n,i,o){var s;return n.has("as")&&(s={as:n.get("as"),noChildContext:n.get("noChildContext")}),t=o.createChildContext(t,s),y.Oa(t,e),{controlsDescendantBindings:!0}}},y.h.ea.using=!0,y.c.value={init:function(e,t,n){var i=y.a.R(e),o="input"==i;if(!o||"checkbox"!=e.type&&"radio"!=e.type){var s=[],a=n.get("valueUpdate"),l=!1,c=null;a&&(s="string"==typeof a?[a]:y.a.wc(a),y.a.Pa(s,"change"));var h,u,d=function(){c=null,l=!1;var i=t(),o=y.w.M(e);y.m.eb(i,n,"value",o)};!y.a.W||!o||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=y.a.A(s,"propertychange")||(y.a.B(e,"propertychange",(function(){l=!0})),y.a.B(e,"focus",(function(){l=!1})),y.a.B(e,"blur",(function(){l&&d()}))),y.a.D(s,(function(t){var n=d;y.a.Ud(t,"after")&&(n=function(){c=y.w.M(e),y.a.setTimeout(d,0)},t=t.substring(5)),y.a.B(e,t,n)})),h=o&&"file"==e.type?function(){var n=y.a.f(t());null===n||n===r||""===n?e.value="":y.u.G(d)}:function(){var o=y.a.f(t()),s=y.w.M(e);null!==c&&o===c?y.a.setTimeout(h,0):o===s&&s!==r||("select"===i?(s=n.get("valueAllowUnset"),y.w.cb(e,o,s),s||o===y.w.M(e)||y.u.G(d)):y.w.cb(e,o))},"select"===i?y.i.subscribe(e,y.i.H,(function(){u?n.get("valueAllowUnset")?h():d():(y.a.B(e,"change",d),u=y.o(h,null,{l:e}))}),null,{notifyImmediately:!0}):(y.a.B(e,"change",d),y.o(h,null,{l:e}))}else y.ib(e,{checkedValue:t})},update:function(){}},y.m.wa.value=!0,y.c.visible={update:function(e,t){var n=y.a.f(t()),i="none"!=e.style.display;n&&!i?e.style.display="":!n&&i&&(e.style.display="none")}},y.c.hidden={update:function(e,t){y.c.visible.update(e,(function(){return!y.a.f(t())}))}},function(e){y.c[e]={init:function(t,n,i,o,s){return y.c.event.init.call(this,t,(function(){var t={};return t[e]=n(),t}),i,o,s)}}}("click"),y.ca=function(){},y.ca.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},y.ca.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},y.ca.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){var n=(t=t||l).getElementById(e);if(!n)throw Error("Cannot find template with ID "+e);return new y.C.F(n)}if(1==e.nodeType||8==e.nodeType)return new y.C.ia(e);throw Error("Unknown template type: "+e)},y.ca.prototype.renderTemplate=function(e,t,n,i){return e=this.makeTemplateSource(e,i),this.renderTemplateSource(e,t,n,i)},y.ca.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting||this.makeTemplateSource(e,t).data("isRewritten")},y.ca.prototype.rewriteTemplate=function(e,t,n){t=t((e=this.makeTemplateSource(e,n)).text()),e.text(t),e.data("isRewritten",!0)},y.b("templateEngine",y.ca),y.kc=function(){function e(e,t,n,i){e=y.m.ac(e);for(var o=y.m.Ra,s=0;s<e.length;s++){var r=e[s].key;if(Object.prototype.hasOwnProperty.call(o,r)){var a=o[r];if("function"==typeof a){if(r=a(e[s].value))throw Error(r)}else if(!a)throw Error("This template engine does not support the '"+r+"' binding within its templates")}}return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+y.m.vb(e,{valueAccessors:!0})+" } })()},'"+n.toLowerCase()+"')",i.createJavaScriptEvaluatorBlock(n)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,n=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{xd:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,(function(e){return y.kc.Ld(e,t)}),n)},Ld:function(i,o){return i.replace(t,(function(t,n,i,s,r){return e(r,n,i,o)})).replace(n,(function(t,n){return e(n,"\x3c!-- ko --\x3e","#comment",o)}))},md:function(e,t){return y.aa.Xb((function(n,i){var o=n.nextSibling;o&&o.nodeName.toLowerCase()===t&&y.ib(o,e,i)}))}}}(),y.b("__tr_ambtns",y.kc.md),function(){y.C={},y.C.F=function(e){if(this.F=e){var t=y.a.R(e);this.ab="script"===t?1:"textarea"===t?2:"template"==t&&e.content&&11===e.content.nodeType?3:4}},y.C.F.prototype.text=function(){var e=1===this.ab?"text":2===this.ab?"value":"innerHTML";if(0==arguments.length)return this.F[e];var t=arguments[0];"innerHTML"===e?y.a.fc(this.F,t):this.F[e]=t};var e=y.a.g.Z()+"_";y.C.F.prototype.data=function(t){if(1===arguments.length)return y.a.g.get(this.F,e+t);y.a.g.set(this.F,e+t,arguments[1])};var t=y.a.g.Z();y.C.F.prototype.nodes=function(){var e=this.F;if(0==arguments.length){var n=y.a.g.get(e,t)||{},i=n.lb||(3===this.ab?e.content:4===this.ab?e:r);if(!i||n.jd){var o=this.text();o&&o!==n.bb&&(i=y.a.Md(o,e.ownerDocument),y.a.g.set(e,t,{lb:i,bb:o,jd:!0}))}return i}n=arguments[0],this.ab!==r&&this.text(""),y.a.g.set(e,t,{lb:n})},y.C.ia=function(e){this.F=e},y.C.ia.prototype=new y.C.F,y.C.ia.prototype.constructor=y.C.ia,y.C.ia.prototype.text=function(){if(0==arguments.length){var e=y.a.g.get(this.F,t)||{};return e.bb===r&&e.lb&&(e.bb=e.lb.innerHTML),e.bb}y.a.g.set(this.F,t,{bb:arguments[0]})},y.b("templateSources",y.C),y.b("templateSources.domElement",y.C.F),y.b("templateSources.anonymousTemplate",y.C.ia)}(),function(){function e(e,t,n){var i;for(t=y.h.nextSibling(t);e&&(i=e)!==t;)n(i,e=y.h.nextSibling(i))}function t(t,n){if(t.length){var i=t[0],o=t[t.length-1],s=i.parentNode,r=y.ga.instance,a=r.preprocessNode;if(a){if(e(i,o,(function(e,t){var n=e.previousSibling,s=a.call(r,e);s&&(e===i&&(i=s[0]||t),e===o&&(o=s[s.length-1]||n))})),t.length=0,!i)return;i===o?t.push(i):(t.push(i,o),y.a.Ua(t,s))}e(i,o,(function(e){1!==e.nodeType&&8!==e.nodeType||y.vc(n,e)})),e(i,o,(function(e){1!==e.nodeType&&8!==e.nodeType||y.aa.cd(e,[n])})),y.a.Ua(t,s)}}function n(e){return e.nodeType?e:0<e.length?e[0]:null}function i(e,i,o,r,a){a=a||{};var l=(e&&n(e)||o||{}).ownerDocument,c=a.templateEngine||s;if(y.kc.xd(o,c,l),"number"!=typeof(o=c.renderTemplate(o,r,a,l)).length||0<o.length&&"number"!=typeof o[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(l=!1,i){case"replaceChildren":y.h.va(e,o),l=!0;break;case"replaceNode":y.a.Xc(e,o),l=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+i)}return l&&(t(o,r),a.afterRender&&y.u.G(a.afterRender,null,[o,r[a.as||"$data"]]),"replaceChildren"==i&&y.i.ma(e,y.i.H)),o}function o(e,t,n){return y.O(e)?e():"function"==typeof e?e(t,n):e}var s;y.gc=function(e){if(e!=r&&!(e instanceof y.ca))throw Error("templateEngine must inherit from ko.templateEngine");s=e},y.dc=function(e,t,a,l,c){if(((a=a||{}).templateEngine||s)==r)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",l){var h=n(l);return y.$((function(){var s=t&&t instanceof y.fa?t:new y.fa(t,null,null,null,{exportDependencies:!0}),r=o(e,s.$data,s);s=i(l,c,r,s,a),"replaceNode"==c&&(h=n(l=s))}),null,{Sa:function(){return!h||!y.a.Sb(h)},l:h&&"replaceNode"==c?h.parentNode:h})}return y.aa.Xb((function(n){y.dc(e,t,a,n,"replaceNode")}))},y.Qd=function(e,n,s,a,l){function c(e,t){y.u.G(y.a.ec,null,[a,e,u,s,h,t]),y.i.ma(a,y.i.H)}function h(e,n){t(n,d),s.afterRender&&s.afterRender(n,e),d=null}function u(t,n){d=l.createChildContext(t,{as:p,noChildContext:s.noChildContext,extend:function(e){e.$index=n,p&&(e[p+"Index"]=n)}});var r=o(e,t,d);return i(a,"ignoreTargetNode",r,d,s)}var d,p=s.as,f=!1===s.includeDestroyed||y.options.foreachHidesDestroyed&&!s.includeDestroyed;if(f||s.beforeRemove||!y.Pc(n))return y.$((function(){var e=y.a.f(n)||[];void 0===e.length&&(e=[e]),f&&(e=y.a.jb(e,(function(e){return e===r||null===e||!y.a.f(e._destroy)}))),c(e)}),null,{l:a});c(n.v());var g=n.subscribe((function(e){c(n(),e)}),null,"arrayChange");return g.l(a),g};var a=y.a.g.Z(),l=y.a.g.Z();y.c.template={init:function(e,t){var n=y.a.f(t());if("string"==typeof n||"name"in n)y.h.Ea(e);else if("nodes"in n){if(n=n.nodes||[],y.O(n))throw Error('The "nodes" option must be a plain, non-observable array.');var i=n[0]&&n[0].parentNode;i&&y.a.g.get(i,l)||(i=y.a.Yb(n),y.a.g.set(i,l,!0)),new y.C.ia(e).nodes(i)}else{if(!(0<(n=y.h.childNodes(e)).length))throw Error("Anonymous template defined, but no template content was provided");i=y.a.Yb(n),new y.C.ia(e).nodes(i)}return{controlsDescendantBindings:!0}},update:function(e,t,n,i,o){var s=t();n=!0,i=null,"string"==typeof(t=y.a.f(s))?t={}:(s="name"in t?t.name:e,"if"in t&&(n=y.a.f(t.if)),n&&"ifnot"in t&&(n=!y.a.f(t.ifnot)),n&&!s&&(n=!1)),"foreach"in t?i=y.Qd(s,n&&t.foreach||[],t,e,o):n?(n=o,"data"in t&&(n=o.createChildContext(t.data,{as:t.as,noChildContext:t.noChildContext,exportDependencies:!0})),i=y.dc(s,n,t,e)):y.h.Ea(e),o=i,(t=y.a.g.get(e,a))&&"function"==typeof t.s&&t.s(),y.a.g.set(e,a,!o||o.ja&&!o.ja()?r:o)}},y.m.Ra.template=function(e){return 1==(e=y.m.ac(e)).length&&e[0].unknown||y.m.Id(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},y.h.ea.template=!0}(),y.b("setTemplateEngine",y.gc),y.b("renderTemplate",y.dc),y.a.Kc=function(e,t,n){var i,o,s,r,a;if(e.length&&t.length)for(i=o=0;(!n||i<n)&&(r=e[o]);++o){for(s=0;a=t[s];++s)if(r.value===a.value){r.moved=a.index,a.moved=r.index,t.splice(s,1),i=s=0;break}i+=s}},y.a.Pb=function(){function e(e,t,n,i,o){var s,r,a,l,c,h=Math.min,u=Math.max,d=[],p=e.length,f=t.length,g=f-p||1,m=p+f+1;for(s=0;s<=p;s++)for(l=a,d.push(a=[]),c=h(f,s+g),r=u(0,s-1);r<=c;r++)a[r]=r?s?e[s-1]===t[r-1]?l[r-1]:h(l[r]||m,a[r-1]||m)+1:r+1:s+1;for(h=[],u=[],g=[],s=p,r=f;s||r;)f=d[s][r]-1,r&&f===d[s][r-1]?u.push(h[h.length]={status:n,value:t[--r],index:r}):s&&f===d[s-1][r]?g.push(h[h.length]={status:i,value:e[--s],index:s}):(--r,--s,o.sparse||h.push({status:"retained",value:t[r]}));return y.a.Kc(g,u,!o.dontLimitMoves&&10*p),h.reverse()}return function(t,n,i){return i="boolean"==typeof i?{dontLimitMoves:i}:i||{},n=n||[],(t=t||[]).length<n.length?e(t,n,"added","deleted",i):e(n,t,"deleted","added",i)}}(),y.b("utils.compareArrays",y.a.Pb),function(){function e(e,t,n,i,o){var s=[],a=y.$((function(){var r=t(n,o,y.a.Ua(s,e))||[];0<s.length&&(y.a.Xc(s,r),i&&y.u.G(i,null,[n,r,o])),s.length=0,y.a.Nb(s,r)}),null,{l:e,Sa:function(){return!y.a.kd(s)}});return{Y:s,$:a.ja()?a:r}}var t=y.a.g.Z(),n=y.a.g.Z();y.a.ec=function(i,o,s,a,l,c){function h(e){p={Aa:e,pb:y.ta(N++)},E.push(p),w||I.push(p)}function u(e){p=b[e],N!==p.pb.v()&&x.push(p),p.pb(N++),y.a.Ua(p.Y,i),E.push(p)}function d(e,t){if(e)for(var n=0,i=t.length;n<i;n++)y.a.D(t[n].Y,(function(i){e(i,n,t[n].Aa)}))}void 0===(o=o||[]).length&&(o=[o]),a=a||{};var p,f,g,m,b=y.a.g.get(i,t),w=!b,E=[],S=0,N=0,C=[],v=[],T=[],x=[],I=[],P=0;if(w)y.a.D(o,h);else{if(!c||b&&b._countWaitingForRemove){var A=y.a.Mb(b,(function(e){return e.Aa}));c=y.a.Pb(A,o,{dontLimitMoves:a.dontLimitMoves,sparse:!0})}var O,k,R;for(A=0;O=c[A];A++)switch(k=O.moved,R=O.index,O.status){case"deleted":for(;S<R;)u(S++);k===r&&((p=b[S]).$&&(p.$.s(),p.$=r),y.a.Ua(p.Y,i).length&&(a.beforeRemove&&(E.push(p),P++,p.Aa===n?p=null:T.push(p)),p&&C.push.apply(C,p.Y))),S++;break;case"added":for(;N<R;)u(S++);k!==r?(v.push(E.length),u(k)):h(O.value)}for(;N<o.length;)u(S++);E._countWaitingForRemove=P}y.a.g.set(i,t,E),d(a.beforeMove,x),y.a.D(C,a.beforeRemove?y.oa:y.removeNode);try{m=i.ownerDocument.activeElement}catch(e){}if(v.length)for(;(A=v.shift())!=r;){for(p=E[A],f=r;A;)if((g=E[--A].Y)&&g.length){f=g[g.length-1];break}for(o=0;S=p.Y[o];f=S,o++)y.h.Wb(i,S,f)}for(A=0;p=E[A];A++){for(p.Y||y.a.extend(p,e(i,s,p.Aa,l,p.pb)),o=0;S=p.Y[o];f=S,o++)y.h.Wb(i,S,f);!p.Ed&&l&&(l(p.Aa,p.Y,p.pb),p.Ed=!0,f=p.Y[p.Y.length-1])}for(m&&i.ownerDocument.activeElement!=m&&m.focus(),d(a.beforeRemove,T),A=0;A<T.length;++A)T[A].Aa=n;d(a.afterMove,x),d(a.afterAdd,I)}}(),y.b("utils.setDomNodeChildrenFromArrayMapping",y.a.ec),y.ba=function(){this.allowTemplateRewriting=!1},y.ba.prototype=new y.ca,y.ba.prototype.constructor=y.ba,y.ba.prototype.renderTemplateSource=function(e,t,n,i){return(t=9>y.a.W||!e.nodes?null:e.nodes())?y.a.la(t.cloneNode(!0).childNodes):(e=e.text(),y.a.ua(e,i))},y.ba.Ma=new y.ba,y.gc(y.ba.Ma),y.b("nativeTemplateEngine",y.ba),function(){y.$a=function(){var e=this.Hd=function(){if(!h||!h.tmpl)return 0;try{if(0<=h.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,n,i,o){if(o=o||l,i=i||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var s=t.data("precompiled");return s||(s=t.text()||"",s=h.template(null,"{{ko_with $item.koBindingContext}}"+s+"{{/ko_with}}"),t.data("precompiled",s)),t=[n.$data],n=h.extend({koBindingContext:n},i.templateOptions),(n=h.tmpl(s,t,n)).appendTo(o.createElement("div")),h.fragments={},n},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){l.write("<script type='text/html' id='"+e+"'>"+t+"<\/script>")},0<e&&(h.tmpl.tag.ko_code={open:"__.push($1 || '');"},h.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},y.$a.prototype=new y.ca,y.$a.prototype.constructor=y.$a;var e=new y.$a;0<e.Hd&&y.gc(e),y.b("jqueryTmplTemplateEngine",y.$a)}()}))}()},function(e,t,n){window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t,n){"use strict";n.d(t,"m",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"o",(function(){return c})),n.d(t,"w",(function(){return u})),n.d(t,"k",(function(){return d})),n.d(t,"f",(function(){return f})),n.d(t,"r",(function(){return g})),n.d(t,"i",(function(){return m})),n.d(t,"h",(function(){return b})),n.d(t,"g",(function(){return w})),n.d(t,"a",(function(){return E})),n.d(t,"l",(function(){return y})),n.d(t,"j",(function(){return N})),n.d(t,"b",(function(){return C})),n.d(t,"e",(function(){return v})),n.d(t,"c",(function(){return T})),n.d(t,"x",(function(){return x})),n.d(t,"n",(function(){return I})),n.d(t,"t",(function(){return P})),n.d(t,"s",(function(){return A})),n.d(t,"q",(function(){return O})),n.d(t,"p",(function(){return k})),n.d(t,"u",(function(){return R})),n.d(t,"v",(function(){return F}));var i=n(1),o=n(4);class s{visitValues(e){for(let t=0;t<e.length;t++)e[t].visit(this)}visitEmpty(e){throw new Error("E_CSS_EMPTY_NOT_ALLOWED")}visitSlash(e){throw new Error("E_CSS_SLASH_NOT_ALLOWED")}visitStr(e){throw new Error("E_CSS_STR_NOT_ALLOWED")}visitIdent(e){throw new Error("E_CSS_IDENT_NOT_ALLOWED")}visitNumeric(e){throw new Error("E_CSS_NUMERIC_NOT_ALLOWED")}visitNum(e){throw new Error("E_CSS_NUM_NOT_ALLOWED")}visitInt(e){return this.visitNum(e)}visitColor(e){throw new Error("E_CSS_COLOR_NOT_ALLOWED")}visitURL(e){throw new Error("E_CSS_URL_NOT_ALLOWED")}visitSpaceList(e){throw new Error("E_CSS_LIST_NOT_ALLOWED")}visitCommaList(e){throw new Error("E_CSS_COMMA_NOT_ALLOWED")}visitFunc(e){throw new Error("E_CSS_FUNC_NOT_ALLOWED")}visitExpr(e){throw new Error("E_CSS_EXPR_NOT_ALLOWED")}}class r extends s{constructor(){super()}visitValues(e){let t=null;for(let n=0;n<e.length;n++){const i=e[n],o=i.visit(this);if(t)t[n]=o;else if(i!==o){t=new Array(e.length);for(let i=0;i<n;i++)t[i]=e[i];t[n]=o}}return t||e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitColor(e){return e}visitURL(e){return e}visitSpaceList(e){const t=this.visitValues(e.values);return t===e.values?e:new N(t)}visitCommaList(e){const t=this.visitValues(e.values);return t===e.values?e:new C(t)}visitFunc(e){const t=this.visitValues(e.values);return t===e.values?e:new v(e.name,t)}visitExpr(e){return e}}class a{toString(){const e=new i.d;return this.appendTo(e,!0),e.toString()}stringValue(){const e=new i.d;return this.appendTo(e,!1),e.toString()}toExpr(e,t){throw new Error("F_ABSTRACT")}appendTo(e,t){e.append("[error]")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(e){throw new Error("F_ABSTRACT")}}class l extends a{constructor(){super()}static get instance(){return this.empty||(this.empty=new l),this.empty}toExpr(e,t){return new o.f(e,"")}appendTo(e,t){}visit(e){return e.visitEmpty(this)}}const c=l.instance;class h extends a{constructor(){super()}static get instance(){return this.slash||(this.slash=new h),this.slash}toExpr(e,t){return new o.f(e,"/")}appendTo(e,t){e.append("/")}visit(e){return e.visitSlash(this)}}const u=h.instance;class d extends a{constructor(e){super(),this.str=e}toExpr(e,t){return new o.f(e,this.str)}appendTo(e,t){t?(e.append('"'),e.append(i.q(this.str)),e.append('"')):e.append(this.str)}visit(e){return e.visitStr(this)}}const p={};class f extends a{constructor(e){if(super(),this.name=e,p[e])throw new Error("E_INVALID_CALL");p[e]=this}toExpr(e,t){return new o.f(e,this.name)}appendTo(e,t){t?e.append(i.p(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}}function g(e){let t=p[e];return t||(t=new f(e)),t}class m extends a{constructor(e,t){super(),this.num=e,this.unit=t.toLowerCase()}toExpr(e,t){return 0==this.num?e.zero:t&&"%"==this.unit?100==this.num?t:new o.r(e,t,new o.f(e,this.num/100)):new o.x(e,this.num,this.unit)}appendTo(e,t){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}}class b extends a{constructor(e){super(),this.num=e}toExpr(e,t){return 0==this.num?e.zero:1==this.num?e.one:new o.f(e,this.num)}appendTo(e,t){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}}class w extends b{constructor(e){super(e)}visit(e){return e.visitInt(this)}}class E extends a{constructor(e){super(),this.rgb=e}appendTo(e,t){e.append("#");const n=this.rgb.toString(16);e.append("000000".substr(n.length)),e.append(n)}visit(e){return e.visitColor(this)}}class y extends a{constructor(e){super(),this.url=e}appendTo(e,t){e.append('url("'),e.append(i.q(this.url)),e.append('")')}visit(e){return e.visitURL(this)}}function S(e,t,n,i){const o=t.length;t[0].appendTo(e,i);for(let s=1;s<o;s++)e.append(n),t[s].appendTo(e,i)}class N extends a{constructor(e){super(),this.values=e}appendTo(e,t){S(e,this.values," ",t)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}}class C extends a{constructor(e){super(),this.values=e}appendTo(e,t){S(e,this.values,",",t)}visit(e){return e.visitCommaList(this)}}class v extends a{constructor(e,t){super(),this.name=e,this.values=t}appendTo(e,t){e.append(i.p(this.name)),e.append("("),S(e,this.values,",",t),e.append(")")}visit(e){return e.visitFunc(this)}}class T extends a{constructor(e){super(),this.expr=e}toExpr(){return this.expr}appendTo(e,t){e.append("-epubx-expr("),this.expr.appendTo(e,0),e.append(")")}visit(e){return e.visitExpr(this)}isExpr(){return!0}}function x(e,t){if(e){if(e.isNumeric()){const n=e;return t.queryUnitSize(n.unit,!1)*n.num}if(e.isNum())return e.num}return 0}function I(e,t){return new m(x(e,t),"px")}const P={absolute:g("absolute"),all:g("all"),always:g("always"),auto:g("auto"),avoid:g("avoid"),balance:g("balance"),balance_all:g("balance-all"),block:g("block"),block_end:g("block-end"),block_start:g("block-start"),both:g("both"),bottom:g("bottom"),border_box:g("border-box"),break_all:g("break-all"),break_word:g("break-word"),crop:g("crop"),cross:g("cross"),column:g("column"),exclusive:g("exclusive"),_false:g("false"),fixed:g("fixed"),flex:g("flex"),footnote:g("footnote"),footer:g("footer"),header:g("header"),hidden:g("hidden"),horizontal_tb:g("horizontal-tb"),inherit:g("inherit"),inline:g("inline"),inline_block:g("inline-block"),inline_end:g("inline-end"),inline_start:g("inline-start"),landscape:g("landscape"),left:g("left"),line:g("line"),list_item:g("list-item"),ltr:g("ltr"),manual:g("manual"),none:g("none"),normal:g("normal"),oeb_page_foot:g("oeb-page-foot"),oeb_page_head:g("oeb-page-head"),page:g("page"),relative:g("relative"),right:g("right"),same:g("same"),scale:g("scale"),snap_block:g("snap-block"),spread:g("spread"),_static:g("static"),rtl:g("rtl"),table:g("table"),table_caption:g("table-caption"),table_cell:g("table-cell"),table_footer_group:g("table-footer-group"),table_header_group:g("table-header-group"),table_row:g("table-row"),top:g("top"),transparent:g("transparent"),vertical_lr:g("vertical-lr"),vertical_rl:g("vertical-rl"),visible:g("visible"),_true:g("true")},A=new m(100,"%"),O=new m(100,"pvw"),k=new m(100,"pvh"),R=new m(0,"px"),L={"font-size":1,color:2};function F(e,t){return(L[e]||Number.MAX_VALUE)-(L[t]||Number.MAX_VALUE)}},function(e,t,n){"use strict";n.d(t,"o",(function(){return o})),n.d(t,"H",(function(){return s})),n.d(t,"I",(function(){return r})),n.d(t,"h",(function(){return a})),n.d(t,"E",(function(){return l})),n.d(t,"D",(function(){return c})),n.d(t,"G",(function(){return h})),n.d(t,"C",(function(){return u})),n.d(t,"n",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return g})),n.d(t,"v",(function(){return E})),n.d(t,"F",(function(){return y})),n.d(t,"t",(function(){return S})),n.d(t,"u",(function(){return N})),n.d(t,"d",(function(){return C})),n.d(t,"p",(function(){return T})),n.d(t,"q",(function(){return x})),n.d(t,"y",(function(){return I})),n.d(t,"x",(function(){return P})),n.d(t,"r",(function(){return A})),n.d(t,"s",(function(){return O})),n.d(t,"J",(function(){return k})),n.d(t,"i",(function(){return R})),n.d(t,"B",(function(){return L})),n.d(t,"e",(function(){return D})),n.d(t,"w",(function(){return _})),n.d(t,"f",(function(){return B})),n.d(t,"A",(function(){return M})),n.d(t,"z",(function(){return U})),n.d(t,"c",(function(){return z})),n.d(t,"m",(function(){return H})),n.d(t,"j",(function(){return $})),n.d(t,"k",(function(){return X})),n.d(t,"l",(function(){return K}));var i=n(6);let o={};function s(e){return JSON.parse(e)}function r(e){const t=e.match(/^([^#]*)/);return t?t[1]:e}let a=window.location.href;function l(e){a=e}let c=window.location.href;function h(e){c=e}function u(e,t){if(t.startsWith("data:"))return e||t;if(!t||e.match(/^\w{2,}:/))return e.toLowerCase().match("^javascript:")?"#":(e.match(/^\w{2,}:\/\/[^\/]+$/)&&(e=`${e}/`),e);let n;if(t.match(/^\w{2,}:\/\/[^\/]+$/)&&(t=`${t}/`),e.match(/^\/\//))return(n=t.match(/^(\w{2,}:)\/\//))?n[1]+e:e;if(e.match(/^\//))return(n=t.match(/^(\w{2,}:\/\/[^\/]+)\//))?n[1]+e:e;if(e.match(/^\.(\/|$)/)&&(e=e.substr(2)),t=function(e){const t=e.match(/^([^#?]*)/);return t?t[1]:e}(t),e.match(/^#/))return t+e;let i=t.lastIndexOf("/");if(i<0)return e;if(i<t.length-1&&t.lastIndexOf(".")<i){if(""==e)return t;i=(t+="/").length-1}let o=t.substr(0,i+1)+e,s="";for((n=o.match(/^([^?#]*)([?#].*)$/))&&(o=n[1],s=n[2]);!((i=o.indexOf("/../"))<=0);){const e=o.lastIndexOf("/",i-1);if(e<=0)break;o=o.substr(0,e)+o.substr(i+3)}return o.replace(/\/(\.\/)+/g,"/")+s}function d(e){let t;return(t=/^(https?:)\/\/github\.com\/([^/]+\/[^/]+)\/(blob\/|tree\/|raw\/)?(.*)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?"":"master/"}${t[4]}`:(t=/^(https?:)\/\/www\.aozora\.gr\.jp\/(cards\/[^/]+\/files\/[^/.]+\.html)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(\/|$)(raw(\/|$))?(.*)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\/\/(?:[^/.]+\.)?jsbin\.com\/(?!(?:blog|help)\b)(\w+)((\/\d+)?).*$/.exec(e))&&(e=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),e}var p;function f(e){return null==e?e:e.toString()}!function(e){e.FB2="http://www.gribuser.ru/xml/fictionbook/2.0",e.epub="http://www.idpf.org/2007/ops",e.EV="http://www.w3.org/2001/xml-events",e.MATHML="http://www.w3.org/1998/Math/MathML",e.XML="http://www.w3.org/XML/1998/namespace",e.XHTML="http://www.w3.org/1999/xhtml",e.XLINK="http://www.w3.org/1999/xlink",e.SHADOW="http://www.pyroxy.com/ns/shadow",e.SVG="http://www.w3.org/2000/svg",e.DC="http://purl.org/dc/elements/1.1/",e.NCX="http://www.daisy.org/z3986/2005/ncx/",e.SSE="http://example.com/sse"}(p||(p={}));class g{constructor(){this.queue=[null]}length(){return this.queue.length-1}add(e){let t=this.queue.length;for(;t>1;){const n=Math.floor(t/2),i=this.queue[n];if(i.compare(e)>0)return void(this.queue[t]=e);this.queue[t]=i,t=n}this.queue[1]=e}peek(){return this.queue[1]}remove(){const e=this.queue[1],t=this.queue.pop(),n=this.queue.length;if(n>1){let e=1;for(;;){let i=2*e;if(i>=n)break;if(this.queue[i].compare(t)>0)i+1<n&&this.queue[i+1].compare(this.queue[i])>0&&i++;else{if(!(i+1<n&&this.queue[i+1].compare(t)>0))break;i++}this.queue[e]=this.queue[i],e=i}this.queue[e]=t}return e}}const m=["","-webkit-","-moz-","-ms-","-o-","-epub-"],b={};function w(e,t){if("writing-mode"===t){const n=document.createElement("span");return"-ms-"===e?(n.style.setProperty(e+t,"tb-rl"),"tb-rl"===n.style["writing-mode"]):(n.style.setProperty(e+t,"vertical-rl"),"vertical-rl"===n.style[e+t])}return"string"==typeof document.documentElement.style[function(e,t){return e&&(t=`-${t}`,"moz"===(e=e.replace(/-/g,""))&&(e="Moz")),e+t.replace(/-[a-z]/g,e=>e.substr(1).toUpperCase())}(e,t)]}function E(e){let t=b[e];if(t||null===t)return t;switch(e){case"text-combine-upright":if(w("-webkit-","text-combine")&&!w("","text-combine-upright"))return b[e]=["-webkit-text-combine"],["-webkit-text-combine"];break;case"writing-mode":if(w("-ms-","writing-mode"))return b[e]=["-ms-writing-mode"],["-ms-writing-mode"];break;case"filter":if(w("-webkit-","filter"))return b[e]=["-webkit-filter"],["-webkit-filter"];break;case"clip-path":if(w("-webkit-","clip-path"))return b[e]=["-webkit-clip-path","clip-path"];break;case"margin-inline-start":if(w("-webkit-","margin-start"))return b[e]=["-webkit-margin-start"],["-webkit-margin-start"];break;case"margin-inline-end":if(w("-webkit-","margin-end"))return b[e]=["-webkit-margin-end"],["-webkit-margin-end"];break;case"padding-inline-start":if(w("-webkit-","padding-start"))return b[e]=["-webkit-padding-start"],["-webkit-padding-start"];break;case"padding-inline-end":if(w("-webkit-","padding-end"))return b[e]=["-webkit-padding-end"],["-webkit-padding-end"]}for(const n of m)if(w(n,e))return t=n+e,b[e]=[t],[t];return i.b.warn("Property not supported by the browser: ",e),b[e]=null,null}function y(e,t,n){try{const i=E(t);if(!i)return;i.forEach(t=>{if("-ms-writing-mode"===t)switch(n){case"horizontal-tb":n="lr-tb";break;case"vertical-rl":n="tb-rl";break;case"vertical-lr":n="tb-lr"}else if("-webkit-text-combine"===t)switch(n){case"all":n="horizontal"}e&&e.style&&e.style.setProperty(t,n)})}catch(e){i.b.warn(e)}}function S(e,t,n){try{const n=b[t];return e.style.getPropertyValue(n?n[0]:t)}catch(e){}return n||""}function N(e){let t=e.getAttributeNS(p.XML,"lang");return t||e.namespaceURI!=p.XHTML||(t=e.getAttribute("lang")),t}class C{constructor(){this.list=[]}append(e){return this.list.push(e),this}clear(){this.list=[]}toString(){const e=this.list.join("");return this.list=[e],e}}function v(e){return`\\${e.charCodeAt(0).toString(16)} `}function T(e){return e.replace(/[^-_a-zA-Z0-9\u0080-\uFFFF]/g,v)}function x(e){return e.replace(/[\u0000-\u001F"\\]/g,v)}function I(e){return e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent)}function P(e){return!!e.match(/^[a-zA-Z\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]$/)}function A(e,t){return e.replace(/[^-a-zA-Z0-9_]/g,(function(e){return function(e,t){return(t="string"==typeof t?t:"\\u")+(65536|e.charCodeAt(0)).toString(16).substr(1)}(e,t)}))}function O(e){return A(e)}function k(e,t){t="string"==typeof t?t:"\\u";const n=new RegExp(`${O(t)}[0-9a-fA-F]{4}`,"g");return e.replace(n,(function(e){return function(e,t){return t="string"==typeof t?t:"\\u",0===e.indexOf(t)?String.fromCharCode(parseInt(e.substring(t.length),16)):e}(e,t)}))}function R(e,t){let n=0,i=e;for(;;){if(n==i)return n;const e=n+i>>1;t(e)?i=e:n=e+1}}function L(e,t){return e-t}const F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function D(e,t){const n=t.length,i=3*Math.floor(n/3);for(let n=0;n<i;n+=3){const i=255&t.charCodeAt(n),o=255&t.charCodeAt(n+1),s=255&t.charCodeAt(n+2);e.append(F.charAt(i>>2)),e.append(F.charAt(63&(i<<4|o>>4))),e.append(F.charAt(63&(o<<2|s>>6))),e.append(F.charAt(63&s))}switch(n-i){case 1:{const n=255&t.charCodeAt(i);e.append(F.charAt(n>>2)),e.append(F.charAt(n<<4&63)),e.append("==");break}case 2:{const n=255&t.charCodeAt(i),o=255&t.charCodeAt(i+1);e.append(F.charAt(n>>2)),e.append(F.charAt(63&(n<<4|o>>4))),e.append(F.charAt(o<<2&63)),e.append("=");break}}}function _(e,t){const n={};for(const i of e){const e=t(i);e&&!n[e]&&(n[e]=i)}return n}function B(e){const t={};for(let n=0;n<e.length;n++)t[e[n]]=!0;return t}function M(e,t){const n={};for(const i of e){const e=t(i);e&&(n[e]?n[e].push(i):n[e]=[i])}return n}function U(e,t){const n={};for(const i in e)n[i]=t(e[i],i);return n}class z{constructor(){this.listeners={}}dispatchEvent(e){const t=this.listeners[e.type];if(t){e.target=this,e.currentTarget=this;for(let n=0;n<t.length;n++)t[n](e)}}addEventListener(e,t,n){if(n)return;const i=this.listeners[e];i?i.push(t):this.listeners[e]=[t]}removeEventListener(e,t,n){if(n)return;const i=this.listeners[e];if(i){const e=i.indexOf(t);e>=0&&i.splice(e,1)}}}let V=null;function H(e){if(null==V){const t=e.ownerDocument,n=t.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.width="100px",n.style.height="100px",n.style.overflow="hidden",n.style.lineHeight="16px",n.style.fontSize="16px",y(n,"writing-mode","vertical-rl"),e.appendChild(n);const i=t.createTextNode("a a a a a a a a a a a a a a a a");n.appendChild(i);const o=t.createRange();o.setStart(i,0),o.setEnd(i,1);const s=o.getBoundingClientRect();V=s.right-s.left<10,e.removeChild(n)}return V}let G=null;function $(e){if(null===G){const t=e.ownerDocument,n=t.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.width="30px",n.style.height="100px",n.style.lineHeight="16px",n.style.fontSize="16px",n.style.textAlign="justify",e.appendChild(n);const i=t.createTextNode("a | ");n.appendChild(i);const o=t.createElement("span");o.style.display="inline-block",o.style.width="30px",n.appendChild(o);const s=t.createRange();s.setStart(i,0),s.setEnd(i,3);const r=s.getBoundingClientRect();G=r.right<27,e.removeChild(n)}return G}let W=null;function X(e){if(null===W){const t=e.ownerDocument,n=t.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.width="40px",n.style.height="100px",n.style.lineHeight="16px",n.style.fontSize="16px",n.style.textAlign="justify",e.appendChild(n);const i=t.createTextNode("a a-");n.appendChild(i);const o=t.createElement("span");o.style.display="inline-block",o.style.width="40px",n.appendChild(o);const s=t.createRange();s.setStart(i,2),s.setEnd(i,4);const r=s.getBoundingClientRect();W=r.right<37,e.removeChild(n)}return W}let j=null;function K(e){if(null===j){const t=e.ownerDocument,n=t.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.width="40px",n.style.height="100px",n.style.lineHeight="16px",n.style.fontSize="16px",n.style.textAlign="justify",e.appendChild(n);const i=t.createTextNode("a a-");n.appendChild(i),n.appendChild(t.createElement("wbr"));const o=t.createElement("span");o.style.display="inline-block",o.style.width="40px",n.appendChild(o);const s=t.createRange();s.setStart(i,2),s.setEnd(i,4);const r=s.getBoundingClientRect();j=r.right<37,e.removeChild(n)}return j}},function(e,t,n){"use strict";function i(e){if((e=e.substr(1)).match(/^[^0-9a-fA-F\n\r]$/))return e;const t=parseInt(e,16);return isNaN(t)?"":t<=65535?String.fromCharCode(t):t<=1114111?String.fromCharCode(55296|t>>10&1023,56320|1023&t):"�"}function o(e){return e.replace(/\\([0-9a-fA-F]{0,6}(\r\n|[ \n\r\t\f])?|[^0-9a-fA-F\n\r])/g,i)}var s,r;n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return M})),function(e){e[e.EOF=0]="EOF",e[e.IDENT=1]="IDENT",e[e.STR=2]="STR",e[e.NUMERIC=3]="NUMERIC",e[e.NUM=4]="NUM",e[e.INT=5]="INT",e[e.FUNC=6]="FUNC",e[e.HASH=7]="HASH",e[e.URL=8]="URL",e[e.CLASS=9]="CLASS",e[e.O_PAR=10]="O_PAR",e[e.C_PAR=11]="C_PAR",e[e.O_BRC=12]="O_BRC",e[e.C_BRC=13]="C_BRC",e[e.O_BRK=14]="O_BRK",e[e.C_BRK=15]="C_BRK",e[e.COMMA=16]="COMMA",e[e.SEMICOL=17]="SEMICOL",e[e.COLON=18]="COLON",e[e.SLASH=19]="SLASH",e[e.AT=20]="AT",e[e.PERCENT=21]="PERCENT",e[e.QMARK=22]="QMARK",e[e.PLUS=23]="PLUS",e[e.MINUS=24]="MINUS",e[e.BAR_BAR=25]="BAR_BAR",e[e.AMP_AMP=26]="AMP_AMP",e[e.BANG=31]="BANG",e[e.DOLLAR=32]="DOLLAR",e[e.HAT=33]="HAT",e[e.BAR=34]="BAR",e[e.TILDE=35]="TILDE",e[e.STAR=36]="STAR",e[e.GT=37]="GT",e[e.LT=38]="LT",e[e.EQ=39]="EQ",e[e.BANG_EQ=41]="BANG_EQ",e[e.DOLLAR_EQ=42]="DOLLAR_EQ",e[e.HAT_EQ=43]="HAT_EQ",e[e.BAR_EQ=44]="BAR_EQ",e[e.TILDE_EQ=45]="TILDE_EQ",e[e.STAR_EQ=46]="STAR_EQ",e[e.GT_EQ=47]="GT_EQ",e[e.LT_EQ=48]="LT_EQ",e[e.EQ_EQ=49]="EQ_EQ",e[e.COL_COL=50]="COL_COL",e[e.INVALID=51]="INVALID",e[e.LAST=51]="LAST"}(s||(s={}));class a{constructor(){this.precededBySpace=!1,this.num=0,this.text="",this.position=0,this.type=s.EOF}}function l(e,t){const n=Array(128);let i;for(i=0;i<128;i++)n[i]=e;for(n.NaN=e==r.END?r.END:r.INVALID,i=0;i<t.length;i+=2)n[t[i]]=t[i+1];return n}!function(e){e[e.SPACE=1]="SPACE",e[e.INT=2]="INT",e[e.IDENT=3]="IDENT",e[e.BANG=4]="BANG",e[e.HASH=6]="HASH",e[e.DOLLAR=7]="DOLLAR",e[e.PERCENT=8]="PERCENT",e[e.AMP=9]="AMP",e[e.O_PAR=10]="O_PAR",e[e.C_PAR=11]="C_PAR",e[e.STAR=12]="STAR",e[e.PLUS=13]="PLUS",e[e.COMMA=14]="COMMA",e[e.MINUS=15]="MINUS",e[e.DOT=16]="DOT",e[e.SLASH=17]="SLASH",e[e.COLON=18]="COLON",e[e.SEMICOL=19]="SEMICOL",e[e.LT=20]="LT",e[e.EQ=21]="EQ",e[e.GT=22]="GT",e[e.QMARK=23]="QMARK",e[e.AT=24]="AT",e[e.O_BRK=25]="O_BRK",e[e.C_BRK=26]="C_BRK",e[e.O_BRC=27]="O_BRC",e[e.C_BRC=28]="C_BRC",e[e.BSLASH=29]="BSLASH",e[e.HAT=30]="HAT",e[e.BAR=31]="BAR",e[e.TILDE=32]="TILDE",e[e.STR1=33]="STR1",e[e.STR2=34]="STR2",e[e.END=35]="END",e[e.EQTAIL=36]="EQTAIL",e[e.ENDINT=37]="ENDINT",e[e.ENDNUM=38]="ENDNUM",e[e.CONT=39]="CONT",e[e.UNIT=40]="UNIT",e[e.PCUNIT=41]="PCUNIT",e[e.NUMBER=42]="NUMBER",e[e.ENDIDNT=43]="ENDIDNT",e[e.IDNTESC=44]="IDNTESC",e[e.ENDIDES=45]="ENDIDES",e[e.ENDSTR=46]="ENDSTR",e[e.ENDESTR=47]="ENDESTR",e[e.STR1ESC=48]="STR1ESC",e[e.STR2ESC=49]="STR2ESC",e[e.BAR_BAR=50]="BAR_BAR",e[e.AMP_AMP=51]="AMP_AMP",e[e.FUNC=52]="FUNC",e[e.FUNCES=53]="FUNCES",e[e.COMMENT=54]="COMMENT",e[e.COMMST=55]="COMMST",e[e.ENDNOTK=56]="ENDNOTK",e[e.MINMIN=57]="MINMIN",e[e.TOINT=58]="TOINT",e[e.TONUM=59]="TONUM",e[e.TOIDENT=60]="TOIDENT",e[e.TOIDES=61]="TOIDES",e[e.KILL1=62]="KILL1",e[e.KILL2=63]="KILL2",e[e.URL=64]="URL",e[e.URL1=65]="URL1",e[e.URL2=66]="URL2",e[e.ENDURL=67]="ENDURL",e[e.TERMURL=68]="TERMURL",e[e.FINURL=69]="FINURL",e[e.LT_BG=70]="LT_BG",e[e.LT_BG_M=71]="LT_BG_M",e[e.INVALID=72]="INVALID",e[e.CHKPOSS=73]="CHKPOSS",e[e.CHKPOSN=74]="CHKPOSN",e[e.URLESC=75]="URLESC",e[e.IDESCH=76]="IDESCH",e[e.COL_COL=77]="COL_COL",e[e.TOCLASS=78]="TOCLASS",e[e.CHKSP=79]="CHKSP",e[e.EOF=80]="EOF"}(r||(r={}));const c=[r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.SPACE,r.SPACE,r.INVALID,r.SPACE,r.SPACE,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.SPACE,r.BANG,r.STR2,r.HASH,r.DOLLAR,r.PERCENT,r.AMP,r.STR1,r.O_PAR,r.C_PAR,r.STAR,r.PLUS,r.COMMA,r.MINUS,r.DOT,r.SLASH,r.INT,r.INT,r.INT,r.INT,r.INT,r.INT,r.INT,r.INT,r.INT,r.INT,r.COLON,r.SEMICOL,r.LT,r.EQ,r.GT,r.QMARK,r.AT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.O_BRK,r.BSLASH,r.C_BRK,r.HAT,r.IDENT,r.INVALID,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.IDENT,r.O_BRC,r.BAR,r.C_BRC,r.TILDE,r.INVALID];c.NaN=r.EOF;const h=[r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.FUNC,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.CONT,r.ENDIDNT,r.ENDIDNT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDIDNT,r.IDNTESC,r.ENDIDNT,r.ENDIDNT,r.CONT,r.ENDIDNT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT,r.ENDIDNT];h.NaN=r.ENDIDNT;const u=[r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.TOCLASS,r.TONUM,r.INVALID,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.TONUM,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.INVALID,r.TOIDES,r.INVALID,r.INVALID,r.TOCLASS,r.INVALID,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.TOCLASS,r.INVALID,r.INVALID,r.INVALID,r.INVALID,r.INVALID];h.NaN=r.ENDIDNT;const d=[r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.MINMIN,r.TONUM,r.END,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.TOINT,r.END,r.END,r.END,r.END,r.END,r.END,r.END,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.END,r.TOIDES,r.END,r.END,r.TOIDENT,r.END,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.TOIDENT,r.END,r.END,r.END,r.END,r.END];d.NaN=r.END;const p=[r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.CHKPOSS,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.CHKPOSS,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.FUNCES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDIDES,r.IDNTESC,r.ENDIDES,r.ENDIDES,r.CONT,r.ENDIDES,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES,r.ENDIDES];p.NaN=r.ENDIDES;const f=[r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.PCUNIT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.NUMBER,r.ENDINT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.UNIT,r.ENDINT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT,r.ENDINT];f.NaN=r.ENDINT;const g=[r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.PCUNIT,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.CONT,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.UNIT,r.ENDNUM,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.UNIT,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM,r.ENDNUM];g.NaN=r.ENDNUM;const m=l(r.END,[61,r.EQTAIL]),b=l(r.END,[58,r.COL_COL]),w=l(r.END,[61,r.EQTAIL,124,r.BAR_BAR]),E=l(r.END,[38,r.AMP_AMP]),y=l(r.END,[42,r.COMMENT]),S=l(r.CONT,[42,r.COMMST]),N=l(r.COMMENT,[42,r.COMMST,47,r.ENDNOTK]),C=l(r.KILL1,[62,r.ENDNOTK]),v=l(r.END,[61,r.EQTAIL,33,r.LT_BG]),T=l(r.KILL1,[45,r.LT_BG_M]),x=l(r.KILL2,[45,r.ENDNOTK]),I=l(r.IDESCH,[9,r.INVALID,10,r.INVALID,13,r.INVALID,32,r.INVALID]),P=l(r.CONT,[39,r.ENDSTR,10,r.INVALID,13,r.INVALID,92,r.STR1ESC]),A=l(r.CONT,[34,r.ENDSTR,10,r.INVALID,13,r.INVALID,92,r.STR2ESC]),O=l(r.CONT,[39,r.ENDESTR,10,r.CHKPOSN,13,r.CHKPOSN,92,r.STR1ESC]),k=l(r.CONT,[34,r.ENDESTR,10,r.CHKPOSN,13,r.CHKPOSN,92,r.STR2ESC]),R=l(r.URL,[9,r.CONT,32,r.CONT,34,r.URL2,39,r.URL1,41,r.INVALID,10,r.CONT,13,r.CONT]),L=l(r.CONT,[41,r.ENDURL,9,r.CHKSP,10,r.CHKSP,13,r.CHKSP,32,r.CHKSP,92,r.URLESC,40,r.INVALID,91,r.INVALID,93,r.INVALID,123,r.INVALID,125,r.INVALID,NaN,r.ENDURL]),F=l(r.CONT,[39,r.TERMURL,10,r.CHKPOSN,13,r.CHKPOSN,92,r.URLESC,NaN,r.ENDURL]),D=l(r.CONT,[34,r.TERMURL,10,r.CHKPOSN,13,r.CHKPOSN,92,r.URLESC,NaN,r.ENDURL]),_=l(r.INVALID,[9,r.CONT,10,r.CONT,13,r.CONT,32,r.CONT,41,r.FINURL]),B=15;class M{constructor(e,t){this.input=e,this.handler=t,this.head=-1,this.tail=0,this.curr=0,this.position=0,this.indexMask=B,this.buffer=Array(this.indexMask+1);for(let e=0;e<=this.indexMask;e++)this.buffer[e]=new a}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(e){return(this.tail-this.curr&this.indexMask)<=e&&this.fillBuffer(),this.buffer[this.curr+e&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}mark(){if(this.head>=0)throw new Error("F_CSSTOK_BAD_CALL mark");this.head=this.curr}reset(){if(this.head<0)throw new Error("F_CSSTOK_BAD_CALL reset");this.curr=this.head,this.head=-1}unmark(){this.head=-1}hasMark(){return this.head>=0}reallocate(){const e=2*(this.indexMask+1)-1,t=Array(e+1);let n=this.head,i=0;for(;n!=this.tail;)t[i]=this.buffer[n],n==this.curr&&(this.curr=i),n=n+1&this.indexMask,i++;for(this.head=0,this.tail=i,this.indexMask=e,this.buffer=t;i<=e;)t[i++]=new a}error(e,t,n){this.handler&&this.handler.error(n,t)}fillBuffer(){let e=this.tail,t=this.head>=0?this.head:this.curr,n=this.indexMask;if(e>=t?t+=n:t--,t==e){if(this.head<0)throw new Error("F_CSSTOK_INTERNAL");this.reallocate(),e=this.tail,t=n=this.indexMask}let i=c;const a=this.input;let l=this.position;const B=this.buffer;let M=s.EOF,U=0,z="",V=0,H=!1,G=B[e],$=-9;for(;;){const W=a.charCodeAt(l);switch(i[W]||i[65]){case r.INVALID:M=s.INVALID,z=isNaN(W)?"E_CSS_UNEXPECTED_EOF":"E_CSS_UNEXPECTED_CHAR",i=c,l++;break;case r.SPACE:l++,H=!0;continue;case r.INT:U=l++,i=f;continue;case r.IDENT:M=s.IDENT,U=l++,i=h;continue;case r.BANG:U=l++,M=s.BANG,i=m;continue;case r.STR1:M=s.STR,U=++l,i=P;continue;case r.STR2:M=s.STR,U=++l,i=A;continue;case r.HASH:U=++l,M=s.HASH,i=h;continue;case r.DOLLAR:U=l++,M=s.DOLLAR,i=m;continue;case r.PERCENT:U=l++,M=s.PERCENT;break;case r.AMP:U=l++,M=s.DOLLAR,i=E;continue;case r.O_PAR:U=l++,M=s.O_PAR;break;case r.C_PAR:U=l++,M=s.C_PAR;break;case r.STAR:U=l++,M=s.STAR,i=m;continue;case r.PLUS:U=l++,M=s.PLUS;break;case r.COMMA:U=l++,M=s.COMMA;break;case r.MINUS:M=s.MINUS,U=l++,i=d;continue;case r.DOT:U=l++,i=u;continue;case r.TOCLASS:U=l++,M=s.CLASS,i=h;continue;case r.SLASH:U=l++,M=s.SLASH,i=y;continue;case r.COLON:U=l++,M=s.COLON,i=b;continue;case r.COL_COL:l++,M=s.COL_COL;break;case r.SEMICOL:U=l++,M=s.SEMICOL;break;case r.LT:U=l++,M=s.LT,i=v;continue;case r.EQ:U=l++,M=s.EQ,i=m;continue;case r.GT:U=l++,M=s.GT,i=m;continue;case r.QMARK:U=l++,M=s.QMARK;break;case r.AT:U=++l,M=s.AT,i=h;continue;case r.O_BRK:U=l++,M=s.O_BRK;break;case r.C_BRK:U=l++,M=s.C_BRK;break;case r.O_BRC:U=l++,M=s.O_BRC;break;case r.C_BRC:U=l++,M=s.C_BRC;break;case r.BSLASH:$=U=l++,M=s.IDENT,i=I;continue;case r.HAT:U=l++,M=s.HAT,i=m;continue;case r.BAR:U=l++,M=s.BAR,i=w;continue;case r.TILDE:U=l++,M=s.TILDE,i=m;continue;case r.END:break;case r.EQTAIL:l++,M=M+s.BANG_EQ-s.BANG;break;case r.ENDINT:M=s.INT,V=parseInt(a.substring(U,l),10);break;case r.ENDNUM:M=s.NUM,V=parseFloat(a.substring(U,l));break;case r.CONT:l++;continue;case r.UNIT:M=s.NUMERIC,V=parseFloat(a.substring(U,l)),U=l++,i=h;continue;case r.PCUNIT:M=s.NUMERIC,V=parseFloat(a.substring(U,l)),z="%",U=l++;break;case r.NUMBER:l++,i=g;continue;case r.ENDIDNT:z=a.substring(U,l);break;case r.IDNTESC:$=l++,i=I;continue;case r.ENDIDES:z=o(a.substring(U,l));break;case r.ENDSTR:z=a.substring(U,l),l++;break;case r.ENDESTR:z=o(a.substring(U,l)),l++;break;case r.STR1ESC:$=l,l+=2,i=O;continue;case r.STR2ESC:$=l,l+=2,i=k;continue;case r.BAR_BAR:l++,M=s.BAR_BAR;break;case r.AMP_AMP:l++,M=s.AMP_AMP;break;case r.FUNC:if(z=a.substring(U,l),M==s.IDENT){if(l++,"url"==z.toLowerCase()){i=R;continue}M=s.FUNC}break;case r.FUNCES:if(z=o(a.substring(U,l)),M==s.IDENT){if(l++,"url"==z.toLowerCase()){i=R;continue}M=s.FUNC}break;case r.COMMENT:i=S,l++;continue;case r.COMMST:i=N,l++;continue;case r.ENDNOTK:i=c,l++;continue;case r.MINMIN:i=C,l++;continue;case r.TOINT:M=s.INT,i=f,l++;continue;case r.TONUM:M=s.NUM,i=g,l++;continue;case r.TOIDENT:M=s.IDENT,i=h,l++;continue;case r.TOIDES:M=s.IDENT,i=I,$=l++;continue;case r.KILL1:l--;break;case r.KILL2:l-=2;break;case r.URL:U=l++,i=L;continue;case r.URL1:U=++l,i=F;continue;case r.URL2:U=++l,i=D;continue;case r.ENDURL:M=s.URL,z=o(a.substring(U,l)),l++;break;case r.FINURL:l++;break;case r.LT_BG:i=T,l++;continue;case r.LT_BG_M:i=x,l++;continue;case r.CHKSP:if(l-$<8&&a.substring($+1,l+1).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])|[ \t]$/)){l++;continue}case r.TERMURL:M=s.URL,z=o(a.substring(U,l)),l++,i=_;continue;case r.CHKPOSN:if(++l-$<9&&a.substring($+1,l).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])$/))continue;M=s.INVALID,z="E_CSS_UNEXPECTED_NEWLINE",i=c;break;case r.CHKPOSS:if(l-$<9&&a.substring($+1,l+1).match(/^[0-9a-fA-F]{0,6}[ \t]$/)){l++;continue}z=o(a.substring(U,l));break;case r.URLESC:$=l++;continue;case r.IDESCH:l++,i=p;continue;default:if(i!==c){M=s.INVALID,z="E_CSS_UNEXPECTED_STATE";break}U=l,M=s.EOF}if(G.type=M,G.precededBySpace=H,G.num=V,G.text=z,G.position=U,++e>=t)break;i=c,H=!1,G=B[e&n]}this.position=l,this.tail=e&n}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return h})),n.d(t,"e",(function(){return u}));var i=n(1),o=n(6);let s=null,r=null;function a(){return s}function l(e){if(!s)throw new Error("E_TASK_NO_CONTEXT");s.name||(s.name=e);const t=s,n=new E(t,t.top,e);return t.top=n,n.state=d.ACTIVE,n}function c(e){return new b(e)}function h(e,t,n){const i=l(e);i.handler=n;try{t(i)}catch(e){i.task.raise(e,i)}return i.result()}function u(e,t){return(s?s.getScheduler():r||new f(new p)).run(e,t)}var d;!function(e){e[e.INIT=0]="INIT",e[e.ACTIVE=1]="ACTIVE",e[e.FINISHED=2]="FINISHED",e[e.DEAD=3]="DEAD"}(d||(d={}));class p{currentTime(){return(new Date).valueOf()}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}}class f{constructor(e){this.timer=e,this.timeout=1,this.slice=25,this.sliceOverTime=0,this.wakeupTime=null,this.timeoutToken=null,this.inTimeSlice=!1,this.order=0,this.queue=new i.b,r||(r=this)}setSlice(e){this.slice=e}setTimeout(e){this.timeout=e}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;const e=this.queue.peek().scheduledTime,t=this.timer.currentTime();if(null!=this.timeoutToken){if(t+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let n=e-t;n<=this.timeout&&(n=this.timeout),this.wakeupTime=t+n;const i=this;this.timeoutToken=this.timer.setTimeout(()=>{i.timeoutToken=null,i.doTimeSlice()},n)}schedule(e,t){const n=e,i=this.timer.currentTime();n.order=this.order++,n.scheduledTime=i+(t||0),this.queue.add(n),this.arm()}doTimeSlice(){null!=this.timeoutToken&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let e=this.timer.currentTime();for(this.sliceOverTime=e+this.slice;this.queue.length();){const t=this.queue.peek();if(t.scheduledTime>e)break;if(this.queue.remove(),t.canceled||t.resumeInternal(),(e=this.timer.currentTime())>=this.sliceOverTime)break}}catch(e){o.b.error(e)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(e,t){const n=new m(this,t||"");n.top=new E(n,null,"bootstrap"),n.top.state=d.ACTIVE,n.top.then(()=>{const t=()=>{n.running=!1;for(const e of n.callbacks)try{e()}catch(e){o.b.error(e)}};try{e().then(e=>{n.result=e,t()})}catch(e){n.raise(e),t()}});const i=s;return s=n,this.schedule(n.top.suspend("bootstrap")),s=i,n}}class g{constructor(e){this.task=e,this.scheduledTime=0,this.order=0,this.result=null,this.canceled=!1}compare(e){const t=e;return t.scheduledTime-this.scheduledTime||t.order-this.order}getTask(){return this.task}schedule(e,t){this.result=e,this.task.scheduler.schedule(this,t)}resumeInternal(){const e=this.task;if(this.task=null,e&&e.continuation==this){e.continuation=null;const t=s;return s=e,e.top.finish(this.result),s=t,!0}return!1}cancel(){this.canceled=!0}}class m{constructor(e,t){this.scheduler=e,this.name=t,this.callbacks=[],this.exception=null,this.running=!0,this.result=null,this.waitTarget=null,this.top=null,this.continuation=null}getName(){return this.name}interrupt(e){if(this.raise(e||new Error("E_TASK_INTERRUPT")),this!==s&&this.continuation){this.continuation.cancel();const e=new g(this);this.waitTarget="interrupt",this.continuation=e,this.scheduler.schedule(e)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(e){this.callbacks.push(e)}join(){const e=l("Task.join");if(this.running){const t=e.suspend(this),n=this;this.whenDone(()=>{t.schedule(n.result)})}else e.finish(this.result);return e.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){const e=this.exception;this.exception=null,this.top.handler(this.top,e)}else this.exception&&o.b.error(this.exception,"Unhandled exception in task",this.name)}raise(e,t){if(this.fillStack(e),t){let e=this.top;for(;e&&e!=t;)e=e.parent;e==t&&(this.top=e)}this.exception=e,this.unwind()}fillStack(e){let t=e.frameTrace;if(!t){t=e.stack?`${e.stack}\n\t---- async ---\n`:"";for(let e=this.top;e;e=e.parent)t+="\t",t+=e.getName(),t+="\n";e.frameTrace=t}}}class b{constructor(e){this.value=e}then(e){e(this.value)}thenAsync(e){return e(this.value)}thenReturn(e){return new b(e)}thenFinish(e){e.finish(this.value)}isPending(){return!1}get(){return this.value}}class w{constructor(e){this.frame=e}then(e){this.frame.then(e)}thenAsync(e){if(this.isPending()){const t=new E(this.frame.task,this.frame.parent,"AsyncResult.thenAsync");return t.state=d.ACTIVE,this.frame.parent=t,this.frame.then(n=>{e(n).then(e=>{t.finish(e)})}),t.result()}return e(this.frame.res)}thenReturn(e){return this.isPending()?this.thenAsync(()=>new b(e)):new b(e)}thenFinish(e){this.isPending()?this.then(t=>{e.finish(t)}):e.finish(this.frame.res)}isPending(){return this.frame.state==d.ACTIVE}get(){if(this.isPending())throw new Error("Result is pending");return this.frame.res}}class E{constructor(e,t,n){this.task=e,this.parent=t,this.name=n,this.res=null,this.callback=null,this.handler=null,this.state=d.INIT}checkEnvironment(){if(!s)throw new Error("F_TASK_NO_CONTEXT");if(this!==s.top)throw new Error("F_TASK_NOT_TOP_FRAME")}result(){return new w(this)}finish(e){this.checkEnvironment(),s&&!s.exception&&(this.res=e),this.state=d.FINISHED;const t=this.parent;if(s&&(s.top=t),this.callback){try{this.callback(e)}catch(e){this.task.raise(e,t)}this.state=d.DEAD}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(e){switch(this.state){case d.ACTIVE:if(this.callback)throw new Error("F_TASK_FRAME_ALREADY_HAS_CALLBACK");this.callback=e;break;case d.FINISHED:{const t=this.task,n=this.parent;try{e(this.res),this.state=d.DEAD}catch(e){this.state=d.DEAD,t.raise(e,n)}break}case d.DEAD:throw new Error("F_TASK_DEAD_FRAME");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){const e=l("Frame.timeSlice");return e.getScheduler().isTimeSliceOver()?(o.b.debug("-- time slice --"),e.suspend().schedule(!0)):e.finish(!0),e.result()}sleep(e){const t=l("Frame.sleep");return t.suspend().schedule(!0,e),t.result()}loop(e){const t=l("Frame.loop"),n=i=>{try{for(;i;){const t=e();if(t.isPending())return void t.then(n);t.then(e=>{i=e})}t.finish(!0)}catch(e){t.task.raise(e,t)}};return n(!0),t.result()}loopWithFrame(e){const t=s;if(!t)throw new Error("E_TASK_NO_CONTEXT");return this.loop(()=>{let n;do{const i=new y(t,t.top);t.top=i,i.state=d.ACTIVE,e(i),n=i.result()}while(!n.isPending()&&n.get());return n})}suspend(e){if(this.checkEnvironment(),this.task.continuation)throw new Error("E_TASK_ALREADY_SUSPENDED");const t=new g(this.task);return this.task.continuation=t,s=null,this.task.waitTarget=e||null,t}}class y extends E{constructor(e,t){super(e,t,"loop")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}}},function(e,t,n){"use strict";n.d(t,"F",(function(){return o})),n.d(t,"E",(function(){return s})),n.d(t,"L",(function(){return l})),n.d(t,"M",(function(){return u})),n.d(t,"m",(function(){return p})),n.d(t,"I",(function(){return f})),n.d(t,"K",(function(){return g})),n.d(t,"J",(function(){return m})),n.d(t,"G",(function(){return b})),n.d(t,"O",(function(){return w})),n.d(t,"g",(function(){return E})),n.d(t,"w",(function(){return I})),n.d(t,"v",(function(){return P})),n.d(t,"b",(function(){return A})),n.d(t,"c",(function(){return O})),n.d(t,"y",(function(){return k})),n.d(t,"z",(function(){return R})),n.d(t,"n",(function(){return L})),n.d(t,"l",(function(){return F})),n.d(t,"k",(function(){return D})),n.d(t,"j",(function(){return _})),n.d(t,"i",(function(){return B})),n.d(t,"u",(function(){return M})),n.d(t,"a",(function(){return U})),n.d(t,"B",(function(){return z})),n.d(t,"r",(function(){return V})),n.d(t,"h",(function(){return H})),n.d(t,"q",(function(){return G})),n.d(t,"x",(function(){return $})),n.d(t,"s",(function(){return W})),n.d(t,"o",(function(){return X})),n.d(t,"t",(function(){return j})),n.d(t,"d",(function(){return K})),n.d(t,"e",(function(){return q})),n.d(t,"f",(function(){return Y})),n.d(t,"p",(function(){return Z})),n.d(t,"A",(function(){return Q})),n.d(t,"D",(function(){return J})),n.d(t,"C",(function(){return ee})),n.d(t,"P",(function(){return te})),n.d(t,"N",(function(){return ne})),n.d(t,"H",(function(){return ie}));var i=n(1);function o(){return{fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0}}function s(e){return{fontFamily:e.fontFamily,lineHeight:e.lineHeight,margin:e.margin,hyphenate:e.hyphenate,columnWidth:e.columnWidth,horizontal:e.horizontal,nightMode:e.nightMode,spreadView:e.spreadView,pageBorder:e.pageBorder,enabledMediaTypes:Object.assign({},e.enabledMediaTypes),defaultPaperSize:e.defaultPaperSize?Object.assign({},e.defaultPaperSize):void 0}}const r={fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0},a={PENDING:{}};function l(e,t,n,i){const o=Math.min((e-0)/n,(t-0)/i);return`matrix(${o},0,0,${o},0,0)`}function c(e){return`"${i.q(`${e}`)}"`}function h(e){return i.p(`${e}`)}function u(e,t){return e?`${i.p(e)}.${i.p(t)}`:i.p(t)}let d=0;class p{constructor(e,t){if(this.parent=e,this.resolver=t,this.children=[],this.values={},this.funcs={},this.builtIns={},this.scopeKey=`S${d++}`,this.zero=new Y(this,0),this.one=new Y(this,1),this._true=new Y(this,!0),this._false=new Y(this,!1),e&&e.children.push(this),!e){const e=this.builtIns;e.floor=Math.floor,e.ceil=Math.ceil,e.round=Math.round,e.sqrt=Math.sqrt,e.min=Math.min,e.max=Math.max,e.letterbox=l,e["css-string"]=c,e["css-name"]=h,e.typeof=e=>typeof e,this.defineBuiltInName("page-width",(function(){return this.pageWidth()})),this.defineBuiltInName("page-height",(function(){return this.pageHeight()})),this.defineBuiltInName("pref-font-family",(function(){return this.pref.fontFamily})),this.defineBuiltInName("pref-night-mode",(function(){return this.pref.nightMode})),this.defineBuiltInName("pref-hyphenate",(function(){return this.pref.hyphenate})),this.defineBuiltInName("pref-margin",(function(){return this.pref.margin})),this.defineBuiltInName("pref-line-height",(function(){return this.pref.lineHeight})),this.defineBuiltInName("pref-column-width",(function(){return this.pref.columnWidth*this.fontSize})),this.defineBuiltInName("pref-horizontal",(function(){return this.pref.horizontal})),this.defineBuiltInName("pref-spread-view",(function(){return this.pref.spreadView})),this.defineBuiltInName("pub-title",(function(){return c(this.pubTitle?this.pubTitle:"")})),this.defineBuiltInName("doc-title",(function(){return c(this.docTitle?this.docTitle:"")}))}}defineBuiltInName(e,t){this.values[e]=new j(this,t,e)}defineName(e,t){this.values[e]=t}defineFunc(e,t){this.funcs[e]=t}defineBuiltIn(e,t){this.builtIns[e]=t}}function f(e){switch(e.toLowerCase()){case"px":case"in":case"pt":case"pc":case"cm":case"mm":case"q":return!0;default:return!1}}function g(e){switch(e.toLowerCase()){case"vw":case"vh":case"vi":case"vb":case"vmin":case"vmax":case"pvw":case"pvh":case"pvi":case"pvb":case"pvmin":case"pvmax":return!0;default:return!1}}function m(e){switch(e.toLowerCase()){case"em":case"ex":case"rem":return!0;default:return!1}}const b={px:1,in:96,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,ex:8,dppx:1,dpi:1/96,dpcm:2.54/96};function w(e){switch(e){case"q":case"rem":return!0;default:return!1}}class E{constructor(e,t,n,i){this.rootScope=e,this.viewportWidth=t,this.viewportHeight=n,this.actualPageWidth=null,this.actualPageHeight=null,this.rootFontSize=null,this.scopes={},this.pageAreaWidth=null,this.pageAreaHeight=null,this.pageVertical=null,this.pubTitle=null,this.docTitle=null,this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(t/2)-this.pref.pageBorder:t},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:n},this.initialFontSize=i,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:i},this.pref=r}getScopeContext(e){let t=this.scopes[e.scopeKey];return t||(t={},this.scopes[e.scopeKey]=t),t}clearScope(e){this.scopes[e.scopeKey]={};for(let t=0;t<e.children.length;t++)this.clearScope(e.children[t])}queryUnitSize(e,t){if(g(e)){const t=this.pageWidth()/100,n=this.pageHeight()/100,i=null!=this.pageAreaWidth?this.pageAreaWidth/100:t,o=null!=this.pageAreaHeight?this.pageAreaHeight/100:n;switch(e){case"vw":return i;case"vh":return o;case"vi":return this.pageVertical?o:i;case"vb":return this.pageVertical?i:o;case"vmin":return i<o?i:o;case"vmax":return i>o?i:o;case"pvw":return t;case"pvh":return n;case"pvi":return this.pageVertical?n:t;case"pvb":return this.pageVertical?t:n;case"pvmin":return t<n?t:n;case"pvmax":return t>n?t:n}}return"em"==e||"rem"==e?t?this.initialFontSize:this.fontSize():"ex"==e?b.ex*(t?this.initialFontSize:this.fontSize())/b.em:b[e]}evalName(e,t){do{let n=e.values[t];if(n)return n;if(e.resolver&&(n=e.resolver.call(this,t,!1)))return n;e=e.parent}while(e);throw new Error(`Name '${t}' is undefined`)}evalCall(e,t,n,i){do{let o=e.funcs[t];if(o)return o;if(e.resolver&&(o=e.resolver.call(this,t,!0)))return o;const s=e.builtIns[t];if(s){if(i)return e.zero;const t=Array(n.length);for(let e=0;e<n.length;e++)t[e]=n[e].evaluate(this);return new Y(e,s.apply(this,t))}e=e.parent}while(e);throw new Error(`Function '${t}' is undefined`)}evalMediaName(e,t){const n="all"===e||!!this.pref.enabledMediaTypes[e];return t?!n:n}evalMediaTest(e,t){let n="";const i=e.match(/^(min|max)-(.*)$/);i&&(n=i[1],e=i[2]);let o=null,s=null;switch(e){case"width":case"height":case"device-width":case"device-height":case"color":t&&(o=t.evaluate(this))}switch(e){case"width":s=this.pageWidth();break;case"height":s=this.pageHeight();break;case"device-width":s=window.screen.availWidth;break;case"device-height":s=window.screen.availHeight;break;case"color":s=window.screen.pixelDepth}if(null!=s&&null!=o)switch(n){case"min":return s>=o;case"max":return s<=o;default:return s==o}else if(null!=s&&null==t)return 0!==s;return!1}queryVal(e,t){const n=this.scopes[e.scopeKey];return n?n[t]:void 0}storeVal(e,t,n){this.getScopeContext(e)[t]=n}}class y{constructor(e){this.scope=e,this.scope=e,this.key=`_${d++}`}toString(){const e=new i.d;return this.appendTo(e,0),e.toString()}appendTo(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){throw new Error("F_ABSTRACT")}expand(e,t){return this}dependCore(e,t,n){return e===this}dependOuter(e,t,n){const i=n[this.key];if(null!=i)return i!==a.PENDING&&i;{n[this.key]=a.PENDING;const i=this.dependCore(e,t,n);return n[this.key]=i,i}}depend(e,t){return this.dependOuter(e,t,{})}evaluate(e){let t=e.queryVal(this.scope,this.key);return void 0!==t?t:(t=this.evaluateCore(e),e.storeVal(this.scope,this.key,t),t)}isMediaName(){return!1}}class S extends y{constructor(e,t){super(e),this.val=t}getOp(){throw new Error("F_ABSTRACT")}evalPrefix(e){throw new Error("F_ABSTRACT")}evaluateCore(e){const t=this.val.evaluate(e);return this.evalPrefix(t)}dependCore(e,t,n){return e===this||this.val.dependOuter(e,t,n)}appendTo(e,t){10<t&&e.append("("),e.append(this.getOp()),this.val.appendTo(e,10),10<t&&e.append(")")}expand(e,t){const n=this.val.expand(e,t);return n===this.val?this:new this.constructor(this.scope,n)}}class N extends y{constructor(e,t,n){super(e),this.lhs=t,this.rhs=n}getPriority(){throw new Error("F_ABSTRACT")}getOp(){throw new Error("F_ABSTRACT")}evalInfix(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){const t=this.lhs.evaluate(e),n=this.rhs.evaluate(e);return this.evalInfix(t,n)}dependCore(e,t,n){return e===this||this.lhs.dependOuter(e,t,n)||this.rhs.dependOuter(e,t,n)}appendTo(e,t){const n=this.getPriority();n<=t&&e.append("("),this.lhs.appendTo(e,n),e.append(this.getOp()),this.rhs.appendTo(e,n),n<=t&&e.append(")")}expand(e,t){const n=this.lhs.expand(e,t),i=this.rhs.expand(e,t);return n===this.lhs&&i===this.rhs?this:new this.constructor(this.scope,n,i)}}class C extends N{constructor(e,t,n){super(e,t,n)}getPriority(){return 1}}class v extends N{constructor(e,t,n){super(e,t,n)}getPriority(){return 2}}class T extends N{constructor(e,t,n){super(e,t,n)}getPriority(){return 3}}class x extends N{constructor(e,t,n){super(e,t,n)}getPriority(){return 4}}class I extends S{constructor(e,t){super(e,t)}getOp(){return"!"}evalPrefix(e){return!e}}class P extends S{constructor(e,t){super(e,t)}getOp(){return"-"}evalPrefix(e){return-e}}class A extends C{constructor(e,t,n){super(e,t,n)}getOp(){return"&&"}evaluateCore(e){return this.lhs.evaluate(e)&&this.rhs.evaluate(e)}}class O extends A{constructor(e,t,n){super(e,t,n)}getOp(){return" and "}}class k extends C{constructor(e,t,n){super(e,t,n)}getOp(){return"||"}evaluateCore(e){return this.lhs.evaluate(e)||this.rhs.evaluate(e)}}class R extends k{constructor(e,t,n){super(e,t,n)}getOp(){return", "}}class L extends v{constructor(e,t,n){super(e,t,n)}getOp(){return"<"}evalInfix(e,t){return e<t}}class F extends v{constructor(e,t,n){super(e,t,n)}getOp(){return"<="}evalInfix(e,t){return e<=t}}class D extends v{constructor(e,t,n){super(e,t,n)}getOp(){return">"}evalInfix(e,t){return e>t}}class _ extends v{constructor(e,t,n){super(e,t,n)}getOp(){return">="}evalInfix(e,t){return e>=t}}class B extends v{constructor(e,t,n){super(e,t,n)}getOp(){return"=="}evalInfix(e,t){return e==t}}class M extends v{constructor(e,t,n){super(e,t,n)}getOp(){return"!="}evalInfix(e,t){return e!=t}}class U extends T{constructor(e,t,n){super(e,t,n)}getOp(){return"+"}evalInfix(e,t){return e+t}}class z extends T{constructor(e,t,n){super(e,t,n)}getOp(){return" - "}evalInfix(e,t){return e-t}}class V extends x{constructor(e,t,n){super(e,t,n)}getOp(){return"*"}evalInfix(e,t){return e*t}}class H extends x{constructor(e,t,n){super(e,t,n)}getOp(){return"/"}evalInfix(e,t){return e/t}}class G extends x{constructor(e,t,n){super(e,t,n)}getOp(){return"%"}evalInfix(e,t){return e%t}}class $ extends y{constructor(e,t,n){super(e),this.num=t,this.unit=n.toLowerCase()}appendTo(e,t){e.append(this.num.toString()),e.append(i.p(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}}class W extends y{constructor(e,t){super(e),this.qualifiedName=t}appendTo(e,t){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,t,n){return e===this||t.evalName(this.scope,this.qualifiedName).dependOuter(e,t,n)}}class X extends y{constructor(e,t,n){super(e),this.not=t,this.name=n}appendTo(e,t){this.not&&e.append("not "),e.append(i.p(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}dependCore(e,t,n){return e===this||this.value.dependOuter(e,t,n)}isMediaName(){return!0}}class j extends y{constructor(e,t,n){super(e),this.fn=t,this.str=n}appendTo(e,t){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}}class K extends y{constructor(e,t,n){super(e),this.qualifiedName=t,this.params=n}appendTo(e,t){e.append(this.qualifiedName),function(e,t){e.append("(");for(let n=0;n<t.length;n++)n&&e.append(","),t[n].appendTo(e,0);e.append(")")}(e,this.params)}evaluateCore(e){return e.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(e,this.params).evaluate(e)}dependCore(e,t,n){if(e===this)return!0;for(let i=0;i<this.params.length;i++)if(this.params[i].dependOuter(e,t,n))return!0;return t.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(e,t,n)}expand(e,t){const n=function(e,t,n){let i=t;for(let o=0;o<t.length;o++){const s=t[o].expand(e,n);if(t!==i)i[o]=s;else if(s!==t[o]){i=Array(t.length);for(let e=0;e<o;e++)i[e]=t[e];i[o]=s}}return i}(e,this.params,t);return n===this.params?this:new K(this.scope,this.qualifiedName,n)}}class q extends y{constructor(e,t,n,i){super(e),this.cond=t,this.ifTrue=n,this.ifFalse=i}appendTo(e,t){t>0&&e.append("("),this.cond.appendTo(e,0),e.append("?"),this.ifTrue.appendTo(e,0),e.append(":"),this.ifFalse.appendTo(e,0),t>0&&e.append(")")}evaluateCore(e){return this.cond.evaluate(e)?this.ifTrue.evaluate(e):this.ifFalse.evaluate(e)}dependCore(e,t,n){return e===this||this.cond.dependOuter(e,t,n)||this.ifTrue.dependOuter(e,t,n)||this.ifFalse.dependOuter(e,t,n)}expand(e,t){const n=this.cond.expand(e,t),i=this.ifTrue.expand(e,t),o=this.ifFalse.expand(e,t);return n===this.cond&&i===this.ifTrue&&o===this.ifFalse?this:new q(this.scope,n,i,o)}}class Y extends y{constructor(e,t){super(e),this.val=t}appendTo(e,t){switch(typeof this.val){case"number":case"boolean":e.append(this.val.toString());break;case"string":e.append('"'),e.append(i.q(this.val)),e.append('"');break;default:throw new Error("F_UNEXPECTED_STATE")}}evaluateCore(e){return this.val}}class Z extends y{constructor(e,t,n){super(e),this.name=t,this.value=n}appendTo(e,t){e.append("("),e.append(i.q(this.name.name)),e.append(":"),this.value.appendTo(e,0),e.append(")")}evaluateCore(e){return e.evalMediaTest(this.name.name,this.value)}dependCore(e,t,n){return e===this||this.value.dependOuter(e,t,n)}expand(e,t){const n=this.value.expand(e,t);return n===this.value?this:new Z(this.scope,this.name,n)}}class Q extends y{constructor(e,t){super(e),this.index=t}appendTo(e,t){e.append("$"),e.append(this.index.toString())}expand(e,t){const n=t[this.index];if(!n)throw new Error(`Parameter missing: ${this.index}`);return n}}function J(e,t,n){return t===e._false||t===e.zero||n==e._false||n==e.zero?e._false:t===e._true||t===e.one?n:n===e._true||n===e.one?t:new A(e,t,n)}function ee(e,t,n){return t===e.zero?n:n===e.zero?t:new U(e,t,n)}function te(e,t,n){return t===e.zero?new P(e,n):n===e.zero?t:new z(e,t,n)}function ne(e,t,n){return t===e.zero||n===e.zero?e.zero:t===e.one?n:n===e.one?t:new V(e,t,n)}function ie(e,t,n){return t===e.zero?e.zero:n===e.one?t:new H(e,t,n)}},function(e,t,n){"use strict";n.d(t,"v",(function(){return p})),n.d(t,"r",(function(){return g})),n.d(t,"H",(function(){return m})),n.d(t,"m",(function(){return S})),n.d(t,"l",(function(){return N})),n.d(t,"c",(function(){return T})),n.d(t,"i",(function(){return I})),n.d(t,"x",(function(){return O})),n.d(t,"w",(function(){return k})),n.d(t,"s",(function(){return R})),n.d(t,"F",(function(){return L})),n.d(t,"u",(function(){return F})),n.d(t,"q",(function(){return D})),n.d(t,"t",(function(){return B})),n.d(t,"B",(function(){return U})),n.d(t,"A",(function(){return z})),n.d(t,"g",(function(){return H})),n.d(t,"j",(function(){return G})),n.d(t,"a",(function(){return j})),n.d(t,"d",(function(){return K})),n.d(t,"e",(function(){return Pe})),n.d(t,"G",(function(){return Ve})),n.d(t,"b",(function(){return He})),n.d(t,"f",(function(){return Xe})),n.d(t,"h",(function(){return je})),n.d(t,"p",(function(){return qe})),n.d(t,"D",(function(){return Ye})),n.d(t,"E",(function(){return Ze})),n.d(t,"z",(function(){return Qe})),n.d(t,"y",(function(){return Je})),n.d(t,"n",(function(){return et})),n.d(t,"o",(function(){return tt})),n.d(t,"C",(function(){return nt})),n.d(t,"k",(function(){return it}));var i=n(7),o=n(1),s=n(0),r=n(10),a=n(20),l=n(2),c=n(4),h=n(6),u=n(25),d=n(9);const p={azimuth:!0,"border-collapse":!0,"border-spacing":!0,"caption-side":!0,"clip-rule":!0,color:!0,"color-interpolation":!0,"color-rendering":!0,cursor:!0,direction:!0,elevation:!0,"empty-cells":!0,fill:!0,"fill-opacity":!0,"fill-rule":!0,"font-kerning":!0,"font-size":!0,"font-size-adjust":!0,"font-family":!0,"font-feature-settings":!0,"font-style":!0,"font-stretch":!0,"font-variant":!0,"font-weight":!0,"glyph-orientation-vertical":!0,hyphens:!0,"hyphenate-character":!0,"hyphenate-limit-chars":!0,"hyphenate-limit-last":!0,"image-rendering":!0,"image-resolution":!0,"letter-spacing":!0,"line-break":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,marker:!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,orphans:!0,"overflow-wrap":!0,"paint-order":!0,"pointer-events":!0,"pitch-range":!0,quotes:!0,richness:!0,"ruby-align":!0,"ruby-position":!0,"speak-header":!0,"speak-numeral":!0,"speak-punctuation":!0,"speech-rate":!0,"shape-rendering":!0,stress:!0,stroke:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0,"tab-size":!0,"text-align":!0,"text-align-last":!0,"text-anchor":!0,"text-decoration-skip":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-combine-upright":!0,"text-indent":!0,"text-justify":!0,"text-rendering":!0,"text-size-adjust":!0,"text-transform":!0,"text-underline-position":!0,visibility:!0,"voice-family":!0,volume:!0,"white-space":!0,widows:!0,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"writing-mode":!0},f=["box-decoration-break","image-resolution","orphans","widows"];function g(){return d.b(d.a.POLYFILLED_INHERITED_PROPS).reduce((e,t)=>e.concat(t()),[].concat(f))}const m={"http://www.idpf.org/2007/ops":!0,"http://www.w3.org/1999/xhtml":!0,"http://www.w3.org/2000/svg":!0},b=["margin-%","padding-%","border-%-width","border-%-style","border-%-color","%"],w=["max-%","min-%","%"],E=(()=>{const e=["left","right","top","bottom"],t={width:!0,height:!0,"max-width":!0,"max-height":!0,"min-width":!0,"min-height":!0};for(let n=0;n<b.length;n++)for(let i=0;i<e.length;i++)t[b[n].replace("%",e[i])]=!0;return t})();function y(e,t){const n={};for(const t of b)for(const i in e){const o=t.replace("%",i),s=t.replace("%",e[i]);n[o]=s,n[s]=o}for(const e of w)for(const i in t){const o=e.replace("%",i),s=e.replace("%",t[i]);n[o]=s,n[s]=o}return n}const S=y({"block-start":"right","block-end":"left","inline-start":"top","inline-end":"bottom"},{"block-size":"width","inline-size":"height"}),N=y({"block-start":"top","block-end":"bottom","inline-start":"left","inline-end":"right"},{"block-size":"height","inline-size":"width"}),C=y({"block-start":"right","block-end":"left","inline-start":"bottom","inline-end":"top"},{"block-size":"width","inline-size":"height"}),v=y({"block-start":"top","block-end":"bottom","inline-start":"right","inline-end":"left"},{"block-size":"height","inline-size":"width"});class T{constructor(e,t){this.value=e,this.priority=t}getBaseValue(){return this}filterValue(e){const t=this.value.visit(e);return t===this.value?this:new T(t,this.priority)}increaseSpecificity(e){return 0==e?this:new T(this.value,this.priority+e)}evaluate(e,t){return r.i(e,this.value,t)}isEnabled(e){return!0}}class x extends T{constructor(e,t,n){super(e,t),this.condition=n}getBaseValue(){return new T(this.value,this.priority)}filterValue(e){const t=this.value.visit(e);return t===this.value?this:new x(t,this.priority,this.condition)}increaseSpecificity(e){return 0==e?this:new x(this.value,this.priority+e,this.condition)}isEnabled(e){return!!this.condition.evaluate(e)}}function I(e,t,n){return(null==t||n.priority>t.priority)&&n.isEnabled(e)?n.getBaseValue():t}const P={"region-id":!0,"fragment-selector-id":!0};function A(e){return!!P[e]}function O(e){return"_"!=e.charAt(0)&&!P[e]}function k(e){return!!p[e]}function R(e,t){return e[t]}function L(e,t,n){n?e[t]=n:delete e[t]}function F(e,t){return e[t]}function D(e,t){let n=e[t];return n||(n={},e[t]=n),n}const _=e=>{let t=e._viewConditionalStyles;return t||(t=[],e._viewConditionalStyles=t),t};function B(e,t){return e[t]}function M(e,t){let n=e[t];return n||(n=[],e[t]=n),n}function U(e,t,n,i,o,s,r){if([{id:o,styleKey:"_pseudos"},{id:s,styleKey:"_regions"}].forEach(e=>{if(e.id){const n=D(t,e.styleKey);(t=n[e.id])||(t={},n[e.id]=t)}}),r){const e=_(t);t={},e.push({styles:t,matcher:r})}for(const o in n)if("_"!=o.charAt(0))if(A(o)){const e=B(n,o),i=M(t,o);Array.prototype.push.apply(i,e)}else{const s=R(n,o).increaseSpecificity(i),r=R(t,o);L(t,o,I(e,r,s))}}function z(e,t){const n={};for(let i=0;i<t.length;i++)U(e,n,t[i],0,null,null,null);return n}function V(e,t){if(e.length>0){e.sort((e,t)=>t.getPriority()-e.getPriority());let n=null;for(let i=e.length-1;i>=0;i--)(n=e[i]).chained=t,t=n;return n}return t}class H extends s.d{constructor(e,t){super(),this.props=e,this.context=t,this.propName=""}setPropName(e){this.propName=e}getFontSize(){const e=R(this.props,"font-size").value;if(!c.I(e.unit))throw new Error("Unexpected state");return e.num*c.G[e.unit]}visitNumeric(e){if(i.a(this.context),"font-size"===this.propName)return function(e,t,n){const i=(e=G(e,t,n)).unit,o=e.num;return"px"===i?e:"%"===i?new s.i(o/100*t,"px"):new s.i(o*n.queryUnitSize(i,!1),"px")}(e,this.getFontSize(),this.context);if("em"==e.unit||"ex"==e.unit||"rem"==e.unit)return G(e,this.getFontSize(),this.context);if("%"==e.unit){if("line-height"===this.propName)return e;const t=this.propName.match(/height|^(top|bottom)$/)?"vh":"vw";return new s.i(e.num,t)}return e}visitExpr(e){return"font-size"==this.propName?r.i(this.context,e,this.propName).visit(this):e}}function G(e,t,n){const i=e.unit,o=e.num;if("em"===i||"ex"===i){const e=c.G[i]/c.G.em;return new s.i(o*e*t,"px")}return"rem"===i?new s.i(o*n.fontSize(),"px"):e}class ${apply(e){}mergeWith(e){return new X([this,e])}clone(){return this}}class W extends ${constructor(e){super(),this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}}class X extends ${constructor(e){super(),this.list=e}apply(e){for(let t=0;t<this.list.length;t++)this.list[t].apply(e)}mergeWith(e){return this.list.push(e),this}clone(){return new X([].concat(this.list))}}class j extends ${constructor(e,t,n,i,o){super(),this.style=e,this.specificity=t,this.pseudoelement=n,this.regionId=i,this.viewConditionId=o}apply(e){U(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}}class K extends ${constructor(){super(),this.chained=null}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}}class q extends K{constructor(e){super(),this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}}class Y extends K{constructor(e){super(),this.id=e}apply(e){e.currentId!=this.id&&e.currentXmlId!=this.id||this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}}class Z extends K{constructor(e){super(),this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}}class Q extends K{constructor(e,t){super(),this.ns=e,this.localName=t}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let t=e.nsPrefix[this.ns];t||(t=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=t);const n=t+this.localName;e.insertInTable(e.nstags,n,this.chained)}return!0}}class J extends K{constructor(e){super(),this.epubTypePatt=e}apply(e){const t=e.currentElement;if(t&&"a"==e.currentLocalName){const n=t.getAttribute("href");if(n&&n.match(/^#/)){const i=n.substring(1),s=t.ownerDocument.getElementById(i);if(s){const t=s.getAttributeNS(o.a.epub,"type");t&&t.match(this.epubTypePatt)&&this.chained.apply(e)}}}}}class ee extends K{constructor(e){super(),this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}}class te extends K{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){e.currentElement&&e.currentElement.hasAttributeNS(this.ns,this.name)&&this.chained.apply(e)}}class ne extends K{constructor(e,t,n){super(),this.ns=e,this.name=t,this.value=n}apply(e){e.currentElement&&e.currentElement.getAttributeNS(this.ns,this.name)==this.value&&this.chained.apply(e)}getPriority(){return"type"==this.name&&this.ns==o.a.epub?9:0}makePrimary(e){return"type"==this.name&&this.ns==o.a.epub&&(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0)}}class ie extends K{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){if(e.currentElement){const t=e.currentElement.getAttributeNS(this.ns,this.name);t&&m[t]&&this.chained.apply(e)}}getPriority(){return 0}makePrimary(e){return!1}}class oe extends K{constructor(e,t,n){super(),this.ns=e,this.name=t,this.regexp=n}apply(e){if(e.currentElement){const t=e.currentElement.getAttributeNS(this.ns,this.name);t&&t.match(this.regexp)&&this.chained.apply(e)}}}class se extends K{constructor(e){super(),this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}}class re extends K{constructor(){super()}apply(e){e.isFirst&&this.chained.apply(e)}getPriority(){return 6}}class ae extends K{constructor(){super()}apply(e){e.isRoot&&this.chained.apply(e)}getPriority(){return 12}}class le extends K{constructor(e,t){super(),this.a=e,this.b=t}matchANPlusB(e){return u.c(e,this.a,this.b)}}class ce extends le{constructor(e,t){super(e,t)}apply(e){const t=e.currentSiblingTypeCounts[e.currentNamespace][e.currentLocalName];this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 5}}class he extends le{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingOrder;null===t&&(t=e.currentFollowingSiblingOrder=e.currentElement.parentNode.childElementCount-e.currentSiblingOrder+1),this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}}class ue extends le{constructor(e,t){super(e,t)}apply(e){const t=e.currentFollowingSiblingTypeCounts;if(!t[e.currentNamespace]){let n=e.currentElement;do{const e=n.namespaceURI,i=n.localName;let o=t[e];o||(o=t[e]={}),o[i]=(o[i]||0)+1}while(n=n.nextElementSibling)}this.matchANPlusB(t[e.currentNamespace][e.currentLocalName])&&this.chained.apply(e)}getPriority(){return 4}}class de extends K{constructor(){super()}apply(e){let t=e.currentElement.firstChild;for(;t;){switch(t.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(t.length>0)return}t=t.nextSibling}this.chained.apply(e)}getPriority(){return 4}}class pe extends K{constructor(){super()}apply(e){!1===e.currentElement.disabled&&this.chained.apply(e)}getPriority(){return 5}}class fe extends K{constructor(){super()}apply(e){!0===e.currentElement.disabled&&this.chained.apply(e)}getPriority(){return 5}}class ge extends K{constructor(){super()}apply(e){const t=e.currentElement;!0!==t.selected&&!0!==t.checked||this.chained.apply(e)}getPriority(){return 5}}class me extends K{constructor(e){super(),this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}}class be extends ${constructor(){super(),this.applied=!1}apply(e){this.applied=!0}clone(){const e=new be;return e.applied=this.applied,e}}class we extends K{constructor(e){super(),this.checkAppliedAction=new be,this.firstAction=V(e,this.checkAppliedAction)}apply(e){this.firstAction.apply(e),this.checkAppliedAction.applied||this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return this.firstAction.getPriority()}}class Ee{constructor(e,t,n){this.condition=e,this.viewConditionId=t,this.viewCondition=n}increment(e){e.increment(this.condition,this.viewCondition)}decrement(e){e.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(e){return e.buildViewConditionMatcher(this.viewConditionId)}}class ye extends Ee{constructor(e,t,n){super(e,t,n)}fresh(e){return new ye(this.condition,this.viewConditionId,this.buildViewConditionMatcher(e))}push(e,t){return 0==t&&this.increment(e),!1}pop(e,t){return 0==t&&(this.decrement(e),!0)}}class Se extends Ee{constructor(e,t,n){super(e,t,n)}fresh(e){return new Se(this.condition,this.viewConditionId,this.buildViewConditionMatcher(e))}push(e,t){return 0==t?this.increment(e):1==t&&this.decrement(e),!1}pop(e,t){return 0==t?(this.decrement(e),!0):(1==t&&this.increment(e),!1)}}class Ne extends Ee{constructor(e,t,n){super(e,t,n),this.fired=!1}fresh(e){return new Ne(this.condition,this.viewConditionId,this.buildViewConditionMatcher(e))}push(e,t){return!!this.fired&&(this.decrement(e),!0)}pop(e,t){return this.fired?(this.decrement(e),!0):(0==t&&(this.fired=!0,this.increment(e)),!1)}}class Ce extends Ee{constructor(e,t,n){super(e,t,n),this.fired=!1}fresh(e){return new Ce(this.condition,this.viewConditionId,this.buildViewConditionMatcher(e))}push(e,t){return this.fired&&(-1==t?this.increment(e):0==t&&this.decrement(e)),!1}pop(e,t){if(this.fired){if(-1==t)return this.decrement(e),!0;0==t&&this.increment(e)}else 0==t&&(this.fired=!0,this.increment(e));return!1}}class ve{constructor(e,t){this.afterprop=e,this.element=t}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.processPseudoelementProps(this.afterprop,this.element),!0)}}class Te{constructor(e){this.lang=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.lang=this.lang,!0)}}class xe{constructor(e){this.oldQuotes=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return 0==t&&(e.quotes=this.oldQuotes,!0)}}class Ie extends s.d{constructor(e){super(),this.element=e}createValueFromString(e,t){switch(t){case"url":return e?new s.l(e):new s.l("about:invalid");case"string":default:return e?new s.k(e):new s.k("")}}visitFunc(e){if("attr"!==e.name)return super.visitFunc(e);let t="string",n=null,i=null;if(e.values[0]instanceof s.j){const i=e.values[0].values;i.length>=2&&(t=i[1].stringValue()),n=i[0].stringValue()}else n=e.values[0].stringValue();return i=e.values.length>1?this.createValueFromString(e.values[1].stringValue(),t):this.createValueFromString(null,t),this.element&&this.element.hasAttribute(n)?this.createValueFromString(this.element.getAttribute(n),t):i}}class Pe extends s.d{constructor(e,t,n){super(),this.cascade=e,this.element=t,this.counterResolver=n}visitIdent(e){const t=this.cascade,n=t.quotes,i=Math.floor(n.length/2)-1;switch(e.name){case"open-quote":{const e=n[2*Math.min(i,t.quoteDepth)];return t.quoteDepth++,e}case"close-quote":return t.quoteDepth>0&&t.quoteDepth--,n[2*Math.min(i,t.quoteDepth)+1];case"no-open-quote":return t.quoteDepth++,new s.k("");case"no-close-quote":return t.quoteDepth>0&&t.quoteDepth--,new s.k("")}return e}format(e,t){let n,i=!1,s=!1;null!=(n=t.match(/^upper-(.*)/))?(i=!0,t=n[1]):null!=(n=t.match(/^lower-(.*)/))&&(s=!0,t=n[1]);let r="";return Ae[t]?r=function(e,t){if(t>e[0]||t<=0||t!=Math.round(t))return"";let n="";for(let i=1;i<e.length;i+=2){const o=e[i];let s=Math.floor(t/o);if(s>20)return"";for(t-=s*o;s>0;)n+=e[i+1],s--}return n}(Ae[t],e):Oe[t]?r=function(e,t){if(t<=0||t!=Math.round(t))return"";const n=function(e){const t=[];let n=0;for(;n<e.length;)if("-"==e.substr(n+1,1)){const i=e.charCodeAt(n),o=e.charCodeAt(n+2);n+=3;for(let e=i;e<=o;e++)t.push(String.fromCharCode(e))}else t.push(e.substr(n++,1));return t}(e);let i="";do{const e=--t%n.length;i=n[e]+i,t=(t-e)/n.length}while(t>0);return i}(Oe[t],e):null!=ke[t]?r=ke[t]:"decimal-leading-zero"==t?1==(r=`${e}`).length&&(r=`0${r}`):r="cjk-ideographic"==t||"trad-chinese-informal"==t?function(e,t){if(e>9999||e<-9999)return`${e}`;if(0==e)return t.digits.charAt(0);const n=new o.d;if(e<0&&(n.append(t.negative),e=-e),e<10)n.append(t.digits.charAt(e));else if(!t.formal&&e<=19)n.append(t.markers.charAt(0)),0!=e&&n.append(t.digits.charAt(e-10));else{const i=Math.floor(e/1e3);i&&(n.append(t.digits.charAt(i)),n.append(t.markers.charAt(2)));const o=Math.floor(e/100)%10;o&&(n.append(t.digits.charAt(o)),n.append(t.markers.charAt(1)));const s=Math.floor(e/10)%10;s&&(n.append(t.digits.charAt(s)),n.append(t.markers.charAt(0)));const r=e%10;r&&n.append(t.digits.charAt(r))}return n.toString()}(e,Re):`${e}`,i?r.toUpperCase():s?r.toLowerCase():r}visitFuncCounter(e){const t=e[0].toString(),n=e.length>1?e[1].stringValue():"decimal",i=this.cascade.counters[t];if(i&&i.length){const e=i&&i.length&&i[i.length-1]||0;return new s.k(this.format(e,n))}{const e=this,i=new s.c(this.counterResolver.getPageCounterVal(t,t=>e.format(t||0,n)));return new s.j([i])}}visitFuncCounters(e){const t=e[0].toString(),n=e[1].stringValue(),i=e.length>2?e[2].stringValue():"decimal",r=this.cascade.counters[t],a=new o.d;if(r&&r.length)for(let e=0;e<r.length;e++)e>0&&a.append(n),a.append(this.format(r[e],i));const l=this,c=new s.c(this.counterResolver.getPageCountersVal(t,e=>{const t=[];if(e.length)for(let n=0;n<e.length;n++)t.push(l.format(e[n],i));const o=a.toString();return o.length&&t.push(o),t.length?t.join(n):l.format(0,i)}));return new s.j([c])}visitFuncTargetCounter(e){const t=e[0];let n;n=t instanceof s.l?t.url:t.stringValue();const i=e[1].toString(),o=e.length>2?e[2].stringValue():"decimal",r=this,a=new s.c(this.counterResolver.getTargetCounterVal(n,i,e=>r.format(e||0,o)));return new s.j([a])}visitFuncTargetCounters(e){const t=e[0];let n;n=t instanceof s.l?t.url:t.stringValue();const i=e[1].toString(),o=e[2].stringValue(),r=e.length>3?e[3].stringValue():"decimal",a=this,l=new s.c(this.counterResolver.getTargetCountersVal(n,i,e=>{const t=e.map(e=>a.format(e,r));return t.length?t.join(o):a.format(0,r)}));return new s.j([l])}visitFunc(e){switch(e.name){case"counter":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case"counters":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case"target-counter":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case"target-counters":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values)}return h.b.warn("E_CSS_CONTENT_PROP:",e.toString()),new s.k("")}}const Ae={roman:[4999,1e3,"M",900,"CM",500,"D",400,"CD",100,"C",90,"XC",50,"L",40,"XL",10,"X",9,"IX",5,"V",4,"IV",1,"I"],armenian:[9999,9e3,"ք",8e3,"փ",7e3,"ւ",6e3,"ց",5e3,"ր",4e3,"տ",3e3,"վ",2e3,"ս",1e3,"ռ",900,"ջ",800,"պ",700,"չ",600,"ո",500,"շ",400,"ն",300,"յ",200,"մ",100,"ճ",90,"ղ",80,"ձ",70,"հ",60,"կ",50,"ծ",40,"խ",30,"լ",20,"ի",10,"ժ",9,"թ",8,"ը",7,"է",6,"զ",5,"ե",4,"դ",3,"գ",2,"բ",1,"ա"],georgian:[19999,1e4,"ჵ",9e3,"ჰ",8e3,"ჯ",7e3,"ჴ",6e3,"ხ",5e3,"ჭ",4e3,"წ",3e3,"ძ",2e3,"ც",1e3,"ჩ",900,"შ",800,"ყ",700,"ღ",600,"ქ",500,"ფ",400,"ჳ",300,"ტ",200,"ს",100,"რ",90,"ჟ",80,"პ",70,"ო",60,"ჲ",50,"ნ",40,"მ",30,"ლ",20,"კ",10,"ი",9,"თ",8,"ჱ",7,"ზ",6,"ვ",5,"ე",4,"დ",3,"გ",2,"ბ",1,"ა"],hebrew:[999,400,"ת",300,"ש",200,"ר",100,"ק",90,"צ",80,"פ",70,"ע",60,"ס",50,"נ",40,"מ",30,"ל",20,"כ",19,"יט",18,"יח",17,"יז",16,"טז",15,"טו",10,"י",9,"ט",8,"ח",7,"ז",6,"ו",5,"ה",4,"ד",3,"ג",2,"ב",1,"א"]},Oe={latin:"a-z",alpha:"a-z",greek:"α-ρσ-ω",russian:"а-ик-щэ-я"},ke={square:"■",disc:"•",circle:"◦",none:""},Re={formal:!1,digits:"零一二三四五六七八九",markers:"十百千",negative:"負"},Le=1/1048576;function Fe(e,t){for(const n in e)t[n]=e[n].clone()}class De{constructor(){this.nsCount=0,this.nsPrefix={},this.tags={},this.nstags={},this.epubtypes={},this.classes={},this.ids={},this.pagetypes={},this.order=0}clone(){const e=new De;e.nsCount=this.nsCount;for(const t in this.nsPrefix)e.nsPrefix[t]=this.nsPrefix[t];return Fe(this.tags,e.tags),Fe(this.nstags,e.nstags),Fe(this.epubtypes,e.epubtypes),Fe(this.classes,e.classes),Fe(this.ids,e.ids),Fe(this.pagetypes,e.pagetypes),e.order=this.order,e}insertInTable(e,t,n){const i=e[t];i&&(n=i.mergeWith(n)),e[t]=n}createInstance(e,t,n,i){return new _e(this,e,t,n,i)}nextOrder(){return this.order+=Le}}class _e{constructor(e,t,n,i,o){this.context=t,this.counterListener=n,this.counterResolver=i,this.stack=[[],[]],this.conditions={},this.currentElement=null,this.currentElementOffset=null,this.currentStyle=null,this.currentClassNames=null,this.currentLocalName="",this.currentNamespace="",this.currentId="",this.currentXmlId="",this.currentNSTag="",this.currentEpubTypes=null,this.currentPageType=null,this.isFirst=!0,this.isRoot=!0,this.counters={},this.counterScoping=[{}],this.quoteDepth=0,this.lang="",this.siblingOrderStack=[0],this.currentSiblingOrder=0,this.siblingTypeCountsStack=[{}],this.currentFollowingSiblingOrder=null,this.followingSiblingTypeCountsStack=[{}],this.viewConditions={},this.dependentConditions=[],this.code=e,this.quotes=[new s.k("“"),new s.k("”"),new s.k("‘"),new s.k("’")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(e){this.stack[this.stack.length-1].push(e)}increment(e,t){this.conditions[e]=(this.conditions[e]||0)+1,t&&(this.viewConditions[e]?this.viewConditions[e].push(t):this.viewConditions[e]=[t])}decrement(e,t){this.conditions[e]--,this.viewConditions[e]&&(this.viewConditions[e]=this.viewConditions[e].filter(e=>e!==t),0===this.viewConditions[e].length&&delete this.viewConditions[e])}buildViewConditionMatcher(e){let t=null;e&&(i.a(this.currentElementOffset),t=u.a.buildViewConditionMatcher(this.currentElementOffset,e));const n=this.dependentConditions.map(e=>{const t=this.viewConditions[e];return t&&t.length>0?1===t.length?t[0]:u.a.buildAnyMatcher([].concat(t)):null}).filter(e=>e);return n.length<=0?t:null===t?1===n.length?n[0]:u.a.buildAllMatcher(n):u.a.buildAllMatcher([t].concat(n))}applyAction(e,t){const n=e[t];n&&n.apply(this)}pushRule(e,t,n){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=n,this.currentNamespace="",this.currentLocalName="",this.currentId="",this.currentXmlId="",this.currentClassNames=e,this.currentNSTag="",this.currentEpubTypes=Be,this.currentPageType=t,this.applyActions()}defineCounter(e,t){this.counters[e]?this.counters[e].push(t):this.counters[e]=[t];let n=this.counterScoping[this.counterScoping.length-1];n||(n={},this.counterScoping[this.counterScoping.length-1]=n),n[e]=!0}pushCounters(e){let t=s.t.inline;const n=e.display;n&&(t=n.evaluate(this.context));let i=null,r=null,l=null;const c=e["counter-reset"];if(c){const e=c.evaluate(this.context);e&&(i=a.b(e,!0))}const h=e["counter-set"];if(h){const e=h.evaluate(this.context);e&&(l=a.b(e,!1))}const u=e["counter-increment"];if(u){const e=u.evaluate(this.context);e&&(r=a.b(e,!1))}if("ol"!=this.currentLocalName&&"ul"!=this.currentLocalName||this.currentNamespace!=o.a.XHTML||(i||(i={}),i["ua-list-item"]=0),t===s.t.list_item&&(r||(r={}),r["ua-list-item"]=1),i)for(const e in i)this.defineCounter(e,i[e]);if(l)for(const e in l)if(this.counters[e]){const t=this.counters[e];t[t.length-1]=l[e]}else this.defineCounter(e,l[e]);if(r)for(const e in r){this.counters[e]||this.defineCounter(e,0);const t=this.counters[e];t[t.length-1]+=r[e]}if(t===s.t.list_item){const t=this.counters["ua-list-item"],n=t[t.length-1];e["ua-list-item-count"]=new T(new s.h(n),0)}this.counterScoping.push(null)}popCounters(){const e=this.counterScoping.pop();if(e)for(const t in e){const e=this.counters[t];e&&(1==e.length?delete this.counters[t]:e.pop())}}processPseudoelementProps(e,t){this.pushCounters(e),e.content&&(e.content=e.content.filterValue(new Pe(this,t,this.counterResolver))),this.popCounters()}pushElement(e,t,n){this.currentPageType=null,this.currentElement=e,this.currentElementOffset=n,this.currentStyle=t,this.currentNamespace=e.namespaceURI,this.currentLocalName=e.localName;const i=this.code.nsPrefix[this.currentNamespace];this.currentNSTag=i?i+this.currentLocalName:"",this.currentId=e.getAttribute("id"),this.currentXmlId=e.getAttributeNS(o.a.XML,"id");const r=e.getAttribute("class");this.currentClassNames=r?r.split(/\s+/):Be;const a=e.getAttributeNS(o.a.epub,"type");if(this.currentEpubTypes=a?a.split(/\s+/):Be,"style"==this.currentLocalName&&this.currentNamespace==o.a.FB2){const t=e.getAttribute("name")||"";this.currentClassNames=[t]}const l=o.u(e);l&&(this.stack[this.stack.length-1].push(new Te(this.lang)),this.lang=l.toLowerCase());const c=this.isRoot,h=this.siblingOrderStack;this.currentSiblingOrder=++h[h.length-1],h.push(0);const u=this.siblingTypeCountsStack,d=this.currentSiblingTypeCounts=u[u.length-1];let p=d[this.currentNamespace];p||(p=d[this.currentNamespace]={}),p[this.currentLocalName]=(p[this.currentLocalName]||0)+1,u.push({});const f=this.followingSiblingOrderStack;null!==f[f.length-1]?this.currentFollowingSiblingOrder=--f[f.length-1]:this.currentFollowingSiblingOrder=null,f.push(null);const g=this.followingSiblingTypeCountsStack,m=this.currentFollowingSiblingTypeCounts=g[g.length-1];m&&m[this.currentNamespace]&&m[this.currentNamespace][this.currentLocalName]--,g.push({}),this.applyActions(),this.applyAttrFilter(e);const b=t.quotes;let w=null;if(b){const e=b.evaluate(this.context);e&&(w=new xe(this.quotes),e===s.t.none?this.quotes=[new s.k(""),new s.k("")]:e instanceof s.j&&(this.quotes=e.values))}this.pushCounters(this.currentStyle);const E=this.currentId||this.currentXmlId||e.getAttribute("name")||"";if(c||E){const e={};Object.keys(this.counters).forEach(t=>{e[t]=Array.from(this.counters[t])}),this.counterListener.countersOfId(E,e)}const y=F(this.currentStyle,"_pseudos");if(y){let t=!0;for(const n of Me){n||(t=!1);const i=y[n];i&&(t?this.processPseudoelementProps(i,e):this.stack[this.stack.length-2].push(new ve(i,e)))}}w&&this.stack[this.stack.length-2].push(w)}applyAttrFilterInner(e,t){for(const n in t)O(n)&&(t[n]=t[n].filterValue(e))}applyAttrFilter(e){const t=new Ie(e),n=this.currentStyle,i=F(n,"_pseudos");for(const e in i)this.applyAttrFilterInner(t,i[e]);this.applyAttrFilterInner(t,n)}applyActions(){let e;for(e=0;e<this.currentClassNames.length;e++)this.applyAction(this.code.classes,this.currentClassNames[e]);for(e=0;e<this.currentEpubTypes.length;e++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[e]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),""!=this.currentLocalName&&this.applyAction(this.code.tags,"*"),this.applyAction(this.code.nstags,this.currentNSTag),null!==this.currentPageType&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,"*")),this.currentElement=null,this.currentDoc=null,this.stack.push([]);for(let t=1;t>=-1;--t){const n=this.stack[this.stack.length-t-2];for(e=0;e<n.length;)n[e].push(this,t)?n.splice(e,1):e++}this.isFirst=!0,this.isRoot=!1}pop(){for(let e=1;e>=-1;--e){const t=this.stack[this.stack.length-e-2];let n=0;for(;n<t.length;)t[n].pop(this,e)?t.splice(n,1):n++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(e){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}}const Be=[],Me=["before","transclusion-before","footnote-call","footnote-marker","inner","first-letter","first-line","","transclusion-after","after"];var Ue;!function(e){e[e.TOP=0]="TOP",e[e.SELECTOR=1]="SELECTOR",e[e.RULE=2]="RULE"}(Ue||(Ue={}));let ze=null;function Ve(e){ze=e}class He extends r.f{constructor(e,t,n,i,o,s,r){super(e,t,r),this.condition=n,this.regionId=o,this.validatorSet=s,this.chain=null,this.specificity=0,this.elementStyle=null,this.conditionCount=0,this.pseudoelement=null,this.footnoteContent=!1,this.viewConditionId=null,this.cascade=i?i.cascade:ze?ze.clone():new De,this.state=Ue.TOP}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,"*",e)}processChain(e){const t=V(this.chain,e);t!==e&&t.makePrimary(this.cascade)||this.insertNonPrimary(t)}isInsideSelectorRule(e){return this.state!=Ue.TOP&&(this.reportAndSkip(e),!0)}tagSelector(e,t){(t||e)&&(this.specificity+=1,t&&e?this.chain.push(new Q(e,t.toLowerCase())):t?this.chain.push(new Z(t.toLowerCase())):this.chain.push(new ee(e)))}classSelector(e){if(this.pseudoelement)return h.b.warn(`::${this.pseudoelement}`,`followed by .${e}`),void this.chain.push(new me(""));this.specificity+=256,this.chain.push(new q(e))}pseudoclassSelector(e,t){if(this.pseudoelement)return h.b.warn(`::${this.pseudoelement}`,`followed by :${e}`),void this.chain.push(new me(""));switch(e.toLowerCase()){case"enabled":this.chain.push(new pe);break;case"disabled":this.chain.push(new fe);break;case"checked":this.chain.push(new ge);break;case"root":this.chain.push(new ae);break;case"link":this.chain.push(new Z("a")),this.chain.push(new te("","href"));break;case"-adapt-href-epub-type":case"href-epub-type":if(t&&1==t.length&&"string"==typeof t[0]){const e=t[0],n=new RegExp(`(^|s)${o.s(e)}($|s)`);this.chain.push(new J(n))}else this.chain.push(new me(""));break;case"-adapt-footnote-content":case"footnote-content":this.footnoteContent=!0;break;case"visited":case"active":case"hover":case"focus":this.chain.push(new me(""));break;case"lang":if(t&&1==t.length&&"string"==typeof t[0]){const e=t[0];this.chain.push(new se(new RegExp(`^${o.s(e.toLowerCase())}($|-)`)))}else this.chain.push(new me(""));break;case"nth-child":case"nth-last-child":case"nth-of-type":case"nth-last-of-type":{const n=Ge[e.toLowerCase()];t&&2==t.length?this.chain.push(new n(t[0],t[1])):this.chain.push(new me(""));break}case"first-child":this.chain.push(new re);break;case"last-child":this.chain.push(new he(0,1));break;case"first-of-type":this.chain.push(new ce(0,1));break;case"last-of-type":this.chain.push(new ue(0,1));break;case"only-child":this.chain.push(new re),this.chain.push(new he(0,1));break;case"only-of-type":this.chain.push(new ce(0,1)),this.chain.push(new ue(0,1));break;case"empty":this.chain.push(new de);break;case"before":case"after":case"first-line":case"first-letter":return void this.pseudoelementSelector(e,t);default:h.b.warn(`unknown pseudo-class selector: ${e}`),this.chain.push(new me(""))}this.specificity+=256}pseudoelementSelector(e,t){switch(e){case"before":case"after":case"first-line":case"first-letter":case"footnote-call":case"footnote-marker":case"inner":case"after-if-continues":this.pseudoelement?(h.b.warn(`Double pseudoelement ::${this.pseudoelement}::${e}`),this.chain.push(new me(""))):this.pseudoelement=e;break;case"first-n-lines":if(t&&1==t.length&&"number"==typeof t[0]){const n=Math.round(t[0]);if(n>0&&n==t[0]){this.pseudoelement?(h.b.warn(`Double pseudoelement ::${this.pseudoelement}::${e}`),this.chain.push(new me(""))):this.pseudoelement=`first-${n}-lines`;break}}this.chain.push(new me(""));break;case"nth-fragment":t&&2==t.length?this.viewConditionId=`NFS_${t[0]}_${t[1]}`:this.chain.push(new me(""));break;default:h.b.warn(`Unrecognized pseudoelement: ::${e}`),this.chain.push(new me(""))}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new Y(e))}attributeSelector(e,t,n,i){let s;switch(this.specificity+=256,t=t.toLowerCase(),i=i||"",n){case l.a.EOF:s=new te(e,t);break;case l.a.EQ:s=new ne(e,t,i);break;case l.a.TILDE_EQ:s=!i||i.match(/\s/)?new me(""):new oe(e,t,new RegExp(`(^|\\s)${o.s(i)}($|\\s)`));break;case l.a.BAR_EQ:s=new oe(e,t,new RegExp(`^${o.s(i)}($|-)`));break;case l.a.HAT_EQ:s=i?new oe(e,t,new RegExp(`^${o.s(i)}`)):new me("");break;case l.a.DOLLAR_EQ:s=i?new oe(e,t,new RegExp(`${o.s(i)}$`)):new me("");break;case l.a.STAR_EQ:s=i?new oe(e,t,new RegExp(o.s(i))):new me("");break;case l.a.COL_COL:"supported"==i?s=new ie(e,t):(h.b.warn("Unsupported :: attr selector op:",i),s=new me(""));break;default:h.b.warn("Unsupported attr selector:",n),s=new me("")}this.chain.push(s)}descendantSelector(){const e=`d${$e++}`;this.processChain(new W(new ye(e,this.viewConditionId,null))),this.chain=[new me(e)],this.viewConditionId=null}childSelector(){const e=`c${$e++}`;this.processChain(new W(new Se(e,this.viewConditionId,null))),this.chain=[new me(e)],this.viewConditionId=null}adjacentSiblingSelector(){const e=`a${$e++}`;this.processChain(new W(new Ne(e,this.viewConditionId,null))),this.chain=[new me(e)],this.viewConditionId=null}followingSiblingSelector(){const e=`f${$e++}`;this.processChain(new W(new Ce(e,this.viewConditionId,null))),this.chain=[new me(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule("E_CSS_UNEXPECTED_SELECTOR")||(this.state=Ue.SELECTOR,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[])}error(e,t){super.error(e,t),this.state==Ue.SELECTOR&&(this.state=Ue.TOP)}startStylesheet(e){super.startStylesheet(e),this.state=Ue.TOP}startRuleBody(){this.finishChain(),super.startRuleBody(),this.state==Ue.SELECTOR&&(this.state=Ue.TOP)}endRule(){super.endRule(),this.insideSelectorRule=Ue.TOP}finishChain(){if(this.chain){const e=this.specificity+this.cascade.nextOrder();this.processChain(this.makeApplyRuleAction(e)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}}makeApplyRuleAction(e){let t=this.regionId;return this.footnoteContent&&(t=t?"xxx-bogus-xxx":"footnote"),new j(this.elementStyle,e,this.pseudoelement,t,this.viewConditionId)}special(e,t){let n;n=this.condition?new x(t,0,this.condition):new T(t,0),M(this.elementStyle,e).push(n)}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,n){"display"!=e||t!==s.t.oeb_page_head&&t!==s.t.oeb_page_foot||(this.simpleProperty("flow-options",new s.j([s.t.exclusive,s.t._static]),n),this.simpleProperty("flow-into",t,n),t=s.t.block),d.b("SIMPLE_PROPERTY").forEach(i=>{const o=i({name:e,value:t,important:n});e=o.name,t=o.value,n=o.important});const i=n?this.getImportantSpecificity():this.getBaseSpecificity(),o=this.condition?new x(t,i,this.condition):new T(t,i);L(this.elementStyle,e,o)}finish(){return this.cascade}startFuncWithSelector(e){switch(e){case"not":{const e=new We(this);e.startSelectorRule(),this.owner.pushHandler(e);break}}}}const Ge={"nth-child":class extends le{constructor(e,t){super(e,t)}apply(e){this.matchANPlusB(e.currentSiblingOrder)&&this.chained.apply(e)}getPriority(){return 5}},"nth-of-type":ce,"nth-last-child":he,"nth-last-of-type":ue};let $e=0;class We extends He{constructor(e){super(e.scope,e.owner,e.condition,e,e.regionId,e.validatorSet,!1),this.parent=e,this.parentChain=e.chain}startFuncWithSelector(e){"not"==e&&this.reportAndSkip("E_CSS_UNEXPECTED_NOT")}startRuleBody(){this.reportAndSkip("E_CSS_UNEXPECTED_RULE_BODY")}nextSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_NEXT_SELECTOR")}endFuncWithSelector(){this.chain&&this.chain.length>0&&this.parentChain.push(new we(this.chain)),this.parent.specificity+=this.specificity,this.owner.popHandler()}error(e,t){super.error(e,t),this.owner.popHandler()}}class Xe extends r.f{constructor(e,t){super(e,t,!1)}property(e,t,n){if(this.scope.values[e])this.error(`E_CSS_NAME_REDEFINED ${e}`,this.getCurrentToken());else{const n=e.match(/height|^(top|bottom)$/)?"vh":"vw",i=new c.x(this.scope,100,n);this.scope.defineName(e,t.toExpr(this.scope,i))}}}class je extends r.f{constructor(e,t,n,i,o){super(e,t,!1),this.condition=n,this.elementStyle=i,this.validatorSet=o,this.order=0}property(e,t,n){n?h.b.warn("E_IMPORTANT_NOT_ALLOWED"):this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){h.b.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){h.b.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,n){let i=n?this.getImportantSpecificity():this.getBaseSpecificity();i+=this.order,this.order+=Le;const o=this.condition?new x(t,i,this.condition):new T(t,i);L(this.elementStyle,e,o)}}class Ke extends r.b{constructor(e,t){super(e),this.validatorSet=t,this.elementStyle={},this.order=0}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){h.b.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){h.b.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,n){let i=n?r.e:r.d;i+=this.order,this.order+=Le;const o=new T(t,i);L(this.elementStyle,e,o)}}function qe(e,t){const n=_(e);n&&n.forEach(e=>{e.matcher.matches()&&t(e.styles)})}function Ye(e,t,n){qe(n,n=>{nt(e,n,t)})}function Ze(e,t,n,i){const o=new Ke(e,t),s=new l.b(i,o);try{r.j(s,o,n)}catch(e){h.b.warn(e,"Style attribute parse error:")}return o.elementStyle}function Qe(e,t,n){const i=e["writing-mode"];if(i){const e=i.evaluate(t,"writing-mode");if(e&&e!==s.t.inherit)return e===s.t.vertical_rl}return n}function Je(e,t,n){const i=e.direction;if(i){const e=i.evaluate(t,"direction");if(e&&e!==s.t.inherit)return e===s.t.rtl}return n}function et(e,t,n,i,o){const s={};for(const t in e)O(t)&&(s[t]=R(e,t));return Ye(s,t,e),tt(e,n,i,(e,n)=>{nt(s,n,t),Ye(s,t,n)}),s}function tt(e,t,n,i){const o=F(e,"_regions");if((t||n)&&o){if(n){const e=["footnote"];t=t?t.concat(e):e}for(const e of t){const t=o[e];t&&i(e,t)}}}function nt(e,t,n){for(const i in t)if(O(i)){const o=R(t,i),s=e[i];e[i]=I(n,s,o)}}const it=(e,t,n,i,o)=>{const s=n?i?C:S:i?v:N;for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];if(!i)continue;const r=s[n];let a;if(r){const t=e[r];if(t&&t.priority>i.priority)continue;a=E[r]?r:n}else a=n;t[a]=o(n,i)}}},function(e,t,n){"use strict";var i;function o(e){const t=Array.from(e);let n=null;return t[0]instanceof Error&&(n=t.shift()),{error:n,messages:t}}function s(e){const t=e.error,n=t&&(t.frameTrace||t.stack);let i=[].concat(e.messages);return t&&(i.length>0&&(i=i.concat(["\n"])),i=i.concat([t.toString()]),n&&(i=i.concat(["\n"]).concat(n))),i}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),function(e){e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR"}(i||(i={}));const r=new class{constructor(e){this.opt_console=e,this.listeners={}}consoleDebug(e){this.opt_console?this.opt_console.debug?this.opt_console.debug(...e):this.opt_console.log(...e):console.debug(...e)}consoleInfo(e){this.opt_console?this.opt_console.info?this.opt_console.info(...e):this.opt_console.log(...e):console.info(...e)}consoleWarn(e){this.opt_console?this.opt_console.warn?this.opt_console.warn(...e):this.opt_console.log(...e):console.warn(...e)}consoleError(e){this.opt_console?this.opt_console.error?this.opt_console.error(...e):this.opt_console.log(...e):console.error(...e)}triggerListeners(e,t){const n=this.listeners[e];n&&n.forEach(e=>{e(t)})}addListener(e,t){let n=this.listeners[e];n||(n=this.listeners[e]=[]),n.push(t)}debug(...e){const t=o(arguments);this.consoleDebug(s(t)),this.triggerListeners(i.DEBUG,t)}info(...e){const t=o(arguments);this.consoleInfo(s(t)),this.triggerListeners(i.INFO,t)}warn(...e){const t=o(arguments);this.consoleWarn(s(t)),this.triggerListeners(i.WARN,t)}error(...e){const t=o(arguments);this.consoleError(s(t)),this.triggerListeners(i.ERROR,t)}}},function(e,t,n){"use strict";function i(e){}function o(e){}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}))},function(e,t,n){"use strict";n.d(t,"s",(function(){return p})),n.d(t,"t",(function(){return f})),n.d(t,"d",(function(){return g})),n.d(t,"l",(function(){return w})),n.d(t,"m",(function(){return E})),n.d(t,"z",(function(){return S})),n.d(t,"p",(function(){return N})),n.d(t,"f",(function(){return C})),n.d(t,"g",(function(){return v})),n.d(t,"r",(function(){return T})),n.d(t,"q",(function(){return x})),n.d(t,"u",(function(){return P})),n.d(t,"w",(function(){return A})),n.d(t,"x",(function(){return O})),n.d(t,"v",(function(){return k})),n.d(t,"o",(function(){return R})),n.d(t,"n",(function(){return L})),n.d(t,"e",(function(){return D})),n.d(t,"k",(function(){return _})),n.d(t,"a",(function(){return B})),n.d(t,"h",(function(){return M})),n.d(t,"i",(function(){return U})),n.d(t,"j",(function(){return z})),n.d(t,"b",(function(){return V})),n.d(t,"c",(function(){return H})),n.d(t,"y",(function(){return G}));var i=n(7),o=n(1),s=n(0),r=n(10),a=n(20),l=n(2),c=n(27),h=n(4),u=n(11),d=n(15);const p={transform:!0,"transform-origin":!0},f={top:!0,bottom:!0,left:!0,right:!0};class g{constructor(e,t,n){this.target=e,this.name=t,this.value=n}}const m={show:function(e){e.style.visibility="visible"},hide:function(e){e.style.visibility="hidden"},play:function(e){e.currentTime=0,e.play()},pause:function(e){e.pause()},resume:function(e){e.play()},mute:function(e){e.muted=!0},unmute:function(e){e.muted=!1}};function b(e,t){const n=m[t];return n?()=>{for(let t=0;t<e.length;t++)try{n(e[t])}catch(e){}}:null}class w extends o.c{constructor(e,t){super(),this.container=e,this.bleedBox=t,this.pageAreaElement=null,this.delayedItems=[],this.elementsById={},this.dimensions={width:0,height:0},this.isFirstPage=!1,this.isLastPage=!1,this.isAutoPageWidth=!0,this.isAutoPageHeight=!0,this.spineIndex=0,this.position=null,this.offset=-1,this.side=null,this.fetchers=[],this.marginBoxes={top:{},bottom:{},left:{},right:{}};const n=this;this.hrefHandler=e=>{const t=e.currentTarget,i=t.getAttribute("href")||t.getAttributeNS(o.a.XLINK,"href");if(i){const o={type:"hyperlink",target:null,currentTarget:null,anchorElement:t,href:i,preventDefault(){e.preventDefault()}};n.dispatchEvent(o)}}}setAutoPageWidth(e){this.isAutoPageWidth=e,e?this.container.setAttribute(w.AUTO_PAGE_WIDTH_ATTRIBUTE,"true"):this.container.removeAttribute(w.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(e){this.isAutoPageHeight=e,e?this.container.setAttribute(w.AUTO_PAGE_HEIGHT_ATTRIBUTE,"true"):this.container.removeAttribute(w.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(e,t){const n=this.elementsById[t];n?n.push(e):this.elementsById[t]=[e]}finish(e,t){Object.keys(this.elementsById).forEach(e=>{const t=this.elementsById[e];for(let e=0;e<t.length;)this.container.contains(t[e])?e++:t.splice(e,1);0===t.length&&delete this.elementsById[e]});const n=this.delayedItems;for(let e=0;e<n.length;e++){const t=n[e];(t.target!==this.container||"transform"!==t.name||this.isAutoPageWidth||this.isAutoPageHeight)&&o.F(t.target,t.name,t.value.toString())}const i=t.getElementClientRect(this.container);this.dimensions.width=i.width,this.dimensions.height=i.height;for(let t=0;t<e.length;t++){const n=e[t],i=this.elementsById[n.ref],o=this.elementsById[n.observer];if(i&&o){const e=b(i,n.action);if(e)for(let t=0;t<o.length;t++)o[t].addEventListener(n.event,e,!1)}}}zoom(e){o.F(this.container,"transform",`scale(${e})`)}getPageAreaElement(){return this.pageAreaElement||this.container}}w.AUTO_PAGE_WIDTH_ATTRIBUTE="data-vivliostyle-auto-page-width",w.AUTO_PAGE_HEIGHT_ATTRIBUTE="data-vivliostyle-auto-page-height";const E="data-adapt-spec",y=d.f.Whitespace;function S(e){switch(e){case"normal":case"nowrap":return y.IGNORE;case"pre-line":return y.NEWLINE;case"pre":case"pre-wrap":return y.PRESERVE;default:return null}}function N(e,t){if(1==e.nodeType)return!1;const n=e.textContent;switch(t){case y.IGNORE:return!!n.match(/^\s*$/);case y.NEWLINE:return!!n.match(/^[ \t\f]*$/);case y.PRESERVE:return 0==n.length}throw new Error(`Unexpected whitespace: ${t}`)}class C{constructor(e,t){this.flowName=e,this.parentFlowName=t,this.forcedBreakOffsets=[],this.formattingContext=null}}class v{constructor(e,t,n,i,o,s,r,a,l){this.flowName=e,this.element=t,this.startOffset=n,this.priority=i,this.linger=o,this.exclusive=s,this.repeated=r,this.last=a,this.breakBefore=l,this.startPage=-1}isBetter(e){return!!this.exclusive&&(!e.exclusive||this.priority>e.priority||this.last)}}function T(e,t){return e.top-t.top}function x(e,t){return t.right-e.right}function I(e,t){return e===t||!(!e||!t)&&e.node===t.node&&e.shadowType===t.shadowType&&F(e.shadowContext,t.shadowContext)&&F(e.nodeShadow,t.nodeShadow)&&I(e.shadowSibling,t.shadowSibling)}function P(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.offsetInNode!==t.offsetInNode||e.after!==t.after||e.steps.length!==t.steps.length)return!1;for(let n=0;n<e.steps.length;n++)if(!I(e.steps[n],t.steps[n]))return!1;return!0}function A(e){return{steps:[{node:e,shadowType:R.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}function O(e,t){return{steps:[{node:e.sourceNode,shadowType:R.NONE,shadowContext:e.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:null!=t?t:e.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:e.preprocessedTextContent}}function k(e,t){const n=new _(e.node,t,0);return n.shadowType=e.shadowType,n.shadowContext=e.shadowContext,n.nodeShadow=e.nodeShadow,n.shadowSibling=e.shadowSibling?k(e.shadowSibling,t.copy()):null,n.formattingContext=e.formattingContext,n.fragmentIndex=e.fragmentIndex+1,n}const R=d.f.ShadowType;class L{constructor(e,t,n,i,o,s,r){this.owner=e,this.root=t,this.xmldoc=n,this.parentShadow=i,this.type=s,this.styler=r,this.subShadow=null,o&&(o.subShadow=this)}equals(e){return!!e&&this.owner===e.owner&&this.xmldoc===e.xmldoc&&this.type===e.type&&F(this.parentShadow,e.parentShadow)}}function F(e,t){return e===t||!!e&&!!t&&e.equals(t)}class D{constructor(e,t){this.outer=e,this.count=t}}class _{constructor(e,t,n){this.sourceNode=e,this.parent=t,this.boxOffset=n,this.offsetInNode=0,this.after=!1,this.nodeShadow=null,this.shadowSibling=null,this.shared=!1,this.inline=!0,this.overflow=!1,this.display=null,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.captionSide="top",this.inlineBorderSpacing=0,this.blockBorderSpacing=0,this.flexContainer=!1,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.breakBefore=null,this.breakAfter=null,this.viewNode=null,this.clearSpacer=null,this.lang=null,this.preprocessedTextContent=null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null,this.shadowType=R.NONE,this.shadowContext=t?t.shadowContext:null,this.breakPenalty=t?t.breakPenalty:0,this.floatReference=d.b.FloatReference.INLINE,this.whitespace=t?t.whitespace:y.IGNORE,this.hyphenateCharacter=t?t.hyphenateCharacter:null,this.breakWord=!!t&&t.breakWord,this.inheritedProps=t?t.inheritedProps:{},this.vertical=!!t&&t.vertical,this.direction=t?t.direction:"ltr",this.firstPseudo=t?t.firstPseudo:null,this.formattingContext=t?t.formattingContext:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=d.b.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:y.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=!!this.parent&&this.parent.breakWord,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=!!this.parent&&this.parent.vertical,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){const e=new _(this.sourceNode,this.parent,this.boxOffset);return e.offsetInNode=this.offsetInNode,e.after=this.after,e.nodeShadow=this.nodeShadow,e.shadowType=this.shadowType,e.shadowContext=this.shadowContext,e.shadowSibling=this.shadowSibling,e.inline=this.inline,e.breakPenalty=this.breakPenalty,e.display=this.display,e.floatReference=this.floatReference,e.floatSide=this.floatSide,e.clearSide=this.clearSide,e.floatMinWrapBlock=this.floatMinWrapBlock,e.columnSpan=this.columnSpan,e.verticalAlign=this.verticalAlign,e.captionSide=this.captionSide,e.inlineBorderSpacing=this.inlineBorderSpacing,e.blockBorderSpacing=this.blockBorderSpacing,e.establishesBFC=this.establishesBFC,e.containingBlockForAbsolute=this.containingBlockForAbsolute,e.flexContainer=this.flexContainer,e.whitespace=this.whitespace,e.hyphenateCharacter=this.hyphenateCharacter,e.breakWord=this.breakWord,e.breakBefore=this.breakBefore,e.breakAfter=this.breakAfter,e.viewNode=this.viewNode,e.clearSpacer=this.clearSpacer,e.firstPseudo=this.firstPseudo,e.vertical=this.vertical,e.overflow=this.overflow,e.preprocessedTextContent=this.preprocessedTextContent,e.formattingContext=this.formattingContext,e.repeatOnBreak=this.repeatOnBreak,e.pluginProps=Object.create(this.pluginProps),e.fragmentIndex=this.fragmentIndex,e.afterIfContinues=this.afterIfContinues,e.footnotePolicy=this.footnotePolicy,e}modify(){return this.shared?this.cloneItem():this}copy(){let e=this;do{if(e.shared)break;e.shared=!0,e=e.parent}while(e);return this}clone(){const e=this.cloneItem();let t,n=e;for(;null!=(t=n.parent);)t=t.cloneItem(),n.parent=t,n=t;return e}toNodePositionStep(){return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:this.fragmentIndex}}toNodePosition(){let e=this;const t=[];do{e.firstPseudo&&e.parent&&e.parent.firstPseudo!==e.firstPseudo||t.push(e.toNodePositionStep()),e=e.parent}while(e);return{steps:t,offsetInNode:this.preprocessedTextContent?c.c(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let e=this.parent;for(;e;){if(e.establishesBFC)return!0;e=e.parent}return!1}getContainingBlockForAbsolute(){let e=this.parent;for(;e;){if(e.containingBlockForAbsolute)return e;e=e.parent}return null}walkUpBlocks(e){let t=this;for(;t;)t.inline||e(t),t=t.parent}belongsTo(e){return this.formattingContext===e&&!!this.parent&&this.parent.formattingContext===e}}class B{constructor(e){this.primary=e,this.floats=null}clone(){const e=new B(this.primary);if(this.floats){e.floats=[];for(let t=0;t<this.floats.length;++t)e.floats[t]=this.floats[t]}return e}isSamePosition(e){if(!e)return!1;if(this===e)return!0;if(!P(this.primary,e.primary))return!1;if(this.floats){if(!e.floats||this.floats.length!==e.floats.length)return!1;for(let t=0;t<this.floats.length;t++)if(!P(this.floats[t],e.floats[t]))return!1}else if(e.floats)return!1;return!0}}class M{constructor(e,t){this.chunkPosition=e,this.flowChunk=t}clone(){return new M(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(e){return!!e&&(this===e||this.chunkPosition.isSamePosition(e.chunkPosition))}}class U{constructor(){this.positions=[],this.startSide="any",this.breakAfter=null}clone(){const e=new U,t=this.positions,n=e.positions;for(let e=0;e<t.length;e++)n[e]=t[e].clone();return e.startSide=this.startSide,e.breakAfter=this.breakAfter,e}isSamePosition(e){if(this===e)return!0;if(!e||this.positions.length!==e.positions.length)return!1;for(let t=0;t<this.positions.length;t++)if(!this.positions[t].isSamePosition(e.positions[t]))return!1;return!0}hasContent(e){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=e}}class z{constructor(){this.page=0,this.flows={},this.flowPositions={},this.highestSeenOffset=0}clone(){const e=new z;e.page=this.page,e.highestSeenNode=this.highestSeenNode,e.highestSeenOffset=this.highestSeenOffset,e.lookupPositionOffset=this.lookupPositionOffset,e.flows=this.flows;for(const t in this.flowPositions)e.flowPositions[t]=this.flowPositions[t].clone();return e}isSamePosition(e){if(this===e)return!0;if(!e||this.page!==e.page||this.highestSeenOffset!==e.highestSeenOffset)return!1;const t=Object.keys(this.flowPositions),n=Object.keys(e.flowPositions);if(t.length!==n.length)return!1;for(const n of t)if(!this.flowPositions[n].isSamePosition(e.flowPositions[n]))return!1;return!0}hasContent(e,t){const n=this.flowPositions[e];return!!n&&n.hasContent(t)}startSideOfFlow(e){const t=this.flowPositions[e];return t?t.startSide:"any"}firstFlowChunkOfFlow(e){const t=this.flowPositions[e];if(!t)return null;const n=t.positions[0];return n?n.flowChunk:null}}class V{constructor(e){this.element=e,this.left=0,this.top=0,this.marginLeft=0,this.marginRight=0,this.marginTop=0,this.marginBottom=0,this.borderLeft=0,this.borderRight=0,this.borderTop=0,this.borderBottom=0,this.paddingLeft=0,this.paddingRight=0,this.paddingTop=0,this.paddingBottom=0,this.width=0,this.height=0,this.originX=0,this.originY=0,this.exclusions=null,this.innerShape=null,this.computedBlockSize=0,this.snapWidth=0,this.snapHeight=0,this.snapOffsetX=0,this.snapOffsetY=0,this.vertical=!1}getInsetTop(){return this.marginTop+this.borderTop+this.paddingTop}getInsetBottom(){return this.marginBottom+this.borderBottom+this.paddingBottom}getInsetLeft(){return this.marginLeft+this.borderLeft+this.paddingLeft}getInsetRight(){return this.marginRight+this.borderRight+this.paddingRight}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(e){return this.vertical?e.right:e.top}getAfterEdge(e){return this.vertical?e.left:e.bottom}getStartEdge(e){return this.vertical?e.top:e.left}getEndEdge(e){return this.vertical?e.bottom:e.right}getInlineSize(e){return this.vertical?e.bottom-e.top:e.right-e.left}getBoxSize(e){return this.vertical?e.right-e.left:e.bottom-e.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return 1}copyFrom(e){this.element=e.element,this.left=e.left,this.top=e.top,this.marginLeft=e.marginLeft,this.marginRight=e.marginRight,this.marginTop=e.marginTop,this.marginBottom=e.marginBottom,this.borderLeft=e.borderLeft,this.borderRight=e.borderRight,this.borderTop=e.borderTop,this.borderBottom=e.borderBottom,this.paddingLeft=e.paddingLeft,this.paddingRight=e.paddingRight,this.paddingTop=e.paddingTop,this.paddingBottom=e.paddingBottom,this.width=e.width,this.height=e.height,this.originX=e.originX,this.originY=e.originY,this.innerShape=e.innerShape,this.exclusions=e.exclusions,this.computedBlockSize=e.computedBlockSize,this.snapWidth=e.snapWidth,this.snapHeight=e.snapHeight,this.vertical=e.vertical}setVerticalPosition(e,t){this.top=e,this.height=t,o.F(this.element,"top",`${e}px`),o.F(this.element,"height",`${t}px`)}setHorizontalPosition(e,t){this.left=e,this.width=t,o.F(this.element,"left",`${e}px`),o.F(this.element,"width",`${t}px`)}setBlockPosition(e,t){this.vertical?this.setHorizontalPosition(e+t*this.getBoxDir(),t):this.setVerticalPosition(e,t)}setInlinePosition(e,t){this.vertical?this.setVerticalPosition(e,t):this.setHorizontalPosition(e,t)}clear(){const e=this.element;let t;for(;t=e.lastChild;)e.removeChild(t)}getInnerShape(){const e=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(e.x1,e.y1):u.k(e.x1,e.y1,e.x2,e.y2)}getInnerRect(){const e=this.originX+this.left+this.getInsetLeft(),t=this.originY+this.top+this.getInsetTop();return new u.c(e,t,e+this.width,t+this.height)}getPaddingRect(){const e=this.originX+this.left+this.marginLeft+this.borderLeft,t=this.originY+this.top+this.marginTop+this.borderTop,n=this.paddingLeft+this.width+this.paddingRight,i=this.paddingTop+this.height+this.paddingBottom;return new u.c(e,t,e+n,t+i)}getOuterShape(e,t){const n=this.getOuterRect();return a.e(e,n.x1,n.y1,n.x2-n.x1,n.y2-n.y1,t)}getOuterRect(){const e=this.originX+this.left,t=this.originY+this.top,n=this.getInsetLeft()+this.width+this.getInsetRight(),i=this.getInsetTop()+this.height+this.getInsetBottom();return new u.c(e,t,e+n,t+i)}}class H extends s.m{constructor(e,t,n,i){super(),this.elem=e,this.context=t,this.rootContentValue=n,this.exprContentListener=i}visitStrInner(e,t){t||(t=this.elem.ownerDocument.createTextNode(e)),this.elem.appendChild(t)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue.url)this.elem.setAttribute("src",e.url);else{const t=this.elem.ownerDocument.createElementNS(o.a.XHTML,"img");t.setAttribute("src",e.url),this.elem.appendChild(t)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){const t=e.toExpr();let n=t.evaluate(this.context);if("string"==typeof n){t instanceof h.s&&(n=r.m(t.scope,new l.b(n,null),"").stringValue()),i.a(this.elem.ownerDocument);const e=this.exprContentListener(t,n,this.elem.ownerDocument);this.visitStrInner(n,e)}return null}}function G(e){return null!=e&&e!==s.t.normal&&e!==s.t.none&&e!==s.t.inherit}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return l}));var i,o=n(6);!function(e){e.SIMPLE_PROPERTY="SIMPLE_PROPERTY",e.PREPROCESS_SINGLE_DOCUMENT="PREPROCESS_SINGLE_DOCUMENT",e.PREPROCESS_TEXT_CONTENT="PREPROCESS_TEXT_CONTENT",e.PREPROCESS_ELEMENT_STYLE="PREPROCESS_ELEMENT_STYLE",e.POLYFILLED_INHERITED_PROPS="POLYFILLED_INHERITED_PROPS",e.CONFIGURATION="CONFIGURATION",e.RESOLVE_TEXT_NODE_BREAKER="RESOLVE_TEXT_NODE_BREAKER",e.RESOLVE_FORMATTING_CONTEXT="RESOLVE_FORMATTING_CONTEXT",e.RESOLVE_LAYOUT_PROCESSOR="RESOLVE_LAYOUT_PROCESSOR",e.POST_LAYOUT_BLOCK="POST_LAYOUT_BLOCK"}(i||(i={}));const s={};function r(e,t){if(i[e]){let n=s[e];n||(n=s[e]=[]),n.push(t)}else o.b.warn(new Error(`Skipping unknown plugin hook '${e}'.`))}function a(e){return s[e]||[]}const l={registerHook:r,removeHook:function(e,t){if(i[e]){const n=s[e];if(n){const e=n.indexOf(t);e>=0&&n.splice(e,1)}}else o.b.warn(new Error(`Ignoring unknown plugin hook '${e}'.`))}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return f})),n.d(t,"g",(function(){return b})),n.d(t,"h",(function(){return w})),n.d(t,"a",(function(){return y})),n.d(t,"f",(function(){return N})),n.d(t,"b",(function(){return z})),n.d(t,"k",(function(){return H})),n.d(t,"l",(function(){return G})),n.d(t,"m",(function(){return $})),n.d(t,"j",(function(){return W})),n.d(t,"i",(function(){return j}));var i=n(1),o=n(0),s=n(2),r=n(4),a=n(6),l=n(16),c=n(3);const h=0,u=16777216,d=33554432,p=50331648,f=67108864,g=83886080,m=100663296;var b;function w(e){let t=parseInt(e,16);if(isNaN(t))throw new Error("E_CSS_COLOR");if(6==e.length)return new o.a(t);if(3==e.length)return t=15&t|(15&t)<<4|(240&t)<<4|(240&t)<<8|(3840&t)<<8|(3840&t)<<12,new o.a(t);throw new Error("E_CSS_COLOR")}!function(e){e.USER_AGENT="UA",e.USER="User",e.AUTHOR="Author"}(b||(b={}));class E{constructor(e){this.scope=e,this.flavor=b.AUTHOR}getCurrentToken(){return null}getScope(){return this.scope}error(e,t){}startStylesheet(e){this.flavor=e}tagSelector(e,t){}classSelector(e){}pseudoclassSelector(e,t){}pseudoelementSelector(e,t){}idSelector(e){}attributeSelector(e,t,n,i){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startFootnoteRule(e){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(e){}startWhenRule(e){}startMediaRule(e){this.startWhenRule(e)}startFlowRule(e){}startPageTemplateRule(){}startPageMasterRule(e,t,n){}startPartitionRule(e,t,n){}startPartitionGroupRule(e,t,n){}startRuleBody(){}property(e,t,n){}endRule(){}startFuncWithSelector(e){}endFuncWithSelector(){}getImportantSpecificity(){switch(this.flavor){case b.USER_AGENT:return h;case b.USER:return m;default:return g}}getBaseSpecificity(){switch(this.flavor){case b.USER_AGENT:return h;case b.USER:return u;default:return d}}}class y extends E{constructor(){super(null),this.stack=[],this.tokenizer=null,this.slave=null}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,t){this.slave.error(e,t)}errorMsg(e,t){a.b.warn(e)}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,t){this.slave.tagSelector(e,t)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,t){this.slave.pseudoclassSelector(e,t)}pseudoelementSelector(e,t){this.slave.pseudoelementSelector(e,t)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,t,n,i){this.slave.attributeSelector(e,t,n,i)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,t,n){this.slave.startPageMasterRule(e,t,n)}startPartitionRule(e,t,n){this.slave.startPartitionRule(e,t,n)}startPartitionGroupRule(e,t,n){this.slave.startPartitionGroupRule(e,t,n)}startRuleBody(){this.slave.startRuleBody()}property(e,t,n){this.slave.property(e,t,n)}endRule(){this.slave.endRule()}startFuncWithSelector(e){this.slave.startFuncWithSelector(e)}endFuncWithSelector(){this.slave.endFuncWithSelector()}}class S extends E{constructor(e,t,n){super(e),this.owner=t,this.topLevel=n,this.depth=0,t&&(this.flavor=t.flavor)}getCurrentToken(){return this.owner.getCurrentToken()}error(e,t){this.owner.errorMsg(e,t)}startRuleBody(){this.depth++}endRule(){0!=--this.depth||this.topLevel||this.owner.popHandler()}}class N extends S{constructor(e,t,n){super(e,t,n)}report(e){this.error(e,this.getCurrentToken())}reportAndSkip(e){this.report(e),this.owner.pushHandler(new S(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR")}startFontFaceRule(){this.reportAndSkip("E_CSS_UNEXPECTED_FONT_FACE")}startFootnoteRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FOOTNOTE")}startViewportRule(){this.reportAndSkip("E_CSS_UNEXPECTED_VIEWPORT")}startDefineRule(){this.reportAndSkip("E_CSS_UNEXPECTED_DEFINE")}startRegionRule(){this.reportAndSkip("E_CSS_UNEXPECTED_REGION")}startPageRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE")}startWhenRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_WHEN")}startFlowRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FLOW")}startPageTemplateRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_TEMPLATE")}startPageMasterRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_MASTER")}startPartitionRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION")}startPartitionGroupRule(e,t,n){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION_GROUP")}startFuncWithSelector(e){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR_FUNC")}endFuncWithSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_END_SELECTOR_FUNC")}property(e,t,n){this.error("E_CSS_UNEXPECTED_PROPERTY",this.getCurrentToken())}}const C=[],v=[],T=[],x=[],I=[],P=[],A=[],O=[],k=[],R=[],L=[],F=[],D=[];var _;!function(e){e[e.SELECTOR_NAME_1=1]="SELECTOR_NAME_1",e[e.SELECTOR_NAME=2]="SELECTOR_NAME",e[e.SELECTOR_ANY_1=3]="SELECTOR_ANY_1",e[e.SELECTOR_ANY=4]="SELECTOR_ANY",e[e.SELECTOR_ID_1=5]="SELECTOR_ID_1",e[e.SELECTOR_ID=6]="SELECTOR_ID",e[e.SELECTOR_CLASS_1=7]="SELECTOR_CLASS_1",e[e.SELECTOR_CLASS=8]="SELECTOR_CLASS",e[e.SELECTOR_ATTR_1=9]="SELECTOR_ATTR_1",e[e.SELECTOR_ATTR=10]="SELECTOR_ATTR",e[e.SELECTOR_CHILD=11]="SELECTOR_CHILD",e[e.SELECTOR_SIBLING=12]="SELECTOR_SIBLING",e[e.SELECTOR_BODY=13]="SELECTOR_BODY",e[e.SELECTOR_PSEUDOCLASS=14]="SELECTOR_PSEUDOCLASS",e[e.VAL_IDENT=15]="VAL_IDENT",e[e.VAL_HASH=16]="VAL_HASH",e[e.VAL_NUM=17]="VAL_NUM",e[e.VAL_INT=18]="VAL_INT",e[e.VAL_NUMERIC=19]="VAL_NUMERIC",e[e.VAL_STR=20]="VAL_STR",e[e.VAL_URL=21]="VAL_URL",e[e.VAL_COMMA=22]="VAL_COMMA",e[e.VAL_SLASH=23]="VAL_SLASH",e[e.VAL_FUNC=24]="VAL_FUNC",e[e.VAL_C_PAR=25]="VAL_C_PAR",e[e.VAL_END=26]="VAL_END",e[e.RULE_END=27]="RULE_END",e[e.IDENT=28]="IDENT",e[e.SELECTOR_START=29]="SELECTOR_START",e[e.AT=30]="AT",e[e.EXPR_IDENT=31]="EXPR_IDENT",e[e.EXPR_NUM=32]="EXPR_NUM",e[e.EXPR_NUMERIC=33]="EXPR_NUMERIC",e[e.EXPR_STR=34]="EXPR_STR",e[e.EXPR_PARAM=35]="EXPR_PARAM",e[e.EXPR_PREFIX=36]="EXPR_PREFIX",e[e.EXPR_INFIX=37]="EXPR_INFIX",e[e.EXPR_FUNC=38]="EXPR_FUNC",e[e.EXPR_C_PAR=39]="EXPR_C_PAR",e[e.EXPR_O_PAR=40]="EXPR_O_PAR",e[e.SELECTOR_NEXT=41]="SELECTOR_NEXT",e[e.SELECTOR_PSEUDOELEM=42]="SELECTOR_PSEUDOELEM",e[e.EXPR_O_BRC=43]="EXPR_O_BRC",e[e.VAL_FINISH=44]="VAL_FINISH",e[e.EXPR_INFIX_NAME=45]="EXPR_INFIX_NAME",e[e.PROP=46]="PROP",e[e.VAL_BANG=47]="VAL_BANG",e[e.VAL_BRC=48]="VAL_BRC",e[e.EXPR_SEMICOL=49]="EXPR_SEMICOL",e[e.ERROR_PUSH=50]="ERROR_PUSH",e[e.ERROR_POP=51]="ERROR_POP",e[e.ERROR_POP_DECL=52]="ERROR_POP_DECL",e[e.ERROR_SEMICOL=53]="ERROR_SEMICOL",e[e.VAL_PLUS=54]="VAL_PLUS",e[e.SELECTOR_PSEUDOCLASS_1=55]="SELECTOR_PSEUDOCLASS_1",e[e.SELECTOR_FOLLOWING_SIBLING=56]="SELECTOR_FOLLOWING_SIBLING",e[e.DONE=200]="DONE"}(_||(_={}));const B=s.a.LAST+1;var M;C[s.a.IDENT]=_.IDENT,C[s.a.STAR]=_.SELECTOR_START,C[s.a.HASH]=_.SELECTOR_START,C[s.a.CLASS]=_.SELECTOR_START,C[s.a.O_BRK]=_.SELECTOR_START,C[s.a.COLON]=_.SELECTOR_START,C[s.a.AT]=_.AT,C[s.a.C_BRC]=_.RULE_END,C[s.a.EOF]=_.DONE,v[s.a.IDENT]=_.PROP,v[s.a.EOF]=_.DONE,P[s.a.IDENT]=_.SELECTOR_NAME,P[s.a.STAR]=_.SELECTOR_ANY,P[s.a.HASH]=_.SELECTOR_ID,P[s.a.CLASS]=_.SELECTOR_CLASS,P[s.a.O_BRK]=_.SELECTOR_ATTR,P[s.a.COLON]=_.SELECTOR_PSEUDOCLASS,T[s.a.GT]=_.SELECTOR_CHILD,T[s.a.PLUS]=_.SELECTOR_SIBLING,T[s.a.TILDE]=_.SELECTOR_FOLLOWING_SIBLING,T[s.a.IDENT]=_.SELECTOR_NAME_1,T[s.a.STAR]=_.SELECTOR_ANY_1,T[s.a.HASH]=_.SELECTOR_ID_1,T[s.a.CLASS]=_.SELECTOR_CLASS_1,T[s.a.O_BRK]=_.SELECTOR_ATTR_1,T[s.a.O_BRC]=_.SELECTOR_BODY,T[s.a.COLON]=_.SELECTOR_PSEUDOCLASS_1,T[s.a.COL_COL]=_.SELECTOR_PSEUDOELEM,T[s.a.COMMA]=_.SELECTOR_NEXT,x[s.a.IDENT]=_.SELECTOR_NAME_1,x[s.a.STAR]=_.SELECTOR_ANY_1,x[s.a.HASH]=_.SELECTOR_ID_1,x[s.a.CLASS]=_.SELECTOR_CLASS_1,x[s.a.O_BRK]=_.SELECTOR_ATTR_1,x[s.a.C_PAR]=_.DONE,x[s.a.COLON]=_.SELECTOR_PSEUDOCLASS_1,I[s.a.IDENT]=_.SELECTOR_NAME,I[s.a.STAR]=_.SELECTOR_ANY,I[s.a.HASH]=_.SELECTOR_ID,I[s.a.CLASS]=_.SELECTOR_CLASS,I[s.a.COLON]=_.SELECTOR_PSEUDOCLASS,I[s.a.COL_COL]=_.SELECTOR_PSEUDOELEM,I[s.a.O_BRK]=_.SELECTOR_ATTR,I[s.a.O_BRC]=_.SELECTOR_BODY,A[s.a.IDENT]=_.VAL_IDENT,A[s.a.HASH]=_.VAL_HASH,A[s.a.NUM]=_.VAL_NUM,A[s.a.INT]=_.VAL_INT,A[s.a.NUMERIC]=_.VAL_NUMERIC,A[s.a.STR]=_.VAL_STR,A[s.a.URL]=_.VAL_URL,A[s.a.COMMA]=_.VAL_COMMA,A[s.a.SLASH]=_.VAL_SLASH,A[s.a.FUNC]=_.VAL_FUNC,A[s.a.C_PAR]=_.VAL_C_PAR,A[s.a.SEMICOL]=_.VAL_END,A[s.a.C_BRC]=_.VAL_BRC,A[s.a.BANG]=_.VAL_BANG,A[s.a.PLUS]=_.VAL_PLUS,A[s.a.EOF]=_.VAL_FINISH,O[s.a.IDENT]=_.EXPR_IDENT,O[s.a.NUM]=_.EXPR_NUM,O[s.a.INT]=_.EXPR_NUM,O[s.a.NUMERIC]=_.EXPR_NUMERIC,O[s.a.STR]=_.EXPR_STR,O[s.a.O_PAR]=_.EXPR_O_PAR,O[s.a.FUNC]=_.EXPR_FUNC,O[s.a.BANG]=_.EXPR_PREFIX,O[s.a.MINUS]=_.EXPR_PREFIX,O[s.a.DOLLAR]=_.EXPR_PARAM,k[s.a.IDENT]=_.EXPR_INFIX_NAME,k[s.a.COMMA]=_.EXPR_INFIX,k[s.a.GT]=_.EXPR_INFIX,k[s.a.LT]=_.EXPR_INFIX,k[s.a.GT_EQ]=_.EXPR_INFIX,k[s.a.LT_EQ]=_.EXPR_INFIX,k[s.a.EQ]=_.EXPR_INFIX,k[s.a.EQ_EQ]=_.EXPR_INFIX,k[s.a.BANG_EQ]=_.EXPR_INFIX,k[s.a.AMP_AMP]=_.EXPR_INFIX,k[s.a.BAR_BAR]=_.EXPR_INFIX,k[s.a.PLUS]=_.EXPR_INFIX,k[s.a.MINUS]=_.EXPR_INFIX,k[s.a.SLASH]=_.EXPR_INFIX,k[s.a.PERCENT]=_.EXPR_INFIX,k[s.a.STAR]=_.EXPR_INFIX,k[s.a.COLON]=_.EXPR_INFIX,k[s.a.QMARK]=_.EXPR_INFIX,k[s.a.C_PAR]=_.EXPR_C_PAR,k[s.a.O_BRC]=_.EXPR_O_BRC,k[s.a.SEMICOL]=_.EXPR_SEMICOL,R[s.a.EOF]=_.DONE,R[s.a.O_BRC]=_.ERROR_PUSH,R[s.a.C_BRC]=_.ERROR_POP,R[s.a.O_BRK]=_.ERROR_PUSH,R[s.a.C_BRK]=_.ERROR_POP,R[s.a.O_PAR]=_.ERROR_PUSH,R[s.a.C_PAR]=_.ERROR_POP,R[s.a.SEMICOL]=_.ERROR_SEMICOL,L[s.a.EOF]=_.DONE,L[s.a.O_BRC]=_.ERROR_PUSH,L[s.a.C_BRC]=_.ERROR_POP_DECL,L[s.a.O_BRK]=_.ERROR_PUSH,L[s.a.C_BRK]=_.ERROR_POP,L[s.a.O_PAR]=_.ERROR_PUSH,L[s.a.C_PAR]=_.ERROR_POP,L[s.a.SEMICOL]=_.ERROR_SEMICOL,F[s.a.EOF]=_.DONE,F[s.a.O_BRC]=_.ERROR_PUSH,F[s.a.C_BRC]=_.ERROR_POP,F[s.a.O_BRK]=_.ERROR_PUSH,F[s.a.C_BRK]=_.ERROR_POP,F[s.a.O_PAR]=_.ERROR_PUSH,F[s.a.C_PAR]=_.ERROR_POP,D[s.a.C_PAR]=0,D[s.a.COMMA]=0,D[s.a.QMARK]=1,D[s.a.COLON]=1,D[s.a.AMP_AMP]=2,D[s.a.BAR_BAR]=2,D[s.a.LT]=3,D[s.a.GT]=3,D[s.a.LT_EQ]=3,D[s.a.GT_EQ]=3,D[s.a.EQ]=3,D[s.a.EQ_EQ]=3,D[s.a.BANG_EQ]=3,D[s.a.PLUS]=4,D[s.a.MINUS]=4,D[s.a.STAR]=5,D[s.a.SLASH]=5,D[s.a.PERCENT]=5,D[s.a.EOF]=6,D[B]=2,function(e){e[e.PROP=0]="PROP",e[e.WHEN=1]="WHEN",e[e.MEDIA=2]="MEDIA",e[e.IMPORT=3]="IMPORT"}(M||(M={}));class U{constructor(e,t,n,i){this.actions=e,this.tokenizer=t,this.handler=n,this.baseURL=i,this.valStack=[],this.namespacePrefixToURI={},this.defaultNamespaceURI=null,this.propName=null,this.propImportant=!1,this.result=null,this.importReady=!1,this.importURL=null,this.importCondition=null,this.errorBrackets=[],this.ruleStack=[],this.regionRule=!1,this.pageRule=!1,this.exprContext=M.MEDIA}extractVals(e,t){const n=[],i=this.valStack;for(;n.push(i[t++]),t!=i.length;)if(i[t++]!=e)throw new Error("Unexpected state");return n}valStackReduce(e,t){const n=this.valStack;let i,s=n.length;do{i=n[--s]}while(void 0!==i&&"string"!=typeof i);let r=n.length-(s+1);if(r>1&&n.splice(s+1,r,new o.j(n.slice(s+1,n.length))),","==e)return null;s++;do{i=n[--s]}while(void 0!==i&&("string"!=typeof i||","==i));if(r=n.length-(s+1),"("==i){if(")"!=e)return this.handler.error("E_CSS_MISMATCHED_C_PAR",t),this.actions=L,null;const i=new o.e(n[s-1],this.extractVals(",",s+1));return n.splice(s-1,r+2,i),null}return";"!=e||s>=0?(this.handler.error("E_CSS_UNEXPECTED_VAL_END",t),this.actions=L,null):r>1?new o.b(this.extractVals(",",s+1)):n[0]}exprError(e,t){this.actions=this.propName?L:R,this.handler.error(e,t)}exprStackReduce(e,t){const n=this.valStack,i=this.handler;let a,l=n.pop();for(;;){let c=n.pop();if(e==s.a.C_PAR){const t=[l];for(;c==s.a.COMMA;)t.unshift(n.pop()),c=n.pop();if("string"==typeof c){if("{"==c){for(;t.length>=2;){const e=t.shift(),n=t.shift(),o=new r.z(i.getScope(),e,n);t.unshift(o)}return n.push(new o.c(t[0])),!0}if("("==c){const o=n.pop(),a=n.pop();l=new r.d(i.getScope(),r.M(a,o),t),e=s.a.EOF;continue}}if(c==s.a.O_PAR){l.isMediaName()&&(l=new r.p(i.getScope(),l,null)),e=s.a.EOF;continue}}else if("string"==typeof c){n.push(c);break}if(c<0)if(c==-s.a.BANG)l=new r.w(i.getScope(),l);else{if(c!=-s.a.MINUS)return this.exprError("F_UNEXPECTED_STATE",t),!1;l=new r.v(i.getScope(),l)}else{if(D[e]>D[c]){n.push(c);break}switch(a=n.pop(),c){case s.a.AMP_AMP:l=new r.b(i.getScope(),a,l);break;case B:l=new r.c(i.getScope(),a,l);break;case s.a.BAR_BAR:l=new r.y(i.getScope(),a,l);break;case s.a.LT:l=new r.n(i.getScope(),a,l);break;case s.a.GT:l=new r.k(i.getScope(),a,l);break;case s.a.LT_EQ:l=new r.l(i.getScope(),a,l);break;case s.a.GT_EQ:l=new r.j(i.getScope(),a,l);break;case s.a.EQ:case s.a.EQ_EQ:l=new r.i(i.getScope(),a,l);break;case s.a.BANG_EQ:l=new r.u(i.getScope(),a,l);break;case s.a.PLUS:l=new r.a(i.getScope(),a,l);break;case s.a.MINUS:l=new r.B(i.getScope(),a,l);break;case s.a.STAR:l=new r.r(i.getScope(),a,l);break;case s.a.SLASH:l=new r.h(i.getScope(),a,l);break;case s.a.PERCENT:l=new r.q(i.getScope(),a,l);break;case s.a.COLON:if(!(n.length>1))return this.exprError("E_CSS_EXPR_COND",t),!1;switch(n[n.length-1]){case s.a.QMARK:n.pop(),l=new r.e(i.getScope(),n.pop(),a,l);break;case s.a.O_PAR:if(!a.isMediaName())return this.exprError("E_CSS_MEDIA_TEST",t),!1;l=new r.p(i.getScope(),a,l)}break;case s.a.QMARK:if(e!=s.a.COLON)return this.exprError("E_CSS_EXPR_COND",t),!1;case s.a.O_PAR:return n.push(a),n.push(c),n.push(l),!1;default:return this.exprError("F_UNEXPECTED_STATE",t),!1}}}return n.push(l),!1}readPseudoParams(){const e=[];for(;;){const t=this.tokenizer.token();switch(t.type){case s.a.IDENT:e.push(t.text);break;case s.a.PLUS:e.push("+");break;case s.a.NUM:case s.a.INT:e.push(t.num);break;default:return e}this.tokenizer.consume()}}readNthPseudoParams(){let e=!1,t=this.tokenizer.token();if(t.type===s.a.PLUS)e=!0,this.tokenizer.consume(),t=this.tokenizer.token();else if(t.type===s.a.IDENT&&("even"===t.text||"odd"===t.text))return this.tokenizer.consume(),[2,"odd"===t.text?1:0];switch(t.type){case s.a.NUMERIC:if(e&&t.num<0)return null;case s.a.IDENT:if(e&&"-"===t.text.charAt(0))return null;if("n"===t.text||"-n"===t.text){if(e&&t.precededBySpace)return null;let n="-n"===t.text?-1:1;t.type===s.a.NUMERIC&&(n=t.num);let i=0;this.tokenizer.consume();const o=(t=this.tokenizer.token()).type===s.a.MINUS,r=t.type===s.a.PLUS||o;if(r&&(this.tokenizer.consume(),t=this.tokenizer.token()),t.type===s.a.INT){if(1/(i=t.num)==-1/0){if(i=0,r)return null}else if(i<0){if(r)return null}else if(i>=0&&!r)return null;this.tokenizer.consume()}else if(r)return null;return[n,o&&i>0?-i:i]}if("n-"===t.text||"-n-"===t.text){if(e&&t.precededBySpace)return null;let n="-n-"===t.text?-1:1;if(t.type===s.a.NUMERIC&&(n=t.num),this.tokenizer.consume(),(t=this.tokenizer.token()).type===s.a.INT)return t.num<0||1/t.num==-1/0?null:(this.tokenizer.consume(),[n,t.num])}else{let n=t.text.match(/^n(-[0-9]+)$/);if(n)return e&&t.precededBySpace?null:(this.tokenizer.consume(),[t.type===s.a.NUMERIC?t.num:1,parseInt(n[1],10)]);if(n=t.text.match(/^-n(-[0-9]+)$/))return this.tokenizer.consume(),[-1,parseInt(n[1],10)]}return null;case s.a.INT:return e&&(t.precededBySpace||t.num<0)?null:(this.tokenizer.consume(),[0,t.num])}return null}makeCondition(e,t){const n=this.handler.getScope();if(!n)return null;if(t=t||n._true,e){const i=e.split(/\s+/);for(const e of i)switch(e){case"vertical":t=r.D(n,t,new r.w(n,new r.s(n,"pref-horizontal")));break;case"horizontal":t=r.D(n,t,new r.s(n,"pref-horizontal"));break;case"day":t=r.D(n,t,new r.w(n,new r.s(n,"pref-night-mode")));break;case"night":t=r.D(n,t,new r.s(n,"pref-night-mode"));break;default:t=n._false}}return t===n._true?null:new o.c(t)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case"[selector]":case"font-face":case"-epubx-flow":case"-epubx-viewport":case"-epubx-define":case"-adapt-footnote-area":return!0}return!1}runParser(e,t,n,a,l){const c=this.handler,h=this.tokenizer,u=this.valStack;let d,p,f,g,m,b,E;a&&(this.exprContext=M.MEDIA,this.valStack.push("{"));e:for(;e>0;--e)switch(d=h.token(),this.actions[d.type]){case _.IDENT:if(h.nthToken(1).type!=s.a.COLON){this.isInsidePropertyOnlyRule()?(c.error("E_CSS_COLON_EXPECTED",h.nthToken(1)),this.actions=L):(this.actions=P,c.startSelectorRule());continue}(p=h.nthToken(2)).precededBySpace||p.type!=s.a.IDENT&&p.type!=s.a.FUNC||h.mark(),this.propName=d.text,this.propImportant=!1,h.consume(),h.consume(),this.actions=A,u.splice(0,u.length);continue;case _.PROP:if(h.nthToken(1).type!=s.a.COLON){this.actions=L,c.error("E_CSS_COLON_EXPECTED",h.nthToken(1));continue}this.propName=d.text,this.propImportant=!1,h.consume(),h.consume(),this.actions=A,u.splice(0,u.length);continue;case _.SELECTOR_START:this.actions=P,c.startSelectorRule();continue;case _.SELECTOR_NAME_1:if(!d.precededBySpace){this.actions=F,c.error("E_CSS_SPACE_EXPECTED",d);continue}c.descendantSelector();case _.SELECTOR_NAME:if(h.nthToken(1).type==s.a.BAR)if(h.consume(),h.consume(),null!=(f=this.namespacePrefixToURI[d.text]))switch((d=h.token()).type){case s.a.IDENT:c.tagSelector(f,d.text),this.actions=l?x:T,h.consume();break;case s.a.STAR:c.tagSelector(f,null),this.actions=l?x:T,h.consume();break;default:this.actions=R,c.error("E_CSS_NAMESPACE",d)}else this.actions=R,c.error("E_CSS_UNDECLARED_PREFIX",d);else c.tagSelector(this.defaultNamespaceURI,d.text),this.actions=l?x:T,h.consume();continue;case _.SELECTOR_ANY_1:if(!d.precededBySpace){this.actions=F,c.error("E_CSS_SPACE_EXPECTED",d);continue}c.descendantSelector();case _.SELECTOR_ANY:if(h.nthToken(1).type==s.a.BAR)switch(h.consume(),h.consume(),(d=h.token()).type){case s.a.IDENT:c.tagSelector(null,d.text),this.actions=l?x:T,h.consume();break;case s.a.STAR:c.tagSelector(null,null),this.actions=l?x:T,h.consume();break;default:this.actions=R,c.error("E_CSS_NAMESPACE",d)}else c.tagSelector(this.defaultNamespaceURI,null),this.actions=l?x:T,h.consume();continue;case _.SELECTOR_ID_1:d.precededBySpace&&c.descendantSelector();case _.SELECTOR_ID:c.idSelector(d.text),this.actions=l?x:T,h.consume();continue;case _.SELECTOR_CLASS_1:d.precededBySpace&&c.descendantSelector();case _.SELECTOR_CLASS:c.classSelector(d.text),this.actions=l?x:T,h.consume();continue;case _.SELECTOR_PSEUDOCLASS_1:d.precededBySpace&&c.descendantSelector();case _.SELECTOR_PSEUDOCLASS:h.consume();t:switch((d=h.token()).type){case s.a.IDENT:c.pseudoclassSelector(d.text,null),h.consume(),this.actions=l?x:T;continue;case s.a.FUNC:switch(g=d.text,h.consume(),g){case"not":this.actions=P,c.startFuncWithSelector("not"),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0)?this.actions=T:this.actions=F;break e;case"lang":case"href-epub-type":if((d=h.token()).type===s.a.IDENT){E=[d.text],h.consume();break}break t;case"nth-child":case"nth-of-type":case"nth-last-child":case"nth-last-of-type":if(E=this.readNthPseudoParams())break;break t;default:E=this.readPseudoParams()}if((d=h.token()).type==s.a.C_PAR){c.pseudoclassSelector(g,E),h.consume(),this.actions=l?x:T;continue}}c.error("E_CSS_PSEUDOCLASS_SYNTAX",d),this.actions=R;continue;case _.SELECTOR_PSEUDOELEM:switch(h.consume(),(d=h.token()).type){case s.a.IDENT:c.pseudoelementSelector(d.text,null),this.actions=l?x:T,h.consume();continue;case s.a.FUNC:if(g=d.text,h.consume(),"nth-fragment"==g){if(null===(E=this.readNthPseudoParams()))break}else E=this.readPseudoParams();if((d=h.token()).type==s.a.C_PAR){c.pseudoelementSelector(g,E),this.actions=l?x:T,h.consume();continue}}c.error("E_CSS_PSEUDOELEM_SYNTAX",d),this.actions=R;continue;case _.SELECTOR_ATTR_1:d.precededBySpace&&c.descendantSelector();case _.SELECTOR_ATTR:if(h.consume(),(d=h.token()).type==s.a.IDENT)g=d.text,h.consume();else if(d.type==s.a.STAR)g=null,h.consume();else{if(d.type!=s.a.BAR){this.actions=F,c.error("E_CSS_ATTR",d),h.consume();continue}g=""}if((d=h.token()).type==s.a.BAR){if(null==(f=g?this.namespacePrefixToURI[g]:g)){this.actions=F,c.error("E_CSS_UNDECLARED_PREFIX",d),h.consume();continue}if(h.consume(),(d=h.token()).type!=s.a.IDENT){this.actions=F,c.error("E_CSS_ATTR_NAME_EXPECTED",d);continue}g=d.text,h.consume(),d=h.token()}else f="";switch(d.type){case s.a.EQ:case s.a.TILDE_EQ:case s.a.BAR_EQ:case s.a.HAT_EQ:case s.a.DOLLAR_EQ:case s.a.STAR_EQ:case s.a.COL_COL:m=d.type,h.consume(),d=h.token();break;case s.a.C_BRK:c.attributeSelector(f,g,s.a.EOF,null),this.actions=l?x:T,h.consume();continue;default:this.actions=F,c.error("E_CSS_ATTR_OP_EXPECTED",d);continue}switch(d.type){case s.a.IDENT:case s.a.STR:c.attributeSelector(f,g,m,d.text),h.consume(),d=h.token();break;default:this.actions=F,c.error("E_CSS_ATTR_VAL_EXPECTED",d);continue}if(d.type!=s.a.C_BRK){this.actions=F,c.error("E_CSS_ATTR",d);continue}this.actions=l?x:T,h.consume();continue;case _.SELECTOR_CHILD:c.childSelector(),this.actions=I,h.consume();continue;case _.SELECTOR_SIBLING:c.adjacentSiblingSelector(),this.actions=I,h.consume();continue;case _.SELECTOR_FOLLOWING_SIBLING:c.followingSiblingSelector(),this.actions=I,h.consume();continue;case _.SELECTOR_BODY:this.regionRule?(this.ruleStack.push("-epubx-region"),this.regionRule=!1):this.pageRule?(this.ruleStack.push("page"),this.pageRule=!1):this.ruleStack.push("[selector]"),c.startRuleBody(),this.actions=C,h.consume();continue;case _.SELECTOR_NEXT:c.nextSelector(),this.actions=P,h.consume();continue;case _.VAL_IDENT:u.push(o.r(d.text)),h.consume();continue;case _.VAL_HASH:m=parseInt(d.text,16);try{u.push(w(d.text))}catch(e){c.error("E_CSS_COLOR",d),this.actions=R}h.consume();continue;case _.VAL_NUM:u.push(new o.h(d.num)),h.consume();continue;case _.VAL_INT:u.push(new o.g(d.num)),h.consume();continue;case _.VAL_NUMERIC:r.K(d.text)?u.push(new o.c(new r.x(c.getScope(),d.num,d.text))):u.push(new o.i(d.num,d.text)),h.consume();continue;case _.VAL_STR:u.push(new o.k(d.text)),h.consume();continue;case _.VAL_URL:u.push(new o.l(i.C(d.text,this.baseURL))),h.consume();continue;case _.VAL_COMMA:this.valStackReduce(",",d),u.push(","),h.consume();continue;case _.VAL_SLASH:u.push(o.w),h.consume();continue;case _.VAL_FUNC:"-epubx-expr"==(g=d.text.toLowerCase())||"calc"==g||"env"==g?(this.actions=O,this.exprContext=M.PROP,u.push("{")):(u.push(g),u.push("(")),h.consume();continue;case _.VAL_C_PAR:this.valStackReduce(")",d),h.consume();continue;case _.VAL_BANG:if(h.consume(),d=h.token(),p=h.nthToken(1),d.type==s.a.IDENT&&"important"==d.text.toLowerCase()&&(p.type==s.a.SEMICOL||p.type==s.a.EOF||p.type==s.a.C_BRC)){h.consume(),this.propImportant=!0;continue}this.exprError("E_CSS_SYNTAX",d);continue;case _.VAL_PLUS:switch((p=h.nthToken(1)).type){case s.a.NUM:case s.a.NUMERIC:case s.a.INT:if(!p.precededBySpace){h.consume();continue}}if(this.actions===A&&h.hasMark()){h.reset(),this.actions=P,c.startSelectorRule();continue}this.exprError("E_CSS_UNEXPECTED_PLUS",d);continue;case _.VAL_END:h.consume();case _.VAL_BRC:h.unmark(),(b=this.valStackReduce(";",d))&&this.propName&&c.property(this.propName,b,this.propImportant),this.actions=n?v:C;continue;case _.VAL_FINISH:if(h.consume(),h.unmark(),b=this.valStackReduce(";",d),t)return this.result=b,!0;if(this.propName&&b&&c.property(this.propName,b,this.propImportant),n)return!0;this.exprError("E_CSS_SYNTAX",d);continue;case _.EXPR_IDENT:(p=h.nthToken(1)).type==s.a.CLASS?(h.nthToken(2).type!=s.a.O_PAR||h.nthToken(2).precededBySpace?(u.push(new r.s(c.getScope(),r.M(d.text,p.text))),this.actions=k):(u.push(d.text,p.text,"("),h.consume()),h.consume()):(this.exprContext==M.MEDIA||this.exprContext==M.IMPORT?"not"==d.text.toLowerCase()?(h.consume(),u.push(new r.o(c.getScope(),!0,p.text))):("only"==d.text.toLowerCase()&&(h.consume(),d=p),u.push(new r.o(c.getScope(),!1,d.text))):u.push(new r.s(c.getScope(),d.text)),this.actions=k),h.consume();continue;case _.EXPR_FUNC:u.push(null,d.text,"("),h.consume();continue;case _.EXPR_NUM:u.push(new r.f(c.getScope(),d.num)),h.consume(),this.actions=k;continue;case _.EXPR_NUMERIC:"%"==(g=d.text)&&(g=this.propName&&this.propName.match(/height|^(top|bottom)$/)?"vh":"vw"),u.push(new r.x(c.getScope(),d.num,g)),h.consume(),this.actions=k;continue;case _.EXPR_STR:u.push(new r.f(c.getScope(),d.text)),h.consume(),this.actions=k;continue;case _.EXPR_PARAM:h.consume(),(d=h.token()).type!=s.a.INT||d.precededBySpace?this.exprError("E_CSS_SYNTAX",d):(u.push(new r.A(c.getScope(),d.num)),h.consume(),this.actions=k);continue;case _.EXPR_PREFIX:u.push(-d.type),h.consume();continue;case _.EXPR_INFIX:this.actions=O,this.exprStackReduce(d.type,d),u.push(d.type),h.consume();continue;case _.EXPR_INFIX_NAME:"and"==d.text.toLowerCase()?(this.actions=O,this.exprStackReduce(B,d),u.push(B),h.consume()):this.exprError("E_CSS_SYNTAX",d);continue;case _.EXPR_C_PAR:this.exprStackReduce(d.type,d)&&(this.propName?this.actions=A:this.exprError("E_CSS_UNBALANCED_PAR",d)),h.consume();continue;case _.EXPR_O_BRC:this.exprStackReduce(s.a.C_PAR,d)&&(this.propName||this.exprContext==M.IMPORT?this.exprError("E_CSS_UNEXPECTED_BRC",d):(this.exprContext==M.WHEN?c.startWhenRule(u.pop()):c.startMediaRule(u.pop()),this.ruleStack.push("media"),c.startRuleBody(),this.actions=C)),h.consume();continue;case _.EXPR_SEMICOL:if(this.exprStackReduce(s.a.C_PAR,d)){if(!this.propName&&this.exprContext==M.IMPORT)return this.importCondition=u.pop(),this.importReady=!0,this.actions=C,h.consume(),!1;this.exprError("E_CSS_UNEXPECTED_SEMICOL",d)}h.consume();continue;case _.EXPR_O_PAR:u.push(d.type),h.consume();continue;case _.RULE_END:this.actions=C,h.consume(),c.endRule(),this.ruleStack.length&&this.ruleStack.pop();continue;case _.AT:switch(g=d.text.toLowerCase()){case"import":if(h.consume(),(d=h.token()).type==s.a.STR||d.type==s.a.URL){if(this.importURL=d.text,h.consume(),(d=h.token()).type==s.a.SEMICOL||d.type==s.a.EOF)return this.importReady=!0,h.consume(),!1;this.propName=null,this.exprContext=M.IMPORT,this.actions=O,u.push("{");continue}c.error("E_CSS_IMPORT_SYNTAX",d),this.actions=R;continue;case"namespace":switch(h.consume(),(d=h.token()).type){case s.a.IDENT:if(g=d.text,h.consume(),((d=h.token()).type==s.a.STR||d.type==s.a.URL)&&h.nthToken(1).type==s.a.SEMICOL){this.namespacePrefixToURI[g]=d.text,h.consume(),h.consume();continue}break;case s.a.STR:case s.a.URL:if(h.nthToken(1).type==s.a.SEMICOL){this.defaultNamespaceURI=d.text,h.consume(),h.consume();continue}}c.error("E_CSS_NAMESPACE_SYNTAX",d),this.actions=R;continue;case"charset":if(h.consume(),(d=h.token()).type==s.a.STR&&h.nthToken(1).type==s.a.SEMICOL){"utf-8"!=(g=d.text.toLowerCase())&&"utf-16"!=g&&c.error(`E_CSS_UNEXPECTED_CHARSET ${g}`,d),h.consume(),h.consume();continue}c.error("E_CSS_CHARSET_SYNTAX",d),this.actions=R;continue;case"font-face":case"-epubx-page-template":case"-epubx-define":case"-epubx-viewport":if(h.nthToken(1).type==s.a.O_BRC){switch(h.consume(),h.consume(),g){case"font-face":c.startFontFaceRule();break;case"-epubx-page-template":c.startPageTemplateRule();break;case"-epubx-define":c.startDefineRule();break;case"-epubx-viewport":c.startViewportRule()}this.ruleStack.push(g),c.startRuleBody();continue}break;case"-adapt-footnote-area":switch(h.consume(),(d=h.token()).type){case s.a.O_BRC:h.consume(),c.startFootnoteRule(null),this.ruleStack.push(g),c.startRuleBody();continue;case s.a.COL_COL:if(h.consume(),(d=h.token()).type==s.a.IDENT&&h.nthToken(1).type==s.a.O_BRC){g=d.text,h.consume(),h.consume(),c.startFootnoteRule(g),this.ruleStack.push("-adapt-footnote-area"),c.startRuleBody();continue}}break;case"-epubx-region":h.consume(),c.startRegionRule(),this.regionRule=!0,this.actions=P;continue;case"page":h.consume(),c.startPageRule(),this.pageRule=!0,this.actions=I;continue;case"top-left-corner":case"top-left":case"top-center":case"top-right":case"top-right-corner":case"right-top":case"right-middle":case"right-bottom":case"bottom-right-corner":case"bottom-right":case"bottom-center":case"bottom-left":case"bottom-left-corner":case"left-bottom":case"left-middle":case"left-top":if(h.consume(),(d=h.token()).type==s.a.O_BRC){h.consume(),c.startPageMarginBoxRule(g),this.ruleStack.push(g),c.startRuleBody();continue}break;case"-epubx-when":h.consume(),this.propName=null,this.exprContext=M.WHEN,this.actions=O,u.push("{");continue;case"media":h.consume(),this.propName=null,this.exprContext=M.MEDIA,this.actions=O,u.push("{");continue;case"-epubx-flow":if(h.nthToken(1).type==s.a.IDENT&&h.nthToken(2).type==s.a.O_BRC){c.startFlowRule(h.nthToken(1).text),h.consume(),h.consume(),h.consume(),this.ruleStack.push(g),c.startRuleBody();continue}break;case"-epubx-page-master":case"-epubx-partition":case"-epubx-partition-group":{h.consume();let e=null,t=null;const n=[];for((d=h.token()).type==s.a.IDENT&&(e=d.text,h.consume(),d=h.token()),d.type==s.a.COLON&&h.nthToken(1).type==s.a.IDENT&&(t=h.nthToken(1).text,h.consume(),h.consume(),d=h.token());d.type==s.a.FUNC&&"class"==d.text.toLowerCase()&&h.nthToken(1).type==s.a.IDENT&&h.nthToken(2).type==s.a.C_PAR;)n.push(h.nthToken(1).text),h.consume(),h.consume(),h.consume(),d=h.token();if(d.type==s.a.O_BRC){switch(h.consume(),g){case"-epubx-page-master":c.startPageMasterRule(e,t,n);break;case"-epubx-partition":c.startPartitionRule(e,t,n);break;case"-epubx-partition-group":c.startPartitionGroupRule(e,t,n)}this.ruleStack.push(g),c.startRuleBody();continue}break}case"":c.error(`E_CSS_UNEXPECTED_AT${g}`,d),this.actions=F;continue;default:c.error(`E_CSS_AT_UNKNOWN ${g}`,d),this.actions=R;continue}c.error(`E_CSS_AT_SYNTAX ${g}`,d),this.actions=R;continue;case _.ERROR_PUSH:if(t||n)return!0;this.errorBrackets.push(d.type+1),h.consume();continue;case _.ERROR_POP_DECL:if(t||n)return!0;if(0==this.errorBrackets.length){this.actions=C;continue}case _.ERROR_POP:this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==d.type&&this.errorBrackets.pop(),0==this.errorBrackets.length&&d.type==s.a.C_BRC&&(this.actions=C),h.consume();continue;case _.ERROR_SEMICOL:if(t||n)return!0;0==this.errorBrackets.length&&(this.actions=C),h.consume();continue;case _.DONE:return l&&(h.consume(),c.endFuncWithSelector()),!0;default:if(t||n)return!0;if(a)return!!this.exprStackReduce(s.a.C_PAR,d)&&(this.result=u.pop(),!0);if(l)return d.type==s.a.INVALID?c.error(d.text,d):c.error("E_CSS_SYNTAX",d),!1;if(this.actions===A&&h.hasMark()){h.reset(),this.actions=P,c.startSelectorRule();continue}if(this.actions!==R&&this.actions!==F&&this.actions!==L){d.type==s.a.INVALID?c.error(d.text,d):c.error("E_CSS_SYNTAX",d),this.isInsidePropertyOnlyRule()?this.actions=L:this.actions=F;continue}h.consume();continue}return!1}}class z extends E{constructor(e){super(null),this.scope=e}error(e,t){throw new Error(e)}getScope(){return this.scope}}function V(e,t,n,o,r){const a=c.c("parseStylesheet"),l=new U(C,e,t,n);let h=null;return r&&(h=function(e,t,n){const i=new U(O,e,t,n);return i.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),i.result}(new s.b(r,t),t,n)),(h=l.makeCondition(o,h&&h.toExpr()))&&(t.startMediaRule(h),t.startRuleBody()),a.loop(()=>{for(;!l.runParser(100,!1,!1,!1,!1);){if(l.importReady){const e=i.C(l.importURL,n);l.importCondition&&(t.startMediaRule(l.importCondition),t.startRuleBody());const o=c.c("parseStylesheet.import");return G(e,t,null,null).then(()=>{l.importCondition&&t.endRule(),l.importReady=!1,l.importURL=null,l.importCondition=null,o.finish(!0)}),o.result()}const e=a.timeSlice();if(e.isPending)return e}return c.d(!1)}).then(()=>{h&&t.endRule(),a.finish(!0)}),a.result()}function H(e,t,n,i,o){return c.b("parseStylesheetFromText",r=>{V(new s.b(e,t),t,n,i,o).thenFinish(r)},(t,n)=>{a.b.warn(n,`Failed to parse stylesheet text: ${e}`),t.finish(!1)})}function G(e,t,n,i){return c.b("parseStylesheetFromURL",o=>{l.c(e).then(s=>{s.responseText?H(s.responseText,t,e,n,i).then(t=>{t||a.b.warn(`Failed to parse stylesheet from ${e}`),o.finish(!0)}):o.finish(!0)})},(t,n)=>{a.b.warn(n,"Exception while fetching and parsing:",e),t.finish(!0)})}function $(e,t,n){const i=new U(A,t,new z(e),n);return i.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),i.result}function W(e,t,n){new U(v,e,t,n).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}const X={"z-index":!0,"column-count":!0,"flow-linger":!0,opacity:!0,page:!0,"flow-priority":!0,utilization:!0};function j(e,t,n){return t.isExpr()?function(e,t,n){const i=t.evaluate(e);switch(typeof i){case"number":return function(e){return!!X[e]}(n)?i==Math.round(i)?new o.g(i):new o.h(i):new o.i(i,"px");case"string":return i?$(t.scope,new s.b(i,null),""):o.o;case"boolean":return i?o.t._true:o.t._false;case"undefined":return o.o}throw new Error("E_UNEXPECTED")}(e,t.expr,n):t}},function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return h})),n.d(t,"j",(function(){return u})),n.d(t,"k",(function(){return d})),n.d(t,"i",(function(){return w})),n.d(t,"m",(function(){return E})),n.d(t,"l",(function(){return S})),n.d(t,"g",(function(){return v})),n.d(t,"f",(function(){return T})),n.d(t,"h",(function(){return x})),n.d(t,"e",(function(){return I}));var i=n(6);class o{constructor(e,t,n,i){this.x1=e,this.y1=t,this.x2=n,this.y2=i}}class s{constructor(e,t){this.x=e,this.y=t}}class r{constructor(e,t,n,i){this.left=e,this.top=t,this.right=n,this.bottom=i}}class a{constructor(e,t,n,i){this.low=e,this.high=t,this.winding=n,this.shapeId=i}}class l{constructor(e,t,n,i){this.y1=e,this.y2=t,this.x1=n,this.x2=i,this.left=null,this.right=null}}function c(e,t){return e.low.y-t.low.y||e.low.x-t.low.x}class h{constructor(e){this.points=e}addSegments(e,t){const n=this.points,i=n.length;let o=n[i-1];for(let s=0;s<i;s++){const i=n[s];let r;r=o.y<i.y?new a(o,i,1,t):new a(i,o,-1,t),e.push(r),o=i}}withOffset(e,t){const n=[];for(const i of this.points)n.push(new s(i.x+e,i.y+t));return new h(n)}}function u(e,t,n,i){const o=[];for(let r=0;r<20;r++){const a=2*r*Math.PI/20;o.push(new s(e+n*Math.sin(a),t+i*Math.cos(a)))}return new h(o)}function d(e,t,n,i){return new h([new s(e,t),new s(n,t),new s(n,i),new s(e,i)])}class p{constructor(e,t,n,i){this.x=e,this.winding=t,this.shapeId=n,this.lowOrHigh=i}}function f(e,t){const n=e.low.x+(e.high.x-e.low.x)*(t-e.low.y)/(e.high.y-e.low.y);if(isNaN(n))throw new Error("Bad intersection");return n}function g(e,t,n,o){let s,r,a,l;t.high.y<n&&i.b.warn("Error: inconsistent segment (1)"),t.low.y<=n?(s=f(t,n),r=t.winding):(s=t.low.x,r=0),t.high.y>=o?(a=f(t,o),l=t.winding):(a=t.high.x,l=0),s<a?(e.push(new p(s,r,t.shapeId,-1)),e.push(new p(a,l,t.shapeId,1))):(e.push(new p(a,l,t.shapeId,-1)),e.push(new p(s,r,t.shapeId,1)))}function m(e,t,n){const i=t+n,o=Array(i),s=Array(i);let r;for(r=0;r<=i;r++)o[r]=0,s[r]=0;const a=[];let l=!1;const c=e.length;for(let n=0;n<c;n++){const c=e[n];o[c.shapeId]+=c.winding,s[c.shapeId]+=c.lowOrHigh;let h=!1;for(r=0;r<t;r++)if(o[r]&&!s[r]){h=!0;break}if(h)for(r=t;r<=i;r++)if(o[r]||s[r]){h=!1;break}l!=h&&(a.push(c.x),l=h)}return a}function b(e,t){return t?Math.floor(e/t)*t:e}function w(e){return new o(e.y1,-e.x2,e.y2,-e.x1)}function E(e){return new o(-e.y2,e.x1,-e.y1,e.x2)}function y(e){return new h(e.points.map(e=>(function(e){return new s(e.y,-e.x)})(e)))}function S(e,t,n,i,o,s){s&&(e=w(e),t=t.map(e=>y(e)),n=n.map(e=>y(e)));const r=t.length,a=n?n.length:0,h=[],u=[];let d,p,f;for(d=0;d<r;d++)t[d].addSegments(u,d);for(d=0;d<a;d++)n[d].addSegments(u,d+r);const E=u.length;u.sort(c);let S=0;for(;u[S].shapeId>=r;)S++;let C=u[S].low.y;C>e.y1&&h.push(new l(e.y1,C,e.x2,e.x2));let v=0;const T=[];for(;v<E&&(f=u[v]).low.y<C;)f.high.y>C&&T.push(f),v++;for(;v<E||T.length>0;){let t=e.y2;const n=Math.min((x=Math.ceil(C+i),(I=o)?Math.ceil(x/I)*I:x),e.y2);for(p=0;p<T.length&&t>n;p++)(f=T[p]).low.x==f.high.x?f.high.y<t&&(t=Math.max(b(f.high.y,o),n)):f.low.x!=f.high.x&&(t=n);for(t>e.y2&&(t=e.y2);v<E&&(f=u[v]).low.y<t;)if(f.high.y<C)v++;else{if(!(f.low.y<n)){const e=b(f.low.y,o);e<t&&(t=e);break}f.low.y==f.high.y&&f.low.y==C||(T.push(f),t=n),v++}const s=[];for(p=0;p<T.length;p++)g(s,T[p],C,t);s.sort((e,t)=>e.x-t.x||e.lowOrHigh-t.lowOrHigh);const c=m(s,r,a);if(0==c.length)h.push(new l(C,t,e.x2,e.x2));else{let n=0,i=e.x1;for(p=0;p<c.length;p+=2){const t=Math.max(e.x1,c[p]),o=Math.min(e.x2,c[p+1])-t;o>n&&(n=o,i=t)}0==n?h.push(new l(C,t,e.x2,e.x2)):h.push(new l(C,t,Math.max(i,e.x1),Math.min(i+n,e.x2)))}if(t==e.y2)break;for(C=t,p=T.length-1;p>=0;p--)T[p].high.y<=t&&T.splice(p,1)}var x,I;return N(e,h),h}function N(e,t){let n=t.length-1,i=new l(e.y2,e.y2,e.x1,e.x2);for(;n>=0;){const e=i;((i=t[n]).y2-i.y1<1||i.x1==e.x1&&i.x2==e.x2)&&(e.y1=i.y1,t.splice(n,1),i=e),n--}}function C(e,t){let n=0,i=e.length;for(;n<i;){const o=Math.floor((n+i)/2);t>=e[o].y2?n=o+1:i=o}return n}function v(e,t){if(!e.length)return t;let n,i,s=t.y1;for(i=0;i<e.length&&!((n=e[i]).y2>t.y1&&n.x1-.1<=t.x1&&n.x2+.1>=t.x2);i++)s=Math.max(s,n.y2);let r=s;for(;i<e.length&&!((n=e[i]).y1>=t.y2||n.x1-.1>t.x1||n.x2+.1<t.x2);i++)r=n.y2;return(r=i===e.length?t.y2:Math.min(r,t.y2))<=s?null:new o(t.x1,s,t.x2,r)}function T(e,t){if(!e.length)return t;let n,i,s=t.y2;for(i=e.length-1;i>=0&&(n=e[i],!(i===e.length-1&&n.y2<t.y2))&&!(n.y1<t.y2&&n.x1-.1<=t.x1&&n.x2+.1>=t.x2);i--)s=Math.min(s,n.y1);let r=Math.min(s,n.y2);for(;i>=0&&!((n=e[i]).y2<=t.y1||n.x1-.1>t.x1||n.x2+.1<t.x2);i--)r=n.y1;return s<=(r=Math.max(r,t.y1))?null:new o(t.x1,r,t.x2,s)}function x(e,t,n,i){let o=n.y1;const s=n.x2-n.x1,r=n.y2-n.y1;let a=C(t,o);for(;;){const l=o+r;if(l>e.y2)return!1;let c=e.x1,h=e.x2;for(let e=a;e<t.length&&t[e].y1<l;e++){const n=t[e];n.x1>c&&(c=n.x1),n.x2<h&&(h=n.x2)}if(c+s<=h||a>=t.length)return"left"==i?(n.x1=c,n.x2=c+s):(n.x1=h-s,n.x2=h),n.y2+=o-n.y1,n.y1=o,!0;o=t[a].y2,a++}}function I(e,t,n,i,o){for(i||(i=[new l(n.y1,n.y2,n.x1,n.x2)]);i.length>0&&i[0].y2<=e.y1;)i.shift();if(0==i.length)return;let s;i[0].y1<e.y1&&(i[0].y1=e.y1);const r=0==t.length?e.y1:t[t.length-1].y2;r<e.y2&&t.push(new l(r,e.y2,e.x1,e.x2));let a=C(t,i[0].y1);for(const n of i){if(a==t.length)break;for(t[a].y1<n.y1&&(s=t[a],a++,t.splice(a,0,new l(n.y1,s.y2,s.x1,s.x2)),s.y2=n.y1);a<t.length&&((s=t[a++]).y2>n.y2&&(t.splice(a,0,new l(n.y2,s.y2,s.x1,s.x2)),s.y2=n.y2),n.x1!=n.x2&&("left"==o?s.x1=Math.min(n.x2,e.x2):s.x2=Math.max(n.x1,e.x1)),s.y2!=n.y2););}N(e,t)}},function(e,t,n){"use strict";var i=n(7),o=n(0),s=n(11);function r(e,t){const n={};return Object.keys(e).forEach(i=>{const o=n[i]={},s=e[i];Object.keys(s).forEach(e=>{o[e]=s[e].map(e=>{const n=t?e.logical:e.physical,i=t?e.physical:e.logical;return{regexp:new RegExp(`(-?)${n}(-?)`),to:`$1${i}$2`}})})}),n}function a(e,t,n,i){const o=i[t];if(!o)throw new Error(`unknown writing-mode: ${t}`);const s=o[n||"ltr"];if(!s)throw new Error(`unknown direction: ${n}`);for(const t of s){const n=e.replace(t.regexp,t.to);if(n!==e)return n}return e}n(6);const l={"horizontal-tb":{ltr:[{logical:"inline-start",physical:"left"},{logical:"inline-end",physical:"right"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}],rtl:[{logical:"inline-start",physical:"right"},{logical:"inline-end",physical:"left"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}]},"vertical-rl":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]},"vertical-lr":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]}},c=r(l,!0),h=r(l,!1);var u=n(19),d=n(3),p=n(8),f=n(15);n.d(t,"a",(function(){return g})),n.d(t,"g",(function(){return m})),n.d(t,"h",(function(){return b})),n.d(t,"b",(function(){return w})),n.d(t,"d",(function(){return y})),n.d(t,"c",(function(){return S})),n.d(t,"e",(function(){return N})),n.d(t,"f",(function(){return v}));const g=f.b.FloatReference;function m(e){switch(e){case"inline":return g.INLINE;case"column":return g.COLUMN;case"region":return g.REGION;case"page":return g.PAGE;default:throw new Error(`Unknown float-reference: ${e}`)}}function b(e){switch(e){case g.INLINE:return!1;case g.COLUMN:case g.REGION:case g.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${e}`)}}class w{constructor(e,t,n,i,o,s){this.nodePosition=e,this.floatReference=t,this.floatSide=n,this.clearSide=i,this.flowName=o,this.floatMinWrapBlock=s,this.order=null,this.id=null}getOrder(){if(null===this.order)throw new Error("The page float is not yet added");return this.order}getId(){if(!this.id)throw new Error("The page float is not yet added");return this.id}isAllowedOnContext(e){return e.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(e){return!1}}class E{constructor(){this.floats=[],this.nextPageFloatIndex=0}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(e){return`pf${e}`}addPageFloat(e){if(this.floats.findIndex(t=>p.u(t.nodePosition,e.nodePosition))>=0)throw new Error("A page float with the same source node is already registered");{const t=e.order=this.nextOrder();e.id=this.createPageFloatId(t),this.floats.push(e)}}findPageFloatByNodePosition(e){const t=this.floats.findIndex(t=>p.u(t.nodePosition,e));return t>=0?this.floats[t]:null}findPageFloatById(e){const t=this.floats.findIndex(t=>t.id===e);return t>=0?this.floats[t]:null}}class y{constructor(e,t,n,i,o){this.floatReference=e,this.floatSide=t,this.continuations=n,this.area=i,this.continues=o}hasFloat(e){return this.continuations.some(t=>t.float===e)}findNotAllowedFloat(e){for(let t=this.continuations.length-1;t>=0;t--){const n=this.continuations[t].float;if(!n.isAllowedOnContext(e))return n}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){const e=this.continuations.map(e=>e.float);return Math.min.apply(null,e.map(e=>e.getOrder()))}shouldBeStashedBefore(e){return this.getOrder()<e.getOrder()}addContinuations(e){e.forEach(e=>{this.continuations.push(e)})}getFlowName(){const e=this.continuations[0].float.flowName;return i.a(this.continuations.every(t=>t.float.flowName===e)),e}}class S{constructor(e,t){this.float=e,this.nodePosition=t}equals(e){return!!e&&(this===e||this.float===e.float&&p.u(this.nodePosition,e.nodePosition))}}class N{constructor(e,t,n,i,s,r,a){this.parent=e,this.floatReference=t,this.container=n,this.flowName=i,this.generatingNodePosition=s,this.children=[],this.invalidated=!1,this.forbiddenFloats=[],this.floatFragments=[],this.stashedFloatFragments=[],this.floatAnchors={},this.floatsDeferredToNext=[],this.layoutConstraints=[],this.locked=!1,e&&e.children.push(this),this.writingMode=r||e&&e.writingMode||o.t.horizontal_tb,this.direction=a||e&&e.direction||o.t.ltr,this.floatStore=e?e.floatStore:new E;const l=this.getPreviousSibling();this.floatsDeferredFromPrevious=l?[].concat(l.floatsDeferredToNext):[]}getParent(e){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${e}`);return this.parent}getPreviousSiblingOf(e,t,n,i){let o=this.children.indexOf(e);o<0&&(o=this.children.length);for(let e=o-1;e>=0;e--){let o=this.children[e];if(o.floatReference===t&&o.flowName===n&&p.u(o.generatingNodePosition,i))return o;if(o=o.getPreviousSiblingOf(null,t,n,i))return o}return null}getPreviousSibling(){let e,t=this,n=this.parent;for(;n;){if(e=n.getPreviousSiblingOf(t,this.floatReference,this.flowName,this.generatingNodePosition))return e;t=n,n=n.parent}return null}getContainer(e){return e&&e!==this.floatReference?this.getParent(e).getContainer(e):this.container}setContainer(e){this.container=e,this.reattachFloatFragments()}addPageFloat(e){this.floatStore.addPageFloat(e)}getPageFloatLayoutContext(e){return e===this.floatReference?this:this.getParent(e).getPageFloatLayoutContext(e)}findPageFloatByNodePosition(e){return this.floatStore.findPageFloatByNodePosition(e)}forbid(e){const t=e.getId(),n=e.floatReference;n===this.floatReference?this.forbiddenFloats.includes(t)||(this.forbiddenFloats.push(t),(new v).findByFloat(e).forbid(e,this)):this.getParent(n).forbid(e)}isForbidden(e){const t=e.getId(),n=e.floatReference;return n===this.floatReference?this.forbiddenFloats.includes(t):this.getParent(n).isForbidden(e)}addPageFloatFragment(e,t){const n=e.floatReference;n!==this.floatReference?this.getParent(n).addPageFloatFragment(e,t):this.floatFragments.includes(e)||(this.floatFragments.push(e),this.floatFragments.sort((e,t)=>e.getOrder()-t.getOrder())),t||this.invalidate()}removePageFloatFragment(e,t){const n=e.floatReference;if(n!==this.floatReference)this.getParent(n).removePageFloatFragment(e,t);else{const n=this.floatFragments.indexOf(e);if(n>=0){const e=this.floatFragments.splice(n,1)[0],i=e.area&&e.area.element;i&&i.parentNode&&i.parentNode.removeChild(i),t||this.invalidate()}}}findPageFloatFragment(e){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).findPageFloatFragment(e);const t=this.floatFragments.findIndex(t=>t.hasFloat(e));return t>=0?this.floatFragments[t]:null}hasFloatFragments(e){return!(!(this.floatFragments.length>0)||e&&!this.floatFragments.some(e))||!!this.parent&&this.parent.hasFloatFragments(e)}hasContinuingFloatFragmentsInFlow(e){return this.hasFloatFragments(t=>t.continues&&t.getFlowName()===e)}registerPageFloatAnchor(e,t){this.floatAnchors[e.getId()]=t}collectPageFloatAnchors(){const e=Object.assign({},this.floatAnchors);return this.children.reduce((e,t)=>Object.assign(e,t.collectPageFloatAnchors()),e)}isAnchorAlreadyAppeared(e){if(this.getDeferredPageFloatContinuations().some(t=>t.float.getId()===e))return!0;const t=this.collectPageFloatAnchors()[e];return!!t&&!(!this.container||!this.container.element)&&this.container.element.contains(t)}deferPageFloat(e){const t=e.float;if(t.floatReference===this.floatReference){const n=this.floatsDeferredToNext.findIndex(e=>e.float===t);n>=0?this.floatsDeferredToNext.splice(n,1,e):this.floatsDeferredToNext.push(e)}else this.getParent(t.floatReference).deferPageFloat(e)}hasPrecedingFloatsDeferredToNext(e,t){if(!t&&e.floatReference!==this.floatReference)return this.getParent(e.floatReference).hasPrecedingFloatsDeferredToNext(e,!1);const n=e.getOrder();return!!this.floatsDeferredToNext.some(t=>t.float.getOrder()<n&&!e.isAllowedToPrecede(t.float))||!!this.parent&&this.parent.hasPrecedingFloatsDeferredToNext(e,!0)}getLastFollowingFloatInFragments(e){const t=e.getOrder();let n=null;if(this.floatFragments.forEach(e=>{e.continuations.forEach(e=>{const i=e.float,o=i.getOrder();o>t&&(!n||o>n.getOrder())&&(n=i)})}),this.parent){const t=this.parent.getLastFollowingFloatInFragments(e);t&&(!n||t.getOrder()>n.getOrder())&&(n=t)}return n}getDeferredPageFloatContinuations(e){e=e||this.flowName;let t=this.floatsDeferredFromPrevious.filter(t=>!e||t.float.flowName===e);return this.parent&&(t=this.parent.getDeferredPageFloatContinuations(e).concat(t)),t.sort((e,t)=>e.float.getOrder()-t.float.getOrder())}getPageFloatContinuationsDeferredToNext(e){e=e||this.flowName;const t=this.floatsDeferredToNext.filter(t=>!e||t.float.flowName===e);return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(e).concat(t):t}getFloatsDeferredToNextInChildContexts(){let e=[];const t=[];for(let n=this.children.length-1;n>=0;n--){const i=this.children[n];t.includes(i.flowName)||(t.push(i.flowName),e=(e=e.concat(i.floatsDeferredToNext.map(e=>e.float))).concat(i.getFloatsDeferredToNextInChildContexts()))}return e}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let e=this.floatFragments.length-1;e>=0;e--){const t=this.floatFragments[e],n=t.findNotAllowedFloat(this);if(n)return this.locked?this.invalidate():(this.removePageFloatFragment(t),this.forbid(n),this.removeEndFloatFragments(t.floatSide)),!0}return!(this.floatReference!==g.REGION||!this.parent.locked)&&this.parent.checkAndForbidNotAllowedFloat()}checkAndForbidFloatFollowingDeferredFloat(){const e=this.getFloatsDeferredToNextInChildContexts(),t=this.floatFragments.reduce((e,t)=>e.concat(t.continuations.map(e=>e.float)),[]);t.sort((e,t)=>t.getOrder()-e.getOrder());for(const n of t){const t=n.getOrder();if(e.some(e=>!n.isAllowedToPrecede(e)&&t>e.getOrder())){if(this.locked)this.invalidate();else{this.forbid(n);const e=this.findPageFloatFragment(n);i.a(e),this.removePageFloatFragment(e)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let e=this.floatsDeferredToNext.length-1;e>=0;e--)if(!this.floatsDeferredToNext[e].float.isAllowedOnContext(this)){if(this.locked)return void this.invalidate();this.floatsDeferredToNext.splice(e,1)}this.floatsDeferredFromPrevious.forEach(e=>{this.floatsDeferredToNext.findIndex(t=>e.equals(t))>=0||this.floatFragments.some(t=>t.hasFloat(e.float))||this.floatsDeferredToNext.push(e)})}}hasSameContainerAs(e){return!!this.container&&!!e.container&&this.container.element===e.container.element}invalidate(){this.invalidated=!0,this.locked||(this.container&&(this.children.forEach(e=>{this.hasSameContainerAs(e)&&e.floatFragments.forEach(e=>{const t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)})}),this.container.clear()),this.children.forEach(e=>{e.layoutConstraints.splice(0)}),this.children.splice(0),Object.keys(this.floatAnchors).forEach(e=>{delete this.floatAnchors[e]}))}detachChildren(){const e=this.children.splice(0);return e.forEach(e=>{e.floatFragments.forEach(e=>{const t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)})}),e}attachChildren(e){e.forEach(e=>{this.children.push(e),e.reattachFloatFragments()})}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(e){return function(e,t,n){return a(e,t,n||null,h)}(e,this.writingMode.toString(),this.direction.toString())}toPhysical(e){return function(e,t,n){return a(e,t,n||null,c)}(e,this.writingMode.toString(),this.direction.toString())}removeEndFloatFragments(e){const t=this.toLogical(e);if("block-end"===t||"inline-end"===t){let e=0;for(;e<this.floatFragments.length;){const n=this.floatFragments[e];this.toLogical(n.floatSide)===t?this.removePageFloatFragment(n):e++}}}stashEndFloatFragments(e){const t=e.floatReference;if(t!==this.floatReference)return void this.getParent(t).stashEndFloatFragments(e);const n=this.toLogical(e.floatSide);if("block-end"===n||"snap-block"===n||"inline-end"===n){let t=0;for(;t<this.floatFragments.length;){const i=this.floatFragments[t],o=this.toLogical(i.floatSide);(o===n||"snap-block"===n&&"block-end"===o)&&i.shouldBeStashedBefore(e)?(this.stashedFloatFragments.push(i),this.floatFragments.splice(t,1)):t++}}}restoreStashedFragments(e){e===this.floatReference?(this.stashedFloatFragments.forEach(e=>{this.addPageFloatFragment(e,!0)}),this.stashedFloatFragments.splice(0)):this.getParent(e).restoreStashedFragments(e)}discardStashedFragments(e){e===this.floatReference?this.stashedFloatFragments.splice(0):this.getParent(e).discardStashedFragments(e)}getStashedFloatFragments(e){return e===this.floatReference?this.stashedFloatFragments.concat().sort((e,t)=>t.getOrder()-e.getOrder()):this.getParent(e).getStashedFloatFragments(e)}getLimitValue(e,t,n,o){i.a(this.container);const s=this.toLogical(e),r=this.toPhysical(e),a=this.getLimitValueInner(s,t,n,o);if(this.parent&&this.parent.container){const e=this.parent.getLimitValue(r,t,n,o);switch(r){case"top":case"left":return Math.max(a,e);case"bottom":case"right":return Math.min(a,e);default:i.b("Should be unreachable")}}return a}getLimitValueInner(e,t,n,o){i.a(this.container);const s=this.getLimitValuesInner(t,n,o);switch(e){case"block-start":return this.container.vertical?s.right:s.top;case"block-end":return this.container.vertical?s.left:s.bottom;case"inline-start":return this.container.vertical?s.top:s.left;case"inline-end":return this.container.vertical?s.bottom:s.right;default:throw new Error(`Unknown logical side: ${e}`)}}getLimitValuesInner(e,t,n){i.a(this.container);const o=this.container.originX,s=this.container.originY,r=this.container.getPaddingRect();let a={top:r.y1-s,left:r.x1-o,bottom:r.y2-s,right:r.x2-o,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function l(n,i,o){return"%"===n.unit?o*n.num/100:e.convertLengthToPx(n,i,t)}const c=this.floatFragments;return c.length>0&&(a=c.reduce((e,t)=>{if(n&&!n(t,this))return e;const i=this.toLogical(t.floatSide),o=t.area,s=t.continuations[0].float.floatMinWrapBlock;let a=e.top,c=e.left,h=e.bottom,u=e.right,d=e.floatMinWrapBlockStart,p=e.floatMinWrapBlockEnd;switch(i){case"inline-start":o.vertical?a=Math.max(a,o.top+o.height):c=Math.max(c,o.left+o.width);break;case"block-start":o.vertical?(s&&o.left<u&&(d=l(s,o.rootViewNodes[0],r.x2-r.x1)),u=Math.min(u,o.left)):(s&&o.top+o.height>a&&(d=l(s,o.rootViewNodes[0],r.y2-r.y1)),a=Math.max(a,o.top+o.height));break;case"inline-end":o.vertical?h=Math.min(h,o.top):u=Math.min(u,o.left);break;case"block-end":o.vertical?(s&&o.left+o.width>c&&(p=l(s,o.rootViewNodes[0],r.x2-r.x1)),c=Math.max(c,o.left+o.width)):(s&&o.top<h&&(p=l(s,o.rootViewNodes[0],r.y2-r.y1)),h=Math.min(h,o.top));break;default:throw new Error(`Unknown logical float side: ${i}`)}return{top:a,left:c,bottom:h,right:u,floatMinWrapBlockStart:d,floatMinWrapBlockEnd:p}},a)),a.left+=o,a.right+=o,a.top+=s,a.bottom+=s,a}setFloatAreaDimensions(e,t,n,o,r,a,l){if(t!==this.floatReference)return this.getParent(t).setFloatAreaDimensions(e,t,n,o,r,a,l);let c=this.toLogical(n);if("snap-block"===c){if(!l["block-start"]&&!l["block-end"])return null}else if(!l[c])return null;i.a(e.clientLayout);let h=this.getLimitValue("block-start",e.layoutContext,e.clientLayout),d=this.getLimitValue("block-end",e.layoutContext,e.clientLayout),p=this.getLimitValue("inline-start",e.layoutContext,e.clientLayout),f=this.getLimitValue("inline-end",e.layoutContext,e.clientLayout);const g=e.vertical?e.originX:e.originY,m=e.vertical?e.originY:e.originX;function b(t,n){let i=t(e.bands,n);return i?(e.vertical&&(i=s.m(i)),h=e.vertical?Math.min(h,i.x2):Math.max(h,i.y1),d=e.vertical?Math.max(d,i.x1):Math.min(d,i.y2),!0):a}let w,E,y,S;if(h=e.vertical?Math.min(h,e.left+e.getInsetLeft()+e.width+e.getInsetRight()+g):Math.max(h,e.top+g),d=e.vertical?Math.max(d,e.left+g):Math.min(d,e.top+e.getInsetTop()+e.height+e.getInsetBottom()+g),r){const t=e.vertical?s.i(new s.c(d,p,h,f)):new s.c(p,h,f,d);if(("block-start"===c||"snap-block"===c||"inline-start"===c)&&!b(s.g,t))return null;if(("block-end"===c||"snap-block"===c||"inline-end"===c)&&!b(s.f,t))return null;if(w=(y=(d-h)*e.getBoxDir())-e.getInsetBefore()-e.getInsetAfter(),E=(S=f-p)-e.getInsetStart()-e.getInsetEnd(),!a&&(w<=0||E<=0))return null}else{y=(w=e.computedBlockSize)+e.getInsetBefore()+e.getInsetAfter();const t=(d-h)*e.getBoxDir();if("snap-block"===c){if(null===o)c="block-start";else{const e=this.container.getPaddingRect();c=this.container.getBoxDir()*(o-(this.container.vertical?e.x2:e.y1))<=this.container.getBoxDir()*((this.container.vertical?e.x1:e.y2)-o-y)?"block-start":"block-end"}if(!l[c]){if(!l["block-end"])return null;c="block-end"}}if(!a&&t<y)return null;S=(E="inline-start"===c||"inline-end"===c?u.b(e.clientLayout,e.element,[u.a.FIT_CONTENT_INLINE_SIZE])[u.a.FIT_CONTENT_INLINE_SIZE]:e.adjustContentRelativeSize?e.getContentInlineSize():e.vertical?e.height:e.width)+e.getInsetStart()+e.getInsetEnd();const n=f-p;if(!a&&n<S)return null}switch(h-=g,d-=g,p-=m,f-=m,c){case"inline-start":case"block-start":case"snap-block":e.setInlinePosition(p,E),e.setBlockPosition(h,w);break;case"inline-end":case"block-end":e.setInlinePosition(f-S,E),e.setBlockPosition(d-y*e.getBoxDir(),w);break;default:throw new Error(`unknown float direction: ${n}`)}return c}getFloatFragmentExclusions(){const e=this.floatFragments.map(e=>e.getOuterShape());return this.parent?this.parent.getFloatFragmentExclusions().concat(e):e}reattachFloatFragments(){const e=this.container.element&&this.container.element.parentNode;e&&this.floatFragments.forEach(t=>{e.appendChild(t.area.element)})}getMaxReachedAfterEdge(){const e=this.getContainer().vertical;return this.floatFragments.reduce((t,n)=>{const i=n.getOuterRect();return e?Math.min(t,i.x1):Math.max(t,i.y2)},e?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){const e=this.getContainer().vertical;return this.floatFragments.filter(e=>"block-end"===e.floatSide).reduce((t,n)=>{const i=n.getOuterRect();return e?Math.max(t,i.x2):Math.min(t,i.y1)},e?0:1/0)}getPageFloatClearEdge(e,t){function n(e){return t=>e.isAnchorAlreadyAppeared(t.float.getId())}function o(e,t){return e.continuations.some(n(t))}const s=t.getPaddingRect(),r=t.vertical?s.x1:s.y2;let a=this;for(;a;){if(a.floatsDeferredToNext.some(n(a)))return r;a=a.parent}i.a(t.clientLayout);const l=this.getLimitValue("block-start",t.layoutContext,t.clientLayout,o);return this.getLimitValue("block-end",t.layoutContext,t.clientLayout,o)*t.getBoxDir()<r*t.getBoxDir()?r:l}getPageFloatPlacementCondition(e,t,n){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).getPageFloatPlacementCondition(e,t,n);const i={"block-start":!0,"block-end":!0,"inline-start":!0,"inline-end":!0};if(!n)return i;const o=this.toLogical(t),s=this.toLogical(n);let r;r="all"===s?["block-start","block-end","inline-start","inline-end"]:"both"===s?["inline-start","inline-end"]:"same"===s?"snap-block"===o?["block-start","block-end"]:[o]:[s];const a=e.getOrder();function l(e){return t=>t.floatSide===e&&t.getOrder()<a}return r.forEach(e=>{switch(e){case"block-start":case"inline-start":i[e]=!function e(t,n){return t.children.some(t=>t.floatFragments.some(l(n))||e(t,n))}(this,e);break;case"block-end":case"inline-end":i[e]=!function e(t,n){const i=t.parent;return!!i&&(i.floatFragments.some(l(n))||e(i,n))}(this,e);break;default:throw new Error(`Unexpected side: ${e}`)}}),i}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(e,t){t===this.floatReference?this.layoutConstraints.push(e):this.getParent(t).addLayoutConstraint(e,t)}isColumnFullWithPageFloats(e){const t=e.layoutContext,n=e.clientLayout;i.a(n);let o=this,s=null;for(;o&&o.container;){const i=o.getLimitValuesInner(t,n);s?e.vertical?(i.right<s.right&&(s.right=i.right,s.floatMinWrapBlockStart=i.floatMinWrapBlockStart),i.left>s.left&&(s.left=i.left,s.floatMinWrapBlockEnd=i.floatMinWrapBlockEnd)):(i.top>s.top&&(s.top=i.top,s.floatMinWrapBlockStart=i.floatMinWrapBlockStart),i.bottom<s.bottom&&(s.bottom=i.bottom,s.floatMinWrapBlockEnd=i.floatMinWrapBlockEnd)):s=i,o=o.parent}const r=Math.max(s.floatMinWrapBlockStart,s.floatMinWrapBlockEnd);return(e.vertical?s.right-s.left:s.bottom-s.top)<=r}getMaxBlockSizeOfPageFloats(){const e=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map(t=>{const n=t.area;return e?n.width:n.height})):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}}const C=[];class v{static register(e){C.push(e)}findByNodeContext(e){for(let t=C.length-1;t>=0;t--){const n=C[t];if(n.appliesToNodeContext(e))return n}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}findByFloat(e){for(let t=C.length-1;t>=0;t--){const n=C[t];if(n.appliesToFloat(e))return n}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}}v.register(new class{appliesToNodeContext(e){return b(e.floatReference)}appliesToFloat(e){return!0}createPageFloat(e,t,n){let o=e.floatReference;i.a(e.floatSide);const s=e.floatSide,r=e.toNodePosition();return n.resolveFloatReferenceFromColumnSpan(o,e.columnSpan,e).thenAsync(n=>{o=n,i.a(t.flowName);const a=new w(r,o,s,e.clearSide,t.flowName,e.floatMinWrapBlock);return t.addPageFloat(a),d.d(a)})}createPageFloatFragment(e,t,n,i){const o=e[0].float;return new y(o.floatReference,t,e,n,i)}findPageFloatFragment(e,t){return t.findPageFloatFragment(e)}adjustPageFloatArea(e,t,n){}forbid(e,t){}})},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return h})),n.d(t,"e",(function(){return u}));var i=n(0),o=n(9);const s={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function r(e){return!!s[e]}const a={avoid:!0,"avoid-page":!0,"avoid-column":!0,"avoid-region":!0};function l(e){return!!a[e]}function c(e,t){if(!e)return t;if(!t)return e;{const n=r(e),i=r(t);if(!n||!i)return i?t:n?e:l(t)?t:l(e)?e:t;switch(t){case"column":return e;case"region":return"column"===e?t:e;default:return t}}}function h(e){switch(e){case"left":case"right":case"recto":case"verso":return e;default:return"any"}}function u(e){switch(e){case"left":case"right":case"recto":case"verso":return e;default:return null}}o.c.registerHook("SIMPLE_PROPERTY",(function(e){const t=e.name,n=e.value;switch(t){case"page-break-before":case"page-break-after":case"page-break-inside":return{name:t.replace(/^page-/,""),value:n===i.t.always?i.t.page:n,important:e.important};default:return e}}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return u}));var i=n(1),o=n(6),s=n(8);function r(e,t,n,s){const r=e.viewNode;if(!r)return NaN;if(1==r.nodeType){if(e.after||!e.inline){const n=t.getElementClientRect(r);if(n.right>=n.left&&n.bottom>=n.top)return e.after?s?n.left:n.bottom:s?n.right:n.top}return NaN}{let a=NaN;const l=r.ownerDocument.createRange(),c=r.textContent.length;if(!c)return NaN;e.after&&(n+=c),n>=c&&(n=c-1),l.setStart(r,n),l.setEnd(r,n+1);let h=t.getRangeClientRects(l);s&&i.m(document.body)&&(h=function(e,t,n){const i=n.ownerDocument.createRange();i.setStart(n,0),i.setEnd(n,n.textContent.length);const s=e.getRangeClientRects(i),r=[];for(const e of t){let t;for(t=0;t<s.length;t++){const n=s[t];if(e.top>=n.top&&e.bottom<=n.bottom&&Math.abs(e.left-n.left)<1){r.push({top:e.top,left:n.left,bottom:e.bottom,right:n.right});break}}t==s.length&&(o.b.warn("Could not fix character box"),r.push(e))}return r}(t,h,r));let u=0;for(const e of h){const t=s?e.bottom-e.top:e.right-e.left;e.right>e.left&&e.bottom>e.top&&(isNaN(a)||t>u)&&(a=s?e.left:e.bottom,u=t)}return a}}function a(e,t,n){const i=t.clientLayout.getElementClientRect(e),o=t.getComputedMargin(e);return n?i.width+o.left+o.right:i.height+o.top+o.bottom}function l(e){for(;e;){if(e.parentNode===e.ownerDocument)return!1;e=e.parentNode}return!0}function c(e,t){if(!e)return;let n;for(;(n=e.lastChild)!=t;)e.removeChild(n)}function h(e){return!!e.getAttribute(s.m)}function u(e){if(!e)return!1;const t=e.viewNode;return!(!t||1!==t.nodeType)&&h(t)}},function(e,t,n){"use strict";var i,o,s,r,a,l;n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"f",(function(){return l})),function(e){e.isInstanceOfBlockFormattingContext=function(e){return e&&"Block"===e.formattingContextType}}(i||(i={})),function(e){let t;!function(e){e.INLINE="inline",e.COLUMN="column",e.REGION="region",e.PAGE="page"}(t=e.FloatReference||(e.FloatReference={}))}(o||(o={})),function(e){e.isInstanceOfAfterIfContinuesLayoutConstraint=function(e){return e&&"AfterIfContinue"==e.flagmentLayoutConstraintType}}(s||(s={})),function(e){e.isInstanceOfRepetitiveElementsOwnerFormattingContext=function(e){return!!e&&("RepetitiveElementsOwner"===e.formattingContextType||a.isInstanceOfTableFormattingContext(e))},e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=function(e){return!!e&&("RepetitiveElementsOwner"===e.flagmentLayoutConstraintType||a.isInstanceOfTableRowLayoutConstraint(e))}}(r||(r={})),function(e){e.isInstanceOfTableFormattingContext=function(e){return e&&"Table"===e.formattingContextType},e.isInstanceOfTableRowLayoutConstraint=function(e){return e&&"TableRow"===e.flagmentLayoutConstraintType}}(a||(a={})),function(e){let t,n;!function(e){e[e.IGNORE=0]="IGNORE",e[e.NEWLINE=1]="NEWLINE",e[e.PRESERVE=2]="PRESERVE"}(t=e.Whitespace||(e.Whitespace={})),function(e){e[e.NONE=0]="NONE",e[e.CONTENT=1]="CONTENT",e[e.ROOTLESS=2]="ROOTLESS",e[e.ROOTED=3]="ROOTED"}(n=e.ShadowType||(e.ShadowType={}))}(l||(l={}))},function(e,t,n){"use strict";var i,o=n(1),s=n(6),r=n(3),a=n(17),l='<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://www.pyroxy.com/ns/shadow">\n<head>\n<style><![CDATA[\n\n.footnote-content {\n  float: footnote;\n}\n\n.table-cell-container {\n  display: block;\n}\n\n]]></style>\n</head>\n<body>\n\n<s:template id="footnote"><s:content/><s:include class="footnote-content"/></s:template>\n\n<s:template id="table-cell"><div data-vivliostyle-flow-root="true" class="table-cell-container"><s:content/></div></s:template>\n\n</body>\n</html>\n';function c(e,t,n,o,a){const l=r.c("ajax"),c=new XMLHttpRequest,u=l.suspend(c),d={status:0,statusText:"",url:e,contentType:null,responseText:null,responseXML:null,responseBlob:null};c.open(n||"GET",e,!0),t&&(c.responseType=t),c.onreadystatechange=()=>{if(4===c.readyState){if(d.status=c.status,d.statusText=c.statusText||404==c.status&&"Not Found"||"",200==d.status||0==d.status)if(t&&t!==i.DOCUMENT||!c.responseXML||"parsererror"==c.responseXML.documentElement.localName)if((!t||t===i.DOCUMENT)&&c.response instanceof HTMLDocument)d.responseXML=c.response,d.contentType=c.response.contentType;else{const n=c.response;t&&t!==i.TEXT||"string"!=typeof n?n?d.responseBlob="string"==typeof n?h([n]):n:s.b.warn("Unexpected empty success response for",e):d.responseText=n;const o=c.getResponseHeader("Content-Type");o&&(d.contentType=o.replace(/(.*);.*$/,"$1"))}else d.responseXML=c.responseXML,d.contentType=c.responseXML.contentType;u.schedule(d)}};try{o?(c.setRequestHeader("Content-Type",a||"text/plain; charset=UTF-8"),c.send(o)):(/^file:|^https?:\/\/[^/]+\.githubusercontent\.com|\.opf$/.test(e)?/\/aozorabunko\/[^/]+\/cards\/[^/]+\/files\/[^/.]+\.html$/.test(e)?c.overrideMimeType("text/html; charset=Shift_JIS"):/\.(html|htm)$/.test(e)?c.overrideMimeType("text/html; charset=UTF-8"):/\.(xhtml|xht|xml|opf)$/.test(e)?c.overrideMimeType("application/xml; charset=UTF-8"):/\.(txt|css)$/.test(e)?c.overrideMimeType("text/plain; charset=UTF-8"):c.overrideMimeType("text/html; charset=UTF-8"):/^data:,(<|%3C|%3c)/.test(e)?c.overrideMimeType("text/html; charset=UTF-8"):/^data:,/.test(e)&&c.overrideMimeType("text/plain; charset=UTF-8"),c.send(null))}catch(t){s.b.warn(t,`Error fetching ${e}`),u.schedule(d)}return l.result()}function h(e,t){const n=t||"application/octet-stream",i=window.WebKitBlobBuilder||window.MSBlobBuilder;if(i){const t=new i;for(let n=0;n<e.length;n++)t.append(e[n]);return t.getBlob(n)}return new Blob(e,{type:n})}function u(e){const t=r.c("readBlob"),n=new FileReader,i=t.suspend(n);return n.addEventListener("load",()=>{i.schedule(n.result)},!1),n.readAsArrayBuffer(e),t.result()}function d(e){return(window.URL||window.webkitURL).createObjectURL(e)}n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return h})),n.d(t,"g",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"f",(function(){return g})),function(e){e.DEFAULT="",e.ARRAYBUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json",e.TEXT="text"}(i||(i={}));class p{constructor(e,t){this.parser=e,this.type=t,this.resources={},this.fetchers={}}load(e,t,n){e=o.I(e);const i=this.resources[e];return void 0!==i?r.d(i):this.fetch(e,t,n).get()}fetchInner(e,t,n){const i=this,s=r.c("fetch"),a=e.endsWith("?viv-toc-box");a&&(e=e.replace("?viv-toc-box",""));const h=o.C("user-agent.xml",o.D),u=!a&&e===h;return u&&(e=`data:application/xml,${encodeURIComponent(l)}`),c(e,i.type).then(o=>{if(o.status>=400&&t)throw new Error((n||`Failed to fetch required resource: ${e}`)+` (${o.status}${o.statusText?" "+o.statusText:""})`);a?(e+="?viv-toc-box",o.url+="?viv-toc-box"):u&&(o.url=e=h),i.parser(o,i).then(t=>{delete i.fetchers[e],i.resources[e]=t,s.finish(t)})}),s.result()}fetch(e,t,n){if(e=o.I(e),this.resources[e])return null;let i=this.fetchers[e];if(!i){const o=this;i=new a.a(()=>o.fetchInner(e,t,n),`Fetch ${e}`),o.fetchers[e]=i,i.start()}return i}get(e){return this.resources[o.I(e)]}delete(e){delete this.resources[o.I(e)]}}function f(e,t){const n=e.responseText;return r.d(n?o.H(n):null)}function g(){return new p(f,i.TEXT)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return l}));var i=n(1),o=n(6),s=n(3);class r{constructor(e,t){this.fetch=e,this.arrived=!1,this.resource=null,this.task=null,this.piggybacks=[],this.name=t}start(){if(!this.task){const e=this;this.task=s.a().getScheduler().run(()=>{const t=s.c("Fetcher.run");return e.fetch().then(n=>{const i=e.piggybacks;if(e.arrived=!0,e.resource=n,e.task=null,e.piggybacks=[],i)for(let e=0;e<i.length;e++)try{i[e](n)}catch(e){o.b.error(e,"Error:")}t.finish(n)}),t.result()},this.name)}}piggyback(e){this.arrived?e(this.resource):this.piggybacks.push(e)}get(){return this.arrived?s.d(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}}const a=e=>{if(0==e.length)return s.d(!0);if(1==e.length)return e[0].get().thenReturn(!0);const t=s.c("waitForFetches");let n=0;return t.loop(()=>{for(;n<e.length;){const t=e[n++];if(!t.hasArrived())return t.get().thenReturn(!0)}return s.d(!1)}).then(()=>{t.finish(!0)}),t.result()};function l(e,t){let n=null,o=null;"img"==e.localName&&(n=e.getAttribute("width"),o=e.getAttribute("height"));const a=new r(()=>{const r=s.c("loadImage"),a=r.suspend(e);let l=!1;const c=t=>{l||(l=!0,"img"==e.localName&&(n||e.removeAttribute("width"),o||e.removeAttribute("height")),a.schedule(t?t.type:"timeout"))};return e.addEventListener("load",c,!1),e.addEventListener("error",c,!1),e.addEventListener("abort",c,!1),e.namespaceURI==i.a.SVG?(e.setAttributeNS(i.a.XLINK,"xlink:href",t),setTimeout(c,300)):e.src=t,r.result()},`loadElement ${t}`);return a.start(),a}},function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return p}));var i=n(22),o=n(24),s=n(14),r=n(9),a=n(3),l=n(15);class c{find(e){const t=r.b(r.a.RESOLVE_LAYOUT_PROCESSOR);for(let n=0;n<t.length;n++){const i=t[n](e);if(i)return i}throw new Error(`No processor found for a formatting context: ${e.getName()}`)}}class h{layout(e,t,n){return t.isFloatNodeContext(e)?t.layoutFloatOrFootnote(e):t.isBreakable(e)?t.layoutBreakableBlock(e):t.layoutUnbreakable(e)}createEdgeBreakPosition(e,t,n,o){return new i.b(e.copy(),t,n,o)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}clearOverflownViewNodes(e,t,n,i){if(!n.viewNode)return;if(!n.viewNode.parentNode)return;const o=n.viewNode.parentNode;s.f(o,n.viewNode),i&&o.removeChild(n.viewNode)}finishBreak(e,t,n,i){const o=n||null!=t.viewNode&&1==t.viewNode.nodeType&&!t.after;return e.clearOverflownViewNodes(t,o),i&&(e.fixJustificationIfNeeded(t,!0),e.layoutContext.processFragmentedBlockEdge(o?t:t.parent)),a.d(!0)}}class u{constructor(e){this.parent=e,this.formattingContextType="Block"}getName(){return"Block formatting context (BlockFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}saveState(){}restoreState(e){}}const d=new h,p=l.a.isInstanceOfBlockFormattingContext;r.d(r.a.RESOLVE_FORMATTING_CONTEXT,(e,t,n,i,s,r)=>{const a=e.parent;return!a&&e.formattingContext?null:a&&e.formattingContext!==a.formattingContext?null:e.establishesBFC||!e.formattingContext&&o.d(n,i,s,r)?new u(a?a.formattingContext:null):null}),r.d(r.a.RESOLVE_LAYOUT_PROCESSOR,e=>e instanceof u?d:null)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));var i,o=n(1);function s(e,t,n){const s={display:t.style.display,position:t.style.position,width:t.style.width,maxWidth:t.style.maxWidth,minWidth:t.style.minWidth,height:t.style.height,maxHeight:t.style.maxHeight,minHeight:t.style.minHeight},r=t.ownerDocument,a=t.parentNode,l=r.createElement("div");function c(n){return e.getElementComputedStyle(t).getPropertyValue(n)}o.F(l,"position",s.position),a.insertBefore(l,t),l.appendChild(t),o.F(t,"width","auto"),o.F(t,"max-width","none"),o.F(t,"min-width","0"),o.F(t,"height","auto"),o.F(t,"max-height","none"),o.F(t,"min-height","0");const h=o.v("writing-mode"),u=(h?c(h[0]):null)||c("writing-mode"),d="vertical-rl"===u||"tb-rl"===u||"vertical-lr"===u||"tb-lr"===u,p=d?"height":"width",f=d?"width":"height";function g(){return o.F(t,"display","block"),o.F(t,"position","static"),c(p)}function m(){o.F(t,"display","inline-block"),o.F(l,p,"99999999px");const e=c(p);return o.F(l,p,""),e}function b(){o.F(t,"display","inline-block"),o.F(l,p,"0");const e=c(p);return o.F(l,p,""),e}function w(){const e=g(),t=b(),n=parseFloat(e);if(n<=parseFloat(t))return t;{const t=m();return n<=parseFloat(t)?e:t}}function E(){return c(f)}function y(){throw new Error("Getting fill-available block size is not implemented")}const S={};return n.forEach(e=>{let n;switch(e){case i.FILL_AVAILABLE_INLINE_SIZE:n=g();break;case i.MAX_CONTENT_INLINE_SIZE:n=m();break;case i.MIN_CONTENT_INLINE_SIZE:n=b();break;case i.FIT_CONTENT_INLINE_SIZE:n=w();break;case i.FILL_AVAILABLE_BLOCK_SIZE:n=y();break;case i.MAX_CONTENT_BLOCK_SIZE:case i.MIN_CONTENT_BLOCK_SIZE:case i.FIT_CONTENT_BLOCK_SIZE:n=E();break;case i.FILL_AVAILABLE_WIDTH:n=d?y():g();break;case i.FILL_AVAILABLE_HEIGHT:n=d?g():y();break;case i.MAX_CONTENT_WIDTH:n=d?E():m();break;case i.MAX_CONTENT_HEIGHT:n=d?m():E();break;case i.MIN_CONTENT_WIDTH:n=d?E():b();break;case i.MIN_CONTENT_HEIGHT:n=d?b():E();break;case i.FIT_CONTENT_WIDTH:n=d?E():w();break;case i.FIT_CONTENT_HEIGHT:n=d?w():E()}S[e]=parseFloat(n),o.F(t,"position",s.position),o.F(t,"display",s.display)}),o.F(t,"width",s.width),o.F(t,"max-width",s.maxWidth),o.F(t,"min-width",s.minWidth),o.F(t,"height",s.height),o.F(t,"max-height",s.maxHeight),o.F(t,"min-height",s.minHeight),a.insertBefore(t,l),a.removeChild(l),S}!function(e){e.FILL_AVAILABLE_INLINE_SIZE="fill-available inline size",e.FILL_AVAILABLE_BLOCK_SIZE="fill-available block size",e.FILL_AVAILABLE_WIDTH="fill-available width",e.FILL_AVAILABLE_HEIGHT="fill-available height",e.MAX_CONTENT_INLINE_SIZE="max-content inline size",e.MAX_CONTENT_BLOCK_SIZE="max-content block size",e.MAX_CONTENT_WIDTH="max-content width",e.MAX_CONTENT_HEIGHT="max-content height",e.MIN_CONTENT_INLINE_SIZE="min-content inline size",e.MIN_CONTENT_BLOCK_SIZE="min-content block size",e.MIN_CONTENT_WIDTH="min-content width",e.MIN_CONTENT_HEIGHT="min-content height",e.FIT_CONTENT_INLINE_SIZE="fit-content inline size",e.FIT_CONTENT_BLOCK_SIZE="fit-content block size",e.FIT_CONTENT_WIDTH="fit-content width",e.FIT_CONTENT_HEIGHT="fit-content height"}(i||(i={}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return f}));var i=n(0),o=n(11),s=n(6);class r extends i.m{constructor(){super(),this.propSet={}}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}}function a(e){if(e){const t=new r;try{return e.visit(t),t.propSet}catch(e){s.b.warn(e,"toSet:")}}return{}}class l extends i.m{constructor(e){super(),this.value=e}visitInt(e){return this.value=e.num,e}}function c(e,t){if(e){const n=new l(t);try{return e.visit(n),n.value}catch(e){s.b.warn(e,"toInt: ")}}return t}class h extends i.m{constructor(){super(),this.collect=!1,this.coords=[],this.name=null}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&0==e.num&&this.coords.push(new i.i(0,"px")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,t,n,i,s){if(this.coords.length>0){const r=[];switch(this.coords.forEach((e,t)=>{if("%"==e.unit){let o=t%2==0?n:i;3==t&&"circle"==this.name&&(o=Math.sqrt((n*n+i*i)/2)),r.push(e.num*o/100)}else r.push(e.num*s.queryUnitSize(e.unit,!1))}),this.name){case"polygon":if(r.length%2==0){const n=[];for(let i=0;i<r.length;i+=2)n.push(new o.b(e+r[i],t+r[i+1]));return new o.d(n)}break;case"rectangle":if(4==r.length)return o.k(e+r[0],t+r[1],e+r[0]+r[2],t+r[1]+r[3]);break;case"ellipse":if(4==r.length)return o.j(e+r[0],t+r[1],r[2],r[3]);break;case"circle":if(3==r.length)return o.j(e+r[0],t+r[1],r[2],r[2])}}return null}}function u(e,t,n,i,r,a){if(e){const o=new h;try{return e.visit(o),o.getShape(t,n,i,r,a)}catch(e){s.b.warn(e,"toShape:")}}return o.k(t,n,t+i,n+r)}class d extends i.m{constructor(e){super(),this.reset=e,this.counters={},this.name=null}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}}function p(e,t){const n=new d(t);try{e.visit(n)}catch(e){s.b.warn(e,"toCounters:")}return n.counters}class f extends i.d{constructor(e,t){super(),this.baseUrl=e,this.transformer=t}visitURL(e){return new i.l(this.transformer.transformURL(e.url,this.baseUrl))}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return l})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return h})),n.d(t,"f",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n(1),o=n(0),s=n(5),r=n(8);const a=(new DOMParser).parseFromString(`<root xmlns="${i.a.SHADOW}"/>`,"text/xml"),l=["footnote-marker","first-5-lines","first-4-lines","first-3-lines","first-2-lines","first-line","first-letter","before","","after"],c="data-adapt-pseudo";function h(e){return e.getAttribute(c)||""}function u(e,t){e.setAttribute(c,t)}class d{constructor(e,t,n,i,o){this.element=e,this.style=t,this.styler=n,this.context=i,this.exprContentListener=o,this.contentProcessed={}}getStyle(e,t){const n=h(e);this.styler&&n&&n.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);const i=s.u(this.style,"_pseudos")[n]||{};if(n.match(/^first-/)&&!i["x-first-pseudo"]){let e,t=1;"first-letter"==n?t=0:null!=(e=n.match(/^first-([0-9]+)-lines$/))&&(t=e[1]-0),i["x-first-pseudo"]=new s.c(new o.g(t),0)}return i}processContent(e,t){const n=h(e);if(!this.contentProcessed[n]){this.contentProcessed[n]=!0;const i=t.content;i&&r.y(i)&&i.visit(new r.c(e,this.context,i,this.exprContentListener))}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return l}));var i=n(13),o=n(14),s=n(15);class r{calculateOffset(e){return a(this.getNodeContext(),e.collectElementsOffset())}breakPositionChosen(e){}getNodeContext(){return null}}function a(e,t){return{current:t.reduce((t,n)=>t+n.calculateOffset(e),0),minimum:t.reduce((t,n)=>t+n.calculateMinimumOffset(e),0)}}class l extends r{constructor(e,t,n,i){super(),this.position=e,this.breakOnEdge=t,this.overflows=n,this.computedBlockSize=i,this.isEdgeUpdated=!1,this.edge=0,this.overflowIfRepetitiveElementsDropped=n}findAcceptableBreak(e,t){return this.updateOverflows(e),t<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");const e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(i.b(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){const t=e.calculateClonedPaddingBorder(this.position);this.edge=o.a(this.position,e.clientLayout,0,e.vertical)+t,this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);const t=this.edge,n=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(t+(e.vertical?-1:1)*n.minimum),this.overflows=this.position.overflow=e.isOverflown(t+(e.vertical?-1:1)*n.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){const e=this.getNodeContext();if(!e||!e.parent)return!1;const{formattingContext:t}=e.parent;if(!s.c.isInstanceOfRepetitiveElementsOwnerFormattingContext(t))return!1;const n=t.getRepetitiveElements();return!!n&&n.isFirstContentNode(e)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"LayoutIteratorStrategy",(function(){return l})),n.d(t,"LayoutIterator",(function(){return c})),n.d(t,"EdgeSkipper",(function(){return h})),n.d(t,"PseudoColumn",(function(){return u}));var i=n(13),o=n(22),s=n(30),r=n(3),a=n(8);class l{initialState(e){return{nodeContext:e,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(e){}afterNonDisplayableNode(e){}startIgnoredTextNode(e){}afterIgnoredTextNode(e){}startNonElementNode(e){}afterNonElementNode(e){}startInlineElementNode(e){}afterInlineElementNode(e){}startNonInlineElementNode(e){}afterNonInlineElementNode(e){}finish(e){}}class c{constructor(e,t){this.strategy=e,this.layoutContext=t}iterate(e){const t=this.strategy,n=t.initialState(e),i=r.c("LayoutIterator");return i.loopWithFrame(e=>{let i;for(;n.nodeContext;){const o=((i=n.nodeContext.viewNode?1!==n.nodeContext.viewNode.nodeType?a.p(n.nodeContext.viewNode,n.nodeContext.whitespace)?n.nodeContext.after?t.afterIgnoredTextNode(n):t.startIgnoredTextNode(n):n.nodeContext.after?t.afterNonElementNode(n):t.startNonElementNode(n):n.nodeContext.inline?n.nodeContext.after?t.afterInlineElementNode(n):t.startInlineElementNode(n):n.nodeContext.after?t.afterNonInlineElementNode(n):t.startNonInlineElementNode(n):n.nodeContext.after?t.afterNonDisplayableNode(n):t.startNonDisplayableNode(n))&&i.isPending()?i:r.d(!0)).thenAsync(()=>n.break?r.d(null):this.layoutContext.nextInTree(n.nodeContext,n.atUnforcedBreak));if(o.isPending())return void o.then(t=>{n.break?e.breakLoop():(n.nodeContext=t,e.continueLoop())});if(n.break)return void e.breakLoop();n.nodeContext=o.get()}t.finish(n),e.breakLoop()}).then(()=>{i.finish(n.nodeContext)}),i.result()}}class h extends l{constructor(e){super(),this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,t){const n=!e.leadingEdge&&i.c(e.breakAtTheEdge);if(n){const n=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;n.viewNode.parentNode.removeChild(n.viewNode),t.pageBreakType=e.breakAtTheEdge}return n}saveEdgeAndProcessOverflow(e,t){const n=t.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return n&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),n}processLayoutConstraint(e,t,n){let i=e.nodeContext;const o=!t.allowLayout(i);return o&&(n.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),(i=e.nodeContext=i.modify()).overflow=!0),o}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=i.d(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let t,n;return(n=e.onStartEdges?(n=(t=this.endEmptyNonInlineBox(e))&&t.isPending()?t:r.d(!0)).thenAsync(()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),r.d(!0))):(t=this.endNonInlineBox(e))&&t.isPending()?t:r.d(!0)).thenAsync(()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=i.d(e.breakAtTheEdge,e.nodeContext.breakAfter)),r.d(!0)))}}class u{constructor(e,t,n){this.startNodeContexts=[],this.column=Object.create(e),this.column.element=t,this.column.layoutContext=e.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=n.formattingContext,this.column.pseudoParent=e;const i=this.column.calculateClonedPaddingBorder(n);this.column.footnoteEdge=this.column.footnoteEdge-i;const o=this;this.column.openAllViews=function(e){return s.b.prototype.openAllViews.call(this,e).thenAsync(e=>(o.startNodeContexts.push(e.copy()),r.d(e)))}}layout(e,t){return this.column.layout(e,t)}findAcceptableBreakPosition(e){const t=this.column.findAcceptableBreakPosition();if(e){const e=this.startNodeContexts[0].copy(),n=new o.b(e,null,e.overflow,0);if(n.findAcceptableBreak(this.column,0),!t.nodeContext)return{breakPosition:n,nodeContext:e}}return t}finishBreak(e,t,n){return this.column.finishBreak(e,t,n)}doFinishBreakOfFragmentLayoutConstraints(e){this.column.doFinishBreakOfFragmentLayoutConstraints(e)}isStartNodeContext(e){const t=this.startNodeContexts[0];return t.viewNode===e.viewNode&&t.after===e.after&&t.offsetInNode===e.offsetInNode}isLastAfterNodeContext(e){return a.u(e.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}}},function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return p}));var i=n(0);const o="data-vivliostyle-flow-root";function s(e){return"true"===e.getAttribute(o)}function r(e){const t=e.toString();let n;switch(t){case"inline-flex":n="flex";break;case"inline-grid":n="grid";break;case"inline-table":n="table";break;case"inline":case"table-row-group":case"table-column":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-cell":case"table-caption":case"inline-block":n="block";break;default:n=t}return i.r(n)}function a(e){return e===i.t.absolute||e===i.t.fixed}function l(e,t,n,o){return e===i.t.none||(a(t)?(n=i.t.none,e=r(e)):(n&&n!==i.t.none||o)&&(e=r(e))),{display:e,position:t,float:n}}function c(e,t,n,o){return l(e,t,n,o).display===i.t.block}function h(e){switch(e.toString()){case"inline":case"inline-block":case"inline-list-item":case"inline-flex":case"inline-grid":case"ruby":case"inline-table":return!0;default:return!1}}function u(e){switch(e.toString()){case"ruby-base":case"ruby-text":case"ruby-base-container":case"ruby-text-container":return!0;default:return!1}}function d(e,t,n,o,s,r,l){return s=s||r||i.t.horizontal_tb,!!l||!!n&&n!==i.t.none||a(t)||e===i.t.inline_block||e===i.t.table_cell||e===i.t.table_caption||e==i.t.flex||(e===i.t.block||e===i.t.list_item)&&!!o&&o!==i.t.visible||!!r&&s!==r}function p(e){return e===i.t.relative||e===i.t.absolute||e===i.t.fixed}},function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return l}));var i=n(7);function o(e,t,n){return e-=n,0===t?0===e:e%t==0&&e/t>=0}class s{constructor(e){this.matchers=e}matches(){return this.matchers.some(e=>e.matches())}}class r{constructor(e){this.matchers=e}matches(){return this.matchers.every(e=>e.matches())}}class a{constructor(e,t,n){this.elementOffset=e,this.a=t,this.b=n}static registerFragmentIndex(e,t,n){const i=a.fragmentIndices;(!i[e]||i[e].priority<=n)&&(i[e]={fragmentIndex:t,priority:n})}static clearFragmentIndices(){a.fragmentIndices={}}matches(){const e=a.fragmentIndices[this.elementOffset];return null!=e&&null!=e.fragmentIndex&&o(e.fragmentIndex,this.a,this.b)}}a.fragmentIndices={};class l{static buildViewConditionMatcher(e,t){const n=t.split("_");return"NFS"==n[0]?new a(e,parseInt(n[1],10),parseInt(n[2],10)):(i.b(`unknown view condition. condition=${t}`),null)}static buildAllMatcher(e){return new r(e)}static buildAnyMatcher(e){return new s(e)}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"a",(function(){return f})),n.d(t,"c",(function(){return w})),n.d(t,"d",(function(){return E}));var i=n(7),o=n(1),s=n(14),r=n(25),a=n(21),l=n(3),c=n(8),h=n(15);const u=h.d.isInstanceOfAfterIfContinuesLayoutConstraint,d=r.b.registerFragmentIndex;let p;r.b.clearFragmentIndices,Promise.resolve().then(n.bind(null,23)).then(e=>{p=e});class f{constructor(e,t){this.sourceNode=e,this.styler=t}createElement(e,t){if(!p)throw new Error("layoututil module is required but not be imported.");const n=t.viewNode.ownerDocument.createElement("div"),i=new p.PseudoColumn(e,n,t),s=i.getColumn().pageBreakType;return i.getColumn().pageBreakType=null,i.layout(this.createNodePositionForPseudoElement(),!0).thenAsync(()=>{this.styler.contentProcessed["after-if-continues"]=!1,i.getColumn().pageBreakType=s;const e=n.firstChild;return o.F(e,"display","block"),l.d(e)})}createNodePositionForPseudoElement(){const e=a.c.createElementNS(o.a.XHTML,"div");a.f(e,"after-if-continues");const t=this.createShadowContext(e),n={steps:[{node:e,shadowType:t.type,shadowContext:t,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new c.a(n)}createShadowContext(e){return new c.n(this.sourceNode,e,null,null,null,h.f.ShadowType.ROOTED,this.styler)}}class g{constructor(e,t,n){this.nodeContext=e,this.afterIfContinues=t,this.pseudoElementHeight=n,this.flagmentLayoutConstraintType="AfterIfContinue"}allowLayout(e,t,n){return!(t&&!e||e&&e.overflow)}nextCandidate(e){return!1}postLayout(e,t,n,i){}finishBreak(e,t){return this.getRepetitiveElements().affectTo(e)?this.afterIfContinues.createElement(t,this.nodeContext).thenAsync(e=>(this.nodeContext.viewNode.appendChild(e),l.d(!0))):l.d(!0)}getRepetitiveElements(){return new m(this.nodeContext,this.pseudoElementHeight)}equalsTo(e){return e instanceof g&&this.afterIfContinues==e.afterIfContinues}getPriorityOfFinishBreak(){return 9}}class m{constructor(e,t){this.nodeContext=e,this.pseudoElementHeight=t}calculateOffset(e){return this.affectTo(e)?this.pseudoElementHeight:0}calculateMinimumOffset(e){return this.calculateOffset(e)}affectTo(e){if(!e)return!1;const t=e.shadowContext?e.shadowContext.owner:e.sourceNode;if(t===this.nodeContext.sourceNode)return!!e.after;for(let e=t.parentNode;e;e=e.parentNode)if(e===this.nodeContext.sourceNode)return!0;return!1}}function b(e,t){if(!e||!e.afterIfContinues||e.after||t.isFloatNodeContext(e))return l.d(e);const n=e.afterIfContinues;return n.createElement(t,e).thenAsync(o=>{i.a(null!==e);const r=function(e,t,n){const i=e.viewNode;i.appendChild(n);const o=s.b(n,t,e.vertical);return i.removeChild(n),o}(e,t,o);return t.fragmentLayoutConstraints.push(new g(e,n,r)),l.d(e)})}function w(e,t){return e.thenAsync(e=>b(e,t))}function E(e,t){const n=l.c("processAfterIfContinuesOfAncestors");let i=e;return n.loop(()=>{if(null!==i){const e=b(i,t);return i=i.parent,e.thenReturn(!0)}return l.d(!1)}).then(()=>{n.finish(!0)}),n.result()}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return l}));var i=n(28),o=n.n(i);function s(e,t){return o()(e,t,0)}function r(e){return e.reduce((e,t)=>t[0]===o.a.DELETE?e:e+t[1],"")}function a(e,t){return c(e,t,1)}function l(e,t){return c(e,t,-1)}function c(e,t,n){let i=0,s=0;return e.some(e=>{for(let r=0;r<e[1].length;r++){switch(e[0]*n){case o.a.INSERT:i++;break;case o.a.DELETE:i--,s++;break;case o.a.EQUAL:s++}if(s>t)return!0}return!1}),Math.max(Math.min(t,s-1)+i,0)}},function(e,t){var n=-1,i=1,o=0;function s(e,t,c,h){if(e===t)return e?[[o,e]]:[];if(null!=c){var f=function(e,t,n){var i="number"==typeof n?{index:n,length:0}:n.oldRange,o="number"==typeof n?null:n.newRange,s=e.length,r=t.length;if(0===i.length&&(null===o||0===o.length)){var a=i.index,l=e.slice(0,a),c=e.slice(a),h=o?o.index:null,u=a+r-s;if((null===h||h===u)&&!(u<0||u>r)){var d=t.slice(0,u);if((y=t.slice(u))===c){var f=Math.min(a,u),g=l.slice(0,f),m=d.slice(0,f);if(g===m){var b=l.slice(f),w=d.slice(f);return p(g,b,w,c)}}}if(null===h||h===a){var E=a,y=(d=t.slice(0,E),t.slice(E));if(d===l){var S=Math.min(s-E,r-E),N=c.slice(c.length-S),C=y.slice(y.length-S);if(N===C)return p(l,b=c.slice(0,c.length-S),w=y.slice(0,y.length-S),N)}}}return i.length>0&&o&&0===o.length&&(g=e.slice(0,i.index),N=e.slice(i.index+i.length),!(r<(f=g.length)+(S=N.length))&&(m=t.slice(0,f),C=t.slice(r-S),g===m&&N===C))?p(g,b=e.slice(f,s-S),w=t.slice(f,r-S),N):null}(e,t,c);if(f)return f}var g=a(e,t),m=e.substring(0,g);g=l(e=e.substring(g),t=t.substring(g));var b=e.substring(e.length-g),w=function(e,t){var c;if(!e)return[[i,t]];if(!t)return[[n,e]];var h=e.length>t.length?e:t,u=e.length>t.length?t:e,d=h.indexOf(u);if(-1!==d)return c=[[i,h.substring(0,d)],[o,u],[i,h.substring(d+u.length)]],e.length>t.length&&(c[0][0]=c[2][0]=n),c;if(1===u.length)return[[n,e],[i,t]];var p=function(e,t){var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(n.length<4||2*i.length<n.length)return null;function o(e,t,n){for(var i,o,s,r,c=e.substring(n,n+Math.floor(e.length/4)),h=-1,u="";-1!==(h=t.indexOf(c,h+1));){var d=a(e.substring(n),t.substring(h)),p=l(e.substring(0,n),t.substring(0,h));u.length<p+d&&(u=t.substring(h-p,h)+t.substring(h,h+d),i=e.substring(0,n-p),o=e.substring(n+d),s=t.substring(0,h-p),r=t.substring(h+d))}return 2*u.length>=e.length?[i,o,s,r,u]:null}var s,r,c,h,u,d=o(n,i,Math.ceil(n.length/4)),p=o(n,i,Math.ceil(n.length/2));return d||p?(s=p?d&&d[4].length>p[4].length?d:p:d,e.length>t.length?(r=s[0],c=s[1],h=s[2],u=s[3]):(h=s[0],u=s[1],r=s[2],c=s[3]),[r,c,h,u,s[4]]):null}(e,t);if(p){var f=p[0],g=p[1],m=p[2],b=p[3],w=p[4],E=s(f,m),y=s(g,b);return E.concat([[o,w]],y)}return function(e,t){for(var o=e.length,s=t.length,a=Math.ceil((o+s)/2),l=a,c=2*a,h=new Array(c),u=new Array(c),d=0;d<c;d++)h[d]=-1,u[d]=-1;h[l+1]=0,u[l+1]=0;for(var p=o-s,f=p%2!=0,g=0,m=0,b=0,w=0,E=0;E<a;E++){for(var y=-E+g;y<=E-m;y+=2){for(var S=l+y,N=(I=y===-E||y!==E&&h[S-1]<h[S+1]?h[S+1]:h[S-1]+1)-y;I<o&&N<s&&e.charAt(I)===t.charAt(N);)I++,N++;if(h[S]=I,I>o)m+=2;else if(N>s)g+=2;else if(f&&(T=l+p-y)>=0&&T<c&&-1!==u[T]){var C=o-u[T];if(I>=C)return r(e,t,I,N)}}for(var v=-E+b;v<=E-w;v+=2){for(var T=l+v,x=(C=v===-E||v!==E&&u[T-1]<u[T+1]?u[T+1]:u[T-1]+1)-v;C<o&&x<s&&e.charAt(o-C-1)===t.charAt(s-x-1);)C++,x++;if(u[T]=C,C>o)w+=2;else if(x>s)b+=2;else if(!f&&(S=l+p-v)>=0&&S<c&&-1!==h[S]){var I=h[S];if(N=l+I-S,I>=(C=o-C))return r(e,t,I,N)}}}return[[n,e],[i,t]]}(e,t)}(e=e.substring(0,e.length-g),t=t.substring(0,t.length-g));return m&&w.unshift([o,m]),b&&w.push([o,b]),function e(t,s){t.push([o,""]);for(var r,c=0,h=0,p=0,f="",g="";c<t.length;)if(c<t.length-1&&!t[c][1])t.splice(c,1);else switch(t[c][0]){case i:p++,g+=t[c][1],c++;break;case n:h++,f+=t[c][1],c++;break;case o:var m=c-p-h-1;if(s){if(m>=0&&d(t[m][1])){var b=t[m][1].slice(-1);if(t[m][1]=t[m][1].slice(0,-1),f=b+f,g=b+g,!t[m][1]){t.splice(m,1),c--;var w=m-1;t[w]&&t[w][0]===i&&(p++,g=t[w][1]+g,w--),t[w]&&t[w][0]===n&&(h++,f=t[w][1]+f,w--),m=w}}u(t[c][1])&&(b=t[c][1].charAt(0),t[c][1]=t[c][1].slice(1),f+=b,g+=b)}if(c<t.length-1&&!t[c][1]){t.splice(c,1);break}if(f.length>0||g.length>0){f.length>0&&g.length>0&&(0!==(r=a(g,f))&&(m>=0?t[m][1]+=g.substring(0,r):(t.splice(0,0,[o,g.substring(0,r)]),c++),g=g.substring(r),f=f.substring(r)),0!==(r=l(g,f))&&(t[c][1]=g.substring(g.length-r)+t[c][1],g=g.substring(0,g.length-r),f=f.substring(0,f.length-r)));var E=p+h;0===f.length&&0===g.length?(t.splice(c-E,E),c-=E):0===f.length?(t.splice(c-E,E,[i,g]),c=c-E+1):0===g.length?(t.splice(c-E,E,[n,f]),c=c-E+1):(t.splice(c-E,E,[n,f],[i,g]),c=c-E+2)}0!==c&&t[c-1][0]===o?(t[c-1][1]+=t[c][1],t.splice(c,1)):c++,p=0,h=0,f="",g=""}""===t[t.length-1][1]&&t.pop();var y=!1;for(c=1;c<t.length-1;)t[c-1][0]===o&&t[c+1][0]===o&&(t[c][1].substring(t[c][1].length-t[c-1][1].length)===t[c-1][1]?(t[c][1]=t[c-1][1]+t[c][1].substring(0,t[c][1].length-t[c-1][1].length),t[c+1][1]=t[c-1][1]+t[c+1][1],t.splice(c-1,1),y=!0):t[c][1].substring(0,t[c+1][1].length)==t[c+1][1]&&(t[c-1][1]+=t[c+1][1],t[c][1]=t[c][1].substring(t[c+1][1].length)+t[c+1][1],t.splice(c+1,1),y=!0)),c++;y&&e(t,s)}(w,h),w}function r(e,t,n,i){var o=e.substring(0,n),r=t.substring(0,i),a=e.substring(n),l=t.substring(i),c=s(o,r),h=s(a,l);return c.concat(h)}function a(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,s=0;n<o;)e.substring(s,o)==t.substring(s,o)?s=n=o:i=o,o=Math.floor((i-n)/2+n);return c(e.charCodeAt(o-1))&&o--,o}function l(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,s=0;n<o;)e.substring(e.length-o,e.length-s)==t.substring(t.length-o,t.length-s)?s=n=o:i=o,o=Math.floor((i-n)/2+n);return h(e.charCodeAt(e.length-o))&&o--,o}function c(e){return e>=55296&&e<=56319}function h(e){return e>=56320&&e<=57343}function u(e){return h(e.charCodeAt(0))}function d(e){return c(e.charCodeAt(e.length-1))}function p(e,t,s,r){return d(e)||u(r)?null:function(e){for(var t=[],n=0;n<e.length;n++)e[n][1].length>0&&t.push(e[n]);return t}([[o,e],[n,t],[i,s],[o,r]])}function f(e,t,n){return s(e,t,n,!0)}f.INSERT=i,f.DELETE=n,f.EQUAL=o,e.exports=f},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(7),o=n(3);class s{constructor(){this.initialBreakPositions=null,this.initialStateOfFormattingContext=null}layout(e,t){return this.prepareLayout(e,t),this.tryLayout(e,t)}tryLayout(e,t){const n=o.c("AbstractLayoutRetryer.tryLayout");this.saveState(e,t);const s=this.resolveLayoutMode(e);return s.doLayout(e,t).then(o=>{let r=s.accept(o,t);(r=s.postLayout(o,this.initialPosition,t,r))?n.finish(o):(i.a(this.initialPosition),this.clearNodes(this.initialPosition),this.restoreState(e,t),this.tryLayout(this.initialPosition,t).thenFinish(n))}),n.result()}prepareLayout(e,t){}clearNodes(e){const t=e.viewNode||e.parent.viewNode;let n,i;for(;n=t.lastChild;)t.removeChild(n);for(;i=t.nextSibling;)i.parentNode.removeChild(i)}saveState(e,t){this.initialPosition=e.copy(),this.initialBreakPositions=[].concat(t.breakPositions),this.initialFragmentLayoutConstraints=[].concat(t.fragmentLayoutConstraints),e.formattingContext&&(this.initialStateOfFormattingContext=e.formattingContext.saveState())}restoreState(e,t){t.breakPositions=this.initialBreakPositions,t.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,e.formattingContext&&e.formattingContext.restoreState(this.initialStateOfFormattingContext)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return C})),n.d(t,"b",(function(){return x}));var i=n(7),o=n(1),s=n(13),r=n(22),a=n(0),l=n(27),c=n(11),h=n(14),u=n(18),d=n(29),p=n(6),f=n(12),g=n(9),m=n(26),b=n(31),w=n(19),E=n(3),y=n(8),S=n(15);const N={img:!0,svg:!0,audio:!0,video:!0};class C{constructor(e){this.constraints=e}allowLayout(e){return this.constraints.every(t=>t.allowLayout(e))}}class v extends r.a{constructor(e,t){super(),this.checkPoints=e,this.penalty=t,this.alreadyEvaluated=!1,this.breakNodeContext=null}findAcceptableBreak(e,t){return t<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,t>0),this.alreadyEvaluated=!0),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}}function T(e){switch(e){case"ruby":case"inline-block":case"inline-flex":case"inline-grid":case"inline-list-item":case"inline-table":return!0}return!1}class x extends y.b{constructor(e,t,n,i,o){super(e),this.layoutContext=t,this.clientLayout=n,this.layoutConstraint=i,this.pageFloatLayoutContext=o,this.flowRootFormattingContext=null,this.isFloat=!1,this.isFootnote=!1,this.startEdge=0,this.endEdge=0,this.beforeEdge=0,this.afterEdge=0,this.footnoteEdge=0,this.box=null,this.chunkPositions=null,this.bands=null,this.overflown=!1,this.breakPositions=null,this.pageBreakType=null,this.forceNonfitting=!0,this.leftFloatEdge=0,this.rightFloatEdge=0,this.bottommostFloatTop=0,this.stopAtOverflow=!0,this.lastAfterPosition=null,this.fragmentLayoutConstraints=[],this.pseudoParent=null,this.nodeContextOverflowingDueToRepetitiveElements=null,this.blockDistanceToBlockEndFloats=NaN,this.last=e.lastChild,this.viewDocument=e.ownerDocument,o.setContainer(this)}getTopEdge(){return this.vertical?this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.endEdge}isFloatNodeContext(e){return!(!e.floatSide||this.isFloat&&!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){const e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){const t=this,n=E.c("openAllViews"),o=e.steps;t.layoutContext.setViewRoot(t.element,t.isFootnote);let s=o.length-1,r=null;return n.loop(()=>{for(;s>=0;){const n=r,i=o[s];if(r=y.v(i,n),s!==o.length-1||r.formattingContext||(r.formattingContext=t.flowRootFormattingContext),0==s&&(r.offsetInNode=t.calculateOffsetInNodeForNodeContext(e),r.after=e.after,r.preprocessedTextContent=e.preprocessedTextContent,r.after))break;const a=t.layoutContext.setCurrent(r,0==s&&0==r.offsetInNode);if(s--,a.isPending())return a}return E.d(!1)}).then(()=>{i.a(r),n.finish(r)}),n.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?l.b(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,t){if(e.firstPseudo&&e.inline&&!e.after&&0==e.firstPseudo.count&&1!=e.viewNode.nodeType){const t=e.viewNode.textContent.match(I);return this.layoutContext.peelOff(e,t[0].length)}return E.d(e)}buildViewToNextBlockEdge(e,t){const n=this;let i=!1;const o=E.c("buildViewToNextBlockEdge");return o.loopWithFrame(o=>{e.viewNode&&!h.e(e)&&t.push(e.copy()),n.maybePeelOff(e,0).then(s=>{s!==e&&(e=s,h.e(e)||t.push(e.copy())),n.nextInTree(e).then(t=>{(e=t)?(!i&&n.layoutConstraint.allowLayout(e)||(i=!0,(e=e.modify()).overflow=!0),n.isFloatNodeContext(e)&&!n.vertical?n.layoutFloatOrFootnote(e).then(t=>{e=t,n.pageFloatLayoutContext.isInvalidated()&&(e=null),e?o.continueLoop():o.breakLoop()}):e.inline?o.continueLoop():o.breakLoop()):o.breakLoop()})})}).then(()=>{o.finish(e)}),o.result()}nextInTree(e,t){const n=this.layoutContext.nextInTree(e,t);return m.c(n,this)}buildDeepElementView(e){if(!e.viewNode)return E.d(e);let t=[];const n=e.sourceNode,i=this,o=E.c("buildDeepElementView");return o.loopWithFrame(o=>{e.viewNode&&e.inline&&!h.e(e)?t.push(e.copy()):(t.length>0&&i.postLayoutBlock(e,t),t=[]),i.maybePeelOff(e,0).then(s=>{const r=s;if(r!==e){let i=r;for(;i&&i.sourceNode!=n;)i=i.parent;if(null==i)return e=r,void o.breakLoop();h.e(r)||t.push(r.copy())}i.nextInTree(r).then(t=>{(e=t)&&e.sourceNode!=n?i.layoutConstraint.allowLayout(e)?o.continueLoop():((e=e.modify()).overflow=!0,i.stopAtOverflow?o.breakLoop():o.continueLoop()):o.breakLoop()})})}).then(()=>{t.length>0&&i.postLayoutBlock(e,t),o.finish(e)}),o.result()}createFloat(e,t,n,i){const s=this.viewDocument.createElement("div");return this.vertical?(i>=this.height&&(i-=.1),o.F(s,"height",`${n}px`),o.F(s,"width",`${i}px`)):(n>=this.width&&(n-=.1),o.F(s,"width",`${n}px`),o.F(s,"height",`${i}px`)),o.F(s,"float",t),o.F(s,"clear",t),this.element.insertBefore(s,e),s}killFloats(){let e=this.element.firstChild;for(;e;){const t=e.nextSibling;if(1==e.nodeType){const t=e,n=t.style.cssFloat;if("left"!=n&&"right"!=n)break;this.element.removeChild(t)}e=t}}createFloats(){const e=this.element.firstChild,t=this.bands,n=this.vertical?this.getTopEdge():this.getLeftEdge(),i=this.vertical?this.getBottomEdge():this.getRightEdge();for(const o of t){const t=o.y2-o.y1;o.left=this.createFloat(e,"left",o.x1-n,t),o.right=this.createFloat(e,"right",i-o.x2,t)}}calculateEdge(e,t,n,i){let o;if(e&&h.c(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(o=h.a(e,this.clientLayout,0,this.vertical),!isNaN(o)))return o;let s=i-(e=t[n]).boxOffset;for(;;){if(o=h.a(e,this.clientLayout,s,this.vertical),!isNaN(o))return o;if(s>0)s--;else{if(--n<0)return this.beforeEdge;1!=(e=t[n]).viewNode.nodeType&&(s=e.viewNode.textContent.length)}}}parseComputedLength(e){if("number"==typeof e)return e;const t=e.match(/^(-?[0-9]*(\.[0-9]*)?)px$/);return t?parseFloat(t[0]):0}getComputedMargin(e){const t=this.clientLayout.getElementComputedStyle(e),n=new c.a(0,0,0,0);return t&&(n.left=this.parseComputedLength(t.marginLeft),n.top=this.parseComputedLength(t.marginTop),n.right=this.parseComputedLength(t.marginRight),n.bottom=this.parseComputedLength(t.marginBottom)),n}getComputedPaddingBorder(e){const t=this.clientLayout.getElementComputedStyle(e),n=new c.a(0,0,0,0);return t&&(n.left=this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),n.top=this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),n.right=this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),n.bottom=this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)),n}getComputedInsets(e){const t=this.clientLayout.getElementComputedStyle(e),n=new c.a(0,0,0,0);if(t){if("border-box"==t.boxSizing)return this.getComputedMargin(e);n.left=this.parseComputedLength(t.marginLeft)+this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),n.top=this.parseComputedLength(t.marginTop)+this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),n.right=this.parseComputedLength(t.marginRight)+this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),n.bottom=this.parseComputedLength(t.marginBottom)+this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)}return n}setComputedInsets(e,t){const n=this.clientLayout.getElementComputedStyle(e);n&&(t.marginLeft=this.parseComputedLength(n.marginLeft),t.borderLeft=this.parseComputedLength(n.borderLeftWidth),t.paddingLeft=this.parseComputedLength(n.paddingLeft),t.marginTop=this.parseComputedLength(n.marginTop),t.borderTop=this.parseComputedLength(n.borderTopWidth),t.paddingTop=this.parseComputedLength(n.paddingTop),t.marginRight=this.parseComputedLength(n.marginRight),t.borderRight=this.parseComputedLength(n.borderRightWidth),t.paddingRight=this.parseComputedLength(n.paddingRight),t.marginBottom=this.parseComputedLength(n.marginBottom),t.borderBottom=this.parseComputedLength(n.borderBottomWidth),t.paddingBottom=this.parseComputedLength(n.paddingBottom))}setComputedWidthAndHeight(e,t){const n=this.clientLayout.getElementComputedStyle(e);n&&(t.width=this.parseComputedLength(n.width),t.height=this.parseComputedLength(n.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){const t=this,n=E.c("layoutFloat"),s=e.viewNode,r=e.floatSide;return o.F(s,"float","none"),o.F(s,"display","inline-block"),o.F(s,"vertical-align","top"),t.buildDeepElementView(e).then(a=>{const l=t.clientLayout.getElementClientRect(s),h=t.getComputedMargin(s);let u=new c.c(l.left-h.left,l.top-h.top,l.right+h.right,l.bottom+h.bottom),d=t.startEdge,p=t.endEdge,f=e.parent;for(;f&&f.inline;)f=f.parent;if(f){const n=f.viewNode.ownerDocument.createElement("div");n.style.left="0px",n.style.top="0px",t.vertical?(n.style.bottom="0px",n.style.width="1px"):(n.style.right="0px",n.style.height="1px"),f.viewNode.appendChild(n);const i=t.clientLayout.getElementClientRect(n);d=Math.max(t.getStartEdge(i),d),p=Math.min(t.getEndEdge(i),p),f.viewNode.removeChild(n);const o=t.vertical?u.y2-u.y1:u.x2-u.x1;"left"==r?p=Math.max(p,d+o):d=Math.min(d,p-o),f.viewNode.appendChild(e.viewNode)}let g=new c.c(d,t.getBoxDir()*t.beforeEdge,p,t.getBoxDir()*t.afterEdge),m=u;t.vertical&&(m=c.i(u));const b=t.getBoxDir();if(m.y1<t.bottommostFloatTop*b){const e=m.y2-m.y1;m.y1=t.bottommostFloatTop*b,m.y2=m.y1+e}c.h(g,t.bands,m,r),t.vertical&&(u=c.m(m));const w=t.getComputedInsets(s);let E;o.F(s,"width",`${u.x2-u.x1-w.left-w.right}px`),o.F(s,"height",`${u.y2-u.y1-w.top-w.bottom}px`),o.F(s,"position","absolute"),i.a(e.display),o.F(s,"display",e.display);let y=null;if(f&&(y=f.containingBlockForAbsolute?f:f.getContainingBlockForAbsolute()),y){const e=y.viewNode.ownerDocument.createElement("div");e.style.position="absolute",y.vertical?e.style.right="0":e.style.left="0",e.style.top="0",y.viewNode.appendChild(e),E=t.clientLayout.getElementClientRect(e),y.viewNode.removeChild(e)}else E={left:t.getLeftEdge()-t.paddingLeft,right:t.getRightEdge()+t.paddingRight,top:t.getTopEdge()-t.paddingTop};(y?y.vertical:t.vertical)?o.F(s,"right",`${E.right-u.x2}px`):o.F(s,"left",`${u.x1-E.left}px`),o.F(s,"top",`${u.y1-E.top}px`),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);const S=t.vertical?u.x1:u.y2,N=t.vertical?u.x2:u.y1;t.isOverflown(S)&&0!=t.breakPositions.length?((e=e.modify()).overflow=!0,n.finish(e)):(t.killFloats(),g=new c.c(t.getLeftEdge(),t.getTopEdge(),t.getRightEdge(),t.getBottomEdge()),t.vertical&&(g=c.i(g)),c.e(g,t.bands,m,null,r),t.createFloats(),"left"==r?t.leftFloatEdge=S:t.rightFloatEdge=S,t.bottommostFloatTop=N,t.updateMaxReachedAfterEdge(S),n.finish(a))}),n.result()}setupFloatArea(e,t,n,i,o,s){const r=this.pageFloatLayoutContext,a=r.getContainer(t),l=e.element;a.element.parentNode.appendChild(l),e.isFloat=!0,e.originX=a.originX,e.originY=a.originY,e.vertical=a.vertical,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(a.exclusions||[]).concat(),e.forceNonfitting=!r.hasFloatFragments(),e.innerShape=null;const c=a.getPaddingRect();e.setHorizontalPosition(c.x1-a.originX,c.x2-c.x1),e.setVerticalPosition(c.y1-a.originY,c.y2-c.y1),o.adjustPageFloatArea(e,a,this),e.init();const h=!!r.setFloatAreaDimensions(e,t,n,i,!0,!r.hasFloatFragments(),s);return h?(e.killFloats(),e.init()):a.element.parentNode.removeChild(l),h}createPageFloatArea(e,t,n,i,s){const r=this.element.ownerDocument.createElement("div");o.F(r,"position","absolute");const a=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),l=new f.e(null,f.a.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),c=a.getContainer(),h=new R(t,r,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,l,c);return l.setContainer(h),this.setupFloatArea(h,e.floatReference,t,n,i,s)?h:null}layoutSinglePageFloatFragment(e,t,n,o,s,r,a){const l=this.pageFloatLayoutContext,c=a?a.continuations:[],h=(e=c.concat(e))[0].float,u=l.getPageFloatPlacementCondition(h,t,n),d=this.createPageFloatArea(h,t,r,s,u),p={floatArea:d,pageFloatFragment:null,newPosition:null};if(!d)return E.d(p);const f=E.c("layoutSinglePageFloatFragment");let g=!1,m=0;return f.loopWithFrame(t=>{if(m>=e.length)return void t.breakLoop();const n=e[m],i=new y.a(n.nodePosition);d.layout(i,!0).then(e=>{p.newPosition=e,!e||o?(m++,t.continueLoop()):(g=!0,t.breakLoop())})}).then(()=>{if(!g){i.a(d);const n=l.setFloatAreaDimensions(d,h.floatReference,t,r,!1,o,u);if(n){const t=s.createPageFloatFragment(e,n,d,!!p.newPosition);l.addPageFloatFragment(t,!0),p.pageFloatFragment=t}else g=!0}f.finish(p)}),f.result()}layoutPageFloatInner(e,t,n,o){const s=this.pageFloatLayoutContext,r=e.float;function a(t,n){n?s.removePageFloatFragment(n,!0):t&&t.element.parentNode.removeChild(t.element),s.restoreStashedFragments(r.floatReference),s.deferPageFloat(e)}s.stashEndFloatFragments(r);const l=E.c("layoutPageFloatInner"),c=this;return this.layoutSinglePageFloatFragment([e],r.floatSide,r.clearSide,!s.hasFloatFragments(),t,n,o).then(e=>{const t=e.floatArea,n=e.pageFloatFragment,h=e.newPosition;n?c.layoutStashedPageFloats(r.floatReference,[o]).then(e=>{if(e){if(i.a(n),s.addPageFloatFragment(n),s.discardStashedFragments(r.floatReference),h){const e=new f.c(r,h.primary);s.deferPageFloat(e)}l.finish(!0)}else a(t,n),l.finish(!1)}):(a(t,n),l.finish(!1))}),l.result()}layoutStashedPageFloats(e,t){const n=this.pageFloatLayoutContext,i=n.getStashedFloatFragments(e),o=[],s=[];let r=!1;const a=E.c("layoutStashedPageFloats"),l=this;let c=0;return a.loopWithFrame(e=>{if(c>=i.length)return void e.breakLoop();const n=i[c];if(t.includes(n))return c++,void e.continueLoop();const a=(new f.f).findByFloat(n.continuations[0].float);l.layoutSinglePageFloatFragment(n.continuations,n.floatSide,null,!1,a,null).then(t=>{const n=t.floatArea;n&&o.push(n);const i=t.pageFloatFragment;i?(s.push(i),c++,e.continueLoop()):(r=!0,e.breakLoop())})}).then(()=>{r?(s.forEach(e=>{n.removePageFloatFragment(e,!0)}),o.forEach(e=>{const t=e.element;t&&t.parentNode&&t.parentNode.removeChild(t)})):i.forEach(e=>{const t=e.area.element;t&&t.parentNode&&t.parentNode.removeChild(t)}),a.finish(!r)}),a.result()}setFloatAnchorViewNode(e){const t=e.viewNode.parentNode,n=t.ownerDocument.createElement("span");n.setAttribute(y.m,"1"),"footnote"===e.floatSide&&this.layoutContext.applyPseudoelementStyle(e,"footnote-call",n),t.appendChild(n),t.removeChild(e.viewNode);const i=e.modify();return i.after=!0,i.viewNode=n,i}resolveFloatReferenceFromColumnSpan(e,t,n){const i=this,o=E.c("resolveFloatReferenceFromColumnSpan"),s=this.pageFloatLayoutContext,r=s.getPageFloatLayoutContext(f.a.REGION);return s.getContainer().width<r.getContainer().width&&e===f.a.COLUMN?t===a.t.auto?this.buildDeepElementView(n.copy()).then(t=>{const n=t.viewNode;let s=w.b(i.clientLayout,n,[w.a.MIN_CONTENT_INLINE_SIZE])[w.a.MIN_CONTENT_INLINE_SIZE];const r=i.getComputedMargin(n);i.vertical?s+=r.top+r.bottom:s+=r.left+r.right,s>i.width?o.finish(f.a.REGION):o.finish(e)}):t===a.t.all?o.finish(f.a.REGION):o.finish(e):o.finish(e),o.result()}layoutPageFloat(e){const t=this,n=this.pageFloatLayoutContext,o=(new f.f).findByNodeContext(e);let s;const r=n.findPageFloatByNodePosition(e.toNodePosition());return(s=r?E.d(r):o.createPageFloat(e,n,this)).thenAsync(s=>{const r=y.x(e,0),a=t.setFloatAnchorViewNode(e),l=o.findPageFloatFragment(s,n),c=new f.c(s,r);if(l&&l.hasFloat(s))return n.registerPageFloatAnchor(s,a.viewNode),E.d(a);if(n.isForbidden(s)||n.hasPrecedingFloatsDeferredToNext(s))return n.deferPageFloat(c),n.registerPageFloatAnchor(s,a.viewNode),E.d(a);if(t.nodeContextOverflowingDueToRepetitiveElements)return E.d(null);{const e=h.a(a,t.clientLayout,0,t.vertical);return t.isOverflown(e)?E.d(a):t.layoutPageFloatInner(c,o,e,l).thenAsync(e=>(i.a(s),e?E.d(null):(n.registerPageFloatAnchor(s,a.viewNode),E.d(a))))}})}createJustificationAdjustmentElement(e,t,n,i){const s=t.createElement("span");s.style.visibility="hidden",s.style.verticalAlign="top",s.setAttribute(y.m,"1");const r=t.createElement("span");r.style.fontSize="0",r.style.lineHeight="0",r.textContent=" #",s.appendChild(r),s.style.display="block",s.style.textIndent="0",s.style.textAlign="left",n.insertBefore(s,e);const a=this.clientLayout.getElementClientRect(r);s.style.textAlign="right";const l=this.clientLayout.getElementClientRect(r);s.style.textAlign="",o.j(document.body)?s.style.display="inline":s.style.display="inline-block";const c=i?l.top-a.top:l.left-a.left,h=c>=1?`${c-1}px`:"100%";return i?s.style.paddingTop=h:s.style.paddingLeft=h,s}addAndAdjustJustificationElement(e,t,n,i,s,r){return function(e,t,n,i){if(o.k(document.body)){const s=A(e),r=t?n:n.previousSibling,a=r?r.textContent:"";if(a.charAt(a.length-1)===s){const e=n.ownerDocument,t=n.parentNode;o.l(document.body)?t.insertBefore(e.createTextNode(" "),i):t.insertBefore(e.createElement("wbr"),i)}}}(e,t,n,i),this.createJustificationAdjustmentElement(i,s,r,e.vertical)}compensateJustificationLineHeight(e,t,n){const i=this.clientLayout.getElementClientRect(e),o=this.clientLayout.getElementClientRect(t);n.vertical?(t.style.marginRight=`${o.right-i.right}px`,t.style.width="0px"):(t.style.marginTop=`${i.top-o.top}px`,t.style.height="0px"),t.setAttribute(y.m,"1")}fixJustificationIfNeeded(e,t){if(e.after&&!e.inline)return;if(t){let t="";for(let n=e.parent;n&&!t;n=n.parent)!n.inline&&n.viewNode&&(t=n.viewNode.style.textAlign);if("justify"!==t)return}const n=e.viewNode,i=n.ownerDocument,o=t&&(e.after||1!=n.nodeType);let s=o?n.nextSibling:n;s&&!s.parentNode&&(s=null);const r=n.parentNode||e.parent&&e.parent.viewNode;if(!r)return;const a=this.addAndAdjustJustificationElement(e,o,n,s,i,r);if(!t){const t=i.createElement("div");r.insertBefore(t,s),this.compensateJustificationLineHeight(a,t,e)}}processLineStyling(e,t,n){const i=this,o=E.c("processLineStyling");let s=n.concat([]);n.splice(0,n.length);let r=0,a=e.firstPseudo;return 0==a.count&&(a=a.outer),o.loopWithFrame(n=>{if(!a)return void n.breakLoop();const o=i.findLinePositions(s),l=a.count-r;if(o.length<=l)return void n.breakLoop();const c=i.findAcceptableBreakInside(s,o[l-1],!0);null!=c?i.finishBreak(c,!1,!1).then(()=>{r+=l,i.layoutContext.peelOff(c,0).then(o=>{e=o,i.fixJustificationIfNeeded(e,!1),a=e.firstPseudo,s=[],i.buildViewToNextBlockEdge(e,s).then(e=>{t=e,n.continueLoop()})})}):n.breakLoop()}).then(()=>{Array.prototype.push.apply(n,s),o.finish(t)}),o.result()}isLoneImage(e){return!(2!=e.length&&this.breakPositions.length>0)&&e[0].sourceNode==e[1].sourceNode&&N[e[0].sourceNode.localName]}getTrailingMarginEdgeAdjustment(e){let t=0,n=0;for(let i=e.length-1;i>=0;i--){const o=e[i];if(!o.after||!o.viewNode||1!=o.viewNode.nodeType)break;const s=this.getComputedMargin(o.viewNode),r=this.vertical?-s.left:s.bottom;r>0?t=Math.max(t,r):n=Math.min(n,r)}return t-n}layoutBreakableBlock(e){const t=this,n=E.c("layoutBreakableBlock"),i=[];return t.buildViewToNextBlockEdge(e,i).then(o=>{const s=i.length-1;if(s<0)return void n.finish(o);let a,l=t.calculateEdge(o,i,s,i[s].boxOffset),c=!1;if(!o||!h.c(o.viewNode)){const e=r.c(o,t.collectElementsOffset());c=t.isOverflown(l+(t.vertical?-1:1)*e.minimum),t.isOverflown(l+(t.vertical?-1:1)*e.current)&&!t.nodeContextOverflowingDueToRepetitiveElements&&(t.nodeContextOverflowingDueToRepetitiveElements=o)}null==o&&(l+=t.getTrailingMarginEdgeAdjustment(i)),t.updateMaxReachedAfterEdge(l),(a=e.firstPseudo?t.processLineStyling(e,o,i):E.d(o)).then(e=>{t.postLayoutBlock(e,i),i.length>0&&(t.saveBoxBreakPosition(i),c&&!t.isLoneImage(i)&&e&&((e=e.modify()).overflow=!0)),n.finish(e)})}),n.result()}postLayoutBlock(e,t){g.b(g.a.POST_LAYOUT_BLOCK).forEach(n=>{n(e,t,this)})}findEndOfLine(e,t,n){const i=this.vertical?e-1:e+1;let o,s=0,r=t[0].boxOffset,a=s,l=t.length-1,c=t[l].boxOffset;for(;r<c;){o=r+Math.ceil((c-r)/2),a=s;let e=l;for(;a<e;){const n=a+Math.ceil((e-a)/2);t[n].boxOffset>o?e=n-1:a=n}const h=this.calculateEdge(null,t,a,o);if(this.vertical?h<=i:h>=i){for(c=o-1;t[a].boxOffset==o;)a--;l=a}else n&&this.updateMaxReachedAfterEdge(h),r=o,s=a}return{nodeContext:t[a],index:r,checkPointIndex:a}}findAcceptableBreakInside(e,t,n){const i=this.findEndOfLine(t,e,!0);let o=i.nodeContext;const s=o.viewNode;if(1!=s.nodeType){const t=s;o=this.resolveTextNodeBreaker(o).breakTextNode(t,o,i.index,e,i.checkPointIndex,n)}return this.clearOverflownViewNodes(o,!1),o}resolveTextNodeBreaker(e){return g.b(g.a.RESOLVE_TEXT_NODE_BREAKER).reduce((t,n)=>n(e)||t,P.instance)}getRangeBoxes(e,t){const n=[],i=e.ownerDocument.createRange();let o=!1,s=e,r=null,a=!1,l=!0;for(;l;){let e=!0;do{let n=null;s==t&&(l=1===t.nodeType&&!(!t.firstChild||o)),1!=s.nodeType?(a||(i.setStartBefore(s),a=!0),r=s):o?o=!1:h.d(s)?e=!a:"ruby"==s.localName||T(this.clientLayout.getElementComputedStyle(s).display)?((e=!a)&&(i.setStartBefore(s),a=!0,r=s),s.contains(t)&&(l=!1)):n=s.firstChild,n||(n=s.nextSibling)||(o=!0,n=s.parentNode),s=n}while(e&&l);if(a){i.setEndAfter(r);const e=this.clientLayout.getRangeClientRects(i);for(let t=0;t<e.length;t++)n.push(e[t]);a=!1}}return n}findLinePositions(e){const t=[],n=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);n.sort(this.vertical?y.q:y.r);let i=0,s=0,r=0,a=0,l=0;const c=this.getBoxDir();for(;;){if(l<n.length){const e=n[l];let t=1;if(a>0){const n=Math.max(this.getBoxSize(e),1);t=c*this.getBeforeEdge(e)<c*i?c*(this.getAfterEdge(e)-i)/n:c*this.getAfterEdge(e)>c*s?c*(s-this.getBeforeEdge(e))/n:1}if(0==a||t>=.6||t>=.2&&this.getStartEdge(e)>=r-1){r=this.getEndEdge(e),this.vertical?(i=0==a?e.right:Math.max(i,e.right),s=0==a?e.left:Math.min(s,e.left)):(i=0==a?e.top:Math.min(i,e.top),s=0==a?e.bottom:Math.max(s,e.bottom)),a++,l++;continue}}if(a>0&&(t.push(s),a=0),l>=n.length)break}return t.sort(o.B),this.vertical&&t.reverse(),t}calculateClonedPaddingBorder(e){let t=0;return e.walkUpBlocks(e=>{if("clone"===e.inheritedProps["box-decoration-break"]){i.a(e.viewNode instanceof Element);const n=this.getComputedPaddingBorder(e.viewNode);t+=e.vertical?-n.left:n.bottom,"table"===e.display&&(t+=e.blockBorderSpacing)}}),t}getOffsetByRepetitiveElements(e){let t;return(t=e?e.calculateOffset(this):r.c(null,this.collectElementsOffset())).current}findBoxBreakPosition(e,t){const n=this,i=e.checkPoints;let s,r,a=i[0];for(;a.parent&&a.inline;)a=a.parent;t?(s=1,r=1):(s=Math.max((a.inheritedProps.widows||2)-0,1),r=Math.max((a.inheritedProps.orphans||2)-0,1));const l=n.calculateClonedPaddingBorder(a),c=this.findLinePositions(i);let h=this.footnoteEdge-l;const u=this.getBoxDir(),d=this.getOffsetByRepetitiveElements(e);h-=u*d;const p=this.findFirstOverflowingEdgeAndCheckPoint(i);isNaN(p.edge)&&(p.edge=u*(1/0));let f=o.i(c.length,e=>{const t=c[e];return n.vertical?t<h||t<=p.edge:t>h||t>=p.edge});const g=f<=0;if(g&&(f=o.i(c.length,e=>n.vertical?c[e]<h:c[e]>h)),(f=Math.min(c.length-s,f))<r)return null;let m;if(h=c[f-1],m=g?p.checkPoint:this.findAcceptableBreakInside(e.checkPoints,h,t)){const e=this.getAfterEdgeOfBlockContainer(m);!isNaN(e)&&e<h&&(h=e),this.computedBlockSize=u*(h-this.beforeEdge)+d}return m}getAfterEdgeOfBlockContainer(e){let t=e;do{t=t.parent}while(t&&t.inline);return t?((t=t.copy().modify()).after=!0,h.a(t,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){const t=e.findIndex(e=>e.overflow);if(t<0)return{edge:NaN,checkPoint:null};const n=e[t];return{edge:this.calculateEdge(null,e,t,n.boxOffset),checkPoint:n}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,t,n){i.a(e.formattingContext);let o=(new u.c).find(e.formattingContext).finishBreak(this,e,t,n);return o||(o=u.d.finishBreak(this,e,t,n)),o}findAcceptableBreakPosition(){let e=null,t=null,n=0,i=0;do{n=i,i=Number.MAX_VALUE;for(let o=this.breakPositions.length-1;o>=0&&!t;--o){t=(e=this.breakPositions[o]).findAcceptableBreak(this,n);const s=e.getMinBreakPenalty();s>n&&(i=Math.min(i,s))}}while(i>n&&!t&&this.forceNonfitting);return{breakPosition:t?e:null,nodeContext:t}}doFinishBreak(e,t,n,i){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!t)return E.d(e);const o=this,s=E.c("doFinishBreak");let r=!1;if(!e){if(this.forceNonfitting)return p.b.warn("Could not find any page breaks?!!"),o.skipTailEdges(t).then(e=>{e?((e=e.modify()).overflow=!1,o.finishBreak(e,r,!0).then(()=>{s.finish(e)})):s.finish(e)}),s.result();e=n,r=!0,o.computedBlockSize=i}return this.finishBreak(e,r,!0).then(()=>{s.finish(e)}),s.result()}isBreakable(e){if(e.after)return!0;switch(e.sourceNode.namespaceURI){case o.a.SVG:return!1}return!e.flexContainer}zeroIndent(e){const t=e.toString();return""==t||"auto"==t||!!t.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,t){if(!e)return!1;if(h.c(e.viewNode))return!1;let n=h.a(e,this.clientLayout,0,this.vertical);const i=r.c(e,this.collectElementsOffset()),o=this.isOverflown(n+(this.vertical?-1:1)*i.minimum);if(this.isOverflown(n+(this.vertical?-1:1)*i.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(t){const e=n+this.getTrailingMarginEdgeAdjustment(t),o=this.footnoteEdge-this.getBoxDir()*i.current;n=this.vertical?Math.min(n,Math.max(e,o)):Math.max(n,Math.min(e,o))}return this.updateMaxReachedAfterEdge(n),o}checkOverflowAndSaveEdgeAndBreakPosition(e,t,n,i){if(!e)return!1;if(h.c(e.viewNode))return!1;const o=this.checkOverflowAndSaveEdge(e,t);return!n&&o||this.saveEdgeBreakPosition(e,i,o),o}applyClearance(e){if(!e.viewNode.parentNode)return!1;const t=this.getComputedMargin(e.viewNode),n=e.viewNode.ownerDocument.createElement("div");this.vertical?(n.style.bottom="0px",n.style.width="1px",n.style.marginRight=`${t.right}px`):(n.style.right="0px",n.style.height="1px",n.style.marginTop=`${t.top}px`),e.viewNode.parentNode.insertBefore(n,e.viewNode);let i=this.clientLayout.getElementClientRect(n);const o=this.getBeforeEdge(i),s=this.getBoxDir(),r=e.clearSide;let a=-this.getBoxDir()*(1/0);switch("all"===r&&(a=this.pageFloatLayoutContext.getPageFloatClearEdge(r,this)),r){case"left":a=s*Math.max(a*s,this.leftFloatEdge*s);break;case"right":a=s*Math.max(a*s,this.rightFloatEdge*s);break;default:a=s*Math.max(a*s,Math.max(this.rightFloatEdge*s,this.leftFloatEdge*s))}if(o*s>=a*s)return e.viewNode.parentNode.removeChild(n),!1;{const r=Math.max(1,(a-o)*s);this.vertical?n.style.width=`${r}px`:n.style.height=`${r}px`,i=this.clientLayout.getElementClientRect(n);const l=this.getAfterEdge(i);if(this.vertical){let e=l+t.right-a;e>0==t.right>=0&&(e+=t.right),n.style.marginLeft=`${e}px`}else{let e=a-(l+t.top);e>0==t.top>=0&&(e+=t.top),n.style.marginBottom=`${e}px`}return e.clearSpacer=n,!0}}isBFC(e){return!!u.e(e)||!!S.c.isInstanceOfRepetitiveElementsOwnerFormattingContext(e)}skipEdges(e,t,n){const o=e.after?e.parent&&e.parent.formattingContext:e.formattingContext;if(o&&!this.isBFC(o))return E.d(e);const r=this,a=E.c("skipEdges");let l=!n&&t&&e&&e.after,c=n,h=null,d=[],p=[],f=!1;function g(){return!!n||!t&&s.c(c)}function m(){(e=d[0]||e).viewNode.parentNode.removeChild(e.viewNode),r.pageBreakType=c}return a.loopWithFrame(n=>{for(;e;){i.a(e.formattingContext);const o=(new u.c).find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&1!=e.viewNode.nodeType){if(y.p(e.viewNode,e.whitespace))break;if(!e.after)return g()?m():r.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!0,c)?(e=(r.stopAtOverflow&&h||e).modify()).overflow=!0:(e=e.modify()).breakBefore=c,void n.breakLoop()}if(!e.after){if(o&&o.startNonInlineElementNode(e))break;if(e.clearSide&&r.applyClearance(e)&&t&&0===r.breakPositions.length&&r.saveEdgeBreakPosition(e.copy(),c,!1),!r.isBFC(e.formattingContext)||S.c.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||r.isFloatNodeContext(e)||e.flexContainer)return d.push(e.copy()),c=s.d(c,e.breakBefore),g()?m():!r.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!0,c)&&r.layoutConstraint.allowLayout(e)||((e=(r.stopAtOverflow&&h||e).modify()).overflow=!0),void n.breakLoop()}if(1!=e.viewNode.nodeType)break;const i=e.viewNode.style;if(e.after){if(e.inline)break;if(o&&o.afterNonInlineElementNode(e,r.stopAtOverflow))break;if(f){if(g())return m(),void n.breakLoop();d=[],t=!1,l=!1,c=null}f=!1,h=e.copy(),p.push(h),c=s.d(c,e.breakAfter),!i||r.zeroIndent(i.paddingBottom)&&r.zeroIndent(i.borderBottomWidth)||(p=[h])}else{if(d.push(e.copy()),c=s.d(c,e.breakBefore),!r.layoutConstraint.allowLayout(e)&&(r.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!r.stopAtOverflow,c),(e=e.modify()).overflow=!0,r.stopAtOverflow))return void n.breakLoop();const t=e.viewNode.localName;if(N[t])return g()?m():r.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!0,c)&&((e=(r.stopAtOverflow&&h||e).modify()).overflow=!0),void n.breakLoop();!i||r.zeroIndent(i.paddingTop)&&r.zeroIndent(i.borderTopWidth)||(l=!1,p=[]),f=!0}}while(0);const a=r.nextInTree(e,l);if(a.isPending())return void a.then(t=>{e=t,n.continueLoop()});e=a.get()}r.checkOverflowAndSaveEdgeAndBreakPosition(h,p,!r.stopAtOverflow,c)?h&&r.stopAtOverflow&&((e=h.modify()).overflow=!0):s.c(c)&&(r.pageBreakType=c),n.breakLoop()}).then(()=>{h&&(r.lastAfterPosition=h.toNodePosition()),a.finish(e)}),a.result()}skipTailEdges(e){let t=e.copy();const n=this,i=E.c("skipEdges");let o=null,r=!1;return i.loopWithFrame(i=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&1!=e.viewNode.nodeType){if(y.p(e.viewNode,e.whitespace))break;if(!e.after)return s.c(o)&&(n.pageBreakType=o),void i.breakLoop()}if(!e.after&&(n.isFloatNodeContext(e)||e.flexContainer))return o=s.d(o,e.breakBefore),s.c(o)&&(n.pageBreakType=o),void i.breakLoop();if(1!=e.viewNode.nodeType)break;const t=e.viewNode.style;if(e.after){if(r){if(s.c(o))return n.pageBreakType=o,void i.breakLoop();o=null}r=!1,o=s.d(o,e.breakAfter)}else{o=s.d(o,e.breakBefore);const r=e.viewNode.localName;if(N[r])return s.c(o)&&(n.pageBreakType=o),void i.breakLoop();if(t&&(!n.zeroIndent(t.paddingTop)||!n.zeroIndent(t.borderTopWidth)))return void i.breakLoop()}r=!0}while(0);const t=n.layoutContext.nextInTree(e);if(t.isPending())return void t.then(t=>{e=t,i.continueLoop()});e=t.get()}t=null,i.breakLoop()}).then(()=>{i.finish(t)}),i.result()}layoutFloatOrFootnote(e){return f.h(e.floatReference)||"footnote"===e.floatSide?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,t,n){const o=this,s=E.c("layoutNext");return this.skipEdges(e,t,n||null).then(n=>{if(!(e=n)||o.pageBreakType||o.stopByOverflow(e))s.finish(e);else{const n=e.formattingContext;i.a(n),(new u.c).find(n).layout(e,o,t).thenFinish(s)}}),s.result()}clearOverflownViewNodes(e,t){if(e)for(let n=e.parent;e;e=n,n=n?n.parent:null){const o=(n||e).formattingContext;i.a(o),(new u.c).find(o).clearOverflownViewNodes(this,n,e,t),t=!1}}initGeom(){const e=this.element.ownerDocument.createElement("div");e.style.position="absolute",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);const t=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);const n=this.originX+this.left+this.getInsetLeft(),i=this.originY+this.top+this.getInsetTop();this.box=new c.c(n,i,n+this.width,i+this.height),this.startEdge=t?this.vertical?t.top:t.left:0,this.endEdge=t?this.vertical?t.bottom:t.right:0,this.beforeEdge=t?this.vertical?t.right:t.top:0,this.afterEdge=t?this.vertical?t.left:t.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=c.l(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],o.F(this.element,"width",`${this.width}px`),o.F(this.element,"height",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,t,n){i.a(e.formattingContext);const o=e.copy(),s=(new u.c).find(e.formattingContext),r=this.calculateClonedPaddingBorder(o),a=s.createEdgeBreakPosition(o,t,n,this.computedBlockSize+r);this.breakPositions.push(a)}saveBoxBreakPosition(e){const t=e[0].breakPenalty,n=new v(e,t);this.breakPositions.push(n)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){const t=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(t,this.computedBlockSize)}}layout(e,t,n){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return E.d(e);if(this.isFullWithPageFloats())return e.primary.after&&1===e.primary.steps.length?E.d(null):E.d(e);const i=this,o=E.c("layout");return i.openAllViews(e.primary).then(e=>{let s=null;if(e.viewNode)s=e.copy();else{const e=t=>{t.nodeContext.viewNode&&(s=t.nodeContext,i.layoutContext.removeEventListener("nextInTree",e))};i.layoutContext.addEventListener("nextInTree",e)}const r=new O(t,n);r.layout(e,i).then(e=>{i.doFinishBreak(e,r.context.overflownNodeContext,s,r.initialComputedBlockSize).then(e=>{(i.pseudoParent?E.d(null):i.doFinishBreakOfFragmentLayoutConstraints(e)).then(()=>{if(i.pageFloatLayoutContext.isInvalidated())o.finish(null);else if(e){i.overflown=!0;const t=new y.a(e.toNodePosition());o.finish(t)}else o.finish(null)})})})}),o.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){const t=E.c("doFinishBreakOfFragmentLayoutConstraints"),n=[].concat(this.fragmentLayoutConstraints);n.sort((e,t)=>e.getPriorityOfFinishBreak()-t.getPriorityOfFinishBreak());let i=0;return t.loop(()=>i<n.length?n[i++].finishBreak(e,this).thenReturn(!0):E.d(!1)).then(()=>{t.finish(!0)}),t.result()}doLayout(e,t,n){const i=this,o=E.c("doLayout");let s=null;return i.breakPositions=[],i.nodeContextOverflowingDueToRepetitiveElements=null,o.loopWithFrame(o=>{for(;e;){let r=!0;if(i.layoutNext(e,t,n||null).then(a=>{if(t=!1,n=null,i.nodeContextOverflowingDueToRepetitiveElements&&i.stopAtOverflow?(i.pageBreakType=null,(e=i.nodeContextOverflowingDueToRepetitiveElements).overflow=!0):e=a,i.pageFloatLayoutContext.isInvalidated())o.breakLoop();else if(i.pageBreakType)o.breakLoop();else if(e&&i.stopByOverflow(e)){s=e;const t=i.findAcceptableBreakPosition();e=t.nodeContext,t.breakPosition&&t.breakPosition.breakPositionChosen(i),o.breakLoop()}else r?r=!1:o.continueLoop()}),r)return void(r=!1)}i.computedBlockSize+=i.getOffsetByRepetitiveElements(),o.breakLoop()}).then(()=>{o.finish({nodeContext:e,overflownNodeContext:s})}),o.result()}redoLayout(){const e=this.chunkPositions;let t=this.element.lastChild;for(;t!=this.last;){const e=t.previousSibling;this.element===t.parentNode&&this.layoutContext.isPseudoelement(t)||this.element.removeChild(t),t=e}this.killFloats(),this.init();const n=this,i=E.c("redoLayout");let o=0,s=null,r=!0;return i.loopWithFrame(t=>{if(o<e.length){const i=e[o++];n.layout(i,r).then(e=>{r=!1,e?(s=e,t.breakLoop()):t.continueLoop()})}else t.breakLoop()}).then(()=>{i.finish(s)}),i.result()}saveDistanceToBlockEndFloats(){const e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){const e=[];for(let t=this;t;t=t.pseudoParent)t.fragmentLayoutConstraints.forEach(t=>{if(S.c.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(t)){const n=t.getRepetitiveElements();e.push(n)}if(m.b(t)){const n=t.getRepetitiveElements();e.push(n)}S.e.isInstanceOfTableRowLayoutConstraint(t)&&t.getElementsOffsetsForTableCell(this).forEach(t=>{e.push(t)})});return e}}const I=/^[^A-Za-z0-9_\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02AF\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]*([A-Za-z0-9_\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02AF\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527][^A-Za-z0-9_\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02AF\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]*)?/;class P{breakTextNode(e,t,n,i,o,s){if(t.after)t.offsetInNode=e.length;else{let i=n-t.boxOffset;const o=e.data;(i=173==o.charCodeAt(i)?this.breakAfterSoftHyphen(e,o,i,t):this.breakAfterOtherCharacter(e,o,i,t))>0&&(t=this.updateNodeContext(t,i,e))}return t}breakAfterSoftHyphen(e,t,n,i){return e.replaceData(n,t.length-n,i.breakWord?"":A(i)),n+1}breakAfterOtherCharacter(e,t,n,i){const s=t.charAt(n);n++;const r=t.charAt(n);return e.replaceData(n,t.length-n,!i.breakWord&&o.x(s)&&o.x(r)?A(i):""),n}updateNodeContext(e,t,n){return(e=e.modify()).offsetInNode+=t,e.breakBefore=null,e}}function A(e){return e.hyphenateCharacter||e.parent&&e.parent.hyphenateCharacter||"-"}P.instance=new P;class O extends d.a{constructor(e,t){super(),this.leadingEdge=e,this.initialPageBreakType=null,this.initialComputedBlockSize=0,this.initialOverflown=!1,this.context={overflownNodeContext:null},this.breakAfter=t||null}resolveLayoutMode(e){return new k(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,t){t.fragmentLayoutConstraints=[],t.pseudoParent||b.a()}clearNodes(e){super.clearNodes(e);let t=e;for(;t;){const e=t.viewNode;e&&h.f(e.parentNode,e),t=t.parent}}saveState(e,t){super.saveState(e,t),this.initialPageBreakType=t.pageBreakType,this.initialComputedBlockSize=t.computedBlockSize,this.initialOverflown=t.overflown}restoreState(e,t){super.restoreState(e,t),t.pageBreakType=this.initialPageBreakType,t.computedBlockSize=this.initialComputedBlockSize,t.overflown=this.initialOverflown}}class k{constructor(e,t,n){this.leadingEdge=e,this.breakAfter=t,this.context=n}doLayout(e,t){const n=E.c("DefaultLayoutMode.doLayout");return m.d(e,t).then(()=>{t.doLayout(e,this.leadingEdge,this.breakAfter).then(e=>{this.context.overflownNodeContext=e.overflownNodeContext,n.finish(e.nodeContext)})}),n.result()}accept(e,t){return!(!t.pageFloatLayoutContext.isInvalidated()&&!t.pageBreakType)||t.fragmentLayoutConstraints.length<=0||t.fragmentLayoutConstraints.every(n=>n.allowLayout(e,this.context.overflownNodeContext,t))}postLayout(e,t,n,i){if(!i){const t=n.fragmentLayoutConstraints.some(t=>t.nextCandidate(e));i=!t}return n.fragmentLayoutConstraints.forEach(o=>{o.postLayout(i,e,t,n)}),i}}class R extends x{constructor(e,t,n,i,o,s,r){super(t,n,i,o,s),this.floatSide=e,this.parentContainer=r,this.rootViewNodes=[],this.floatMargins=[],this.adjustContentRelativeSize=!0}openAllViews(e){return super.openAllViews(e).thenAsync(e=>(e&&this.fixFloatSizeAndPosition(e),E.d(e)))}convertPercentageSizesToPx(e){const t=this.parentContainer.getPaddingRect(),n=t.x2-t.x1,i=t.y2-t.y1;function s(t,n){t.forEach(t=>{const i=o.t(e,t);if(i&&"%"===i.charAt(i.length-1)){const s=parseFloat(i),r=n*s/100;o.F(e,t,`${r}px`)}})}s(["width","max-width","min-width"],n),s(["height","max-height","min-height"],i),s(["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"],this.vertical?i:n),["margin-top","margin-right","margin-bottom","margin-left"].forEach(t=>{"auto"===o.t(e,t)&&o.F(e,t,"0")})}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;i.a(1===e.viewNode.nodeType);const t=e.viewNode;if(this.rootViewNodes.push(t),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(t),this.floatMargins.push(this.getComputedMargin(t)),this.adjustContentRelativeSize){const e=this.floatSide;if(this.parentContainer.vertical){if("block-end"===e||"left"===e){const e=o.t(t,"height");""!==e&&"auto"!==e&&o.F(t,"margin-top","auto")}}else if("block-end"===e||"bottom"===e){const e=o.t(t,"width");""!==e&&"auto"!==e&&o.F(t,"margin-left","auto")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map((e,t)=>{const n=this.clientLayout.getElementClientRect(e),i=this.floatMargins[t];return this.vertical?i.top+n.height+i.bottom:i.left+n.width+i.right}))}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));let i=[];function o(){i=[]}},function(e,t,n){"use strict";n.r(t);let i=!1;var o,s,r;!function(e){e.LTR="ltr",e.RTL="rtl"}(o||(o={})),function(e){e.LEFT="left",e.RIGHT="right"}(s||(s={})),function(e){e.LOADING="loading",e.INTERACTIVE="interactive",e.COMPLETE="complete"}(r||(r={}));const a={PageProgression:o,PageSide:s,ReadyState:r};var l=n(9),c=n(6);function h(){}function u(e,t,n){n||(n=this.performanceInstance.now());let i,o=this.timestamps[e];o||(o=this.timestamps[e]=[]);for(let e=o.length-1;e>=0&&(!(i=o[e])||i[t]);e--)i=null;i||(i={},o.push(i)),i[t]=n}function d(e,t){this.registerTiming(e,"start",t)}function p(e,t){this.registerTiming(e,"end",t)}const f={now:Date.now},g=new class{constructor(e){this.performanceInstance=e,this.timestamps={},this.registerTiming=h,this.registerStartTiming=this.registerStartTiming=h,this.registerEndTiming=this.registerEndTiming=h}forceRegisterStartTiming(e,t){u.call(this,e,"start",t)}forceRegisterEndTiming(e,t){u.call(this,e,"end",t)}printTimings(){const e=this.timestamps;let t="";Object.keys(e).forEach(n=>{const i=e[n],o=i.length;for(let e=0;e<o;e++){const s=i[e];t+=n,o>1&&(t+=`(${e})`),t+=` => start: ${s.start}, end: ${s.end}, duration: ${s.end-s.start}\n`}}),c.b.info(t)}disable(){this.registerTiming=h,this.registerStartTiming=this.registerStartTiming=h,this.registerEndTiming=this.registerEndTiming=h}enable(){this.registerTiming=u,this.registerStartTiming=this.registerStartTiming=d,this.registerEndTiming=this.registerEndTiming=p}isEnabled(){return this.registerStartTiming===d}}(window&&window.performance||f);g.forceRegisterStartTiming("load_vivliostyle");const m={profiler:{registerStartTiming:g.registerStartTiming,registerEndTiming:g.registerEndTiming,printTimings:g.printTimings,disable:g.disable,enable:g.enable}};var b=n(7),w=n(1);function E(e){if(1==e.nodeType){const t=e.getAttribute("id");if(t&&t.match(/^[-a-zA-Z_0-9.\u007F-\uFFFF]+$/))return t}return null}function y(e){return`^${e}`}function S(e){return e.replace(/[\[\]\(\),=;^]/g,y)}function N(e){return e.substr(1)}function C(e){return e?e.replace(/\^[\[\]\(\),=;^]/g,N):e}function v(e){const t=[];do{const n=e.match(/^(\^,|[^,])*/),i=C(n[0]);if(!(e=e.substr(n[0].length+1))&&!t.length)return i;t.push(i)}while(e);return t}function T(e){const t={};for(;e;){const n=e.match(/^;([^;=]+)=(([^;]|\^;)*)/);if(!n)return t;t[n[1]]=v(n[2]),e=e.substr(n[0].length)}return t}class x{appendTo(e){e.append("!")}applyTo(e){return!1}}class I{constructor(e,t,n){this.index=e,this.id=t,this.sideBias=n}appendTo(e){e.append("/"),e.append(this.index.toString()),(this.id||this.sideBias)&&(e.append("["),this.id&&e.append(this.id),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}applyTo(e){if(1!=e.node.nodeType)throw new Error("E_CFI_NOT_ELEMENT");const t=e.node,n=t.children,i=n.length;let o;const s=Math.floor(this.index/2)-1;if(s<0||0==i)o=t.firstChild,e.node=o||t;else{if(o=n[Math.min(s,i-1)],1&this.index){const t=o.nextSibling;t&&1!=t.nodeType?o=t:e.after=!0}e.node=o}if(this.id&&(e.after||this.id!=E(e.node)))throw new Error("E_CFI_ID_MISMATCH");return e.sideBias=this.sideBias,!0}}class P{constructor(e,t,n,i){this.offset=e,this.textBefore=t,this.textAfter=n,this.sideBias=i}applyTo(e){if(this.offset>0&&!e.after){let t=this.offset,n=e.node;for(;;){const e=n.nodeType;if(1==e)break;const i=n.nextSibling;if(3<=e&&e<=5){const e=n.textContent.length;if(t<=e)break;if(!i){t=e;break}t-=e}if(!i){t=0;break}n=i}e.node=n,e.offset=t}return e.sideBias=this.sideBias,!0}appendTo(e){e.append(":"),e.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(e.append("["),(this.textBefore||this.textAfter)&&(this.textBefore&&e.append(S(this.textBefore)),e.append(","),this.textAfter&&e.append(S(this.textAfter))),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}}class A{constructor(){this.steps=null}fromString(e){let t=e.match(/^#?epubcfi\((.*)\)$/);if(!t)throw new Error("E_CFI_NOT_CFI");const n=t[1];let i=0;const o=[];for(;;){let e;switch(n.charAt(i)){case"/":{if(i++,!(t=n.substr(i).match(/^(0|[1-9][0-9]*)(\[([-a-zA-Z_0-9.\u007F-\uFFFF]+)(;([^\]]|\^\])*)?\])?/)))throw new Error("E_CFI_NUMBER_EXPECTED");i+=t[0].length;const s=parseInt(t[1],10),r=t[3];e=T(t[4]),o.push(new I(s,r,w.g(e.s)));break}case":":{if(i++,!(t=n.substr(i).match(/^(0|[1-9][0-9]*)(\[((([^\];,]|\^[\];,])*)(,(([^\];,]|\^[\];,])*))?)(;([^]]|\^\])*)?\])?/)))throw new Error("E_CFI_NUMBER_EXPECTED");i+=t[0].length;const s=parseInt(t[1],10);let r=t[4];r&&(r=C(r));let a=t[7];a&&(a=C(a)),e=T(t[10]),o.push(new P(s,r,a,w.g(e.s)));break}case"!":i++,o.push(new x);break;case"~":case"@":case"":return void(this.steps=o);default:throw new Error("E_CFI_PARSE_ERROR")}}}navigate(e){const t={node:e.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let e=0;e<this.steps.length;e++)if(!this.steps[e].applyTo(t)){t.ref=new A,t.ref.steps=this.steps.slice(e+1);break}return t}trim(e,t){return e.replace(/\s+/g," ").match(t?/^[ -\uD7FF\uE000-\uFFFF]{0,8}/:/[ -\uD7FF\uE000-\uFFFF]{0,8}$/)[0].replace(/^\s/,"").replace(/\s$/,"")}prependPathFromNode(e,t,n,i){const o=[];let s=e.parentNode,r="",a="";for(;e;){switch(e.nodeType){case 3:case 4:case 5:{const i=e.textContent,o=i.length;n?(t+=o,r||(r=i)):(t>o&&(t=o),n=!0,r=i.substr(0,t),a=i.substr(t)),e=e.previousSibling;continue}case 8:e=e.previousSibling;continue}break}for((t>0||r||a)&&(r=this.trim(r,!1),a=this.trim(a,!0),o.push(new P(t,r,a,i)),i=null);s&&s&&9!=s.nodeType;){const t=n?null:E(e);let r=n?1:0;for(;e;)1==e.nodeType&&(r+=2),e=e.previousSibling;o.push(new I(r,t,i)),i=null,e=s,s=s.parentNode,n=!1}o.reverse(),this.steps?(o.push(new x),this.steps=o.concat(this.steps)):this.steps=o}toString(){if(!this.steps)return"";const e=new w.d;e.append("epubcfi(");for(let t=0;t<this.steps.length;t++)this.steps[t].appendTo(e);return e.append(")"),e.toString()}}var O=n(20),k=n(4);function R(e){const t={};return Object.keys(e).forEach(n=>{t[n]=Array.from(e[n])}),t}class L{constructor(e,t){this.targetId=e,this.resolved=t,this.pageCounters=null,this.spineIndex=-1,this.pageIndex=-1}equals(e){return this===e||!!e&&this.targetId===e.targetId&&this.resolved===e.resolved&&this.spineIndex===e.spineIndex&&this.pageIndex===e.pageIndex}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}}class F{constructor(e,t){this.counterStore=e,this.baseURL=t}countersOfId(e,t){e=this.counterStore.documentURLTransformer.transformFragment(e,this.baseURL),this.counterStore.countersById[e]=t}getExprContentListener(){return this.counterStore.getExprContentListener()}}class D{constructor(e,t,n,i){this.counterStore=e,this.baseURL=t,this.rootScope=n,this.pageScope=i,this.styler=null}setStyler(e){this.styler=e}getFragment(e){const t=e.match(/^[^#]*#(.*)$/);return t?t[1]:null}getTransformedId(e){let t=this.counterStore.documentURLTransformer.transformURL(w.C(e,this.baseURL),this.baseURL);return"#"===t.charAt(0)&&(t=t.substring(1)),t}getPageCounterVal(e,t){const n=this,i=new k.t(this.pageScope,()=>t(function(){const t=n.counterStore.currentPageCounters[e];return t&&t.length?t[t.length-1]:null}()),`page-counter-${e}`);return this.counterStore.registerPageCounterExpr(e,(function(e){return t(e[0])}),i),i}getPageCountersVal(e,t){const n=this,i=new k.t(this.pageScope,()=>t(n.counterStore.currentPageCounters[e]||[]),`page-counters-${e}`);return this.counterStore.registerPageCounterExpr(e,t,i),i}getTargetCounters(e,t,n){let i=this.counterStore.countersById[t];return!i&&n&&e&&(this.styler.styleUntilIdIsReached(e),i=this.counterStore.countersById[t]),i||null}getTargetPageCounters(e){return this.counterStore.currentPage.elementsById[e]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[e]||null}getTargetCounterVal(e,t,n){const i=this.getFragment(e),o=this.getTransformedId(e);let s=this.getTargetCounters(i,o,!1);if(s&&s[t]){const e=s[t];return new k.f(this.rootScope,n(e[e.length-1]||null))}const r=this;return new k.t(this.pageScope,()=>{if(s=r.getTargetCounters(i,o,!0)){if(s[t]){const e=s[t];return n(e[e.length-1]||null)}{const e=r.getTargetPageCounters(o);if(e){if(r.counterStore.resolveReference(o),e[t]){const i=e[t];return n(i[i.length-1]||null)}return n(0)}return r.counterStore.saveReferenceOfCurrentPage(o,!1),"??"}}return r.counterStore.saveReferenceOfCurrentPage(o,!1),"??"},`target-counter-${t}-of-${e}`)}getTargetCountersVal(e,t,n){const i=this.getFragment(e),o=this.getTransformedId(e),s=this;return new k.t(this.pageScope,()=>{const e=s.getTargetPageCounters(o);if(e){s.counterStore.resolveReference(o);const r=e[t]||[],a=s.getTargetCounters(i,o,!0)[t]||[];return n(r.concat(a))}return s.counterStore.saveReferenceOfCurrentPage(o,!1),"??"},`target-counters-${t}-of-${e}`)}}class _{constructor(e){this.documentURLTransformer=e,this.countersById={},this.pageCountersById={},this.currentPageCounters={},this.previousPageCounters={},this.currentPageCountersStack=[],this.pageIndicesById={},this.currentPage=null,this.newReferencesOfCurrentPage=[],this.referencesToSolve=[],this.referencesToSolveStack=[],this.unresolvedReferences={},this.resolvedReferences={},this.pagesCounterExprs=[],this.currentPageCounters.page=[0]}createCounterListener(e){return new F(this,e)}createCounterResolver(e,t,n){return new D(this,e,t,n)}setCurrentPage(e){this.currentPage=e}definePageCounter(e,t){this.currentPageCounters[e]?this.currentPageCounters[e].push(t):this.currentPageCounters[e]=[t]}forceSetPageCounter(e){const t=this.currentPageCounters.page;t&&t.length?t[t.length-1]=e:this.currentPageCounters.page=[e]}updatePageCounters(e,t){let n;this.previousPageCounters=R(this.currentPageCounters);const i=e["counter-reset"];if(i){const e=i.evaluate(t);e&&(n=O.b(e,!0))}if(n)for(const e in n)this.definePageCounter(e,n[e]);let o;const s=e["counter-increment"];if(s){const e=s.evaluate(t);e&&(o=O.b(e,!1))}o?"page"in o||(o.page=1):(o={}).page=1;for(const e in o){this.currentPageCounters[e]||this.definePageCounter(e,0);const t=this.currentPageCounters[e];t[t.length-1]+=o[e]}}pushPageCounters(e){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=R(e)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(e){const t=this.unresolvedReferences[e];let n=this.resolvedReferences[e];n||(n=this.resolvedReferences[e]=[]);let i=!1;for(let o=0;o<this.referencesToSolve.length;){const s=this.referencesToSolve[o];if(s.targetId===e){if(s.resolve(),this.referencesToSolve.splice(o,1),t){const e=t.indexOf(s);e>=0&&t.splice(e,1)}n.push(s),i=!0}else o++}i||this.saveReferenceOfCurrentPage(e,!0)}saveReferenceOfCurrentPage(e,t){if(!this.newReferencesOfCurrentPage.some(t=>t.targetId===e)){const n=new L(e,t);this.newReferencesOfCurrentPage.push(n)}}finishPage(e,t){const n=Object.keys(this.currentPage.elementsById);if(n.length>0){const i=R(this.currentPageCounters);n.forEach(n=>{this.pageCountersById[n]=i;const o=this.pageIndicesById[n];if(o&&o.pageIndex<t){const e=this.resolvedReferences[n];if(e){let t,i=this.unresolvedReferences[n];for(i||(i=this.unresolvedReferences[n]=[]);t=e.shift();)t.unresolve(),i.push(t)}}this.pageIndicesById[n]={spineIndex:e,pageIndex:t}})}const i=this.previousPageCounters;let o;for(;o=this.newReferencesOfCurrentPage.shift();){let n;o.pageCounters=i,o.spineIndex=e,o.pageIndex=t,o.isResolved()?(n=this.resolvedReferences[o.targetId])||(n=this.resolvedReferences[o.targetId]=[]):(n=this.unresolvedReferences[o.targetId])||(n=this.unresolvedReferences[o.targetId]=[]),n.every(e=>!o.equals(e))&&n.push(o)}this.currentPage=null}getUnresolvedRefsToPage(e){let t=[];Object.keys(e.elementsById).forEach(e=>{const n=this.unresolvedReferences[e];n&&(t=t.concat(n))}),t.sort((e,t)=>e.spineIndex-t.spineIndex||e.pageIndex-t.pageIndex);const n=[];let i=null;return t.forEach(e=>{i&&i.spineIndex===e.spineIndex&&i.pageIndex===e.pageIndex?i.refs.push(e):(i={spineIndex:e.spineIndex,pageIndex:e.pageIndex,pageCounters:e.pageCounters,refs:[e]},n.push(i))}),n}pushReferencesToSolve(e){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=e}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(e,t,n){"pages"===e&&this.pagesCounterExprs.push({expr:n,format:t})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(e,t,n){if(this.pagesCounterExprs.findIndex(t=>t.expr===e)>=0){const i=n.createElement("span");return i.textContent=t,i.setAttribute(B,e.key),i}return null}finishLastPage(e){const t=e.root.querySelectorAll(`[${B}]`),n=this.currentPageCounters.page[0];Array.from(t).forEach(e=>{const t=e.getAttribute(B),i=this.pagesCounterExprs.findIndex(e=>e.expr.key===t);b.a(i>=0),e.textContent=this.pagesCounterExprs[i].format([n])})}createLayoutConstraint(e){return new M(this,e)}}const B="data-vivliostyle-pages-counter";class M{constructor(e,t){this.counterStore=e,this.pageIndex=t}allowLayout(e){if(!e||e.after)return!0;const t=e.viewNode;if(!t||1!==t.nodeType)return!0;const n=t.getAttribute("id")||t.getAttribute("name");if(!n)return!0;if(!this.counterStore.resolvedReferences[n]&&!this.counterStore.unresolvedReferences[n])return!0;const i=this.counterStore.pageIndicesById[n];return!i||this.pageIndex>=i.pageIndex}}var U=n(5),z=n(10),V=n(2),H=n(16),G=n(0),$=n(12),W=n(3),X=n(8);const j=$.d;class K extends $.b{constructor(e,t,n,i,o){super(e,t,"block-end",null,n,o),this.footnotePolicy=i}isAllowedToPrecede(e){return!(e instanceof K)}}class q extends j{constructor(e,t,n,i){super(e,"block-end",t,n,i)}getOrder(){return 1/0}shouldBeStashedBefore(e){return e instanceof K||this.getOrder()<e.getOrder()}}class Y{constructor(e){this.footnote=e}allowLayout(e){const t=e.toNodePosition();return!X.u(t,this.footnote.nodePosition)}}$.f.register(new class{appliesToNodeContext(e){return"footnote"===e.floatSide}appliesToFloat(e){return e instanceof K}createPageFloat(e,t,n){let i=$.a.REGION;const o=t.getPageFloatLayoutContext(i);t.getPageFloatLayoutContext($.a.PAGE).hasSameContainerAs(o)&&(i=$.a.PAGE);const s=e.toNodePosition();b.a(t.flowName);const r=new K(s,i,t.flowName,e.footnotePolicy,e.floatMinWrapBlock);return t.addPageFloat(r),W.d(r)}createPageFloatFragment(e,t,n,i){const o=e[0].float;return new q(o.floatReference,e,n,i)}findPageFloatFragment(e,t){const n=t.getPageFloatLayoutContext(e.floatReference).floatFragments.filter(e=>e instanceof q);return b.a(n.length<=1),n[0]||null}adjustPageFloatArea(e,t,n){e.isFootnote=!0,e.adjustContentRelativeSize=!1;const i=e.element;b.a(i),e.vertical=n.layoutContext.applyFootnoteStyle(t.vertical,n.layoutContext.nodeContext&&"rtl"===n.layoutContext.nodeContext.direction,i),e.convertPercentageSizesToPx(i),n.setComputedInsets(i,e),n.setComputedWidthAndHeight(i,e)}forbid(e,t){const n=e;switch(n.footnotePolicy){case G.t.line:{const e=new Y(n);t.addLayoutConstraint(e,n.floatReference);break}}}});var Z=n(22),Q=n(14),J=n(18),ee=n(29),te=n(23),ne=n(26),ie=n(31),oe=n(15);class se{constructor(e,t){this.parent=e,this.rootSourceNode=t,this.formattingContextType="RepetitiveElementsOwner",this.isRoot=!1,this.repetitiveElements=null}getName(){return"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(e){const t=this.getRootNodeContext(e);return t?t.viewNode:null}getRootNodeContext(e){do{if(!e.belongsTo(this)&&e.sourceNode===this.rootSourceNode)return e}while(e=e.parent);return null}initializeRepetitiveElements(e){this.repetitiveElements||ie.b.some(e=>e.root===this.rootSourceNode&&(this.repetitiveElements=e.elements,!0))||(this.repetitiveElements=new re(e,this.rootSourceNode),ie.b.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(e){}}class re{constructor(e,t){this.vertical=e,this.ownerSourceNode=t,this.headerSourceNode=null,this.footerSourceNode=null,this.headerViewNode=null,this.footerViewNode=null,this.headerNodePosition=null,this.footerNodePosition=null,this.headerHeight=0,this.footerHeight=0,this.isSkipHeader=!1,this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0,this.doneInitialLayout=!1,this.firstContentSourceNode=null,this.lastContentSourceNode=null,this.affectedNodeCache=[],this.afterLastContentNodeCache=[],this.allowInsert=!1}setHeaderNodeContext(e){this.headerNodePosition||(this.headerNodePosition=X.x(e,0),this.headerSourceNode=e.sourceNode,this.headerViewNode=e.viewNode)}setFooterNodeContext(e){this.footerNodePosition||(this.footerNodePosition=X.x(e,0),this.footerSourceNode=e.sourceNode,this.footerViewNode=e.viewNode)}updateHeight(e){this.headerViewNode&&(this.headerHeight=Q.b(this.headerViewNode,e,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=Q.b(this.footerViewNode,e,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(e,t,n){return!this.headerNodePosition||this.isSkipHeader?W.d(!0):this.appendElementToFragment(this.headerNodePosition,e,t,n)}appendFooterToFragment(e,t,n){return!this.footerNodePosition||this.isSkipFooter?W.d(!0):this.appendElementToFragment(this.footerNodePosition,e,t,n)}appendElementToFragment(e,t,n,i){const o=t.viewNode.ownerDocument,s=t.viewNode,r=o.createElement("div");s.appendChild(r);const a=new te.PseudoColumn(i,r,t),l=a.getColumn().pageBreakType;return a.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,a.layout(new X.a(e),!0).thenAsync(()=>(this.allowInsertRepeatitiveElements=!1,s.removeChild(r),this.moveChildren(r,s,n),a.getColumn().pageBreakType=l,W.d(!0)))}moveChildren(e,t,n){if(t)for(;e.firstChild;){const i=e.firstChild;e.removeChild(i),i.setAttribute(X.m,"1"),n?t.insertBefore(i,n):t.appendChild(i)}}calculateOffset(e){let t=0;return e&&!this.affectTo(e)?t:((!this.isSkipFooter||e&&this.isAfterLastContent(e))&&(t+=this.footerHeight),this.isSkipHeader||(t+=this.headerHeight),t)}calculateMinimumOffset(e){let t=0;return e&&!this.affectTo(e)?t:(e&&this.isAfterLastContent(e)&&(t+=this.footerHeight),this.enableSkippingHeader||(t+=this.headerHeight),t)}isAfterLastContent(e){return this.findResultFromCache(e,this.afterLastContentNodeCache,t=>this.isAfterNodeContextOf(this.lastContentSourceNode,e,!1))}affectTo(e){return this.findResultFromCache(e,this.affectedNodeCache,t=>this.isAfterNodeContextOf(this.ownerSourceNode,e,!0))}findResultFromCache(e,t,n){const i=t.filter(t=>t.nodeContext.sourceNode===e.sourceNode&&t.nodeContext.after===e.after);if(i.length>0)return i[0].result;{const i=n(e);return t.push({nodeContext:e,result:i}),i}}isAfterNodeContextOf(e,t,n){const i=[];for(let n=e;n;n=n.parentNode){if(t.sourceNode===n)return t.after;i.push(n)}for(let e=t.sourceNode;e;e=e.parentNode){const t=i.indexOf(e);if(t>=0)return!!n&&0===t;for(let t=e;t;t=t.previousElementSibling)if(i.includes(t))return!0}return t.after}isFirstContentNode(e){return e&&this.firstContentSourceNode===e.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(e){return this.headerSourceNode===e}isFooterSourceNode(e){return this.footerSourceNode===e}}class ae{constructor(e){this.formattingContext=e}accept(e,t){return!!e}postLayout(e,t,n,i){const o=this.formattingContext.getRepetitiveElements();return o&&(b.a(n.clientLayout),o.doneInitialLayout||(o.updateHeight(n),o.doneInitialLayout=!0)),i}}class le{constructor(e){this.formattingContext=e}accept(e,t){return!0}postLayout(e,t,n,i){return i}}class ce extends ae{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}accept(e,t){return!1}}class he extends le{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return e.belongsTo(this.formattingContext)||e.after||t.fragmentLayoutConstraints.unshift(new ue(e)),this.processor.doLayout(e,t)}}class ue{constructor(e){this.flagmentLayoutConstraintType="RepetitiveElementsOwner";const t=me(e.formattingContext);this.nodeContext=t.getRootNodeContext(e)}allowLayout(e,t,n){const i=this.getRepetitiveElements();return!(i&&!Q.c(this.nodeContext.viewNode)&&i.isEnableToUpdateState()&&(t&&!e||e&&e.overflow))}nextCandidate(e){const t=this.getRepetitiveElements();return!!t&&!!t.isEnableToUpdateState()&&(t.updateState(),!0)}postLayout(e,t,n,i){const o=this.getRepetitiveElements();o&&e&&i.stopAtOverflow&&(null==t||o.isAfterLastContent(t))&&o.preventSkippingFooter()}finishBreak(e,t){const n=me(this.nodeContext.formattingContext),i=this.getRepetitiveElements();if(!i)return W.d(!0);const o=this.nodeContext;return function(e,t,n){const i=e.getRepetitiveElements();if(i){const o=e.getRootNodeContext(t);if(o.viewNode){const e=o.viewNode.firstChild;return i.appendHeaderToFragment(o,e,n)}}return W.d(!0)}(n,o,t).thenAsync(()=>(function(e,t,n){const i=e.getRepetitiveElements();if(i&&!i.isSkipFooter){const o=e.getRootNodeContext(t);if(o.viewNode)return i.appendFooterToFragment(o,null,n)}return W.d(!0)})(n,o,t).thenAsync(()=>(i.prepareLayoutFragment(),W.d(!0))))}getRepetitiveElements(){return me(this.nodeContext.formattingContext).getRepetitiveElements()}equalsTo(e){return e instanceof ue&&me(this.nodeContext.formattingContext)===me(e.nodeContext.formattingContext)}getPriorityOfFinishBreak(){return 10}}class de extends ee.a{constructor(e,t){super(),this.formattingContext=e,this.processor=t}resolveLayoutMode(e){const t=this.formattingContext.getRepetitiveElements();return e.belongsTo(this.formattingContext)||t.doneInitialLayout?(e.belongsTo(this.formattingContext)||e.after||t&&t.preventSkippingHeader(),new he(this.formattingContext,this.processor)):new ce(this.formattingContext,this.processor)}}class pe extends te.EdgeSkipper{constructor(e,t){super(),this.formattingContext=e,this.column=t}startNonInlineElementNode(e){const t=this.formattingContext,n=e.nodeContext,i=t.getRepetitiveElements();if(n.parent&&t.rootSourceNode===n.parent.sourceNode){switch(n.repeatOnBreak){case"header":if(!i.isHeaderRegistered())return i.setHeaderNodeContext(n),W.d(!0);n.repeatOnBreak="none";break;case"footer":if(!i.isFooterRegistered())return i.setFooterNodeContext(n),W.d(!0);n.repeatOnBreak="none"}i.firstContentSourceNode||(i.firstContentSourceNode=n.sourceNode)}return te.EdgeSkipper.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){const t=this.formattingContext,n=e.nodeContext;return n.sourceNode===t.rootSourceNode&&(t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),"header"===n.repeatOnBreak||"footer"===n.repeatOnBreak?W.d(!0):te.EdgeSkipper.prototype.afterNonInlineElementNode.call(this,e)}}te.EdgeSkipper;class fe extends J.b{layout(e,t,n){if(t.isFloatNodeContext(e))return t.layoutFloatOrFootnote(e);const i=me(e.formattingContext);return i.getRootViewNode(e)?(n&&ge(e.parent,t),e.belongsTo(i)?J.b.prototype.layout.call(this,e,t,n):new de(i,this).layout(e,t)):t.buildDeepElementView(e)}startNonInlineElementNode(e){const t=function(e){const t=e.formattingContext;return t&&t instanceof se?t:null}(e).getRepetitiveElements();return!!t&&(t.allowInsertRepeatitiveElements||!t.isHeaderSourceNode(e.sourceNode)&&!t.isFooterSourceNode(e.sourceNode)||e.viewNode.parentNode.removeChild(e.viewNode),!1)}doInitialLayout(e,t){me(e.formattingContext);const n=W.c("BlockLayoutProcessor.doInitialLayout");return this.layoutEntireBlock(e,t).thenFinish(n),n.result()}layoutEntireBlock(e,t){const n=me(e.formattingContext),i=new pe(n,t);return new te.LayoutIterator(i,t.layoutContext).iterate(e)}doLayout(e,t){const n=me(e.formattingContext),i=W.c("doLayout"),o=t.layoutContext.nextInTree(e,!1);return ne.c(o,t).then(e=>{let o=e;i.loopWithFrame(e=>{for(;o;){let i=!0;if(t.layoutNext(o,!1).then(s=>{o=s,t.pageFloatLayoutContext.isInvalidated()?e.breakLoop():t.pageBreakType?e.breakLoop():o&&t.stopByOverflow(o)?e.breakLoop():o&&o.after&&o.sourceNode==n.rootSourceNode?e.breakLoop():i?i=!1:e.continueLoop()}),i)return void(i=!1)}e.breakLoop()}).then(()=>{i.finish(o)})}),i.result()}finishBreak(e,t,n,i){return J.b.prototype.finishBreak.call(this,e,t,n,i)}clearOverflownViewNodes(e,t,n,i){J.b.prototype.clearOverflownViewNodes(e,t,n,i)}}function ge(e,t){e&&function(e,t){for(let n=e;n;n=n.parent){const e=n.formattingContext;e&&e instanceof se&&!n.belongsTo(e)&&t(e,n)}}(e.after?e.parent:e,(e,n)=>{oe.e.isInstanceOfTableFormattingContext(e)||t.fragmentLayoutConstraints.push(new ue(n))})}function me(e){return b.a(e instanceof se),e}const be=new fe;l.d(l.a.RESOLVE_LAYOUT_PROCESSOR,e=>e instanceof se&&!oe.e.isInstanceOfTableFormattingContext(e)?be:null);class we{constructor(e,t){this.rowIndex=e,this.sourceNode=t,this.cells=[]}addCell(e){this.cells.push(e)}getMinimumHeight(){return Math.min.apply(null,this.cells.map(e=>e.height))}}class Ee{constructor(e,t,n){this.rowIndex=e,this.columnIndex=t,this.height=0,this.anchorSlot=null,this.viewElement=n,this.colSpan=n.colSpan||1,this.rowSpan=n.rowSpan||1}setHeight(e){this.height=e}setAnchorSlot(e){this.anchorSlot=e}}class ye{constructor(e,t,n){this.rowIndex=e,this.columnIndex=t,this.cell=n}}class Se{constructor(e,t,n){this.column=e,this.cellNodeContext=n,this.empty=!1,this.pseudoColumn=new te.PseudoColumn(e,t,n)}findAcceptableBreakPosition(){const e=this.cellNodeContext.viewNode,t=this.cellNodeContext.verticalAlign;"middle"!==t&&"bottom"!==t||w.F(e,"vertical-align","top");const n=this.pseudoColumn.findAcceptableBreakPosition(!0);return w.F(e,"vertical-align",t),n}}class Ne{constructor(e,t){this.viewNode=e,this.side=t}}class Ce extends Z.b{constructor(e,t,n,i){super(e,t,n,i),this.acceptableCellBreakPositions=null,this.rowIndex=null,this.formattingContext=e.formattingContext}findAcceptableBreak(e,t){const n=super.findAcceptableBreak(e,t);return t<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every(e=>!!e.nodeContext)?n:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();return this.getAcceptableCellBreakPositions().forEach(t=>{e+=t.breakPosition.getMinBreakPenalty()}),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){this.formattingContext;const e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(e=>e.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getRowIndex(){return null!=this.rowIndex?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}}class ve extends Z.a{constructor(e,t,n){super(),this.rowIndex=e,this.beforeNodeContext=t,this.formattingContext=n,this.acceptableCellBreakPositions=null}findAcceptableBreak(e,t){if(t<this.getMinBreakPenalty())return null;const n=this.getCellFragments(),i=this.getAcceptableCellBreakPositions(),o=i.every(e=>!!e.nodeContext)&&i.some((e,t)=>{const i=n[t].pseudoColumn,o=e.nodeContext;return!i.isStartNodeContext(o)&&!i.isLastAfterNodeContext(o)});return this.beforeNodeContext.overflow=i.some(e=>e.nodeContext&&e.nodeContext.overflow),o?this.beforeNodeContext:null}getMinBreakPenalty(){const e=this.formattingContext,t=e.getRowByIndex(this.rowIndex);let n=0;return e.isFreelyFragmentableRow(t)||(n+=10),this.getAcceptableCellBreakPositions().forEach(e=>{n+=e.breakPosition.getMinBreakPenalty()}),n}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){const e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(e=>e.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}}class Te extends se{constructor(e,t){super(e,t),this.tableSourceNode=t,this.formattingContextType="Table",this.vertical=!1,this.columnCount=-1,this.tableWidth=0,this.captions=[],this.colGroups=null,this.colWidths=null,this.inlineBorderSpacing=0,this.rows=[],this.slots=[],this.cellFragments=[],this.lastRowViewNode=null,this.cellBreakPositions=[],this.repetitiveElements=null}getName(){return"Table formatting context (Table.TableFormattingContext)"}isFirstTime(e,t){if(!t)return t;switch(e.display){case"table-row":return 0===this.cellBreakPositions.length;case"table-cell":return!this.cellBreakPositions.some(t=>t.cellNodePosition.steps[0].node===e.sourceNode);default:return t}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,t){this.rows[e]=t}getRowSlots(e){let t=this.slots[e];return t||(t=this.slots[e]=[]),t}addCell(e,t){let n=this.rows[e];n||(this.addRow(e,new we(e,null)),n=this.rows[e]),b.a(n),n.addCell(t);const i=e+t.rowSpan;let o=this.getRowSlots(e),s=0;for(;o[s];)s++;for(;e<i;e++){o=this.getRowSlots(e);for(let n=s;n<s+t.colSpan;n++){const i=o[n]=new ye(e,n,t);t.anchorSlot||t.setAnchorSlot(i)}}}getRowByIndex(e){const t=this.rows[e];return b.a(t),t}findRowIndexBySourceNode(e){return this.rows.findIndex(t=>e===t.sourceNode)}addCellFragment(e,t,n){let i=this.cellFragments[e];i||(i=this.cellFragments[e]=[]),i[t]=n}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce((e,t)=>t.cell!==e[e.length-1]?e.concat(t.cell):e,[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter(t=>t.rowIndex+t.rowSpan-1>e)}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}isFreelyFragmentableRow(e){return e.getMinimumHeight()>this.tableWidth/2}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map(e=>e.cells.reduce((e,t)=>e+t.colSpan,0)))),this.columnCount}updateCellSizes(e){this.rows.forEach(t=>{t.cells.forEach(t=>{const n=e.getElementClientRect(t.viewElement);t.viewElement=null,t.setHeight(this.vertical?n.width:n.height)})})}findCellFromColumn(e){if(!e)return null;let t=null,n=0,i=0;e:for(n=0;n<this.cellFragments.length;n++)if(this.cellFragments[n])for(i=0;i<this.cellFragments[n].length;i++)if(this.cellFragments[n][i]&&e===this.cellFragments[n][i].pseudoColumn.getColumn()){t=this.rows[n].cells[i];break e}if(!t)return null;for(;n<this.slots.length;n++)for(;i<this.slots[n].length;i++){const e=this.slots[n][i];if(e.cell===t)return{rowIndex:e.rowIndex,columnIndex:e.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){const t=[];return this.slots.reduce((n,i,o)=>{if(o>=e.rowIndex)return n;const s=this.getCellFragmentOfCell(i[e.columnIndex].cell);return!s||t.includes(s)?n:(this.collectElementsOffsetFromColumn(s.pseudoColumn.getColumn(),n),t.push(s),n)},[])}collectElementsOffsetOfHighestColumn(){const e=[];return this.rows.forEach(t=>{t.cells.forEach((t,n)=>{e[n]||(e[n]={collected:[],elements:[]});const i=e[n],o=this.getCellFragmentOfCell(t);o&&!i.collected.includes(o)&&(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),i.elements),i.collected.push(o))})}),[new xe(e.map(e=>e.elements))]}collectElementsOffsetFromColumn(e,t){e.fragmentLayoutConstraints.forEach(e=>{if(oe.c.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(e)){const n=e.getRepetitiveElements();t.push(n)}oe.e.isInstanceOfTableRowLayoutConstraint(e)&&e.getElementsOffsetsForTableCell(null).forEach(e=>{t.push(e)})})}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}}class xe{constructor(e){this.repeatitiveElementsInColumns=e}calculateOffset(e){return this.calculateMaxOffsetOfColumn(e,e=>e.current)}calculateMinimumOffset(e){return this.calculateMaxOffsetOfColumn(e,e=>e.minimum)}calculateMaxOffsetOfColumn(e,t){let n=0;return this.repeatitiveElementsInColumns.forEach(i=>{const o=Z.c(e,i);n=Math.max(n,t(o))}),n}}function Ie(e){return b.a(e instanceof Te),e}function Pe(e){return function(e){return"table-row-group"===e||"table-header-group"===e||"table-footer-group"===e}(e)||function(e){return"table"===e||"inline-table"===e}(e)}function Ae(e,t,n){const i=e.nodeContext,o=i.display,s=i.parent?i.parent.display:null;let r=!1;if("inline-table"===s&&!(i.formattingContext instanceof Te))for(let e=i.parent;e;e=e.parent)if(e.formattingContext instanceof Te){r=e.formattingContext===t;break}return r||"table-row"===o&&!Pe(s)||"table-cell"===o&&"table-row"!==s&&!Pe(s)||i.formattingContext instanceof Te&&i.formattingContext!==t?n.buildDeepElementView(i).thenAsync(t=>(e.nodeContext=t,W.d(!0))):null}class Oe extends te.EdgeSkipper{constructor(e,t){super(),this.formattingContext=e,this.column=t,this.rowIndex=-1,this.columnIndex=0,this.inRow=!1,this.checkPoints=[],this.inHeaderOrFooter=!1}startNonInlineElementNode(e){const t=this.formattingContext,n=Ae(e,t,this.column);if(n)return n;this.postLayoutBlockContents(e);const i=e.nodeContext,o=i.display,s=t.getRepetitiveElements();switch(o){case"table":t.inlineBorderSpacing=i.inlineBorderSpacing;break;case"table-caption":{const e=new Ne(i.viewNode,i.captionSide);t.captions.push(e);break}case"table-header-group":return s.isHeaderRegistered()||(this.inHeaderOrFooter=!0,s.setHeaderNodeContext(i)),W.d(!0);case"table-footer-group":return s.isFooterRegistered()||(this.inHeaderOrFooter=!0,s.setFooterNodeContext(i)),W.d(!0);case"table-row":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,b.a(i.sourceNode),this.columnIndex=0,t.addRow(this.rowIndex,new we(this.rowIndex,i.sourceNode)),s.firstContentSourceNode||(s.firstContentSourceNode=i.sourceNode))}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){const t=this.formattingContext,n=e.nodeContext,i=n.display,o=this.column.clientLayout;if(this.postLayoutBlockContents(e),n.sourceNode===t.tableSourceNode){const i=o.getElementComputedStyle(t.getRootViewNode(n));t.tableWidth=parseFloat(i[t.vertical?"height":"width"]),t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(i){case"table-header-group":case"table-footer-group":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,W.d(!0);break;case"table-row":this.inHeaderOrFooter||(t.lastRowViewNode=n.viewNode,this.inRow=!1);break;case"table-cell":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);const e=n.viewNode;t.addCell(this.rowIndex,new Ee(this.rowIndex,this.columnIndex,e)),this.columnIndex++}}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){const t=e.nodeContext;t&&t.viewNode&&!Q.e(t)&&this.checkPoints.push(t.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}}class ke extends te.EdgeSkipper{constructor(e,t){super(!0),this.formattingContext=e,this.column=t,this.inRow=!1,this.currentRowIndex=-1,this.currentColumnIndex=0,this.originalStopAtOverflow=t.stopAtOverflow,t.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(e){const t=this.formattingContext.colWidths;b.a(t);let n=0;for(let i=0;i<e.colSpan;i++)n+=t[e.anchorSlot.columnIndex+i];return n+this.formattingContext.inlineBorderSpacing*(e.colSpan-1)}layoutCell(e,t,n){const i=e.rowIndex,o=e.columnIndex,s=e.colSpan,r=t.viewNode;t.verticalAlign,s>1&&(w.F(r,"box-sizing","border-box"),w.F(r,this.formattingContext.vertical?"height":"width",`${this.getColSpanningCellWidth(e)}px`));const a=r.ownerDocument.createElement("div");r.appendChild(a);const l=new Se(this.column,a,t);return this.formattingContext.addCellFragment(i,o,l),1===n.primary.steps.length&&n.primary.after&&(l.empty=!0),l.pseudoColumn.layout(n,!0).thenReturn(!0)}hasBrokenCellAtSlot(e){const t=this.formattingContext.cellBreakPositions[0];return!!t&&t.cell.anchorSlot.columnIndex===e}extractRowSpanningCellBreakPositions(){const e=this.formattingContext.cellBreakPositions;if(0===e.length)return[];const t=[];let n=0;do{const i=e[n],o=i.cell.rowIndex;if(o<this.currentRowIndex){let s=t[o];s||(s=t[o]=[]),s.push(i),e.splice(n,1)}else n++}while(n<e.length);return t}layoutRowSpanningCellsFromPreviousFragment(e){const t=this.formattingContext,n=this.extractRowSpanningCellBreakPositions(),i=n.reduce(e=>e+1,0);if(0===i)return W.d(!0);const o=this.column.layoutContext,s=e.nodeContext;s.viewNode.parentNode.removeChild(s.viewNode);const r=W.c("layoutRowSpanningCellsFromPreviousFragment");let a=W.d(!0),l=0;const c=[];return n.forEach(e=>{a=a.thenAsync(()=>{const n=X.v(e[0].cellNodePosition.steps[1],s.parent);return o.setCurrent(n,!1).thenAsync(()=>{let s=W.d(!0),r=0;function a(e){for(;r<e;){if(!c.includes(r)){const e=n.viewNode.ownerDocument.createElement("td");w.F(e,"padding","0"),n.viewNode.appendChild(e)}r++}}return e.forEach(e=>{s=s.thenAsync(()=>{const t=e.cell;a(t.anchorSlot.columnIndex);const s=e.cellNodePosition,h=X.v(s.steps[0],n);return h.offsetInNode=s.offsetInNode,h.after=s.after,h.fragmentIndex=s.steps[0].fragmentIndex+1,o.setCurrent(h,!1).thenAsync(()=>{const n=e.breakChunkPosition;for(let e=0;e<t.colSpan;e++)c.push(r+e);return r+=t.colSpan,this.layoutCell(t,h,n).thenAsync(()=>(h.viewNode.rowSpan=t.rowIndex+t.rowSpan-this.currentRowIndex+i-l,W.d(!0)))})})}),s.thenAsync(()=>(a(t.getColumnCount()),l++,W.d(!0)))})})}),a.then(()=>{o.setCurrent(s,!0,e.atUnforcedBreak).then(()=>{r.finish(!0)})}),r.result()}startTableRow(e){if(this.inHeader||this.inFooter)return W.d(!0);const t=e.nodeContext,n=this.formattingContext;return this.currentRowIndex<0?(b.a(t.sourceNode),this.currentRowIndex=n.findRowIndexBySourceNode(t.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(e).thenAsync(()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge)&&0===n.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length&&(this.resetColumn(),t.overflow=!0,e.break=!0),W.d(!0)))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach(e=>{const t=this.formattingContext.cellBreakPositions[e.columnIndex];if(t&&t.cell.anchorSlot.columnIndex==e.anchorSlot.columnIndex){const e=t.cellNodePosition.steps[0],n=this.column.layoutContext.xmldoc.getElementOffset(e.node);ne.e(n,e.fragmentIndex+1,1)}})}startTableCell(e){if(this.inHeader||this.inFooter)return W.d(!0);const t=e.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);const n=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex],i=t.copy().modify();i.after=!0,e.nodeContext=i;const o=W.c("startTableCell");let s;if(this.hasBrokenCellAtSlot(n.anchorSlot.columnIndex)){const e=this.formattingContext.cellBreakPositions.shift();t.fragmentIndex=e.cellNodePosition.steps[0].fragmentIndex+1,s=W.d(e.breakChunkPosition)}else s=this.column.nextInTree(t,e.atUnforcedBreak).thenAsync(e=>{e.viewNode&&t.viewNode.removeChild(e.viewNode);const n=X.x(e,0);return W.d(new X.a(n))});return s.then(i=>{b.a(t),this.layoutCell(n,t,i).then(()=>{this.afterNonInlineElementNode(e),this.currentColumnIndex++,o.finish(!0)})}),o.result()}startNonInlineBox(e){const t=Ae(e,Ie(this.formattingContext),this.column);if(t)return t;const n=e.nodeContext,i=this.formattingContext.getRepetitiveElements(),o=n.display;return"table-header-group"===o&&i&&i.isHeaderSourceNode(n.sourceNode)?(this.inHeader=!0,W.d(!0)):"table-footer-group"===o&&i&&i.isFooterSourceNode(n.sourceNode)?(this.inFooter=!0,W.d(!0)):"table-row"===o?this.startTableRow(e):"table-cell"===o?this.startTableCell(e):W.d(!0)}endNonInlineBox(e){const t=e.nodeContext;if("table-row"===t.display&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){const e=t.copy().modify();e.after=!1;const n=new ve(this.currentRowIndex,e,this.formattingContext);this.column.breakPositions.push(n)}return W.d(!0)}afterNonInlineElementNode(e){const t=e.nodeContext,n=this.formattingContext.getRepetitiveElements(),i=t.display;if("table-header-group"===i?n&&!n.allowInsertRepeatitiveElements&&n.isHeaderSourceNode(t.sourceNode)?(this.inHeader=!1,t.viewNode.parentNode.removeChild(t.viewNode)):w.F(t.viewNode,"display","table-row-group"):"table-footer-group"===i&&(n&&!n.allowInsertRepeatitiveElements&&n.isFooterSourceNode(t.sourceNode)?(this.inFooter=!1,t.viewNode.parentNode.removeChild(t.viewNode)):w.F(t.viewNode,"display","table-row-group")),i&&ke.ignoreList[i])t.viewNode.parentNode.removeChild(t.viewNode);else{if(t.sourceNode!==this.formattingContext.tableSourceNode)return super.afterNonInlineElementNode(e);t.overflow=this.column.checkOverflowAndSaveEdge(t,null),this.resetColumn(),e.break=!0}return W.d(!0)}}ke.ignoreList={"table-caption":!0,"table-column-group":!0,"table-column":!0};const Re=[];class Le{layoutEntireTable(e,t){const n=Ie(e.formattingContext),i=new Oe(n,t);return new te.LayoutIterator(i,t.layoutContext).iterate(e)}getColumnWidths(e,t,n,i){const o=e.ownerDocument,s=o.createElement("tr"),r=[];for(let e=0;e<t;e++){const e=o.createElement("td");s.appendChild(e),r.push(e)}e.parentNode.insertBefore(s,e.nextSibling);const a=r.map(e=>{const t=i.getElementClientRect(e);return n?t.height:t.width});return e.parentNode.removeChild(s),a}getColGroupElements(e){const t=[];let n=e.firstElementChild;for(;n;)"colgroup"===n.localName&&t.push(n),n=n.nextElementSibling;return t}normalizeAndGetColElements(e){const t=[];return e.forEach(e=>{let n=e.span;e.removeAttribute("span");let i=e.firstElementChild;for(;i;){if("col"===i.localName){let o=i.span;for(i.removeAttribute("span"),n-=o;o-- >1;){const n=i.cloneNode(!0);e.insertBefore(n,i),t.push(n)}t.push(i)}i=i.nextElementSibling}for(;n-- >0;)i=e.ownerDocument.createElement("col"),e.appendChild(i),t.push(i)}),t}addMissingColElements(e,t,n,i){if(e.length<n){const o=i.ownerDocument.createElement("colgroup");t.push(o);for(let t=e.length;t<n;t++){const t=i.ownerDocument.createElement("col");o.appendChild(t),e.push(t)}}}normalizeColGroups(e,t,n){const i=e.vertical,o=e.lastRowViewNode;if(!o)return;b.a(o),e.lastRowViewNode=null;const s=o.ownerDocument.createDocumentFragment(),r=e.getColumnCount();if(!(r>0))return void(e.colGroups=s);const a=e.colWidths=this.getColumnWidths(o,r,i,n.clientLayout),l=this.getColGroupElements(t),c=this.normalizeAndGetColElements(l);this.addMissingColElements(c,l,r,t),c.forEach((e,t)=>{w.F(e,i?"height":"width",`${a[t]}px`)}),l.forEach(e=>{s.appendChild(e.cloneNode(!0))}),e.colGroups=s}doInitialLayout(e,t){const n=Ie(e.formattingContext);n.vertical=e.vertical,n.initializeRepetitiveElements(e.vertical),b.a(e.sourceNode);const i=function(e){const t=Re.findIndex(t=>t.root===e),n=Re[t];return n?n.tableLayoutOption:null}(e.sourceNode);!function(e){const t=Re.findIndex(t=>t.root===e);t>=0&&Re.splice(t,1)}(e.sourceNode);const o=W.c("TableLayoutProcessor.doInitialLayout"),s=e.copy();return this.layoutEntireTable(e,t).then(r=>{const a=r.viewNode,l=t.clientLayout.getElementClientRect(a);let c=t.vertical?l.left:l.bottom;if(c+=(t.vertical?-1:1)*Z.c(e,t.collectElementsOffset()).current,!(t.isOverflown(c)||i&&i.calculateBreakPositionsInside))return t.breakPositions.push(new _e(s)),void o.finish(r);this.normalizeColGroups(n,a,t),n.updateCellSizes(t.clientLayout),o.finish(null)}),o.result()}addCaptions(e,t,n){const i=e.captions;i.forEach((e,o)=>{e&&(t.insertBefore(e.viewNode,n),"top"===e.side&&(i[o]=null))})}addColGroups(e,t,n){e.colGroups&&0===this.getColGroupElements(t).length&&t.insertBefore(e.colGroups.cloneNode(!0),n)}removeColGroups(e,t){if(e.colGroups&&t){const e=this.getColGroupElements(t);e&&e.forEach(e=>{t.removeChild(e)})}}doLayout(e,t){const n=Ie(e.formattingContext),i=n.getRootViewNode(e),o=i.firstChild;this.addCaptions(n,i,o),this.addColGroups(n,i,o);const s=new ke(n,t),r=new te.LayoutIterator(s,t.layoutContext),a=W.c("TableFormattingContext.doLayout");return r.iterate(e).thenFinish(a),a.result()}layout(e,t,n){const i=Ie(e.formattingContext);return i.getRootViewNode(e)?(n&&ge(e.parent,t),new Fe(i,this).layout(e,t)):t.buildDeepElementView(e)}createEdgeBreakPosition(e,t,n,i){return new Ce(e,t,n,i)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}finishBreak(e,t,n,i){const o=Ie(t.formattingContext);if("table-row"===t.display){b.a(t.sourceNode);const n=o.findRowIndexBySourceNode(t.sourceNode);let i;if(o.cellBreakPositions=[],(i=t.after?o.getRowSpanningCellsOverflowingTheRow(n):o.getCellsFallingOnRow(n)).length){const s=W.c("TableLayoutProcessor.finishBreak");let r=0;return s.loopWithFrame(e=>{if(r===i.length)return void e.breakLoop();const t=i[r++],s=o.getCellFragmentOfCell(t),a=s.findAcceptableBreakPosition().nodeContext;b.a(a);const l=s.cellNodeContext,c=l.toNodePosition(),h=new X.a(a.toNodePosition());o.cellBreakPositions.push({cellNodePosition:c,breakChunkPosition:h,cell:t});const u=l.viewNode;s.column.layoutContext.processFragmentedBlockEdge(s.cellNodeContext),n<t.rowIndex+t.rowSpan-1&&(u.rowSpan=n-t.rowIndex+1),s.empty?e.continueLoop():s.pseudoColumn.finishBreak(a,!1,!0).then(()=>{b.a(s),function(e,t,n){const i=t.getRepetitiveElements();if(!i)return;const o=t.vertical,s=e.column,r=e.pseudoColumn.getColumnElement(),a=e.cellNodeContext.viewNode,l=s.clientLayout.getElementClientRect(a),c=s.getComputedPaddingBorder(a);if(o){const e=l.right-s.footnoteEdge-i.calculateOffset(n)-c.right;w.F(r,"max-width",`${e}px`)}else{const e=s.footnoteEdge-i.calculateOffset(n)-l.top-c.top;w.F(r,"max-height",`${e}px`)}w.F(r,"overflow","hidden")}(s,o,a),e.continueLoop()})}).then(()=>{e.clearOverflownViewNodes(t,!1),e.layoutContext.processFragmentedBlockEdge(t),o.finishFragment(),s.finish(!0)}),s.result()}}return o.finishFragment(),J.d.finishBreak(e,t,n,i)}clearOverflownViewNodes(e,t,n,i){J.b.prototype.clearOverflownViewNodes(e,t,n,i)}}class Fe extends ee.a{constructor(e,t){super(),this.tableFormattingContext=e,this.processor=t}resolveLayoutMode(e){const t=this.tableFormattingContext.getRepetitiveElements();return t&&t.doneInitialLayout?(e.sourceNode!==this.tableFormattingContext.tableSourceNode||e.after||t&&t.preventSkippingHeader(),new Me(this.tableFormattingContext,this.processor)):new De(this.tableFormattingContext,this.processor)}clearNodes(e){super.clearNodes(e);const t=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,t)}restoreState(e,t){super.restoreState(e,t),this.tableFormattingContext.finishFragment()}}class De extends ae{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}}class _e extends Z.b{constructor(e){super(e,null,e.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(e){e.fragmentLayoutConstraints.push(new Be(this.position.sourceNode))}}class Be{constructor(e){this.tableRootNode=e,this.flagmentLayoutConstraintType="EntireTable"}allowLayout(e,t,n){return b.a(!e.overflow),!1}nextCandidate(e){return!0}postLayout(e,t,n,i){b.a(t.sourceNode),Re.push({root:t.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(e,t){return W.d(!0)}equalsTo(e){return e instanceof Be&&e.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}}class Me extends le{constructor(e,t){super(e),this.processor=t}doLayout(e,t){const n=this.formattingContext.getRepetitiveElements();if(n&&!n.isAfterLastContent(e)){const n=new Ue(e);t.fragmentLayoutConstraints.some(e=>n.equalsTo(e))||t.fragmentLayoutConstraints.unshift(n)}return this.processor.doLayout(e,t)}}class Ue extends ue{constructor(e){super(e),this.flagmentLayoutConstraintType="TableRow",this.cellFragmentLayoutConstraints=[]}allowLayout(e,t,n){const i=this.getRepetitiveElements();return!(i&&!n.pseudoParent&&!Q.c(this.nodeContext.viewNode)&&i.isEnableToUpdateState()&&(t&&!e||e&&e.overflow))}nextCandidate(e){const t=Ie(this.nodeContext.formattingContext);return!!this.collectCellFragmentLayoutConstraints(e,t).some(t=>t.constraints.some(t=>t.nextCandidate(e)))||super.nextCandidate(e)}postLayout(e,t,n,i){const o=Ie(this.nodeContext.formattingContext);if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(t,o),this.cellFragmentLayoutConstraints.forEach(t=>{t.constraints.forEach(o=>{o.postLayout(e,t.breakPosition,n,i)})}),!e){const e=o.getRootViewNode(this.nodeContext);(new Le).removeColGroups(o,e),this.removeDummyRowNodes(n)}super.postLayout(e,t,n,i)}finishBreak(e,t){Ie(this.nodeContext.formattingContext);const n=W.c("finishBreak"),i=this.cellFragmentLayoutConstraints.reduce((e,t)=>e.concat(t.constraints.map(e=>({constraint:e,breakPosition:t.breakPosition}))),[]);let o=0;return n.loop(()=>{if(o<i.length){const e=i[o++];return e.constraint.finishBreak(e.breakPosition,t).thenReturn(!0)}return W.d(!1)}).then(()=>{n.finish(!0)}),n.result().thenAsync(()=>super.finishBreak(e,t))}removeDummyRowNodes(e){if(e&&"table-row"===e.display&&e.viewNode)for(;e.viewNode.previousElementSibling;){const t=e.viewNode.previousElementSibling;t.parentNode&&t.parentNode.removeChild(t)}}collectCellFragmentLayoutConstraints(e,t){return this.getCellFragemnts(e,t).map(e=>({constraints:e.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:e.breakPosition}))}getCellFragemnts(e,t){let n=Number.MAX_VALUE;e&&"table-row"===e.display&&(b.a(e.sourceNode),n=t.findRowIndexBySourceNode(e.sourceNode)+1),n=Math.min(t.cellFragments.length,n);const i=[];for(let e=0;e<n;e++)t.cellFragments[e]&&t.cellFragments[e].forEach(e=>{e&&i.push({fragment:e,breakPosition:e.findAcceptableBreakPosition().nodeContext})});return i}getElementsOffsetsForTableCell(e){const t=Ie(this.nodeContext.formattingContext),n=t.findCellFromColumn(e);return n?t.collectElementsOffsetOfUpperCells(n):t.collectElementsOffsetOfHighestColumn()}equalsTo(e){return e instanceof Ue&&Ie(this.nodeContext.formattingContext)===Ie(e.nodeContext.formattingContext)}}const ze=new Le;l.d(l.a.RESOLVE_FORMATTING_CONTEXT,(function(e,t,n,i,o,s){if(!t)return null;if(n===G.t.table){const t=e.parent;return new Te(t?t.formattingContext:null,e.sourceNode)}return null})),l.d(l.a.RESOLVE_LAYOUT_PROCESSOR,(function(e){return e instanceof Te?ze:null}));var Ve=n(13);function He(e){return e.reduce((e,t)=>e+t,0)/e.length}class Ge{constructor(e,t){this.layoutResult=e,this.penalty=t}}function $e(e){return e.vertical?e.width:e.height}function We(e,t){e.vertical?e.width=t:e.height=t}class Xe{constructor(e,t,n){this.layoutContainer=e,this.columnGenerator=t,this.regionPageFloatLayoutContext=n,this.originalContainerBlockSize=$e(e)}balanceColumns(e){const t=this,n=W.c("ColumnBalancer#balanceColumns");t.preBalance(e),t.savePageFloatLayoutContexts(e),t.layoutContainer.clear();const i=[t.createTrialResult(e)];return n.loopWithFrame(e=>{t.hasNextCandidate(i)?(t.updateCondition(i),t.columnGenerator().then(n=>{t.savePageFloatLayoutContexts(n),t.layoutContainer.clear(),n?(i.push(t.createTrialResult(n)),e.continueLoop()):e.breakLoop()})):e.breakLoop()}).then(()=>{const e=i.reduce((e,t)=>t.penalty<e.penalty?t:e,i[0]);t.restoreContents(e.layoutResult),t.postBalance(),n.finish(e.layoutResult)}),n.result()}createTrialResult(e){const t=this.calculatePenalty(e);return new Ge(e,t)}preBalance(e){}postBalance(){We(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(e){const t=this.regionPageFloatLayoutContext.detachChildren();e&&(e.columnPageFloatLayoutContexts=t)}restoreContents(e){const t=this.layoutContainer.element;e.columns.forEach(e=>{t.appendChild(e.element)}),b.a(e.columnPageFloatLayoutContexts),this.regionPageFloatLayoutContext.attachChildren(e.columnPageFloatLayoutContexts)}}const je=1;function Ke(e){const t=e[e.length-1];if(0===t.penalty)return!1;const n=e[e.length-2];if(n&&t.penalty>=n.penalty)return!1;const i=t.layoutResult.columns;return Math.max.apply(null,i.map(e=>e.computedBlockSize))>Math.max.apply(null,i.map(e=>e.getMaxBlockSizeOfPageFloats()))+je}function qe(e,t){const n=e[e.length-1].layoutResult.columns,i=Math.max.apply(null,n.map(e=>isNaN(e.blockDistanceToBlockEndFloats)?e.computedBlockSize:e.computedBlockSize-e.blockDistanceToBlockEndFloats+je))-je;i<$e(t)?We(t,i):We(t,$e(t)-1)}class Ye extends Xe{constructor(e,t,n,i){super(n,e,t),this.columnCount=i,this.originalPosition=null,this.foundUpperBound=!1}preBalance(e){const t=e.columns.reduce((e,t)=>e+t.computedBlockSize,0);We(this.layoutContainer,t/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):null===e}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;const t=e.columns;return Ze(t)?1/0:Math.max.apply(null,t.map(e=>e.computedBlockSize))}hasNextCandidate(e){if(1===e.length)return!0;if(this.foundUpperBound)return Ke(e);{const t=e[e.length-1];return this.checkPosition(t.layoutResult.position)&&!Ze(t.layoutResult.columns)?(this.foundUpperBound=!0,!0):$e(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)qe(e,this.layoutContainer);else{const e=Math.min(this.originalContainerBlockSize,$e(this.layoutContainer)+.1*this.originalContainerBlockSize);We(this.layoutContainer,e)}}}function Ze(e){if(e.length<=1)return!1;const t=e[e.length-1].computedBlockSize;return e.slice(0,e.length-1).every(e=>t>e.computedBlockSize)}class Qe extends Xe{constructor(e,t,n){super(n,e,t)}calculatePenalty(e){return e.columns.every(e=>0===e.computedBlockSize)?1/0:function(e){const t=He(e);return He(e.map(e=>{const n=e-t;return n*n}))}(e.columns.filter(e=>!e.pageBreakType).map(e=>e.computedBlockSize))}hasNextCandidate(e){return Ke(e)}updateCondition(e){qe(e,this.layoutContainer)}}var Je=n(24);class et{constructor(e,t,n){this.endStuckFixed=e,this.endFixed=t,this.endSlipped=n}}class tt{constructor(){this.map=[]}getMaxFixed(){return 0==this.map.length?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return 0==this.map.length?0:this.map[this.map.length-1].endSlipped}addStuckRange(e){if(0==this.map.length)this.map.push(new et(e,e,e));else{const t=this.map[this.map.length-1],n=t.endSlipped+e-t.endFixed;t.endFixed==t.endStuckFixed?(t.endFixed=e,t.endStuckFixed=e,t.endSlipped=n):this.map.push(new et(e,e,n))}}addSlippedRange(e){0==this.map.length?this.map.push(new et(e,0,0)):this.map[this.map.length-1].endFixed=e}slippedByFixed(e){const t=this,n=w.i(this.map.length,n=>e<=t.map[n].endFixed),i=this.map[n];return i.endSlipped-Math.max(0,i.endStuckFixed-e)}fixedBySlipped(e){const t=this,n=w.i(this.map.length,n=>e<=t.map[n].endSlipped),i=this.map[n];return i.endStuckFixed-(i.endSlipped-e)}}class nt{constructor(e,t,n,i,o,s,r,a){if(this.context=e,this.style=t,this.offset=n,this.isRoot=i,this.flowChunk=o,this.atBlockStart=s,this.atFlowStart=r,this.isParentBoxDisplayed=a,this.isBlockValue=null,this.hasBoxValue=null,this.styleValues={},this.beforeBox=null,this.afterBox=null,this.breakBefore=null,this.flowName=o.flowName,this.hasBox()){const i=t._pseudos;if(i&&i.before){const t=new nt(e,i.before,n,!1,o,this.isBlock(),r,!0),s=t.styleValue("content");X.y(s)&&(this.beforeBox=t,this.breakBefore=t.breakBefore)}}this.breakBefore=Ve.d(this.getBreakValue("before"),this.breakBefore),this.atFlowStart&&Ve.c(this.breakBefore)&&(o.breakBefore=Ve.d(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(e,t,n){if(this.hasBox()){const i=this.style._pseudos;if(i&&i.after){const o=new nt(this.context,i.after,e,!1,this.flowChunk,t,n,!0),s=o.styleValue("content");X.y(s)&&(this.afterBox=o)}}}styleValue(e,t){if(!(e in this.styleValues)){const n=this.style[e];this.styleValues[e]=n?n.evaluate(this.context,e):t||null}return this.styleValues[e]}displayValue(){return this.styleValue("display",G.t.inline)}isBlock(){if(null===this.isBlockValue){const e=this.displayValue(),t=this.styleValue("position"),n=this.styleValue("float");this.isBlockValue=Je.d(e,t,n,this.isRoot)}return this.isBlockValue}hasBox(){return null===this.hasBoxValue&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==G.t.none),this.hasBoxValue}getBreakValue(e){let t=null;if(this.isBlock()){const n=this.styleValue(`break-${e}`);n&&(t=n.toString())}return t}}class it{constructor(e){this.context=e,this.stack=[],this.atBlockStart=!0,this.atFlowStart=!0,this.atStartStack=[]}empty(){return 0===this.stack.length}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){const e=this.lastBox();return e?e.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every(e=>e.displayValue()!==G.t.none)}push(e,t,n,i){const o=this.lastBox();i&&o&&i.flowName!==o.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});const s=i||o.flowChunk,r=this.atFlowStart||!!i,a=this.isCurrentBoxDisplayed(),l=new nt(this.context,e,t,n,s,r||this.atBlockStart,r,a);return this.stack.push(l),this.atBlockStart=l.hasBox()?!l.beforeBox&&l.isBlock():this.atBlockStart,this.atFlowStart=l.hasBox()?!l.beforeBox&&r:this.atFlowStart,l}encounteredTextNode(e){const t=this.lastBox();if((this.atBlockStart||this.atFlowStart)&&t.hasBox()){const n=t.styleValue("white-space",G.t.normal).toString(),i=X.z(n);b.a(null!==i),X.p(e,i)||(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(e){const t=this.stack.pop();if(t.buildAfterPseudoElementBox(e,this.atBlockStart,this.atFlowStart),this.atFlowStart&&t.afterBox){const e=t.afterBox.getBreakValue("before");t.flowChunk.breakBefore=Ve.d(t.flowChunk.breakBefore,e)}const n=this.lastBox();if(n)if(n.flowName===t.flowName)t.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{const e=this.atStartStack.pop();this.atBlockStart=e.atBlockStart,this.atFlowStart=e.atFlowStart}return t}nearestBlockStartOffset(e){if(!e.atBlockStart)return e.offset;let t=this.stack.length-1,n=this.stack[t];for(n===e&&(t--,n=this.stack[t]);t>=0;){if(n.flowName!==e.flowName)return e.offset;if(!n.atBlockStart)return n.offset;if(n.isRoot)return n.offset;e=n,n=this.stack[--t]}throw new Error("No block start offset found!")}}class ot{constructor(e,t,n,i,o,s,r,a){this.xmldoc=e,this.scope=n,this.context=i,this.primaryFlows=o,this.validatorSet=s,this.counterListener=r,this.rootStyle={},this.styleMap={},this.flows={},this.flowChunks=[],this.flowListener=null,this.flowToReach=null,this.idToReach=null,this.primary=!0,this.primaryStack=[],this.rootBackgroundAssigned=!1,this.rootLayoutAssigned=!1,this.breakBeforeValues={},this.bodyReached=!0,this.root=e.root,this.cascadeHolder=t,this.last=this.root,this.cascade=t.createInstance(i,r,a,e.lang),this.offsetMap=new tt;const l=e.getElementOffset(this.root);this.lastOffset=l,this.boxStack=new it(i),this.offsetMap.addStuckRange(l);const c=this.getAttrStyle(this.root);switch(this.cascade.pushElement(this.root,c,l),this.postprocessTopStyle(c,!1),this.root.namespaceURI){case w.a.XHTML:case w.a.FB2:this.bodyReached=!1}this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${l}`]=c,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(e,t,n){const i=e[n];return i&&i.evaluate(this.context)!==t[n]}transferPropsToRoot(e,t){for(const n in t){const i=e[n];if(i)this.rootStyle[n]=i,delete e[n];else{const e=t[n];e&&(this.rootStyle[n]=new U.c(e,z.c))}}}postprocessTopStyle(e,t){if(["writing-mode","direction"].forEach(n=>{!e[n]||t&&this.rootStyle[n]||(this.rootStyle[n]=e[n])}),!this.rootBackgroundAssigned){const t=this.hasProp(e,this.validatorSet.backgroundProps,"background-color")?e["background-color"].evaluate(this.context):null,n=this.hasProp(e,this.validatorSet.backgroundProps,"background-image")?e["background-image"].evaluate(this.context):null;(t&&t!==G.t.inherit||n&&n!==G.t.inherit)&&(this.transferPropsToRoot(e,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned)for(let t=0;t<st.length;t++)if(this.hasProp(e,this.validatorSet.layoutProps,st[t])){this.transferPropsToRoot(e,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}if(!t){const t=e["font-size"];if(t){const e=t.evaluate(this.context);let n=e.num;switch(e.unit){case"em":case"rem":n*=this.context.initialFontSize;break;case"ex":n*=this.context.initialFontSize*k.G.ex/k.G.em;break;case"%":n*=this.context.initialFontSize/100;break;default:{const t=k.G[e.unit];t&&(n*=t)}}this.context.rootFontSize=n}}}getTopContainerStyle(){let e=0;for(;!this.bodyReached&&(e+=5e3,this.styleUntil(e,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(e){if(e.style instanceof CSSStyleDeclaration){const t=e.getAttribute("style");if(t)return U.E(this.scope,this.validatorSet,this.xmldoc.url,t)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(e){if(e>=this.lastOffset)return;const t=this.context,n=this.xmldoc.getElementOffset(this.root);if(e<n){const e=this.getStyle(this.root,!1);b.a(e);const i=U.s(e,"flow-into"),o=i?i.evaluate(t,"flow-into").toString():"body",s=this.encounteredFlowElement(o,e,this.root,n);this.boxStack.empty()&&this.boxStack.push(e,n,!0,s)}let i=this.xmldoc.getNodeByOffset(e),o=this.xmldoc.getNodeOffset(i,0,!1);if(!(o>=this.lastOffset))for(;;){if(1!=i.nodeType)o+=i.textContent.length;else{const e=i,n=this.getStyle(e,!1),s=n["flow-into"];if(s){const i=s.evaluate(t,"flow-into").toString();this.encounteredFlowElement(i,n,e,o)}o++}if(o>=this.lastOffset)break;let e=i.firstChild;if(null==e)for(;!(e=i.nextSibling);)if((i=i.parentNode)===this.root)return;i=e}}resetFlowChunkStream(e){this.flowListener=e;for(let e=0;e<this.flowChunks.length;e++)this.flowListener.encounteredFlowChunk(this.flowChunks[e],this.flows[this.flowChunks[e].flowName])}styleUntilFlowIsReached(e){this.flowToReach=e;let t=0;for(;null!=this.flowToReach&&(t+=5e3,this.styleUntil(t,0)!=Number.POSITIVE_INFINITY););}styleUntilIdIsReached(e){if(!e)return;this.idToReach=e;let t=0;for(;this.idToReach&&(t+=5e3,this.styleUntil(t,0)!==Number.POSITIVE_INFINITY););this.idToReach=null}encounteredFlowElement(e,t,n,i){let o=0,s=Number.POSITIVE_INFINITY,r=!1,a=!1,l=!1;const c=t["flow-options"];if(c){const e=O.d(c.evaluate(this.context,"flow-options"));r=!!e.exclusive,a=!!e.static,l=!!e.last}const h=t["flow-linger"];h&&(s=O.c(h.evaluate(this.context,"flow-linger"),Number.POSITIVE_INFINITY));const u=t["flow-priority"];u&&(o=O.c(u.evaluate(this.context,"flow-priority"),0));const d=this.breakBeforeValues[i]||null;let p=this.flows[e];if(!p){const t=this.boxStack.lastFlowName();p=this.flows[e]=new X.f(e,t)}const f=new X.g(e,n,i,o,s,r,a,l,d);return this.flowChunks.push(f),this.flowToReach==e&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(f,p),f}registerForcedBreakOffset(e,t,n){if(Ve.c(e)){const e=this.flows[n].forcedBreakOffsets;(0===e.length||e[e.length-1]<t)&&e.push(t)}const i=this.breakBeforeValues[t];this.breakBeforeValues[t]=Ve.d(i,e)}styleUntil(e,t){let n,i=-1;if(e<=this.lastOffset&&(i=(n=this.offsetMap.slippedByFixed(e))+t)<this.offsetMap.getMaxSlipped())return this.offsetMap.fixedBySlipped(i);if(null==this.last)return Number.POSITIVE_INFINITY;const o=this.context;for(;;){let s=this.last.firstChild;if(null==s)for(;;){if(1==this.last.nodeType){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();const e=this.boxStack.pop(this.lastOffset);let t=null;if(e.afterBox){const n=e.afterBox.getBreakValue("before");this.registerForcedBreakOffset(n,e.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(e):e.afterBox.offset,e.flowName),t=e.afterBox.getBreakValue("after")}t=Ve.d(t,e.getBreakValue("after")),this.registerForcedBreakOffset(t,this.lastOffset,e.flowName)}if(s=this.last.nextSibling)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,e<this.lastOffset&&(i<0&&(i=(n=this.offsetMap.slippedByFixed(e))+t),i<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(i):Number.POSITIVE_INFINITY}if(this.last=s,1!=this.last.nodeType)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{const s=this.last,r=this.getAttrStyle(s);this.primaryStack.push(this.primary),this.cascade.pushElement(s,r,this.lastOffset);const a=s.getAttribute("id")||s.getAttributeNS(w.a.XML,"id");let l;a&&a===this.idToReach&&(this.idToReach=null),this.bodyReached||"body"!=s.localName||s.parentNode!=this.root||(this.postprocessTopStyle(r,!0),this.bodyReached=!0);const c=r["flow-into"];if(c){const e=c.evaluate(o,"flow-into").toString(),t=this.encounteredFlowElement(e,r,s,this.lastOffset);this.primary=!!this.primaryFlows[e],l=this.boxStack.push(r,this.lastOffset,s===this.root,t)}else l=this.boxStack.push(r,this.lastOffset,s===this.root);const h=this.boxStack.nearestBlockStartOffset(l);if(this.registerForcedBreakOffset(l.breakBefore,h,l.flowName),l.beforeBox){const e=l.beforeBox.getBreakValue("after");this.registerForcedBreakOffset(e,l.beforeBox.atBlockStart?h:l.offset,l.flowName)}if(this.primary&&l.displayValue()===G.t.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=r,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),e<this.lastOffset&&(i<0&&(i=(n=this.offsetMap.slippedByFixed(e))+t),i<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(i)}}}getStyle(e,t){let n=this.xmldoc.getElementOffset(e);const i=`e${n}`;return t&&(n=this.xmldoc.getNodeOffset(e,0,!0)),this.lastOffset<=n&&this.styleUntil(n,0),this.styleMap[i]}processContent(e,t){}}const st=["column-count","column-width","column-fill"];var rt,at="/*\n * Copyright 2013 Google, Inc.\n * Copyright 2015 Trim-marks Inc.\n * Copyright 2019 Vivliostyle Foundation\n *\n * CSS property validation.\n */\nNUM = POS_NUM | ZERO | NEGATIVE;\nNNEG_NUM = POS_NUM | ZERO;\nINT = POS_INT | ZERO | NEGATIVE;\nNNEG_INT = POS_INT | ZERO;\nPERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;\nSTRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;\nNNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;\nLENGTH = POS_LENGTH | ZERO | NEGATIVE;\nNNEG_LENGTH = POS_LENGTH | ZERO | NEGATIVE;\nPLENGTH = LENGTH | PERCENTAGE;\nPPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;\nALENGTH = LENGTH | auto;\nAPLENGTH = PLENGTH | auto;\nPAPLENGTH = PPLENGTH | auto;\nANGLE = POS_ANGLE | ZERO | NEGATIVE;\nLENGTH_OR_NUM = LENGTH | NUM;\nANGLE_OR_NUM = ANGLE | NUM;\nSCOLOR = HASHCOLOR | aliceblue: #F0F8FF | antiquewhite: #FAEBD7 | aqua: #00FFFF | aquamarine: #7FFFD4 | azure: #F0FFFF |\n    beige: #F5F5DC | bisque: #FFE4C4 | black: #000000 | blanchedalmond: #FFEBCD | blue: #0000FF | blueviolet: #8A2BE2 | brown: #A52A2A |\n    burlywood: #DEB887 | cadetblue: #5F9EA0 | chartreuse: #7FFF00 | chocolate: #D2691E | coral: #FF7F50 | cornflowerblue: #6495ED |\n    cornsilk: #FFF8DC | crimson: #DC143C | cyan: #00FFFF | darkblue: #00008B | darkcyan: #008B8B | darkgoldenrod: #B8860B |\n    darkgray: #A9A9A9 | darkgreen: #006400 | darkgrey: #A9A9A9 | darkkhaki: #BDB76B | darkmagenta: #8B008B | darkolivegreen: #556B2F |\n    darkorange: #FF8C00 | darkorchid: #9932CC | darkred: #8B0000 | darksalmon: #E9967A | darkseagreen: #8FBC8F | darkslateblue: #483D8B |\n    darkslategray: #2F4F4F | darkslategrey: #2F4F4F | darkturquoise: #00CED1 | darkviolet: #9400D3 | deeppink: #FF1493 |\n    deepskyblue: #00BFFF | dimgray: #696969 | dimgrey: #696969 | dodgerblue: #1E90FF | firebrick: #B22222 | floralwhite: #FFFAF0 |\n    forestgreen: #228B22 | fuchsia: #FF00FF | gainsboro: #DCDCDC | ghostwhite: #F8F8FF | gold: #FFD700 | goldenrod: #DAA520 |\n    gray: #808080 | green: #008000 | greenyellow: #ADFF2F | grey: #808080 | honeydew: #F0FFF0 | hotpink: #FF69B4 | indianred: #CD5C5C |\n    indigo: #4B0082 | ivory: #FFFFF0 | khaki: #F0E68C | lavender: #E6E6FA | lavenderblush: #FFF0F5 | lawngreen: #7CFC00 |\n    lemonchiffon: #FFFACD | lightblue: #ADD8E6 | lightcoral: #F08080 | lightcyan: #E0FFFF | lightgoldenrodyellow: #FAFAD2 |\n    lightgray: #D3D3D3 | lightgreen: #90EE90 | lightgrey: #D3D3D3 | lightpink: #FFB6C1 | lightsalmon: #FFA07A | lightseagreen: #20B2AA |\n    lightskyblue: #87CEFA | lightslategray: #778899 | lightslategrey: #778899 | lightsteelblue: #B0C4DE | lightyellow: #FFFFE0 |\n    lime: #00FF00 | limegreen: #32CD32 | linen: #FAF0E6 | magenta: #FF00FF | maroon: #800000 | mediumaquamarine: #66CDAA |\n    mediumblue: #0000CD | mediumorchid: #BA55D3 | mediumpurple: #9370DB | mediumseagreen: #3CB371 | mediumslateblue: #7B68EE |\n    mediumspringgreen: #00FA9A | mediumturquoise: #48D1CC | mediumvioletred: #C71585 | midnightblue: #191970 | mintcream: #F5FFFA |\n    mistyrose: #FFE4E1 | moccasin: #FFE4B5 | navajowhite: #FFDEAD | navy: #000080 | oldlace: #FDF5E6 | olive: #808000 |\n    olivedrab: #6B8E23 | orange: #FFA500 | orangered: #FF4500 | orchid: #DA70D6 | palegoldenrod: #EEE8AA | palegreen: #98FB98 |\n    paleturquoise: #AFEEEE | palevioletred: #DB7093 | papayawhip: #FFEFD5 | peachpuff: #FFDAB9 | peru: #CD853F | pink: #FFC0CB |\n    plum: #DDA0DD | powderblue: #B0E0E6 | purple: #800080 | rebeccapurple: #663399 | red: #FF0000 | rosybrown: #BC8F8F | royalblue: #4169E1 |\n    saddlebrown: #8B4513 | salmon: #FA8072 | sandybrown: #F4A460 | seagreen: #2E8B57 | seashell: #FFF5EE | sienna: #A0522D |\n    silver: #C0C0C0 | skyblue: #87CEEB | slateblue: #6A5ACD | slategray: #708090 | slategrey: #708090 | snow: #FFFAFA |\n    springgreen: #00FF7F | steelblue: #4682B4 | tan: #D2B48C | teal: #008080 | thistle: #D8BFD8 | tomato: #FF6347 |\n    turquoise: #40E0D0 | violet: #EE82EE | wheat: #F5DEB3 | white: #FFFFFF | whitesmoke: #F5F5F5 | yellow: #FFFF00 |\n    yellowgreen: #9ACD32 | transparent | currentcolor;\nRGBCOLOR = rgb(INT{3}) | rgb(STRICT_PERCENTAGE{3});\nRGBACOLOR = rgba(NUM{4}) | rgba(STRICT_PERCENTAGE{3} NUM);\nHSLCOLOR = hsl(NUM PERCENTAGE{2});\nHSLACOLOR = hsl(NUM PERCENTAGE{2} NUM);\nCOLOR = SCOLOR | RGBCOLOR | RGBACOLOR | HSLCOLOR | HSLACOLOR;\nBG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;\nSIDE_OR_CORNER =  [left | right] || [top | bottom];\nCOLOR_STOP = SPACE(COLOR [PERCENTAGE | LENGTH]?);\nLINEAR_GRADIENT = linear-gradient([ANGLE | SPACE(to SIDE_OR_CORNER)]? COLOR_STOP+) |\n                  repeating-linear-gradient([ANGLE | SPACE(to SIDE_OR_CORNER)]? COLOR_STOP+) |;\nGRADIENT_EXTENT = closest-corner | closest-side | farthest-corner | farthest-side;\nGRADIENT_POSITION = at BG_POSITION_TERM{1,4};\nGRADIENT_SHAPE = SPACE(circle LENGTH? GRADIENT_POSITION?) | SPACE(ellipse PLENGTH{2}? GRADIENT_POSITION?)| SPACE([circle | ellipse] GRADIENT_EXTENT? GRADIENT_POSITION?);\nRADIAL_GRADIENT = radial-gradient([GRADIENT_SHAPE | SPACE(GRADIENT_POSITION)]? COLOR_STOP+) |\n                  repeating-radial-gradient([GRADIENT_SHAPE | SPACE(GRADIENT_POSITION)]? COLOR_STOP+);\nURI_OR_NONE = URI | none;\nIMAGE =  URI | LINEAR_GRADIENT | RADIAL_GRADIENT | none;\nazimuth = ANGLE | [[ left-side | far-left | left | center-left | center | center-right | right | far-right | right-side ] || behind ] | leftwards | rightwards;\nbackground-attachment = COMMA( [scroll | fixed | local]+ );\nbackground-color = COLOR;\nbackground-image = COMMA( IMAGE+ );\nbackground-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\nbackground-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );\nborder-collapse = collapse | separate;\nBORDER_SIDE_COLOR = COLOR;\nBORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;\nBORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;\nborder-spacing = LENGTH LENGTH?;\nborder-top-color = BORDER_SIDE_COLOR;\nborder-right-color = BORDER_SIDE_COLOR;\nborder-bottom-color = BORDER_SIDE_COLOR;\nborder-left-color = BORDER_SIDE_COLOR;\nborder-top-style = BORDER_SIDE_STYLE;\nborder-right-style = BORDER_SIDE_STYLE;\nborder-bottom-style = BORDER_SIDE_STYLE;\nborder-left-style = BORDER_SIDE_STYLE;\nborder-top-width = BORDER_SIDE_WIDTH;\nborder-right-width = BORDER_SIDE_WIDTH;\nborder-bottom-width = BORDER_SIDE_WIDTH;\nborder-left-width = BORDER_SIDE_WIDTH;\nBORDER_RADIUS = PLENGTH{1,2};\nborder-top-left-radius = BORDER_RADIUS;\nborder-top-right-radius = BORDER_RADIUS;\nborder-bottom-right-radius = BORDER_RADIUS;\nborder-bottom-left-radius = BORDER_RADIUS;\nborder-image-source = IMAGE;\nborder-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */\nborder-image-width = [NUM | PLENGTH | auto]{1,4};\nborder-image-outset = [NUM | LENGTH]{1,4};\nborder-image-repeat = [ stretch | repeat | round | space ]{1,2};\nbottom = APLENGTH;\ncaption-side = top | bottom;\nclear = none | left | right | top | bottom | both | all | same;\nclip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;\ncolor = COLOR;\nLIST_STYLE_TYPE = disc | circle | square | decimal | decimal-leading-zero | lower-roman |\n    upper-roman | lower-greek | lower-latin | upper-latin | armenian | georgian | lower-alpha |\n    upper-alpha | russian | upper-russian | lower-russian | cjk-ideographic | trad-chinese-informal |\n    hebrew | none;\nTYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;\nATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);\nCONTENT = normal | none |\n    [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |\n    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |\n    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |\n    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |\n    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |\n    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |\n    open-quote | close-quote | no-open-quote | no-close-quote ]+;\ncontent = CONTENT;\nCOUNTER = [ IDENT INT? ]+ | none;\ncounter-increment = COUNTER;\ncounter-reset = COUNTER;\ncounter-set = COUNTER;\ncue-after = URI_OR_NONE;\ncue-before = URI_OR_NONE;\ncursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |\n    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);\ndirection = ltr | rtl;\ndisplay = inline | block | list-item | inline-block | table | inline-table | table-row-group |\n    table-header-group | table-footer-group | table-row | table-column-group | table-column |\n    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |\n    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker;\nelevation = ANGLE | below | level | above | higher | lower;\nempty-cells = show | hide;\nFAMILY = SPACE(IDENT+) | STRING;\nFAMILY_LIST = COMMA( FAMILY+ );\nfont-family = FAMILY_LIST;\nfont-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH | POS_NUM;\nfont-style = normal | italic | oblique;\nfont-variant = normal | small-caps;\nfont-weight = normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900;\nheight = PAPLENGTH | POS_NUM ;\nleft = APLENGTH;\nletter-spacing = normal | LENGTH_OR_NUM;\nline-height = normal | POS_NUM | PPLENGTH;\nlist-style-image = IMAGE;\nlist-style-position = inside | outside;\nlist-style-type = LIST_STYLE_TYPE;\nmargin-right = APLENGTH;\nmargin-left = APLENGTH;\nmargin-top = APLENGTH;\nmargin-bottom = APLENGTH;\nNPLENGTH = none | PLENGTH;\nmax-height = NPLENGTH;\nmax-width = NPLENGTH;\nmin-height = auto | PLENGTH;\nmin-width = auto | PLENGTH;\norphans = POS_INT;\noutline-offset = LENGTH;\noutline-color = COLOR | invert;\noutline-style = BORDER_SIDE_STYLE;\noutline-width = BORDER_SIDE_WIDTH;\noverflow = visible | hidden | scroll | auto;\npadding-right = PPLENGTH;\npadding-left = PPLENGTH;\npadding-top = PPLENGTH;\npadding-bottom = PPLENGTH;\nPAGE_BREAK = auto | always | avoid | left | right | recto | verso;\npage-break-after = PAGE_BREAK;\npage-break-before = PAGE_BREAK;\npage-break-inside = avoid | auto;\nPAUSE = POS_TIME | ZERO | POS_PERCENTAGE;\npause-after = PAUSE;\npause-before = PAUSE;\npitch-range = NUM;\npitch = FREQUENCY | x-low | low | medium | high | x-high;\nplay-during = [URI [ mix || repeat ]?] | auto | none;\nposition = static | relative | absolute | fixed;\nquotes = [STRING STRING]+ | none;\nrichness = NUM;\nright = APLENGTH;\nspeak-header = once | always;\nspeak-numeral = digits | continuous;\nspeak-punctuation = code | none;\nspeech-rate = NUM | x-slow | slow | medium | fast | x-fast | faster | slower;\nstress = NUM;\ntable-layout = auto | fixed;\ntext-align = left | right | center | justify | start | end;\ntext-decoration = none | [ underline || overline || line-through || blink ];\ntext-indent = PLENGTH;\ntext-transform = capitalize | uppercase | lowercase | none;\ntop = APLENGTH;\nvertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;\nvisibility = visible | hidden | collapse;\nvoice-family = FAMILY_LIST;\nvolume = NUM | PERCENTAGE | silent | x-soft | soft | medium | loud | x-loud;\nwhite-space = normal | pre | nowrap | pre-wrap | pre-line;\nwidows = POS_INT;\nwidth = PAPLENGTH | POS_NUM ;\nword-spacing = normal | LENGTH_OR_NUM;\nz-index = auto | INT;\n\n[epub,moz,ms,webkit]hyphens = auto | manual | none;\n[webkit]hyphenate-character = auto | STRING;\n\n/* css-logical */\nmargin-block-start = APLENGTH;\nmargin-block-end = APLENGTH;\nmargin-inline-start = APLENGTH;\nmargin-inline-end = APLENGTH;\npadding-block-start = APLENGTH;\npadding-block-end = APLENGTH;\npadding-inline-start = APLENGTH;\npadding-inline-end = APLENGTH;\nborder-block-start-color = BORDER_SIDE_COLOR;\nborder-block-end-color = BORDER_SIDE_COLOR;\nborder-inline-start-color = BORDER_SIDE_COLOR;\nborder-inline-end-color = BORDER_SIDE_COLOR;\nborder-block-start-style = BORDER_SIDE_STYLE;\nborder-block-end-style = BORDER_SIDE_STYLE;\nborder-inline-start-style = BORDER_SIDE_STYLE;\nborder-inline-end-style = BORDER_SIDE_STYLE;\nborder-block-start-width = BORDER_SIDE_WIDTH;\nborder-block-end-width = BORDER_SIDE_WIDTH;\nborder-inline-start-width = BORDER_SIDE_WIDTH;\nborder-inline-end-width = BORDER_SIDE_WIDTH;\nblock-start = APLENGTH;\nblock-end = APLENGTH;\ninline-start = APLENGTH;\ninline-end = APLENGTH;\nblock-size = PAPLENGTH | POS_NUM;\ninline-size = PAPLENGTH | POS_NUM;\nmax-block-size = NPLENGTH;\nmax-inline-size = NPLENGTH;\nmin-block-size = auto | PLENGTH;\nmin-inline-size = auto | PLENGTH;\n\nSHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |\n    polygon( SPACE(PLENGTH+)+ );\n[epubx]shape-inside = SHAPE;\n[epubx,webkit]shape-outside = SHAPE;\n[epubx,ms]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;\n\nTRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |\n scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);\n[epub,ms]transform = none | TRANSFORM_FUNCTION+;\n[epub,ms]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */\n\nBOX = border-box | padding-box | content-box;\nSHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */\n[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );\n[webkit]background-origin = COMMA( BOX+ );\n[webkit]background-clip = COMMA( BOX+ );\n[webkit]box-shadow = none | COMMA( SHADOW+ );\ntext-shadow = none |  COMMA( SHADOW+ );\n[webkit]box-decoration-break = slice | clone;\nFILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))\n                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)\n                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);\nFILTER_FUNCTION_LIST = FILTER_FUNCTION+;\n[webkit]filter = none | FILTER_FUNCTION_LIST;\n\nopacity = NUM;\n\n[moz,webkit]column-width = LENGTH | auto;\n[moz,webkit]column-count = INT | auto;\n[moz,webkit]column-gap = LENGTH | normal;\n[moz,webkit]column-rule-color = COLOR;\n[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;\n[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;\nBREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;\nbreak-before = BREAK;\nbreak-after = BREAK;\nbreak-inside = auto | avoid | avoid-page | avoid-column | avoid-region;\n[webkit]column-span = none | auto | all;\n[moz]column-fill = auto | balance | balance-all;\n\nsrc = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */\n\n[epubx,webkit]flow-from = IDENT;\n[epubx,webkit]flow-into = IDENT;\n[epubx]flow-linger = INT | none;\n[epubx]flow-priority = INT;\n[epubx]flow-options = none | [ exclusive || last || static ];\n[epubx]page = INT | auto;\n[epubx]min-page-width = LENGTH;\n[epubx]min-page-height = LENGTH;\n[epubx]required = true | false;\n[epubx]enabled = true | false;\n[epubx]conflicting-partitions = COMMA(IDENT+);\n[epubx]required-partitions = COMMA(IDENT+);\n[epubx]snap-height = LENGTH | none;\n[epubx]snap-width = LENGTH | none;\n[epubx]flow-consume = all | some;\n[epubx]utilization = NUM;\n[epubx]text-zoom = font-size | scale;\n\n[adapt]template = URI_OR_NONE;\n[adapt]behavior = IDENT;\n\n/* CSS Fonts */\nfont-size-adjust = none | NNEG_NUM;\n[webkit]font-kerning = auto | normal | none;\nfont-variant-east-asian = normal | [[ jis78 | jis83 | jis90 | jis04 | simplified | traditional ] || [ full-width | proportional-width ] || ruby];\nfont-feature-settings = COMMA( SPACE( STRING [ on | off | INT ]? )+ );\nfont-stretch = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;\n\n/* CSS Images */\nimage-resolution = RESOLUTION;\nobject-fit = fill | contain | cover | none | scale-down;\nobject-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\n\n/* CSS Paged Media */\nPAGE_SIZE = a5 | a4 | a3 | b5 | b4 | jis-b5 | jis-b4 | letter | legal | ledger;\nbleed = auto | LENGTH;\nmarks = none | [ crop || cross ];\nsize = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];\n\n/* CSS Page Floats */\nfloat-reference = inline | column | region | page;\nfloat = block-start | block-end | inline-start | inline-end | snap-block | snap-inline | left | right | top | bottom | none | footnote;\nfloat-min-wrap-block = PPLENGTH;\n\n/* CSS Ruby */\nruby-align = start | center | space-between | space-around;\nruby-position = over | under | inter-character;\n\n/* CSS Size Adjust */\n[moz,ms]text-size-adjust = auto | none | POS_PERCENTAGE;\n\n/* CSS Text */\n[ms,webkit]line-break = auto | loose | normal | strict;\noverflow-wrap = normal | break-word;\n[moz]tab-size = NNEG_INT | NNEG_LENGTH;\n[moz,ms]text-align-last = auto | start | end | left | right | center | justify;\n[ms]text-justify = auto | none | inter-word | inter-character | inter-ideograph /* specified in UA stylesheet for IE */;\n[ms]word-break = normal | keep-all | break-all | break-word;\n[ms]word-wrap = normal | break-word;\n\n/* CSS Text Decoration */\n[webkit]text-decoration-color = COLOR;\n[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];\n[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];\n[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;\n[epub,webkit]text-emphasis-color = COLOR;\n[webkit]text-emphasis-position = [ over | under ] [ right | left ];\n[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;\n[ms,webkit]text-underline-position = auto | [ under || [ left | right ]];\n\n/* CSS Transforms */\n[ms,webkit]backface-visibility = visible | hidden;\n\n/* CSS UI */\nbox-sizing = content-box | padding-box | border-box;\n[ms]text-overflow = [clip | ellipsis | STRING]{1,2};\n\n/* CSS Writing Modes */\n[webkit]text-combine = none | horizontal;\n[epub,ms]text-combine-horizontal = none | all | [ digits POS_INT? ]; /* relaxed */\ntext-combine-upright = none | all | [ digits POS_INT? ]; /* relaxed */\n[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;\nunicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;\n[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;\n\n/* CSS Flex box */\nFLEX_BASIS = content | PAPLENGTH;\nflex-direction = row | row-reverse | column | column-reverse;\nflex-wrap = nowrap | wrap | wrap-reverse;\norder = INT;\nflex-grow = NNEG_NUM;\nflex-shrink = NNEG_NUM;\nflex-basis = FLEX_BASIS;\nflex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];\njustify-content = flex-start | flex-end | center | space-between | space-around;\nalign-items = flex-start | flex-end | center | baseline | stretch;\nalign-self = auto | flex-start | flex-end | center | baseline | stretch;\nalign-content = flex-start | flex-end | center | space-between | space-around | stretch;\n\n/* Pointer Events */\n[ms]touch-action = auto | none | [ pan-x || pan-y ] | manipulation;\n\n/* SVG 2 */\nOPACITY_VALUE = NUM | PERCENTAGE;\nDASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );\nPAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;\ncolor-interpolation = auto | sRGB | linearRGB;\ncolor-rendering = auto | optimizeSpeed | optimizeQuality;\nfill = PAINT;\nfill-opacity = OPACITY_VALUE;\nfill-rule = nonzero | evenodd;\nglyph-orientation-vertical = auto | NUM | ANGLE;\nimage-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;\nmarker-start = none | URI;\nmarker-mid = none | URI;\nmarker-end = none | URI;\npointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;\npaint-order = normal | [ fill || stroke || markers ];\nshape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;\nstop-color = COLOR;\nstop-opacity = OPACITY_VALUE;\nstroke = PAINT;\nstroke-dasharray = none | DASH_ARRAY;\nstroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;\nstroke-linecap = butt | round | square;\nstroke-linejoin = miter | round | bevel;\nstroke-miterlimit = NUM;\nstroke-opacity = OPACITY_VALUE;\nstroke-width = PERCENTAGE | LENGTH_OR_NUM;\ntext-anchor = start | middle | end;\ntext-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;\nvector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );\n\n/* SVG 1.1 */\nalignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;\nbaseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;\ndominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;\nmask = none | URI;\n\n/* css-masking-1 */\nSHAPE_RADIUS = PLENGTH | closest-side | farthest-side;\nFILL_RULE = nonzero | evenodd;\nSHAPE_BOX = BOX | margin-box;\nGEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;\nBASIC_SHAPE =\n    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )\n  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )\n  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )\n  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );\n[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];\nclip-rule = nonzero | evenodd;\n\n/* filters */\nflood-color = COLOR;\nflood-opacity = OPACITY_VALUE;\nlighting-color = COLOR;\n\n/* compositing-1 */\nBLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;\nmix-blend-mode = BLEND_MODE;\nisolation = auto | isolate;\nbackground-blend-mode = COMMA( BLEND_MODE+ );\n\n/* CSS GCPM */\nfootnote-policy = auto | line;\n\n[viv]repeat-on-break = auto | none | header | footer;\n\nDEFAULTS\n\nbackground-attachment: scroll;\nbackground-color: transparent;\nbackground-image: none;\nbackground-repeat: repeat;\nbackground-position: 0% 0%;\nbackground-clip: border-box;\nbackground-origin: padding-box;\nbackground-size: auto;\nborder-top-color: currentColor;\nborder-right-color: currentColor;\nborder-bottom-color: currentColor;\nborder-left-color: currentColor;\nborder-top-style: none;\nborder-right-style: none;\nborder-bottom-style: none;\nborder-left-style: none;\nborder-top-width: 3px;\nborder-right-width: 3px;\nborder-bottom-width: 3px;\nborder-left-width: 3px;\nborder-top-left-radius: 0;\nborder-top-right-radius: 0;\nborder-bottom-right-radius: 0;\nborder-bottom-left-radius: 0;\nborder-image-source: none;\nborder-image-slice: 100%;\nborder-image-width: 1;\nborder-image-outset: 0;\nborder-image-repeat: stretch;\ncolumn-count: auto;\ncolumn-gap: normal;\ncolumn-width: auto;\ncolumn-rule-color: currentColor;\ncolumn-rule-style: none;\ncolumn-rule-width: 3px;\ncolumn-fill: balance;\noutline-color: currentColor;\noutline-style: none;\noutline-width: 3px;\nflex-direction: row;\nflex-wrap: nowrap;\nfont-family: serif;\nfont-style: normal;\nfont-size: medium;\nfont-variant: normal;\nfont-weight: normal;\nfont-stretch: normal;\nline-height: normal;\nlist-style-image: none;\nlist-style-position: outside;\nlist-style-type: disc;\nmargin-bottom: auto;\nmargin-left: auto;\nmargin-right: auto;\nmargin-top: auto;\npadding-bottom: auto;\npadding-left: auto;\npadding-right: auto;\npadding-top: auto;\ntext-emphasis-color: currentColor;\ntext-emphasis-style: none;\nmarker-start: none;\nmarker-mid: none;\nmarker-end: none;\n\n/* css-logical */\nborder-block-start-color: currentColor;\nborder-block-end-color: currentColor;\nborder-inline-start-color: currentColor;\nborder-inline-end-color: currentColor;\nborder-block-start-style: none;\nborder-block-end-style: none;\nborder-inline-start-style: none;\nborder-inline-end-style: none;\nborder-block-start-width: 3px;\nborder-block-end-width: 3px;\nborder-inline-start-width: 3px;\nborder-inline-end-width: 3px;\n\nSHORTHANDS\n\nbackground = COMMA background-image [background-position [ / background-size ]] background-repeat\n     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */\nborder-top = border-top-width border-top-style border-top-color;\nborder-right = border-right-width border-right-style border-right-color;\nborder-bottom = border-bottom-width border-bottom-style border-bottom-color;\nborder-left = border-left-width border-left-style border-left-color;\nborder-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;\nborder-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;\nborder-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;\nborder = border-width border-style border-color;\nborder-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]\n     border-image-repeat;\nborder-radius = INSETS_SLASH border-top-left-radius border-top-right-radius\n     border-bottom-right-radius border-bottom-left-radius;\n[moz,webkit]columns = column-width column-count;\n[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;\nflex-flow = flex-direction flex-wrap;\noeb-column-number = column-count;\noutline = outline-width outline-style outline-color;\nlist-style = list-style-type list-style-position list-style-image;\nmargin = INSETS margin-top margin-right margin-bottom margin-left;\npadding = INSETS padding-top padding-right padding-bottom padding-left;\npause = INSETS pause-before pause-after;\nfont = FONT font-style font-variant font-weight font-stretch /* font-size line-height font-family are special-cased */;\n[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;\nmarker = INSETS marker-start marker-mid marker-end;\n\n/* css-logical */\nmargin-block = INSETS margin-block-start margin-block-end;\nmargin-inline = INSETS margin-inline-start margin-inline-end;\npadding-block = INSETS padding-block-start padding-block-end;\npadding-inline = INSETS padding-inline-start padding-inline-end;\nborder-block-width = INSETS border-block-start-width border-block-end-width;\nborder-block-style = INSETS border-block-start-style border-block-end-style;\nborder-block-color = INSETS border-block-start-color border-block-end-color;\nborder-inline-width = INSETS border-inline-start-width border-inline-end-width;\nborder-inline-style = INSETS border-inline-start-style border-inline-end-style;\nborder-inline-color = INSETS border-inline-start-color border-inline-end-color;\nborder-block = border-block-width border-block-style border-block-color;\nborder-inline = border-inline-width border-inline-style border-inline-color;\nborder-block-start = border-block-start-width border-block-start-style border-block-start-color;\nborder-block-end = border-block-end-width border-block-end-style border-block-end-color;\nborder-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;\nborder-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;\ninset-block-start = block-start;\ninset-block-end = block-end;\ninset-inline-start = inline-start;\ninset-inline-end = inline-end;\ninset-block = INSETS block-start block-end;\ninset-inline = INSETS inline-start inline-end;\n\n/* old names  */\n[adapt,webkit]margin-before = margin-block-start;\n[adapt,webkit]margin-after = margin-block-end;\n[adapt,webkit]margin-start = margin-inline-start;\n[adapt,webkit]margin-end = margin-inline-end;\n[adapt,webkit]padding-before = padding-block-start;\n[adapt,webkit]padding-after = padding-block-end;\n[adapt,webkit]padding-start = padding-inline-start;\n[adapt,webkit]padding-end = padding-inline-end;\n[adapt,webkit]border-before-color = border-block-start-color;\n[adapt,webkit]border-after-color = border-block-end-color;\n[adapt,webkit]border-start-color = border-inline-start-color;\n[adapt,webkit]border-end-color = border-inline-end-color;\n[adapt,webkit]border-before-style = border-block-start-style;\n[adapt,webkit]border-after-style = border-block-end-style;\n[adapt,webkit]border-start-style = border-inline-start-style;\n[adapt,webkit]border-end-style = border-inline-end-style;\n[adapt,webkit]border-before-width = border-block-start-width;\n[adapt,webkit]border-after-width = border-block-end-width;\n[adapt,webkit]border-start-width = border-inline-start-width;\n[adapt,webkit]border-end-width = border-inline-end-width;\n[adapt,webkit]before = block-start;\n[adapt,webkit]after = block-end;\n[adapt,webkit]start = inline-start;\n[adapt,webkit]end = inline-end;\n";class lt{constructor(e){this.validator=e,this.success=null,this.failure=null,this.code=0}isSpecial(){return 0!=this.code}markAsStartGroup(){this.code=-1}isStartGroup(){return-1==this.code}markAsEndGroup(){this.code=-2}isEndGroup(){return-2==this.code}markAsStartAlternate(e){this.code=2*e+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(e){this.code=2*e+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}}class ct{constructor(e,t){this.where=e,this.success=t,this.what=-1}}!function(e){e[e.FOLLOW=1]="FOLLOW",e[e.OPTIONAL=2]="OPTIONAL",e[e.REPEATED=3]="REPEATED",e[e.ALTERNATE=4]="ALTERNATE"}(rt||(rt={}));class ht{constructor(){this.nodes=[],this.connections=[],this.match=[],this.nomatch=[],this.error=[],this.emptyHead=!0}connect(e,t){for(let n=0;n<e.length;n++)this.connections[e[n]].what=t;e.splice(0,e.length)}clone(){const e=new ht;for(let t=0;t<this.nodes.length;t++){const n=this.nodes[t],i=new lt(n.validator);i.code=n.code,e.nodes.push(i)}for(let t=0;t<this.connections.length;t++){const n=this.connections[t],i=new ct(n.where,n.success);i.what=n.what,e.connections.push(i)}return e.match.push(...this.match),e.nomatch.push(...this.nomatch),e.error.push(...this.error),e}addSpecialToArr(e,t,n){const i=this.nodes.length,o=new lt(xt);n>=0?t?o.markAsStartAlternate(n):o.markAsEndAlternate(n):t?o.markAsStartGroup():o.markAsEndGroup(),this.nodes.push(o),this.connect(e,i);const s=new ct(i,!0),r=new ct(i,!1);e.push(this.connections.length),this.connections.push(r),e.push(this.connections.length),this.connections.push(s)}endSpecialGroup(){const e=[this.match,this.nomatch,this.error];for(let t=0;t<e.length;t++)this.addSpecialToArr(e[t],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error("invalid call");this.addSpecialToArr(this.match,!0,-1)}endClause(e){this.addSpecialToArr(this.match,!1,e)}startClause(e){if(this.nodes.length)throw new Error("invalid call");const t=new lt(xt);t.markAsStartAlternate(e),this.nodes.push(t);const n=new ct(0,!0),i=new ct(0,!1);this.nomatch.push(this.connections.length),this.connections.push(i),this.match.push(this.connections.length),this.connections.push(n)}addPrimitive(e){const t=this.nodes.length;this.nodes.push(new lt(e));const n=new ct(t,!0),i=new ct(t,!1);this.connect(this.match,t),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(i),this.match.push(this.connections.length),this.connections.push(n)}isSimple(){return 1==this.nodes.length&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof vt}addGroup(e,t){if(0==e.nodes.length)return;const n=this.nodes.length;if(t==rt.ALTERNATE&&1==n&&e.isPrimitive()&&this.isPrimitive())return void(this.nodes[0].validator=this.nodes[0].validator.combine(e.nodes[0].validator));for(let t=0;t<e.nodes.length;t++)this.nodes.push(e.nodes[t]);t==rt.ALTERNATE?(this.emptyHead=!0,this.connect(this.nomatch,n)):this.connect(this.match,n);const i=this.connections.length;for(let t=0;t<e.connections.length;t++){const i=e.connections[t];i.where+=n,i.what>=0&&(i.what+=n),this.connections.push(i)}for(let t=0;t<e.match.length;t++)this.match.push(e.match[t]+i);if(t==rt.REPEATED&&this.connect(this.match,n),t==rt.OPTIONAL||t==rt.REPEATED)for(let t=0;t<e.nomatch.length;t++)this.match.push(e.nomatch[t]+i);else if(this.emptyHead){for(let t=0;t<e.nomatch.length;t++)this.nomatch.push(e.nomatch[t]+i);this.emptyHead=e.emptyHead}else for(let t=0;t<e.nomatch.length;t++)this.error.push(e.nomatch[t]+i);for(let t=0;t<e.error.length;t++)this.error.push(e.error[t]+i);e.nodes=null,e.connections=null}finish(e,t){const n=this.nodes.length;this.nodes.push(e),this.nodes.push(t),this.connect(this.match,n),this.connect(this.nomatch,n+1),this.connect(this.error,n+1);for(const e of this.connections)e.success?this.nodes[e.where].success=this.nodes[e.what]:this.nodes[e.where].failure=this.nodes[e.what];for(let e=0;e<n;e++)if(null==this.nodes[e].failure||null==this.nodes[e].success)throw new Error("Invalid validator state");return this.nodes[0]}}const ut=1,dt=2,pt=4,ft=8,gt=16,mt=32,bt=64,wt=128,Et=256,yt=512,St=1024,Nt=2048;class Ct extends G.m{constructor(){super()}validateForShorthand(e,t){const n=e[t].visit(this);return n?[n]:null}}class vt extends Ct{constructor(e,t,n){super(),this.allowed=e,this.idents=t,this.units=n}visitEmpty(e){return this.allowed&ut?e:null}visitSlash(e){return this.allowed&Nt?e:null}visitStr(e){return this.allowed&dt?e:null}visitIdent(e){return this.idents[e.name.toLowerCase()]||(this.allowed&pt?e:null)}visitNumeric(e){return 0!=e.num||this.allowed&yt?e.num<0&&!(this.allowed&Et)?null:this.units[e.unit]?e:null:"%"==e.unit&&this.allowed&St?e:null}visitNum(e){return 0==e.num?this.allowed&yt?e:null:e.num<=0&&!(this.allowed&Et)?null:this.allowed&gt?e:null}visitInt(e){return 0==e.num?this.allowed&yt?e:null:e.num<=0&&!(this.allowed&Et)?null:this.allowed&(mt|gt)?e:this.idents[`${e.num}`]||null}visitColor(e){return this.allowed&bt?e:null}visitURL(e){return this.allowed&wt?e:null}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return null}visitExpr(e){return 2046&this.allowed?e:null}combine(e){const t={},n={};for(const e in this.idents)t[e]=this.idents[e];for(const n in e.idents)t[n]=e.idents[n];for(const e in this.units)n[e]=this.units[e];for(const t in e.units)n[t]=e.units[t];return new vt(this.allowed|e.allowed,t,n)}}const Tt={},xt=new vt(0,Tt,Tt);class It extends Ct{constructor(e){super(),this.successTerminal=new lt(null),this.failureTerminal=new lt(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,t,n){let i=t?[]:e,o=this.first,s=n,r=null,a=null;for(;o!==this.successTerminal&&o!==this.failureTerminal;){if(s>=e.length){o=o.failure;continue}const l=e[s];let c=l;if(o.isSpecial()){let e=!0;o.isStartGroup()?(r?r.push(a):r=[a],a=[]):o.isEndGroup()?a=r.length>0?r.pop():null:o.isEndAlternate()?a[o.getAlternate()]="taken":e=null==a[o.getAlternate()],o=e?o.success:o.failure}else{if(0==s&&!t&&o.validator instanceof Pt&&this instanceof Pt){if(c=new G.j(e).visit(o.validator)){s=e.length,o=o.success;continue}}else if(0==s&&!t&&o.validator instanceof At&&this instanceof Pt){if(c=new G.b(e).visit(o.validator)){s=e.length,o=o.success;continue}}else c=l.visit(o.validator);if(!c){o=o.failure;continue}if(c!==l&&e===i){i=[];for(let t=0;t<s;t++)i[t]=e[t]}e!==i&&(i[s-n]=c),s++,o=o.success}}return o===this.successTerminal&&(t?i.length>0:s==e.length)?i:null}validateSingle(e){let t=null,n=this.first;for(;n!==this.successTerminal&&n!==this.failureTerminal;)e?n.isSpecial()?n=n.success:(t=e.visit(n.validator))?(e=null,n=n.success):n=n.failure:n=n.failure;return n===this.successTerminal?t:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}}class Pt extends It{constructor(e){super(e)}visitSpaceList(e){const t=this.validateList(e.values,!1,0);return t===e.values?e:t?new G.j(t):null}visitCommaList(e){let t=this.first,n=!1;for(;t;){if(t.validator instanceof At){n=!0;break}t=t.failure}if(n){const t=this.validateList(e.values,!1,0);return t===e.values?e:t?new G.b(t):null}return null}validateForShorthand(e,t){return this.validateList(e,!0,t)}}class At extends It{constructor(e){super(e)}visitSpaceList(e){return this.validateSingle(e)}visitCommaList(e){const t=this.validateList(e.values,!1,0);return t===e.values?e:t?new G.b(t):null}validateForShorthand(e,t){let n,i=this.first;for(;i!==this.failureTerminal;){if(n=i.validator.validateForShorthand(e,t))return n;i=i.failure}return null}}class Ot extends It{constructor(e,t){super(t),this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;const t=this.validateList(e.values,!1,0);return t===e.values?e:t?new G.e(e.name,t):null}}class kt{tryParse(e,t,n){return t}success(e,t){}}class Rt extends kt{constructor(e,t){super(),this.name=t,this.validator=e.validators[this.name]}tryParse(e,t,n){if(n.values[this.name])return t;const i=this.validator.validateForShorthand(e,t);if(i){const e=i.length,o=e>1?new G.j(i):i[0];return this.success(o,n),t+e}return t}success(e,t){t.values[this.name]=e}}class Lt extends Rt{constructor(e,t){super(e,t[0]),this.names=t}success(e,t){for(let n=0;n<this.names.length;n++)t.values[this.names[n]]=e}}class Ft extends kt{constructor(e,t){super(),this.nodes=e,this.slash=t}tryParse(e,t,n){const i=t;if(this.slash){if(e[t]!=G.w)return i;if(++t==e.length)return i}let o=this.nodes[0].tryParse(e,t,n);if(o==t)return i;t=o;for(let i=1;i<this.nodes.length&&t<e.length&&(o=this.nodes[i].tryParse(e,t,n))!=t;i++)t=o;return t}}class Dt extends G.m{constructor(){super(...arguments),this.syntax=null,this.propList=null,this.error=!1,this.values={},this.validatorSet=null}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new Rt(this.validatorSet,e)}clone(){const e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,t){this.syntax=e,this.propList=t}finish(e,t){if(!this.error){for(const n of this.propList)t.simpleProperty(n,this.values[n]||this.validatorSet.defaultValues[n],e);return!0}return!1}propagateInherit(e,t){for(const n of this.propList)t.simpleProperty(n,G.t.inherit,e)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.error=!0,null}}class _t extends Dt{constructor(){super()}validateList(e){let t=0,n=0;for(;t<e.length;){const i=this.syntax[n].tryParse(e,t,this);if(i>t)t=i,n=0;else if(++n==this.syntax.length){this.error=!0;break}}return t}}class Bt extends Dt{constructor(){super()}validateList(e){if(e.length>this.syntax.length||0==e.length)return this.error=!0,0;for(let t=0;t<this.syntax.length;t++){let n=t;for(;n>=e.length;)n=1==n?0:n-2;if(this.syntax[t].tryParse(e,n,this)!=n+1)return this.error=!0,0}return e.length}createSyntaxNode(){return new Lt(this.validatorSet,this.propList)}}const Mt={SIMPLE:_t,INSETS:Bt,INSETS_SLASH:class extends Dt{constructor(){super()}validateList(e){let t=e.length;for(let n=0;n<e.length;n++)if(e[n]===G.w){t=n;break}if(t>this.syntax.length||0==e.length)return this.error=!0,0;for(let n=0;n<this.syntax.length;n++){let i,o=n;for(;o>=t;)o=1==o?0:o-2;if(t+1<e.length)for(i=t+n+1;i>=e.length;)i-=i==t+2?1:2;else i=o;const s=[e[o],e[i]];if(2!=this.syntax[n].tryParse(s,0,this))return this.error=!0,0}return e.length}},COMMA:class extends _t{constructor(){super()}mergeIn(e,t){for(const n of this.propList){const i=t[n]||this.validatorSet.defaultValues[n];let o=e[n];o||(o=[],e[n]=o),o.push(i)}}visitCommaList(e){const t={};for(let n=0;n<e.values.length;n++)if(this.values={},e.values[n]instanceof G.b?this.error=!0:(e.values[n].visit(this),this.mergeIn(t,this.values),this.values["background-color"]&&n!=e.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(const e in t)this.values[e]="background-color"==e?t[e].pop():new G.b(t[e]);return null}},FONT:class extends _t{constructor(){super()}init(e,t){super.init(e,t),this.propList.push("font-family","line-height","font-size")}validateList(e){let t=super.validateList(e);if(t+2>e.length)return this.error=!0,t;this.error=!1;const n=this.validatorSet.validators;if(!e[t].visit(n["font-size"]))return this.error=!0,t;if(this.values["font-size"]=e[t++],e[t]===G.w){if(++t+2>e.length)return this.error=!0,t;if(!e[t].visit(n["line-height"]))return this.error=!0,t;this.values["line-height"]=e[t++]}const i=t==e.length-1?e[t]:new G.j(e.slice(t,e.length));return i.visit(n["font-family"])?(this.values["font-family"]=i,e.length):(this.error=!0,t)}visitCommaList(e){if(e.values[0].visit(this),this.error)return null;const t=[this.values["font-family"]];for(let n=1;n<e.values.length;n++)t.push(e.values[n]);const n=new G.b(t);return n.visit(this.validatorSet.validators["font-family"])?this.values["font-family"]=n:this.error=!0,null}visitIdent(e){const t=this.validatorSet.systemFonts[e.name];if(t)for(const e in t)this.values[e]=t[e];else this.error=!0;return null}}};class Ut{constructor(){this.validators={},this.prefixes={},this.defaultValues={},this.namedValidators={},this.systemFonts={},this.shorthands={},this.layoutProps={},this.backgroundProps={}}addReplacement(e,t){let n;if(t.type==V.a.NUMERIC)n=new G.i(t.num,t.text);else if(t.type==V.a.HASH)n=z.h(t.text);else{if(t.type!=V.a.IDENT)throw new Error("unexpected replacement");n=G.r(t.text)}if(e.isPrimitive()){const t=e.nodes[0].validator.idents;for(const e in t)t[e]=n;return e}throw new Error("unexpected replacement")}newGroup(e,t){const n=new ht;if("||"==e){for(let e=0;e<t.length;e++){const i=new ht;i.startClause(e),i.addGroup(t[e],rt.FOLLOW),i.endClause(e),n.addGroup(i,0==e?rt.FOLLOW:rt.ALTERNATE)}const e=new ht;return e.startSpecialGroup(),e.addGroup(n,rt.REPEATED),e.endSpecialGroup(),e}{let i;switch(e){case" ":i=rt.FOLLOW;break;case"|":case"||":i=rt.ALTERNATE;break;default:throw new Error("unexpected op")}for(let e=0;e<t.length;e++)n.addGroup(t[e],0==e?rt.FOLLOW:i);return n}}addCounts(e,t,n){const i=new ht;for(let n=0;n<t;n++)i.addGroup(e.clone(),rt.FOLLOW);if(n==Number.POSITIVE_INFINITY)i.addGroup(e,rt.REPEATED);else for(let o=t;o<n;o++)i.addGroup(e.clone(),rt.OPTIONAL);return i}primitive(e){const t=new ht;return t.addPrimitive(e),t}newFunc(e,t){let n;switch(e){case"COMMA":n=new At(t);break;case"SPACE":n=new Pt(t);break;default:n=new Ot(e.toLowerCase(),t)}return this.primitive(n)}initBuiltInValidators(){this.namedValidators.HASHCOLOR=this.primitive(new vt(bt,Tt,Tt)),this.namedValidators.POS_INT=this.primitive(new vt(mt,Tt,Tt)),this.namedValidators.POS_NUM=this.primitive(new vt(gt,Tt,Tt)),this.namedValidators.POS_PERCENTAGE=this.primitive(new vt(ft,Tt,{"%":G.o})),this.namedValidators.NEGATIVE=this.primitive(new vt(Et,Tt,Tt)),this.namedValidators.ZERO=this.primitive(new vt(yt,Tt,Tt)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new vt(St,Tt,Tt)),this.namedValidators.POS_LENGTH=this.primitive(new vt(ft,Tt,{em:G.o,ex:G.o,ch:G.o,rem:G.o,vw:G.o,vh:G.o,vi:G.o,vb:G.o,vmin:G.o,vmax:G.o,pvw:G.o,pvh:G.o,pvi:G.o,pvb:G.o,pvmin:G.o,pvmax:G.o,cm:G.o,mm:G.o,in:G.o,px:G.o,pt:G.o,pc:G.o,q:G.o})),this.namedValidators.POS_ANGLE=this.primitive(new vt(ft,Tt,{deg:G.o,grad:G.o,rad:G.o,turn:G.o})),this.namedValidators.POS_TIME=this.primitive(new vt(ft,Tt,{s:G.o,ms:G.o})),this.namedValidators.FREQUENCY=this.primitive(new vt(ft,Tt,{Hz:G.o,kHz:G.o})),this.namedValidators.RESOLUTION=this.primitive(new vt(ft,Tt,{dpi:G.o,dpcm:G.o,dppx:G.o})),this.namedValidators.URI=this.primitive(new vt(wt,Tt,Tt)),this.namedValidators.IDENT=this.primitive(new vt(pt,Tt,Tt)),this.namedValidators.STRING=this.primitive(new vt(dt,Tt,Tt)),this.namedValidators.SLASH=this.primitive(new vt(Nt,Tt,Tt));const e={"font-family":G.r("sans-serif")};this.systemFonts.caption=e,this.systemFonts.icon=e,this.systemFonts.menu=e,this.systemFonts["message-box"]=e,this.systemFonts["small-caption"]=e,this.systemFonts["status-bar"]=e}isBuiltIn(e){return!!e.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(e,t){let n=e.token();if(n.type==V.a.EOF)return null;const i={"":!0};if(n.type==V.a.O_BRK){do{if(e.consume(),(n=e.token()).type!=V.a.IDENT)throw new Error("Prefix name expected");i[n.text]=!0,e.consume(),n=e.token()}while(n.type==V.a.COMMA);if(n.type!=V.a.C_BRK)throw new Error("']' expected");e.consume(),n=e.token()}if(n.type!=V.a.IDENT)throw new Error("Property name expected");if(2==t?"SHORTHANDS"==n.text:"DEFAULTS"==n.text)return e.consume(),null;const o=n.text;if(e.consume(),2!=t){if(e.token().type!=V.a.EQ)throw new Error("'=' expected");this.isBuiltIn(o)||(this.prefixes[o]=i)}else if(e.token().type!=V.a.COLON)throw new Error("':' expected");return o}parseValidators(e){for(;;){const t=this.readNameAndPrefixes(e,1);if(!t)return;let n=[];const i=[];let o,s="",r=!0;const a=this,l=()=>{if(0==n.length)throw new Error("No values");return 1==n.length?n[0]:a.newGroup(s,n)},c=e=>{if(r)throw new Error(`'${e}': unexpected`);if(s&&s!=e)throw new Error(`mixed operators: '${e}' and '${s}'`);s=e,r=!0};let h=null;for(;!h;){e.consume();let t=e.token();switch(t.type){case V.a.IDENT:if(r||c(" "),this.isBuiltIn(t.text)){const e=this.namedValidators[t.text];if(!e)throw new Error(`'${t.text}' unexpected`);n.push(e.clone())}else{const e={};e[t.text.toLowerCase()]=G.r(t.text),n.push(this.primitive(new vt(0,e,Tt)))}r=!1;break;case V.a.INT:{const e={};e[`${t.num}`]=new G.g(t.num),n.push(this.primitive(new vt(0,e,Tt))),r=!1;break}case V.a.BAR:c("|");break;case V.a.BAR_BAR:c("||");break;case V.a.O_BRK:r||c(" "),i.push({vals:n,op:s,b:"["}),s="",n=[],r=!0;break;case V.a.FUNC:r||c(" "),i.push({vals:n,op:s,b:"(",fn:t.text}),s="",n=[],r=!0;break;case V.a.C_BRK:{o=l();const e=i.pop();if("["!=e.b)throw new Error("']' unexpected");(n=e.vals).push(o),s=e.op,r=!1;break}case V.a.C_PAR:{o=l();const e=i.pop();if("("!=e.b)throw new Error("')' unexpected");(n=e.vals).push(this.newFunc(e.fn,o)),s=e.op,r=!1;break}case V.a.COLON:if(r)throw new Error("':' unexpected");e.consume(),n.push(this.addReplacement(n.pop(),e.token()));break;case V.a.QMARK:if(r)throw new Error("'?' unexpected");n.push(this.addCounts(n.pop(),0,1));break;case V.a.STAR:if(r)throw new Error("'*' unexpected");n.push(this.addCounts(n.pop(),0,Number.POSITIVE_INFINITY));break;case V.a.PLUS:if(r)throw new Error("'+' unexpected");n.push(this.addCounts(n.pop(),1,Number.POSITIVE_INFINITY));break;case V.a.O_BRC:{if(e.consume(),(t=e.token()).type!=V.a.INT)throw new Error("<int> expected");const i=t.num;let o=i;if(e.consume(),(t=e.token()).type==V.a.COMMA){if(e.consume(),(t=e.token()).type!=V.a.INT)throw new Error("<int> expected");o=t.num,e.consume(),t=e.token()}if(t.type!=V.a.C_BRC)throw new Error("'}' expected");n.push(this.addCounts(n.pop(),i,o));break}case V.a.SEMICOL:if(h=l(),i.length>0)throw new Error(`unclosed '${i.pop().b}'`);break;default:throw new Error("unexpected token")}}e.consume(),this.isBuiltIn(t)?this.namedValidators[t]=h:h.isSimple()?this.validators[t]=h.nodes[0].validator:this.validators[t]=new Pt(h)}}parseDefaults(e){for(;;){const t=this.readNameAndPrefixes(e,2);if(!t)return;const n=[];for(;;){e.consume();const t=e.token();if(t.type==V.a.SEMICOL){e.consume();break}switch(t.type){case V.a.IDENT:n.push(G.r(t.text));break;case V.a.NUM:n.push(new G.h(t.num));break;case V.a.INT:n.push(new G.g(t.num));break;case V.a.NUMERIC:n.push(new G.i(t.num,t.text));break;default:throw new Error("unexpected token")}}this.defaultValues[t]=n.length>1?new G.j(n):n[0]}}parseShorthands(e){for(;;){const t=this.readNameAndPrefixes(e,3);if(!t)return;let n,i=e.nthToken(1);i.type==V.a.IDENT&&Mt[i.text]?(n=new Mt[i.text],e.consume()):n=new _t,n.setOwner(this);let o=!1,s=[],r=!1;const a=[],l=[];for(;!o;)switch(e.consume(),(i=e.token()).type){case V.a.IDENT:if(this.validators[i.text])s.push(n.syntaxNodeForProperty(i.text)),l.push(i.text);else{if(!(this.shorthands[i.text]instanceof Bt))throw new Error(`'${i.text}' is neither a simple property nor an inset shorthand`);{const e=this.shorthands[i.text];s.push(e.createSyntaxNode()),l.push(...e.propList)}}break;case V.a.SLASH:if(s.length>0||r)throw new Error("unexpected slash");r=!0;break;case V.a.O_BRK:a.push({slash:r,syntax:s}),s=[],r=!1;break;case V.a.C_BRK:{const e=new Ft(s,r),t=a.pop();s=t.syntax,r=t.slash,s.push(e);break}case V.a.SEMICOL:o=!0,e.consume();break;default:throw new Error("unexpected token")}n.init(s,l),this.shorthands[t]=n}}parse(e){const t=new V.b(e,null);this.parseValidators(t),this.parseDefaults(t),this.parseShorthands(t),this.backgroundProps=this.makePropSet(["background"]),this.layoutProps=this.makePropSet(["margin","border","padding","columns","column-gap","column-rule","column-fill"])}makePropSet(e){const t={};for(const n of e){const e=this.shorthands[n],i=e?e.propList:[n];for(const e of i){const n=this.defaultValues[e];n?t[e]=n:c.b.warn("Unknown property in makePropSet:",e)}}return t}validatePropertyAndHandleShorthand(e,t,n,i){let o="";const s=e,r=(e=e.toLowerCase()).match(/^-([a-z]+)-([-a-z0-9]+)$/);r&&(o=r[1],e=r[2]);const a=this.prefixes[e];if(!a||!a[o])return void i.unknownProperty(s,t);const l=this.validators[e];if(l){const o=t===G.t.inherit||t.isExpr()?t:t.visit(l);o?i.simpleProperty(e,o,n):i.invalidPropertyValue(s,t)}else{const o=this.shorthands[e].clone();t===G.t.inherit?o.propagateInherit(n,i):(t.visit(o),o.finish(n,i)||i.invalidPropertyValue(s,t))}}}function zt(){const e=new Ut;return e.initBuiltInValidators(),e.parse(at),e}var Vt=n(17);const Ht={"font-style":G.t.normal,"font-variant":G.t.normal,"font-weight":G.t.normal},Gt=`OTTO${(new Date).valueOf()}`;let $t=1;function Wt(e,t){const n={};for(const i in e)n[i]=U.s(e,i).evaluate(t,i);return function(e){for(const t in Ht)e[t]||(e[t]=Ht[t])}(n),n}class Xt{constructor(e){this.properties=e,this.blobURLs=[],this.blobs=[],this.fontTraitKey=function(e){const t=new w.d;for(const n in Ht)t.append(" "),t.append(e[n].toString());return t.toString()}(this.properties),this.src=this.properties.src?this.properties.src.toString():null;const t=this.properties["font-family"];this.family=t?t.stringValue():null}traitsEqual(e){return this.fontTraitKey==e.fontTraitKey}makeAtRule(e,t){const n=new w.d;n.append("@font-face {\n  font-family: "),n.append(this.family),n.append(";\n  ");for(const e in Ht)n.append(e),n.append(": "),this.properties[e].appendTo(n,!0),n.append(";\n  ");if(t){n.append('src: url("');const e=H.d(t);n.append(e),this.blobURLs.push(e),this.blobs.push(t),n.append('")')}else n.append("src: "),n.append(e);return n.append(";\n}\n"),n.toString()}}class jt{constructor(e){this.deobfuscator=e,this.familyMap={}}registerFamily(e,t){const n=e.family,i=this.familyMap[n],o=t.family;if(i){if(i!=o)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${e.family}`)}else this.familyMap[n]=o}filterFontFamily(e){if(e instanceof G.b){const t=e.values,n=[];for(const e of t){const t=this.familyMap[e.stringValue()];t&&n.push(G.r(t)),n.push(e)}return new G.b(n)}{const t=this.familyMap[e.stringValue()];return t?new G.b([G.r(t),e]):e}}}class Kt{constructor(e,t,n){this.head=e,this.body=t,this.srcURLMap={},this.familyCounter=0,this.familyPrefix=n||"Fnt_"}getViewFontFamily(e,t){const n=e.family;let i=t.familyMap[n];return i||(i=this.familyPrefix+ ++this.familyCounter,t.familyMap[n]=i,i)}initFont(e,t,n){const i=W.c("initFont"),o=this,s=e.src,r={};for(const t in Ht)r[t]=e.properties[t];const a=o.getViewFontFamily(e,n);r["font-family"]=G.r(a);const l=new Xt(r),h=o.body.ownerDocument.createElement("span");h.textContent="M";const u=(new Date).valueOf()+1e3,d=o.head.ownerDocument.createElement("style"),p=Gt+$t++;d.textContent=l.makeAtRule("",H.e([p])),o.head.appendChild(d),o.body.appendChild(h),h.style.visibility="hidden",h.style.fontFamily=a;for(const e in Ht)w.F(h,e,r[e].toString());const f=h.getBoundingClientRect(),g=f.right-f.left,m=f.bottom-f.top;d.textContent=l.makeAtRule(s,t),c.b.info("Starting to load font:",s);let b=!1;return i.loop(()=>{const e=h.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top;return g!=t||m!=n?(b=!0,W.d(!1)):(new Date).valueOf()>u?W.d(!1):i.sleep(10)}).then(()=>{b?c.b.info("Loaded font:",s):c.b.warn("Failed to load font:",s),o.body.removeChild(h),i.finish(l)}),i.result()}loadFont(e,t){const n=e.src;let i=this.srcURLMap[n];const o=this;return i?i.piggyback(i=>{const o=i;o.traitsEqual(e)?(t.registerFamily(e,o),c.b.warn("Found already-loaded font:",n)):c.b.warn("E_FONT_FACE_INCOMPATIBLE",e.src)}):(i=new Vt.a(()=>{const i=W.c("loadFont"),s=t.deobfuscator?t.deobfuscator(n):null;return s?H.c(n,H.b.BLOB).then(n=>{n.responseBlob?s(n.responseBlob).then(n=>{o.initFont(e,n,t).thenFinish(i)}):i.finish(null)}):o.initFont(e,null,t).thenFinish(i),i.result()},`loadFont ${n}`),this.srcURLMap[n]=i,i.start()),i}findOrLoadFonts(e,t){const n=[];for(const i of e)i.src&&i.family?n.push(this.loadFont(i,t)):c.b.warn("E_FONT_FACE_INVALID");return Vt.c(n)}}var qt=n(30);let Yt=1;class Zt{constructor(e,t,n,i,o){this.name=t,this.pseudoName=n,this.classes=i,this.parent=o,this.specified={},this.children=[],this.pageMaster=null,this.index=0,this._scope=e,this.key=`p${Yt++}`,o&&(this.index=o.children.length,o.children.push(this))}get scope(){return this._scope}createInstance(e){throw new Error("E_UNEXPECTED_CALL")}clone(e){throw new Error("E_UNEXPECTED_CALL")}copySpecified(e){const t=this.specified,n=e.specified;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}cloneChildren(e){for(let t=0;t<this.children.length;t++)this.children[t].clone({parent:e})}}class Qt extends Zt{constructor(e){super(e,null,null,[],null),this.specified.width=new U.c(G.q,0),this.specified.height=new U.c(G.p,0)}}class Jt extends k.m{constructor(e,t){super(e,(function(e,t){const i=e.match(/^([^.]+)\.([^.]+)$/);if(i){const e=n.pageMaster.keyMap[i[1]];if(e){const n=this.lookupInstance(e);if(n)return t?n.resolveFunc(i[2]):n.resolveName(i[2])}}return null})),this.pageMaster=t;const n=this}}class en extends Zt{constructor(e,t,n,i,o,s,r){super(e,t,n,i,o),this.condition=s,this.specificity=r,this.keyMap={},e instanceof Jt||(this._scope=new Jt(e,this)),this.pageMaster=this,this.specified.width=new U.c(G.q,0),this.specified.height=new U.c(G.p,0),this.specified["wrap-flow"]=new U.c(G.t.auto,0),this.specified.position=new U.c(G.t.relative,0),this.specified.overflow=new U.c(G.t.visible,0)}createInstance(e){return new bn(e,this)}clone(e){const t=new en(this.scope,this.name,e.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(t),this.cloneChildren(t),t}resetScope(){this.scope.pageMaster=this}}class tn extends Zt{constructor(e,t,n,i,o){super(e,t,n,i,o),this.pageMaster=o.pageMaster,t&&(this.pageMaster.keyMap[t]=this.key),this.specified["wrap-flow"]=new U.c(G.t.auto,0)}createInstance(e){return new wn(e,this)}clone(e){const t=new tn(e.parent.scope,this.name,this.pseudoName,this.classes,e.parent);return this.copySpecified(t),this.cloneChildren(t),t}}class nn extends Zt{constructor(e,t,n,i,o){super(e,t,n,i,o),this.pageMaster=o.pageMaster,t&&(this.pageMaster.keyMap[t]=this.key)}createInstance(e){return new En(e,this)}clone(e){const t=new nn(e.parent.scope,this.name,this.pseudoName,this.classes,e.parent);return this.copySpecified(t),this.cloneChildren(t),t}}function on(e,t,n){return t&&t!==G.t.auto?t.toExpr(e,n):null}function sn(e,t,n){return t&&t!==G.t.auto?t.toExpr(e,n):e.zero}function rn(e,t,n){return t?t===G.t.auto?null:t.toExpr(e,n):e.zero}function an(e,t,n,i){return t&&n!==G.t.none?t.toExpr(e,i):e.zero}function ln(e,t,n){return t?t===G.t._true?e._true:t===G.t._false?e._false:t.toExpr(e,e.zero):n}class cn{constructor(e,t){this.parentInstance=e,this.pageBox=t,this.cascaded={},this.style={},this.autoWidth=null,this.autoHeight=null,this.children=[],this.isAutoWidth=!1,this.isAutoHeight=!1,this.isTopDependentOnAutoHeight=!1,this.isRightDependentOnAutoWidth=!1,this.calculatedWidth=0,this.calculatedHeight=0,this.pageMasterInstance=null,this.namedValues={},this.namedFuncs={},this.vertical=!1,this.rtl=!1,this.suppressEmptyBoxGeneration=!1,e&&e.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(e,t){const n=this.resolveName(e),i=this.resolveName(t);if(!n||!i)throw new Error("E_INTERNAL");return k.C(this.pageBox.scope,n,i)}resolveName(e){let t=this.namedValues[e];if(t)return t;const n=this.style[e];switch(n&&(t=n.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),e){case"margin-left-edge":t=this.resolveName("left");break;case"margin-top-edge":t=this.resolveName("top");break;case"margin-right-edge":t=this.addNamedValues("border-right-edge","margin-right");break;case"margin-bottom-edge":t=this.addNamedValues("border-bottom-edge","margin-bottom");break;case"border-left-edge":t=this.addNamedValues("margin-left-edge","margin-left");break;case"border-top-edge":t=this.addNamedValues("margin-top-edge","margin-top");break;case"border-right-edge":t=this.addNamedValues("padding-right-edge","border-right-width");break;case"border-bottom-edge":t=this.addNamedValues("padding-bottom-edge","border-bottom-width");break;case"padding-left-edge":t=this.addNamedValues("border-left-edge","border-left-width");break;case"padding-top-edge":t=this.addNamedValues("border-top-edge","border-top-width");break;case"padding-right-edge":t=this.addNamedValues("right-edge","padding-right");break;case"padding-bottom-edge":t=this.addNamedValues("bottom-edge","padding-bottom");break;case"left-edge":t=this.addNamedValues("padding-left-edge","padding-left");break;case"top-edge":t=this.addNamedValues("padding-top-edge","padding-top");break;case"right-edge":t=this.addNamedValues("left-edge","width");break;case"bottom-edge":t=this.addNamedValues("top-edge","height")}if(!t){let n;if("extent"==e)n=this.vertical?"width":"height";else if("measure"==e)n=this.vertical?"height":"width";else{const t=this.vertical?U.m:U.l;n=e;for(const e in t)n=n.replace(e,t[e])}n!=e&&(t=this.resolveName(n))}return t&&(this.namedValues[e]=t),t}resolveFunc(e){let t=this.namedFuncs[e];if(t)return t;switch(e){case"columns":{const e=this.pageBox.scope,n=new k.A(e,0),i=this.resolveName("column-count"),o=this.resolveName("column-width"),s=this.resolveName("column-gap");t=k.P(e,k.N(e,new k.d(e,"min",[n,i]),k.C(e,o,s)),s);break}}return t&&(this.namedFuncs[e]=t),t}initEnabled(){const e=this.pageBox.scope,t=this.style;let n=ln(e,t.enabled,e._true);const i=on(e,t.page,e.zero);if(i){const t=new k.s(e,"page-number");n=k.D(e,n,new k.i(e,i,t))}const o=on(e,t["min-page-width"],e.zero);o&&(n=k.D(e,n,new k.j(e,new k.s(e,"page-width"),o)));const s=on(e,t["min-page-height"],e.zero);s&&(n=k.D(e,n,new k.j(e,new k.s(e,"page-height"),s))),n=this.boxSpecificEnabled(n),t.enabled=new G.c(n)}boxSpecificEnabled(e){return e}initHorizontal(){const e=this.pageBox.scope,t=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null;let i=on(e,t.left,n),o=on(e,t["margin-left"],n);const s=an(e,t["border-left-width"],t["border-left-style"],n),r=sn(e,t["padding-left"],n);let a=on(e,t.width,n),l=on(e,t["max-width"],n);const c=sn(e,t["padding-right"],n),h=an(e,t["border-right-width"],t["border-right-style"],n);let u=on(e,t["margin-right"],n),d=on(e,t.right,n);const p=k.C(e,s,r),f=k.C(e,s,c);if(i&&d&&a){let t=k.P(e,n,k.C(e,a,k.C(e,k.C(e,i,p),f)));o?u?d=k.P(e,t,u):u=k.P(e,t,k.C(e,d,o)):(t=k.P(e,t,d),u?o=k.P(e,t,u):u=o=k.N(e,t,new k.f(e,.5)))}else{o||(o=e.zero),u||(u=e.zero),i||d||a||(i=e.zero),i||a?i||d?a||d||(a=this.autoWidth,this.isAutoWidth=!0):i=e.zero:(a=this.autoWidth,this.isAutoWidth=!0);const s=k.P(e,n,k.C(e,k.C(e,o,p),k.C(e,u,f)));this.isAutoWidth&&(l||(l=k.P(e,s,i||d)),this.vertical||!on(e,t["column-width"],null)&&!on(e,t["column-count"],null)||(a=l,this.isAutoWidth=!1)),i?a?d||(d=k.P(e,s,k.C(e,i,a))):a=k.P(e,s,k.C(e,i,d)):i=k.P(e,s,k.C(e,d,a))}const g=sn(e,t["snap-width"]||(this.parentInstance?this.parentInstance.style["snap-width"]:null),n);t.left=new G.c(i),t["margin-left"]=new G.c(o),t["border-left-width"]=new G.c(s),t["padding-left"]=new G.c(r),t.width=new G.c(a),t["max-width"]=new G.c(l||a),t["padding-right"]=new G.c(c),t["border-right-width"]=new G.c(h),t["margin-right"]=new G.c(u),t.right=new G.c(d),t["snap-width"]=new G.c(g)}initVertical(){const e=this.pageBox.scope,t=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,i=this.parentInstance?this.parentInstance.style.height.toExpr(e,null):null;let o=on(e,t.top,i),s=on(e,t["margin-top"],n);const r=an(e,t["border-top-width"],t["border-top-style"],n),a=sn(e,t["padding-top"],n);let l=on(e,t.height,i),c=on(e,t["max-height"],i);const h=sn(e,t["padding-bottom"],n),u=an(e,t["border-bottom-width"],t["border-bottom-style"],n);let d=on(e,t["margin-bottom"],n),p=on(e,t.bottom,i);const f=k.C(e,r,a),g=k.C(e,u,h);if(o&&p&&l){let t=k.P(e,i,k.C(e,l,k.C(e,k.C(e,o,f),g)));s?d?p=k.P(e,t,s):d=k.P(e,t,k.C(e,p,s)):(t=k.P(e,t,p),d?s=k.P(e,t,d):d=s=k.N(e,t,new k.f(e,.5)))}else{s||(s=e.zero),d||(d=e.zero),o||p||l||(o=e.zero),o||l?o||p?l||p||(l=this.autoHeight,this.isAutoHeight=!0):o=e.zero:(l=this.autoHeight,this.isAutoHeight=!0);const n=k.P(e,i,k.C(e,k.C(e,s,f),k.C(e,d,g)));this.isAutoHeight&&(c||(c=k.P(e,n,o||p)),this.vertical&&(on(e,t["column-width"],null)||on(e,t["column-count"],null))&&(l=c,this.isAutoHeight=!1)),o?l?p||(p=k.P(e,n,k.C(e,o,l))):l=k.P(e,n,k.C(e,p,o)):o=k.P(e,n,k.C(e,p,l))}const m=sn(e,t["snap-height"]||(this.parentInstance?this.parentInstance.style["snap-height"]:null),n);t.top=new G.c(o),t["margin-top"]=new G.c(s),t["border-top-width"]=new G.c(r),t["padding-top"]=new G.c(a),t.height=new G.c(l),t["max-height"]=new G.c(c||l),t["padding-bottom"]=new G.c(h),t["border-bottom-width"]=new G.c(u),t["margin-bottom"]=new G.c(d),t.bottom=new G.c(p),t["snap-height"]=new G.c(m)}initColumns(){const e=this.pageBox.scope,t=this.style,n=on(e,t[this.vertical?"height":"width"],null);let i=on(e,t["column-width"],n),o=on(e,t["column-count"],null),s=function(e,t,n){return t&&t!==G.t.normal?t.toExpr(e,null):null}(e,t["column-gap"]);s||(s=new k.x(e,1,"em")),i&&!o&&(o=new k.d(e,"floor",[k.H(e,k.C(e,n,s),k.C(e,i,s))]),o=new k.d(e,"max",[e.one,o])),o||(o=e.one),i=k.P(e,k.H(e,k.C(e,n,s),o),s),t["column-width"]=new G.c(i),t["column-count"]=new G.c(o),t["column-gap"]=new G.c(s)}depends(e,t,n){return this.style[e].toExpr(this.pageBox.scope,null).depend(t,n)}init(e){e.registerInstance(this.pageBox.key,this);const t=this.pageBox.scope,n=this.style,i=this,o=this.parentInstance?this.parentInstance.getActiveRegions(e):null,s=U.n(this.cascaded,e,o,!1,null);this.vertical=U.z(s,e,!!this.parentInstance&&this.parentInstance.vertical),this.rtl=U.y(s,e,!!this.parentInstance&&this.parentInstance.rtl),U.k(s,n,this.vertical,this.rtl,(e,t)=>t.value),this.autoWidth=new k.t(t,()=>i.calculatedWidth,"autoWidth"),this.autoHeight=new k.t(t,()=>i.calculatedHeight,"autoHeight"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(e,t){let n=this.style[t];return n&&(n=z.i(e,n,t)),n}getPropAsNumber(e,t){let n=this.style[t];return n&&(n=z.i(e,n,t)),G.x(n,e)}getSpecial(e,t){const n=U.t(this.cascaded,t);if(n){const t=[];for(let i=0;i<n.length;i++){const o=n[i].evaluate(e,"");o&&o!==G.o&&t.push(o)}if(t.length)return t}return null}getActiveRegions(e){const t=this.getSpecial(e,"region-id");if(t){const e=[];for(let n=0;n<t.length;n++)e[n]=t[n].toString();return e}return null}propagateProperty(e,t,n,i){this.propagatePropertyToElement(e,t.element,n,i)}propagatePropertyToElement(e,t,n,i){let o=this.getProp(e,n);o&&(o.isNumeric()&&k.O(o.unit)&&(o=G.n(o,e)),"font-family"===n&&(o=i.filterFontFamily(o)),w.F(t,n,o.toString()))}propagateDelayedProperty(e,t,n,i){const o=this.getProp(e,n);o&&i.push(new X.d(t.element,n,o))}assignLeftPosition(e,t){const n=this.getPropAsNumber(e,"left"),i=this.getPropAsNumber(e,"margin-left"),o=this.getPropAsNumber(e,"padding-left"),s=this.getPropAsNumber(e,"border-left-width"),r=this.getPropAsNumber(e,"width");t.setHorizontalPosition(n,r),w.F(t.element,"margin-left",`${i}px`),w.F(t.element,"padding-left",`${o}px`),w.F(t.element,"border-left-width",`${s}px`),t.marginLeft=i,t.borderLeft=s,t.paddingLeft=o}assignRightPosition(e,t){const n=this.getPropAsNumber(e,"right"),i=this.getPropAsNumber(e,"snap-height"),o=this.getPropAsNumber(e,"margin-right");let s=this.getPropAsNumber(e,"padding-right");const r=this.getPropAsNumber(e,"border-right-width");if(w.F(t.element,"margin-right",`${o}px`),w.F(t.element,"padding-right",`${s}px`),w.F(t.element,"border-right-width",`${r}px`),t.marginRight=o,t.borderRight=r,this.vertical&&i>0){const e=n+t.getInsetRight(),o=e-Math.floor(e/i)*i;o>0&&(t.snapOffsetX=i-o,s+=t.snapOffsetX)}t.paddingRight=s,t.snapWidth=i}assignTopPosition(e,t){const n=this.getPropAsNumber(e,"snap-height"),i=this.getPropAsNumber(e,"top"),o=this.getPropAsNumber(e,"margin-top");let s=this.getPropAsNumber(e,"padding-top");const r=this.getPropAsNumber(e,"border-top-width");if(t.top=i,t.marginTop=o,t.borderTop=r,t.snapHeight=n,!this.vertical&&n>0){const e=i+t.getInsetTop(),o=e-Math.floor(e/n)*n;o>0&&(t.snapOffsetY=n-o,s+=t.snapOffsetY)}t.paddingTop=s,w.F(t.element,"top",`${i}px`),w.F(t.element,"margin-top",`${o}px`),w.F(t.element,"padding-top",`${s}px`),w.F(t.element,"border-top-width",`${r}px`)}assignBottomPosition(e,t){const n=this.getPropAsNumber(e,"margin-bottom"),i=this.getPropAsNumber(e,"padding-bottom"),o=this.getPropAsNumber(e,"border-bottom-width"),s=this.getPropAsNumber(e,"height")-t.snapOffsetY;w.F(t.element,"height",`${s}px`),w.F(t.element,"margin-bottom",`${n}px`),w.F(t.element,"padding-bottom",`${i}px`),w.F(t.element,"border-bottom-width",`${o}px`),t.height=s-t.snapOffsetY,t.marginBottom=n,t.borderBottom=o,t.paddingBottom=i}assignBeforePosition(e,t){this.vertical?this.assignRightPosition(e,t):this.assignTopPosition(e,t)}assignAfterPosition(e,t){this.vertical?this.assignLeftPosition(e,t):this.assignBottomPosition(e,t)}assignStartEndPosition(e,t){this.vertical?(this.assignTopPosition(e,t),this.assignBottomPosition(e,t)):(this.assignRightPosition(e,t),this.assignLeftPosition(e,t))}sizeWithMaxHeight(e,t){w.F(t.element,"border-top-width","0px");let n=this.getPropAsNumber(e,"max-height");this.isTopDependentOnAutoHeight?t.setVerticalPosition(0,n):(this.assignTopPosition(e,t),n-=t.snapOffsetY,t.height=n,w.F(t.element,"height",`${n}px`))}sizeWithMaxWidth(e,t){w.F(t.element,"border-left-width","0px");let n=this.getPropAsNumber(e,"max-width");if(this.isRightDependentOnAutoWidth)t.setHorizontalPosition(0,n);else{this.assignRightPosition(e,t),n-=t.snapOffsetX,t.width=n;const i=this.getPropAsNumber(e,"right");w.F(t.element,"right",`${i}px`),w.F(t.element,"width",`${n}px`)}}prepareContainer(e,t,n,i,o){this.parentInstance&&this.vertical==this.parentInstance.vertical||w.F(t.element,"writing-mode",this.vertical?"vertical-rl":"horizontal-tb"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(e,t):this.sizeWithMaxHeight(e,t):(this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(e,t):this.sizeWithMaxWidth(e,t):this.assignStartEndPosition(e,t);for(let n=0;n<hn.length;n++)this.propagateProperty(e,t,hn[n],i)}transferContentProps(e,t,n,i){for(let n=0;n<dn.length;n++)this.propagateProperty(e,t,dn[n],i)}transferSinglUriContentProps(e,t,n){for(let i=0;i<pn.length;i++)this.propagatePropertyToElement(e,t,pn[i],n)}finishContainer(e,t,n,i,o,s,r){this.vertical?this.calculatedWidth=t.computedBlockSize+t.snapOffsetX:this.calculatedHeight=t.computedBlockSize+t.snapOffsetY;const a=(this.vertical||!i)&&this.isAutoHeight,l=(!this.vertical||!i)&&this.isAutoWidth;let c=null;if((l||a)&&(l&&w.F(t.element,"width","auto"),a&&w.F(t.element,"height","auto"),c=s.getElementClientRect(i?i.element:t.element),l&&(this.calculatedWidth=Math.ceil(c.right-c.left-t.paddingLeft-t.borderLeft-t.paddingRight-t.borderRight),this.vertical&&(this.calculatedWidth+=t.snapOffsetX)),a&&(this.calculatedHeight=c.bottom-c.top-t.paddingTop-t.borderTop-t.paddingBottom-t.borderBottom,this.vertical||(this.calculatedHeight+=t.snapOffsetY))),(this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(e,t),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),o>1){const n=this.getPropAsNumber(e,"column-rule-width"),i=this.getProp(e,"column-rule-style"),s=this.getProp(e,"column-rule-color");if(n>0&&i&&i!=G.t.none&&s!=G.t.transparent){const r=this.getPropAsNumber(e,"column-gap"),a=this.vertical?t.height:t.width,l=this.vertical?"border-top":"border-left";for(let e=1;e<o;e++){const c=(a+r)*e/o-r/2+t.paddingLeft-n/2,h=t.height+t.paddingTop+t.paddingBottom,u=t.element.ownerDocument.createElement("div");w.F(u,"position","absolute"),w.F(u,this.vertical?"left":"top","0px"),w.F(u,this.vertical?"top":"left",`${c}px`),w.F(u,this.vertical?"height":"width","0px"),w.F(u,this.vertical?"width":"height",`${h}px`),w.F(u,l,`${n}px ${i.toString()}${s?` ${s.toString()}`:""}`),t.element.insertBefore(u,t.element.firstChild)}}}for(let n=0;n<un.length;n++)this.propagateProperty(e,t,un[n],r);for(let i=0;i<fn.length;i++)this.propagateDelayedProperty(e,t,fn[i],n.delayedItems)}applyCascadeAndInit(e,t){const n=this.cascaded,i=this.pageBox.specified;for(const e in i)U.x(e)&&U.F(n,e,U.s(i,e));if(this.pageBox.pseudoName==gn)for(const e in t)(e.match(/^background-/)||"writing-mode"==e)&&(n[e]=t[e]);if("layout-host"==this.pageBox.pseudoName)for(const e in t)e.match(/^background-/)||"writing-mode"==e||(n[e]=t[e]);e.pushRule(this.pageBox.classes,null,n),n.content&&(n.content=n.content.filterValue(new U.e(e,null,e.counterResolver))),this.init(e.context);for(const n of this.pageBox.children)n.createInstance(this).applyCascadeAndInit(e,t);e.popRule()}resolveAutoSizing(e){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends("right",this.autoWidth,e)||this.depends("margin-right",this.autoWidth,e)||this.depends("border-right-width",this.autoWidth,e)||this.depends("padding-right",this.autoWidth,e)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends("top",this.autoHeight,e)||this.depends("margin-top",this.autoHeight,e)||this.depends("border-top-width",this.autoHeight,e)||this.depends("padding-top",this.autoHeight,e));for(const t of this.children)t.resolveAutoSizing(e)}}const hn=["border-left-style","border-right-style","border-top-style","border-bottom-style","border-left-color","border-right-color","border-top-color","border-bottom-color","outline-style","outline-color","outline-width","overflow","visibility"],un=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat","background-attachment","background-color","background-image","background-repeat","background-position","background-clip","background-origin","background-size","opacity","z-index","background-blend-mode","isolation","mix-blend-mode","filter"],dn=["color","font-family","font-size","font-style","font-weight","font-variant","line-height","letter-spacing","text-align","text-decoration","text-indent","text-transform","white-space","word-spacing","font-feature-settings","font-kerning","font-size-adjust","font-variant-east-asian","font-stretch","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-shadow","text-underline-position"],pn=["width","height","image-resolution","object-fit","object-position"],fn=["transform","transform-origin"],gn="background-host";class mn extends cn{constructor(e){super(null,e)}applyCascadeAndInit(e,t){super.applyCascadeAndInit(e,t),this.children.sort((e,t)=>t.pageBox.specificity-e.pageBox.specificity||e.pageBox.index-t.pageBox.index)}}class bn extends cn{constructor(e,t){super(e,t),this.pageMasterInstance=this}boxSpecificEnabled(e){const t=this.pageBox.pageMaster;return t.condition&&(e=k.D(t.scope,e,t.condition)),e}adjustPageLayout(e,t,n){}}class wn extends cn{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}}class En extends cn{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}processPartitionList(e,t,n){let i=null;if(t instanceof G.f&&(i=[t]),t instanceof G.b&&(i=t.values),i){const t=this.pageBox.scope;for(let o=0;o<i.length;o++)if(i[o]instanceof G.f){const s=k.M(i[o].name,"enabled");let r=new k.s(t,s);n&&(r=new k.w(t,r)),e=k.D(t,e,r)}}return e}boxSpecificEnabled(e){const t=this.pageBox.scope,n=this.style,i=ln(t,n.required,t._false)!==t._false;if(i||this.isAutoHeight){const i=function(e,t,n){return t?t.toExpr(e,e.zero):new k.f(e,"body")}(t,n["flow-from"]),o=new k.d(t,"has-content",[i]);e=k.D(t,e,o)}if(e=this.processPartitionList(e,n["required-partitions"],!1),e=this.processPartitionList(e,n["conflicting-partitions"],!0),i){const n=this.pageMasterInstance.style.enabled;let i=n?n.toExpr(t,null):t._true;i=k.D(t,i,e),this.pageMasterInstance.style.enabled=new G.c(i)}return e}prepareContainer(e,t,n,i,o){w.F(t.element,"overflow","hidden"),super.prepareContainer(e,t,n,i,o)}}class yn extends z.f{constructor(e,t,n,i){super(e,t,!1),this.target=n,this.validatorSet=i}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}simpleProperty(e,t,n){this.target.specified[e]=new U.c(t,n?z.d:z.e)}}class Sn extends yn{constructor(e,t,n,i){super(e,t,n,i)}}class Nn extends yn{constructor(e,t,n,i){super(e,t,n,i),n.specified.width=new U.c(G.s,0),n.specified.height=new U.c(G.s,0)}startPartitionRule(e,t,n){const i=new nn(this.scope,e,t,n,this.target),o=new Sn(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(e,t,n){const i=new tn(this.scope,e,t,n,this.target),o=new Nn(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(o)}}class Cn extends yn{constructor(e,t,n,i){super(e,t,n,i)}startPartitionRule(e,t,n){const i=new nn(this.scope,e,t,n,this.target),o=new Sn(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(e,t,n){const i=new tn(this.scope,e,t,n,this.target),o=new Nn(this.scope,this.owner,i,this.validatorSet);this.owner.pushHandler(o)}}var vn=n(19);function Tn(e){let t=e["writing-mode"];t=t&&t.value;let n=e.direction;return n=n&&n.value,t===G.t.vertical_lr||t!==G.t.vertical_rl&&n!==G.t.rtl?o.LTR:o.RTL}const xn={a5:{width:new G.i(148,"mm"),height:new G.i(210,"mm")},a4:{width:new G.i(210,"mm"),height:new G.i(297,"mm")},a3:{width:new G.i(297,"mm"),height:new G.i(420,"mm")},b5:{width:new G.i(176,"mm"),height:new G.i(250,"mm")},b4:{width:new G.i(250,"mm"),height:new G.i(353,"mm")},"jis-b5":{width:new G.i(182,"mm"),height:new G.i(257,"mm")},"jis-b4":{width:new G.i(257,"mm"),height:new G.i(364,"mm")},letter:{width:new G.i(8.5,"in"),height:new G.i(11,"in")},legal:{width:new G.i(8.5,"in"),height:new G.i(14,"in")},ledger:{width:new G.i(11,"in"),height:new G.i(17,"in")}},In=new G.i(.24,"pt"),Pn=new G.i(3,"mm"),An=new G.i(10,"mm"),On=new G.i(13,"mm");function kn(e){const t={width:G.q,height:G.p,bleed:G.u,bleedOffset:G.u},n=e.size;if(n&&n.value!==G.t.auto){const e=n.value;let i,o;if(e.isSpaceList()?(i=e.values[0],o=e.values[1]):(i=e,o=null),i.isNumeric())t.width=i,t.height=o||i;else{const e=i.name&&xn[i.name.toLowerCase()];e&&(o&&o===G.t.landscape?(t.width=e.height,t.height=e.width):(t.width=e.width,t.height=e.height))}}const i=e.marks;i&&i.value!==G.t.none&&(t.bleedOffset=On);const o=e.bleed;if(o&&o.value!==G.t.auto)o.value&&o.value.isNumeric()&&(t.bleed=o.value);else if(i){let e=!1;(e=i.value.isSpaceList()?i.value.values.some(e=>e===G.t.crop):i.value===G.t.crop)&&(t.bleed=new G.i(6,"pt"))}return t}function Rn(e,t){const n={},i=e.bleed.num*t.queryUnitSize(e.bleed.unit,!1),o=e.bleedOffset.num*t.queryUnitSize(e.bleedOffset.unit,!1),s=i+o,r=e.width;r===G.q?t.pref.defaultPaperSize?n.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize("px",!1):n.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-2*s:n.pageWidth=r.num*t.queryUnitSize(r.unit,!1);const a=e.height;return a===G.p?t.pref.defaultPaperSize?n.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize("px",!1):n.pageHeight=t.viewportHeight-2*s:n.pageHeight=a.num*t.queryUnitSize(a.unit,!1),n.bleed=i,n.bleedOffset=o,n.cropOffset=s,n}function Ln(e,t,n){const i=e.createElementNS(w.a.SVG,"svg");return i.setAttribute("width",t),i.setAttribute("height",n),i.style.position="absolute",i}function Fn(e,t,n){n=n||"polyline";const i=e.createElementNS(w.a.SVG,n);return i.setAttribute("stroke","black"),i.setAttribute("stroke-width",t),i.setAttribute("fill","none"),i}var Dn,_n;!function(e){e.TOP_LEFT="top left",e.TOP_RIGHT="top right",e.BOTTOM_LEFT="bottom left",e.BOTTOM_RIGHT="bottom right"}(Dn||(Dn={})),function(e){e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right"}(_n||(_n={}));const Bn=(()=>{const e={width:!0,height:!0,"block-size":!0,"inline-size":!0,margin:!0,padding:!0,border:!0,outline:!0,"outline-width":!0,"outline-style":!0,"outline-color":!0};return["left","right","top","bottom","before","after","start","end","block-start","block-end","inline-start","inline-end"].forEach(t=>{e[`margin-${t}`]=!0,e[`padding-${t}`]=!0,e[`border-${t}-width`]=!0,e[`border-${t}-style`]=!0,e[`border-${t}-color`]=!0}),e})();var Mn;!function(e){e.START="start",e.CENTER="center",e.END="end"}(Mn||(Mn={}));const Un={"top-left-corner":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!0,positionAlongVariableDimension:null},"top-left":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:Mn.START},"top-center":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:Mn.CENTER},"top-right":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:Mn.END},"top-right-corner":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"right-top":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:Mn.START},"right-middle":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:Mn.CENTER},"right-bottom":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:Mn.END},"bottom-right-corner":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"bottom-right":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:Mn.END},"bottom-center":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:Mn.CENTER},"bottom-left":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:Mn.START},"bottom-left-corner":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"left-bottom":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:Mn.END},"left-middle":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:Mn.CENTER},"left-top":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:Mn.START}},zn=(()=>{const e=Un;return Object.keys(e).sort((t,n)=>e[t].order-e[n].order)})(),Vn="vivliostyle-page-rule-master",Hn="_marginBoxes";class Gn extends en{constructor(e,t,n){super(e,null,Vn,[],t,null,0),this.pageMarginBoxes={};const i=kn(n),o=new $n(this.scope,this,n,i);this.bodyPartitionKey=o.key,this.createPageMarginBoxes(n),this.applySpecified(n,i)}createPageMarginBoxes(e){const t=e[Hn];if(t){const n=this;zn.forEach(i=>{t[i]&&(n.pageMarginBoxes[i]=new Wn(n.scope,n,i,e))})}}applySpecified(e,t){this.specified.position=new U.c(G.t.relative,0),this.specified.width=new U.c(t.width,0),this.specified.height=new U.c(t.height,0);for(const t in e)Bn[t]||"background-clip"===t||(this.specified[t]=e[t])}createInstance(e){return new Xn(e,this)}}class $n extends nn{constructor(e,t,n,i){super(e,null,null,[],t),this.pageSize=i,this.specified["z-index"]=new U.c(new G.g(0),0),this.applySpecified(n)}applySpecified(e){this.specified["flow-from"]=new U.c(G.r("body"),0),this.specified.position=new U.c(G.t.absolute,0),this.specified.overflow=new U.c(G.t.visible,0);for(const t in Bn)Bn.hasOwnProperty(t)&&(this.specified[t]=e[t])}createInstance(e){return new Yn(e,this)}}class Wn extends nn{constructor(e,t,n,i){super(e,null,null,[],t),this.marginBoxName=n,this.applySpecified(i)}applySpecified(e){const t=e[Hn][this.marginBoxName];for(const n in e){const i=e[n],o=t[n];(U.v[n]||o&&o.value===G.t.inherit)&&(this.specified[n]=i)}for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];n&&n.value!==G.t.inherit&&(this.specified[e]=n)}}createInstance(e){return new Zn(e,this)}}class Xn extends bn{constructor(e,t){super(e,t),this.pageAreaDimension=null,this.pageMarginBoxInstances={}}applyCascadeAndInit(e,t){const n=this.cascaded;for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"writing-mode":case"direction":n[e]=t[e]}super.applyCascadeAndInit(e,t)}initHorizontal(){const e=this.style;e.left=G.u,e["margin-left"]=G.u,e["border-left-width"]=G.u,e["padding-left"]=G.u,e["padding-right"]=G.u,e["border-right-width"]=G.u,e["margin-right"]=G.u,e.right=G.u}initVertical(){const e=this.style;e.top=G.u,e["margin-top"]=G.u,e["border-top-width"]=G.u,e["padding-top"]=G.u,e["padding-bottom"]=G.u,e["border-bottom-width"]=G.u,e["margin-bottom"]=G.u,e.bottom=G.u}setPageAreaDimension(e){this.pageAreaDimension=e;const t=this.style;t.width=new G.c(e.borderBoxWidth),t.height=new G.c(e.borderBoxHeight),t["padding-left"]=new G.c(e.marginLeft),t["padding-right"]=new G.c(e.marginRight),t["padding-top"]=new G.c(e.marginTop),t["padding-bottom"]=new G.c(e.marginBottom)}adjustPageLayout(e,t,n){const i=t.marginBoxes,o={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},s={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(i.top,!0,o,e,n),this.sizeMarginBoxesAlongVariableDimension(i.bottom,!0,o,e,n),this.sizeMarginBoxesAlongVariableDimension(i.left,!1,s,e,n),this.sizeMarginBoxesAlongVariableDimension(i.right,!1,s,e,n)}sizeMarginBoxesAlongVariableDimension(e,t,n,i,o){const s=Mn.START,r=Mn.CENTER,a=Mn.END,l=this.pageBox.scope,c={},h={},u={};for(const n in e){const i=Un[n];if(i){const s=e[n],r=this.pageMarginBoxInstances[n],a=new jn(s,r.style,t,l,o);c[i.positionAlongVariableDimension]=s,h[i.positionAlongVariableDimension]=r,u[i.positionAlongVariableDimension]=a}}const d={start:n.start.evaluate(i),end:n.end.evaluate(i),extent:n.extent.evaluate(i)};let p=this.getSizesOfMarginBoxesAlongVariableDimension(u,d.extent),f=!1;const g={};Object.keys(c).forEach(e=>{const s=e,r=on(l,h[s].style[t?"max-width":"max-height"],n.extent);if(r){const e=r.evaluate(i);if(p[s]>e){const n=u[s]=new qn(c[s],h[s].style,t,l,o,e);g[s]=n.getOuterSize(),f=!0}}}),f&&(p=this.getSizesOfMarginBoxesAlongVariableDimension(u,d.extent),f=!1,[s,r,a].forEach(e=>{p[e]=g[e]||p[e]}));const m={};Object.keys(c).forEach(e=>{const s=e,r=on(l,h[s].style[t?"min-width":"min-height"],n.extent);if(r){const e=r.evaluate(i);if(p[s]<e){const n=u[s]=new qn(c[s],h[s].style,t,l,o,e);m[s]=n.getOuterSize(),f=!0}}}),f&&(p=this.getSizesOfMarginBoxesAlongVariableDimension(u,d.extent),[s,r,a].forEach(e=>{p[e]=m[e]||p[e]}));const b=d.start+d.extent,w=d.start+(d.start+d.extent);[s,r,a].forEach(e=>{const n=p[e];if(n){const i=c[e];let o=0;switch(e){case s:o=t?i.left:i.top;break;case r:o=(w-n)/2;break;case a:o=b-n}t?i.setHorizontalPosition(o,n-i.getInsetLeft()-i.getInsetRight()):i.setVerticalPosition(o,n-i.getInsetTop()-i.getInsetBottom())}})}getSizesOfMarginBoxesAlongVariableDimension(e,t){const n=e[Mn.START],i=e[Mn.CENTER],o=e[Mn.END],s={};if(i){const e=[n,o].filter(e=>e),r=e.length?new Kn(e):null,a=this.distributeAutoMarginBoxSizes(i,r,t);a.xSize&&(s[Mn.CENTER]=a.xSize);const l=(t-(a.xSize||i.getOuterSize()))/2;n&&n.hasAutoSize()&&(s[Mn.START]=l),o&&o.hasAutoSize()&&(s[Mn.END]=l)}else{const e=this.distributeAutoMarginBoxSizes(n,o,t);e.xSize&&(s[Mn.START]=e.xSize),e.ySize&&(s[Mn.END]=e.ySize)}return s}distributeAutoMarginBoxSizes(e,t,n){const i={xSize:null,ySize:null};if(e&&t)if(e.hasAutoSize()&&t.hasAutoSize()){const o=e.getOuterMaxContentSize(),s=t.getOuterMaxContentSize();if(o>0&&s>0){const r=o+s;if(r<n)i.xSize=n*o/r;else{const s=e.getOuterMinContentSize(),a=s+t.getOuterMinContentSize();a<n?i.xSize=s+(n-a)*(o-s)/(r-a):a>0&&(i.xSize=n*s/a)}i.xSize>0&&(i.ySize=n-i.xSize)}else o>0?i.xSize=n:s>0&&(i.ySize=n)}else e.hasAutoSize()?i.xSize=Math.max(n-t.getOuterSize(),0):t.hasAutoSize()&&(i.ySize=Math.max(n-e.getOuterSize(),0));else e?e.hasAutoSize()&&(i.xSize=n):t&&t.hasAutoSize()&&(i.ySize=n);return i}prepareContainer(e,t,n,i,o){super.prepareContainer(e,t,n,i,o),t.element.setAttribute("data-vivliostyle-page-box",!0)}}class jn{constructor(e,t,n,i,o){this.container=e,this.isHorizontal=n,this.clientLayout=o,this.size=null,this.hasAutoSize_=!on(i,t[n?"width":"height"],new k.x(i,0,"px"))}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){const e=this.isHorizontal?[vn.a.MAX_CONTENT_WIDTH,vn.a.MIN_CONTENT_WIDTH]:[vn.a.MAX_CONTENT_HEIGHT,vn.a.MIN_CONTENT_HEIGHT];this.size=vn.b(this.clientLayout,this.container.element,e)}return this.size}getOuterMaxContentSize(){const e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e[vn.a.MAX_CONTENT_WIDTH]+this.container.getInsetRight():this.container.getInsetTop()+e[vn.a.MAX_CONTENT_HEIGHT]+this.container.getInsetBottom()}getOuterMinContentSize(){const e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e[vn.a.MIN_CONTENT_WIDTH]+this.container.getInsetRight():this.container.getInsetTop()+e[vn.a.MIN_CONTENT_HEIGHT]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}}class Kn{constructor(e){this.params=e}hasAutoSize(){return this.params.some(e=>e.hasAutoSize())}getOuterMaxContentSize(){const e=this.params.map(e=>e.getOuterMaxContentSize());return Math.max.apply(null,e)*e.length}getOuterMinContentSize(){const e=this.params.map(e=>e.getOuterMinContentSize());return Math.max.apply(null,e)*e.length}getOuterSize(){const e=this.params.map(e=>e.getOuterSize());return Math.max.apply(null,e)*e.length}}class qn extends jn{constructor(e,t,n,i,o,s){super(e,t,n,i,o),this.fixedSize=s}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}}class Yn extends En{constructor(e,t){super(e,t),this.borderBoxWidth=null,this.borderBoxHeight=null,this.marginTop=null,this.marginRight=null,this.marginBottom=null,this.marginLeft=null}applyCascadeAndInit(e,t){const n=this.cascaded;for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(e.match(/^column.*$/)||e.match(/^background-/))&&(n[e]=t[e]);super.applyCascadeAndInit(e,t),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){const e=this.resolvePageBoxDimensions({start:"left",end:"right",extent:"width"});this.borderBoxWidth=e.borderBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){const e=this.resolvePageBoxDimensions({start:"top",end:"bottom",extent:"height"});this.borderBoxHeight=e.borderBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){const t=this.style,n=this.pageBox.pageSize,i=this.pageBox.scope,o=e.start,s=e.end,r=e.extent,a=n[r].toExpr(i,null);let l=on(i,t[r],a),c=on(i,t[`margin-${o}`],a),h=on(i,t[`margin-${s}`],a);const u=sn(i,t[`padding-${o}`],a),d=sn(i,t[`padding-${s}`],a),p=an(i,t[`border-${o}-width`],t[`border-${o}-style`],a),f=an(i,t[`border-${s}-width`],t[`border-${s}-style`],a);let g=k.P(i,a,k.C(i,k.C(i,p,u),k.C(i,f,d)));return l?(g=k.P(i,g,l),c||h?c?h=k.P(i,g,c):c=k.P(i,g,h):h=c=k.N(i,g,new k.f(i,.5))):(c||(c=i.zero),h||(h=i.zero),l=k.P(i,g,k.C(i,c,h))),t[o]=new G.c(c),t[s]=new G.c(h),t[`margin-${o}`]=G.u,t[`margin-${s}`]=G.u,t[`padding-${o}`]=new G.c(u),t[`padding-${s}`]=new G.c(d),t[`border-${o}-width`]=new G.c(p),t[`border-${s}-width`]=new G.c(f),t[r]=new G.c(l),t[`max-${r}`]=new G.c(l),{borderBoxExtent:k.P(i,a,k.C(i,c,h)),marginStart:c,marginEnd:h}}prepareContainer(e,t,n,i,o){super.prepareContainer(e,t,n,i,o),n.pageAreaElement=t.element,e.pageAreaWidth=parseFloat(n.pageAreaElement.style.width),e.pageAreaHeight=parseFloat(n.pageAreaElement.style.height)}}class Zn extends En{constructor(e,t){super(e,t),this.suppressEmptyBoxGeneration=!0;const n=t.marginBoxName;this.boxInfo=Un[n],e.pageMarginBoxInstances[n]=this}prepareContainer(e,t,n,i,o){this.applyVerticalAlign(e,t.element),super.prepareContainer(e,t,n,i,o)}applyVerticalAlign(e,t){w.F(t,"display","flex");const n=this.getProp(e,"vertical-align");let i=null;n===G.r("middle")?i="center":n===G.r("top")?i="flex-start":n===G.r("bottom")&&(i="flex-end"),i&&(w.F(t,"flex-flow",this.vertical?"row":"column"),w.F(t,"justify-content",i))}positionAlongVariableDimension(e,t){const n=this.style,i=this.pageBox.scope,o=e.start,s=e.end,r=e.extent,a="left"===o,l=a?t.borderBoxWidth:t.borderBoxHeight,c=on(i,n[r],l),h=a?t.marginLeft:t.marginTop;if(this.boxInfo.positionAlongVariableDimension===Mn.START)n[o]=new G.c(h);else if(c){const e=sn(i,n[`margin-${o}`],l),t=sn(i,n[`margin-${s}`],l),r=sn(i,n[`padding-${o}`],l),a=sn(i,n[`padding-${s}`],l),u=an(i,n[`border-${o}-width`],n[`border-${o}-style`],l),d=an(i,n[`border-${s}-width`],n[`border-${s}-style`],l),p=k.C(i,c,k.C(i,k.C(i,r,a),k.C(i,k.C(i,u,d),k.C(i,e,t))));switch(this.boxInfo.positionAlongVariableDimension){case Mn.CENTER:n[o]=new G.c(k.C(i,h,k.H(i,k.P(i,l,p),new k.f(i,2))));break;case Mn.END:n[o]=new G.c(k.P(i,k.C(i,h,l),p))}}}positionAndSizeAlongFixedDimension(e,t){const n=this.style,i=this.pageBox.scope,o=e.inside,s=e.outside,r=e.extent,a=t[`margin${s.charAt(0).toUpperCase()}${s.substring(1)}`],l=rn(i,n[`margin-${o}`],a),c=rn(i,n[`margin-${s}`],a),h=sn(i,n[`padding-${o}`],a),u=sn(i,n[`padding-${s}`],a),d=an(i,n[`border-${o}-width`],n[`border-${o}-style`],a),p=an(i,n[`border-${s}-width`],n[`border-${s}-style`],a),f=on(i,n[r],a);let g=null;function m(e){if(g)return g;g={extent:f?f.evaluate(e):null,marginInside:l?l.evaluate(e):null,marginOutside:c?c.evaluate(e):null};const t=a.evaluate(e);let n=0;return[d,h,u,p].forEach(t=>{t&&(n+=t.evaluate(e))}),(null===g.marginInside||null===g.marginOutside)&&n+g.extent+g.marginInside+g.marginOutside>t&&(null===g.marginInside&&(g.marginInside=0),null===g.marginOutside&&(g.marginOutside=0)),null!==g.extent&&null!==g.marginInside&&null!==g.marginOutside&&(g.marginOutside=null),null===g.extent&&null!==g.marginInside&&null!==g.marginOutside?g.extent=t-n-g.marginInside-g.marginOutside:null!==g.extent&&null===g.marginInside&&null!==g.marginOutside?g.marginInside=t-n-g.extent-g.marginOutside:null!==g.extent&&null!==g.marginInside&&null===g.marginOutside?g.marginOutside=t-n-g.extent-g.marginInside:null===g.extent?(g.marginInside=g.marginOutside=0,g.extent=t-n):g.marginInside=g.marginOutside=(t-n-g.extent)/2,g}n[r]=new G.c(new k.t(i,(function(){const e=m(this).extent;return null===e?0:e}),r)),n[`margin-${o}`]=new G.c(new k.t(i,(function(){const e=m(this).marginInside;return null===e?0:e}),`margin-${o}`)),n[`margin-${s}`]=new G.c(new k.t(i,(function(){const e=m(this).marginOutside;return null===e?0:e}),`margin-${s}`)),"left"===o?n.left=new G.c(k.C(i,t.marginLeft,t.borderBoxWidth)):"top"===o&&(n.top=new G.c(k.C(i,t.marginTop,t.borderBoxHeight)))}initHorizontal(){const e=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:"right",outside:"left",extent:"width"},e):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:"left",outside:"right",extent:"width"},e):this.positionAlongVariableDimension({start:"left",end:"right",extent:"width"},e)}initVertical(){const e=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:"bottom",outside:"top",extent:"height"},e):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:"top",outside:"bottom",extent:"height"},e):this.positionAlongVariableDimension({start:"top",end:"bottom",extent:"height"},e)}finishContainer(e,t,n,i,o,s,r){super.finishContainer(e,t,n,i,o,s,r);const a=n.marginBoxes,l=this.pageBox.marginBoxName,c=this.boxInfo;c.isInLeftColumn||c.isInRightColumn?c.isInTopRow||c.isInBottomRow||(c.isInLeftColumn?a.left[l]=t:c.isInRightColumn&&(a.right[l]=t)):c.isInTopRow?a.top[l]=t:c.isInBottomRow&&(a.bottom[l]=t)}}class Qn{constructor(e,t,n,i,o){this.cascadeInstance=e,this.pageScope=t,this.rootPageBoxInstance=n,this.context=i,this.docElementStyle=o,this.pageMasterCache={},this.definePageProgression()}definePageProgression(){const e=this.pageScope,t=new k.s(e,"page-number"),n=new k.i(e,new k.q(e,t,new k.f(e,2)),e.zero);e.defineName("recto-page",new k.w(e,n)),e.defineName("verso-page",n),(this.context.pageProgression||Tn(this.docElementStyle))===o.LTR?(e.defineName("left-page",n),e.defineName("right-page",new k.w(e,n))):(e.defineName("left-page",new k.w(e,n)),e.defineName("right-page",n))}getCascadedPageStyle(){const e={};return this.cascadeInstance.pushRule([],"",e),this.cascadeInstance.popRule(),e}getPageRulePageMaster(e,t){const n=e.pageBox;if(0===Object.keys(t).length)return n.resetScope(),e;const i=this.makeCacheKey(t,n);let o=this.pageMasterCache[i];return o||(o=n.pseudoName===gn?this.generatePageRuleMaster(t):this.generateCascadedPageMaster(t,n),this.pageMasterCache[i]=o),o.pageBox.resetScope(),o}makeCacheKey(e,t){const n=this.makeCascadeValueObjectKey(e);return`${t.key}^${n}`}makeCascadeValueObjectKey(e){const t=[];for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n];let o;o=i instanceof U.c?`${i.value}`:this.makeCascadeValueObjectKey(i),t.push(n+o+(i.priority||""))}return t.sort().join("^")}generatePageRuleMaster(e){const t=new Gn(this.pageScope,this.rootPageBoxInstance.pageBox,e).createInstance(this.rootPageBoxInstance);return t.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),t.resolveAutoSizing(this.context),t}generateCascadedPageMaster(e,t){const n=t.clone({pseudoName:Vn}),i=n.specified,o=e.size;if(o){const t=kn(e),n=o.priority;i.width=U.i(this.context,i.width,new U.c(t.width,n)),i.height=U.i(this.context,i.height,new U.c(t.height,n))}["counter-reset","counter-increment"].forEach(t=>{i[t]&&(e[t]=i[t])});const s=n.createInstance(this.rootPageBoxInstance);return s.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),s.resolveAutoSizing(this.context),s}}class Jn extends U.d{constructor(e){super(),this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}}class ei extends U.d{constructor(e){super(),this.scope=e}apply(e){1===new k.s(this.scope,"page-number").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}}class ti extends U.d{constructor(e){super(),this.scope=e}apply(e){new k.s(this.scope,"left-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}}class ni extends U.d{constructor(e){super(),this.scope=e}apply(e){new k.s(this.scope,"right-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}}class ii extends U.d{constructor(e){super(),this.scope=e}apply(e){new k.s(this.scope,"recto-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}}class oi extends U.d{constructor(e){super(),this.scope=e}apply(e){new k.s(this.scope,"verso-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}}class si extends U.a{constructor(e,t){super(e,t,null,null,null)}apply(e){!function(e,t,n,i,o){U.B(e,t,n,i,null,null,null);const s=n[Hn];if(s){const n=U.q(t,Hn);for(const t in s)if(s.hasOwnProperty(t)){let o=n[t];o||(o={},n[t]=o),U.B(e,o,s[t],i,null,null,null)}}}(e.context,e.currentStyle,this.style,this.specificity)}}class ri extends U.b{constructor(e,t,n,i,o){super(e,t,null,n,null,i,!1),this.pageProps=o,this.currentPageSelectors=[],this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}startPageRule(){this.startSelectorRule()}tagSelector(e,t){b.a(t),this.currentNamedPageSelector=t,t&&(this.chain.push(new Jn(t)),this.specificity+=65536)}pseudoclassSelector(e,t){switch(t&&this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${t.join("")})`),this.currentPseudoPageClassSelectors.push(`:${e}`),e.toLowerCase()){case"first":this.chain.push(new ei(this.scope)),this.specificity+=256;break;case"left":this.chain.push(new ti(this.scope)),this.specificity+=1;break;case"right":this.chain.push(new ni(this.scope)),this.specificity+=1;break;case"recto":this.chain.push(new ii(this.scope)),this.specificity+=1;break;case"verso":this.chain.push(new oi(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`)}}finishSelector(){let e;e=this.currentNamedPageSelector||this.currentPseudoPageClassSelectors.length?[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()):null,this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,t,n){if(("bleed"===e||"marks"===e)&&!this.currentPageSelectors.some(e=>null===e.selectors))return;super.simpleProperty(e,t,n);const i=U.s(this.elementStyle,e),o=this.pageProps;if("bleed"===e||"marks"===e)o[""]||(o[""]={}),Object.keys(o).forEach(t=>{U.F(o[t],e,i)});else if("size"===e){const t=o[""];this.currentPageSelectors.forEach(n=>{let s=new U.c(i.value,i.priority+n.specificity);const r=n.selectors?n.selectors.join(""):"";let a=o[r];if(a){const t=U.s(a,e);s=t?U.i(null,s,t):s,U.F(a,e,s)}else a=o[r]={},U.F(a,e,s),t&&["bleed","marks"].forEach(e=>{t[e]&&U.F(a,e,t[e])},this)})}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,"*",e)}makeApplyRuleAction(e){return new si(this.elementStyle,e)}startPageMarginBoxRule(e){const t=U.q(this.elementStyle,Hn);let n=t[e];n||(n={},t[e]=n);const i=new ai(this.scope,this.owner,this.validatorSet,n);this.owner.pushHandler(i)}}class ai extends z.f{constructor(e,t,n,i){super(e,t,!1),this.validatorSet=n,this.boxStyle=i}property(e,t,n){this.validatorSet.validatePropertyAndHandleShorthand(e,t,n,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,n){const i=n?this.getImportantSpecificity():this.getBaseSpecificity(),o=new U.c(t,i);U.F(this.boxStyle,e,o)}}var li=n(27),ci=n(25),hi=n(21);const ui=(e,t,n)=>e.replace(/[uU][rR][lL]\(\s*"((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"\r\n])+)"/gm,(e,i)=>`url("${n.transformURL(i,t)}"`).replace(/[uU][rR][lL]\(\s*'((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^'\r\n])+)'/gm,(e,i)=>`url('${n.transformURL(i,t)}'`).replace(/[uU][rR][lL]\(\s*((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"'\r\n\)\s])+)/gm,(e,i)=>`url(${n.transformURL(i,t)}`),di={},pi={"text-indent":"0px","margin-top":"0px","padding-top":"0px","border-top-width":"0px","border-top-style":"none","border-top-color":"transparent","border-top-left-radius":"0px","border-top-right-radius":"0px"},fi={"text-indent":"0px","margin-right":"0px","padding-right":"0px","border-right-width":"0px","border-right-style":"none","border-right-color":"transparent","border-top-right-radius":"0px","border-bottom-right-radius":"0px"},gi={"margin-top":"0px"},mi={"margin-right":"0px"};class bi extends w.c{constructor(e,t,n,i,o,s,r,a,l,c,h,u,d){super(),this.flowName=e,this.context=t,this.viewport=n,this.styler=i,this.regionIds=o,this.xmldoc=s,this.docFaces=r,this.footnoteStyle=a,this.stylerProducer=l,this.page=c,this.customRenderer=h,this.fallbackMap=u,this.documentURLTransformer=d,this.nodeContext=null,this.viewRoot=null,this.isFootnote=!1,this.sourceNode=null,this.offsetInNode=0,this.viewNode=null,this.document=n.document,this.exprContentListener=i.counterListener.getExprContentListener()}clone(){return new bi(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(e,t,n,i,o,s,r,a){const l=this.getPseudoMap(n,this.regionIds,this.isFootnote,this.nodeContext,s);if(!l)return a;const c=[],h=hi.c.createElementNS(w.a.SHADOW,"root");let u=h;for(const e of hi.e){let n;if(e){if(!l[e])continue;if(!("footnote-marker"!=e||t&&this.isFootnote))continue;if(e.match(/^first-/)){const e=i.display;if(!e||e===G.t.inline)continue}if("before"===e||"after"===e){const t=l[e].content;if(!t||t===G.t.normal||t===G.t.none)continue}c.push(e),n=hi.c.createElementNS(w.a.XHTML,"span"),hi.f(n,e)}else n=hi.c.createElementNS(w.a.SHADOW,"content");u.appendChild(n),e.match(/^first-/)&&(u=n)}if(!c.length)return a;const d=new hi.b(e,n,o,s,this.exprContentListener);return new X.n(e,h,null,r,a,X.o.ROOTLESS,d)}getPseudoMap(e,t,n,i,o){const s=U.u(e,"_pseudos");if(!s)return null;const r={};for(const e in s){const i=r[e]={};U.C(i,s[e],o),U.D(i,o,s[e]),U.o(s[e],t,n,(e,t)=>{U.C(i,t,o),U.p(t,e=>{U.C(i,e,o)})})}return r}createRefShadow(e,t,n,i,o){const s=this,r=W.c("createRefShadow");return s.xmldoc.store.load(e).then(a=>{const l=a;if(l){const r=l.getElement(e);if(r){const e=s.stylerProducer.getStylerForDoc(l);o=new X.n(n,r,l,i,o,t,e)}}r.finish(o)}),r.result()}createShadows(e,t,n,i,o,s,r){const a=this,l=W.c("createShadows"),c=i.template;let h;if(c instanceof G.l){const t=c.url;h=a.createRefShadow(t,X.o.ROOTLESS,e,r,null)}else h=W.d(null);return h.then(c=>{let h=null;if(e.namespaceURI==w.a.SHADOW&&"include"==e.localName){let t=e.getAttribute("href"),n=null;t?n=r?r.xmldoc:a.xmldoc:r&&(t=r.owner.namespaceURI==w.a.XHTML?r.owner.getAttribute("href"):r.owner.getAttributeNS(w.a.XLINK,"href"),n=r.parentShadow?r.parentShadow.xmldoc:a.xmldoc),t&&(t=w.C(t,n.url),h=a.createRefShadow(t,X.o.ROOTED,e,r,c))}null==h&&(h=W.d(c));let u=null;h.then(t=>{if(i.display===G.t.table_cell){const n=w.C("user-agent.xml#table-cell",w.D);u=a.createRefShadow(n,X.o.ROOTLESS,e,r,t)}else u=W.d(t)}),u.then(c=>{c=a.createPseudoelementShadow(e,t,n,i,o,s,r,c),l.finish(c)})}),l.result()}setViewRoot(e,t){this.viewRoot=e,this.isFootnote=t}computeStyle(e,t,n,i){const o=this.context,s=U.n(n,o,this.regionIds,this.isFootnote,this.nodeContext);e=U.z(s,o,e),t=U.y(s,o,t);const r=this;U.k(s,i,e,t,(e,t)=>{let n=t.evaluate(o,e);return"font-family"==e&&(n=r.docFaces.filterFontFamily(n)),n});const a=i.position,l=i.float,c=Je.c(i.display||G.t.inline,a,l,this.sourceNode===this.xmldoc.root);return["display","position","float"].forEach(e=>{c[e]&&(i[e]=c[e])}),e}inheritFromSourceParent(e){let t=this.nodeContext.sourceNode;const n=[];let i=null,o=this.nodeContext.shadowContext,s=-1;for(;t&&1==t.nodeType;){const e=o&&o.root==t;if(!e||o.type==X.o.ROOTLESS){const e=(o?o.styler:this.styler).getStyle(t,!1);n.push(e),i=i||w.u(t)}e?(t=o.owner,o=o.parentShadow):(t=t.parentNode,s++)}const r=0===s,a=this.context.queryUnitSize("em",r),l={"font-size":new U.c(new G.i(a,"px"),0)},c=new U.g(l,this.context);for(let e=n.length-1;e>=0;--e){const t=n[e],i=[];for(const e in t)U.w(e)&&i.push(e);i.sort(G.v);for(const e of i){c.setPropName(e);const n=U.s(t,e);n.value!==G.t.inherit&&(l[e]=n.filterValue(c))}}for(const t in e)U.w(t)||(l[t]=e[t]);return{lang:i,elementStyle:l}}resolveURL(e){return e=w.C(e,this.xmldoc.url),this.fallbackMap[e]||e}inheritLangAttribute(){this.nodeContext.lang=w.u(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(e){const t=U.r().filter(t=>e[t]);if(t.length){let n=this.nodeContext.inheritedProps;if(this.nodeContext.parent){n=this.nodeContext.inheritedProps={};for(const e in this.nodeContext.parent.inheritedProps)n[e]=this.nodeContext.parent.inheritedProps[e]}t.forEach(t=>{const i=e[t];if(i){if(i instanceof G.g)n[t]=i.num;else if(i instanceof G.f)n[t]=i.name;else if(i instanceof G.i){const e=i;switch(e.unit){case"dpi":case"dpcm":case"dppx":n[t]=e.num*k.G[e.unit]}}else n[t]=i;delete e[t]}})}}resolveFormattingContext(e,t,n,i,o,s){const r=l.b(l.a.RESOLVE_FORMATTING_CONTEXT);for(let a=0;a<r.length;a++){const l=r[a](e,t,n,i,o,s);if(l)return void(e.formattingContext=l)}}createElementView(e,t){const n=this;let i=!0;const o=W.c("createElementView");let s=n.sourceNode;const r=n.nodeContext.shadowContext?n.nodeContext.shadowContext.styler:n.styler;let a=r.getStyle(s,!1);if(!n.nodeContext.shadowContext){const e=this.xmldoc.getElementOffset(s);ci.b.registerFragmentIndex(e,n.nodeContext.fragmentIndex,0)}const l={};if(!n.nodeContext.parent){const e=n.inheritFromSourceParent(a);a=e.elementStyle,n.nodeContext.lang=e.lang}const c=a["float-reference"]&&$.g(a["float-reference"].value.toString());if(n.nodeContext.parent&&c&&$.h(c)){const e=n.inheritFromSourceParent(a);a=e.elementStyle,n.nodeContext.lang=e.lang}n.nodeContext.vertical=n.computeStyle(n.nodeContext.vertical,"rtl"===n.nodeContext.direction,a,l),r.processContent(s,l),this.transferPolyfilledInheritedProps(l),this.inheritLangAttribute(),l.direction&&(n.nodeContext.direction=l.direction.toString());const h=l["flow-into"];if(h&&h.toString()!=n.flowName)return o.finish(!1),o.result();let u=l.display;if(u===G.t.none)return o.finish(!1),o.result();const d=null==n.nodeContext.parent;return n.nodeContext.flexContainer=u===G.t.flex,n.createShadows(s,d,a,l,r,n.context,n.nodeContext.shadowContext).then(h=>{n.nodeContext.nodeShadow=h;const p=l.position;let f=l.float,g=l.clear;const m=n.nodeContext.vertical?G.t.vertical_rl:G.t.horizontal_tb,b=n.nodeContext.parent?n.nodeContext.parent.vertical?G.t.vertical_rl:G.t.horizontal_tb:m,E=Je.e(s);n.nodeContext.establishesBFC=Je.a(u,p,f,l.overflow,m,b,E),n.nodeContext.containingBlockForAbsolute=Je.b(p),!n.nodeContext.isInsideBFC()||f===G.t.footnote||c&&$.h(c)||(f=null,g=null);let y=f===G.t.left||f===G.t.right||f===G.t.top||f===G.t.bottom||f===G.t.inline_start||f===G.t.inline_end||f===G.t.block_start||f===G.t.block_end||f===G.t.snap_block||f===G.t.footnote;f&&(delete l.float,f===G.t.footnote&&(n.isFootnote?(y=!1,l.display=G.t.block):l.display=G.t.inline)),g&&(g===G.t.inherit&&n.nodeContext.parent&&n.nodeContext.parent.clearSide&&(g=G.r(n.nodeContext.parent.clearSide)),g!==G.t.left&&g!==G.t.right&&g!==G.t.top&&g!==G.t.bottom&&g!==G.t.both&&g!==G.t.all&&g!==G.t.same||(delete l.clear,l.display&&l.display!=G.t.inline&&(n.nodeContext.clearSide=g.toString())));const S=u===G.t.list_item&&l["ua-list-item-count"];if((y||l["break-inside"]&&l["break-inside"]!==G.t.auto)&&n.nodeContext.breakPenalty++,u&&u!==G.t.inline&&Je.f(u)&&n.nodeContext.breakPenalty++,n.nodeContext.inline=!y&&!u||Je.f(u)||Je.g(u),n.nodeContext.display=u?u.toString():"inline",n.nodeContext.floatSide=y?f.toString():null,n.nodeContext.floatReference=c||$.a.INLINE,n.nodeContext.floatMinWrapBlock=l["float-min-wrap-block"]||null,n.nodeContext.columnSpan=l["column-span"],!n.nodeContext.inline){const e=l["break-after"];e&&(n.nodeContext.breakAfter=e.toString());const t=l["break-before"];t&&(n.nodeContext.breakBefore=t.toString())}n.nodeContext.verticalAlign=l["vertical-align"]&&l["vertical-align"].toString()||"baseline",n.nodeContext.captionSide=l["caption-side"]&&l["caption-side"].toString()||"top";const N=l["border-collapse"];if(!N||N===G.r("separate")){const e=l["border-spacing"];let t,i;e&&(e.isSpaceList()?(t=e.values[0],i=e.values[1]):t=i=e,t.isNumeric()&&(n.nodeContext.inlineBorderSpacing=G.x(t,n.context)),i.isNumeric()&&(n.nodeContext.blockBorderSpacing=G.x(i,n.context)))}n.nodeContext.footnotePolicy=l["footnote-policy"];const C=l["x-first-pseudo"];if(C){const e=n.nodeContext.parent?n.nodeContext.parent.firstPseudo:null;n.nodeContext.firstPseudo=new X.e(e,C.num)}n.nodeContext.inline||n.processAfterIfcontinues(s,a,r,n.context);const v=l["white-space"];if(v){const e=X.z(v.toString());null!==e&&(n.nodeContext.whitespace=e)}const T=l["hyphenate-character"];T&&T!==G.t.auto&&(n.nodeContext.hyphenateCharacter=T.str);const x=l["word-break"],I=l["overflow-wrap"]||["word-wrap"];n.nodeContext.breakWord=x===G.t.break_all||I===G.t.break_word,n.resolveFormattingContext(n.nodeContext,e,u,p,f,d),n.nodeContext.parent&&n.nodeContext.parent.formattingContext&&(e=n.nodeContext.parent.formattingContext.isFirstTime(n.nodeContext,e)),n.nodeContext.inline||(n.nodeContext.repeatOnBreak=n.processRepeatOnBreak(l),n.findAndProcessRepeatingElements(s,r));let P=!1,A=null;const O=[];let k,R=s.namespaceURI,L=s.localName;if(R==w.a.XHTML)"html"==L||"body"==L||"script"==L||"link"==L||"meta"==L?L="div":"vide_"==L?L="video":"audi_"==L?L="audio":"object"==L&&(P=!!n.customRenderer),s.getAttribute(hi.a)&&a.content&&a.content.value&&a.content.value.url&&(L="img");else if(R==w.a.epub)L="span",R=w.a.XHTML;else if(R==w.a.FB2){if(R=w.a.XHTML,"image"==L){L="div";const e=s.getAttributeNS(w.a.XLINK,"href");if(e&&"#"==e.charAt(0)){const t=n.xmldoc.getElement(e);if(t){A=n.createElement(R,"img");const e=`data:${t.getAttribute("content-type")||"image/jpeg"};base64,${t.textContent.replace(/[ \t\n\t]/g,"")}`;O.push(Vt.b(A,e))}}}else L=wi[L];L||(L=n.nodeContext.inline?"span":"div")}else if(R==w.a.NCX)if(R=w.a.XHTML,"ncx"==L||"navPoint"==L)L="div";else if("navLabel"==L){L="span";const e=s.parentNode;if(e){let t=null;for(let n=e.firstChild;n;n=n.nextSibling){if(1!=n.nodeType)continue;const e=n;if(e.namespaceURI==w.a.NCX&&"content"==e.localName){t=e.getAttribute("src");break}}t&&(L="a",(s=s.ownerDocument.createElementNS(R,"a")).setAttribute("href",t))}}else L="span";else R==w.a.SHADOW?(R=w.a.XHTML,L=n.nodeContext.inline?"span":"div"):P=!!n.customRenderer;if(S)e?L="li":(L="div",u=G.t.block,l.display=u);else if("body"==L||"li"==L)L="div";else if("q"==L)L="span";else if("a"==L){const e=l["hyperlink-processing"];e&&"normal"!=e.toString()&&(L="span")}if(l.behavior&&"none"!=l.behavior.toString()&&n.customRenderer&&(P=!0),s.dataset&&"true"===s.getAttribute("data-math-typeset")&&(P=!0),P){const e=n.nodeContext.parent?n.nodeContext.parent.viewNode:null;k=n.customRenderer(s,e,l)}else k=W.d(null);k.then(r=>{r?P&&(i="true"==r.getAttribute("data-adapt-process-children")):r=n.createElement(R,L),"a"==L&&r.addEventListener("click",n.page.hrefHandler,!1),A&&(n.applyPseudoelementStyle(n.nodeContext,"inner",A),r.appendChild(A)),"iframe"==r.localName&&r.namespaceURI==w.a.XHTML&&function(e){e.addEventListener("load",()=>{e.contentWindow.navigator.epubReadingSystem={name:"adapt",version:"0.1",layoutStyle:"paginated",hasFeature:function(e,t){switch(e){case"mouse-events":return!0}return!1}}},!1)}(r);const a=n.nodeContext.inheritedProps["image-resolution"],c=[],h=l.width,u=l.height,d=s.getAttribute("width"),p=s.getAttribute("height"),f=h===G.t.auto||!h&&!d,g=u===G.t.auto||!u&&!p;if(s.namespaceURI!=w.a.FB2||"td"==L){const t=s.attributes,i=t.length;let o=null;for(let s=0;s<i;s++){const i=t[s],a=i.namespaceURI;let l=i.localName,h=i.nodeValue;if(a){if("http://www.w3.org/2000/xmlns/"==a)continue;a==w.a.XLINK&&"href"==l&&(h=n.resolveURL(h))}else{if(l.match(/^on/))continue;if("style"==l)continue;if(("id"==l||"name"==l)&&e){h=n.documentURLTransformer.transformFragment(h,n.xmldoc.url),r.setAttribute(l,h),n.page.registerElementWithId(r,h);continue}if("src"==l||"href"==l||"poster"==l?(h=n.resolveURL(h),"href"===l&&(h=n.documentURLTransformer.transformURL(h,n.xmldoc.url))):"srcset"==l&&(h=h.split(",").map(e=>n.resolveURL(e.trim())).join(",")),"poster"===l&&"video"===L&&R===w.a.XHTML&&f&&g){const e=new Image,t=Vt.b(e,h);O.push(t),c.push({image:e,element:r,fetcher:t})}}if(R==w.a.SVG&&/^[A-Z\-]+$/.test(l)&&(l=l.toLowerCase()),n.isSVGUrlAttribute(l)&&(h=ui(h,n.xmldoc.url,n.documentURLTransformer)),a){const e=di[a];e&&(l=`${e}:${l}`)}"src"!=l||a||"img"!=L&&"input"!=L||R!=w.a.XHTML?"href"==l&&"image"==L&&R==w.a.SVG&&a==w.a.XLINK?n.page.fetchers.push(Vt.b(r,h)):a?r.setAttributeNS(a,l,h):r.setAttribute(l,h):o=h}if(o){const e="input"===L?new Image:r,t=Vt.b(e,o);e!==r&&(r.src=o),f||g?(f&&g&&a&&1!==a&&c.push({image:e,element:r,fetcher:t}),O.push(t)):n.page.fetchers.push(t)}}delete l.content;const m=l["list-style-image"];if(m&&m instanceof G.l){const e=m.url;O.push(Vt.b(new Image,e))}if(n.preprocessElementStyle(l),n.applyComputedStyles(r,l),!n.nodeContext.inline){let i=null;if(e?t&&(i=n.nodeContext.vertical?mi:gi):i="clone"!==n.nodeContext.inheritedProps["box-decoration-break"]?n.nodeContext.vertical?fi:pi:n.nodeContext.vertical?mi:gi,i)for(const e in i)w.F(r,e,i[e])}S&&r.setAttribute("value",l["ua-list-item-count"].stringValue()),n.viewNode=r,O.length?Vt.c(O).then(()=>{a>0&&n.modifyElemDimensionWithImageResolution(c,a,l,n.nodeContext.vertical),o.finish(i)}):o.timeSlice().then(()=>{o.finish(i)})})}),o.result()}processAfterIfcontinues(e,t,n,i){const o=this.getPseudoMap(t,this.regionIds,this.isFootnote,this.nodeContext,i);if(o&&o["after-if-continues"]&&o["after-if-continues"].content){const o=new hi.b(e,t,n,i,this.exprContentListener);this.nodeContext.afterIfContinues=new ne.a(e,o)}}isSVGUrlAttribute(e){return bi.SVG_URL_ATTRIBUTES.includes(e.toLowerCase())}modifyElemDimensionWithImageResolution(e,t,n,i){const o=this;e.forEach(e=>{if("load"===e.fetcher.get().get()){const s=e.image;let r=s.width/t,a=s.height/t;const l=e.element;if(r>0&&a>0)if(n["box-sizing"]===G.t.border_box&&(n["border-left-style"]!==G.t.none&&(r+=G.x(n["border-left-width"],o.context)),n["border-right-style"]!==G.t.none&&(r+=G.x(n["border-right-width"],o.context)),n["border-top-style"]!==G.t.none&&(a+=G.x(n["border-top-width"],o.context)),n["border-bottom-style"]!==G.t.none&&(a+=G.x(n["border-bottom-width"],o.context))),t>1){const e=n["max-width"]||G.t.none,t=n["max-height"]||G.t.none;if(e===G.t.none&&t===G.t.none)w.F(l,"max-width",`${r}px`);else if(e!==G.t.none&&t===G.t.none)w.F(l,"width",`${r}px`);else if(e===G.t.none&&t!==G.t.none)w.F(l,"height",`${a}px`);else{b.a(e.isNumeric()),b.a(t.isNumeric());const n=e,s=t;"%"!==n.unit?w.F(l,"max-width",`${Math.min(r,G.x(n,o.context))}px`):"%"!==s.unit?w.F(l,"max-height",`${Math.min(a,G.x(s,o.context))}px`):i?w.F(l,"height",`${a}px`):w.F(l,"width",`${r}px`)}}else if(t<1){const e=n["min-width"]||G.u,t=n["min-height"]||G.u;b.a(e.isNumeric()),b.a(e.isNumeric());const s=e,c=t;0===s.num&&0===c.num?w.F(l,"min-width",`${r}px`):0!==s.num&&0===c.num?w.F(l,"width",`${r}px`):0===s.num&&0!==c.num?w.F(l,"height",`${a}px`):"%"!==s.unit?w.F(l,"min-width",`${Math.max(r,G.x(s,o.context))}px`):"%"!==c.unit?w.F(l,"min-height",`${Math.max(a,G.x(c,o.context))}px`):i?w.F(l,"height",`${a}px`):w.F(l,"width",`${r}px`)}}})}preprocessElementStyle(e){const t=this;l.b(l.a.PREPROCESS_ELEMENT_STYLE).forEach(n=>{n(t.nodeContext,e)})}findAndProcessRepeatingElements(e,t){for(let n=e.firstChild;n;n=n.nextSibling){if(1!==n.nodeType)continue;const e={},i=t.getStyle(n,!1);if(this.computeStyle(this.nodeContext.vertical,"rtl"===this.nodeContext.direction,i,e),!this.processRepeatOnBreak(e))continue;if(this.nodeContext.formattingContext instanceof se&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;const o=this.nodeContext.parent,s=o&&o.formattingContext;return this.nodeContext.formattingContext=new se(s,this.nodeContext.sourceNode),void this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical)}}processRepeatOnBreak(e){let t=e["repeat-on-break"];return t!==G.t.none&&(t===G.t.auto&&(t=e.display===G.t.table_header_group?G.t.header:e.display===G.t.table_footer_group?G.t.footer:G.t.none),t&&t!==G.t.none)?t.toString():null}createTextNodeView(){const e=this,t=W.c("createTextNodeView");return this.preprocessTextContent().then(()=>{const n=e.offsetInNode||0,i=li.d(e.nodeContext.preprocessedTextContent).substr(n);e.viewNode=document.createTextNode(i),t.finish(!0)}),t.result()}preprocessTextContent(){if(null!=this.nodeContext.preprocessedTextContent)return W.d(!0);const e=this;let t,n=t=e.sourceNode.textContent;const i=W.c("preprocessTextContent"),o=l.b(l.a.PREPROCESS_TEXT_CONTENT);let s=0;return i.loop(()=>s>=o.length?W.d(!1):o[s++](e.nodeContext,n).thenAsync(e=>(n=e,W.d(!0)))).then(()=>{e.nodeContext.preprocessedTextContent=li.a(t,n),i.finish(!0)}),i.result()}createNodeView(e,t){const n=this,i=W.c("createNodeView");let o,s=!0;return 1==n.sourceNode.nodeType?o=n.createElementView(e,t):8==n.sourceNode.nodeType?(n.viewNode=null,o=W.d(!0)):o=n.createTextNodeView(),o.then(e=>{if(s=e,n.nodeContext.viewNode=n.viewNode,n.viewNode){const e=n.nodeContext.parent?n.nodeContext.parent.viewNode:n.viewRoot;e&&e.appendChild(n.viewNode)}i.finish(s)}),i.result()}setCurrent(e,t,n){return this.nodeContext=e,e?(this.sourceNode=e.sourceNode,this.offsetInNode=e.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(t,!!n):W.d(!0)}processShadowContent(e){if(null==e.shadowContext||"content"!=e.sourceNode.localName||e.sourceNode.namespaceURI!=w.a.SHADOW)return e;const t=e.boxOffset,n=e.shadowContext,i=e.parent;let o,s,r;n.subShadow?(r=n.subShadow,o=n.root,(s=n.type)==X.o.ROOTLESS&&(o=o.firstChild)):(r=n.parentShadow,o=n.owner.firstChild,s=X.o.ROOTLESS);const a=e.sourceNode.nextSibling;if(a?(e.sourceNode=a,e.resetView()):e.shadowSibling?e=e.shadowSibling:o?e=null:(e=e.parent.modify()).after=!0,o){const n=new X.k(o,i,t);return n.shadowContext=r,n.shadowType=s,n.shadowSibling=e,n}return e.boxOffset=t,e}nextPositionInTree(e){let t=e.boxOffset+1;if(e.after){if(!e.parent)return null;if(e.shadowType!=X.o.ROOTED){const n=e.sourceNode.nextSibling;if(n)return(e=e.modify()).boxOffset=t,e.sourceNode=n,e.resetView(),this.processShadowContent(e)}return e.shadowSibling?((e=e.shadowSibling.modify()).boxOffset=t,e):((e=e.parent.modify()).boxOffset=t,e.after=!0,e)}{if(e.nodeShadow){let n=e.nodeShadow.root;if(e.nodeShadow.type==X.o.ROOTLESS&&(n=n.firstChild),n){const i=new X.k(n,e,t);return i.shadowContext=e.nodeShadow,i.shadowType=e.nodeShadow.type,this.processShadowContent(i)}}const n=e.sourceNode.firstChild;return n?this.processShadowContent(new X.k(n,e,t)):(1!=e.sourceNode.nodeType&&(t+=li.d(e.preprocessedTextContent).length-1-e.offsetInNode),(e=e.modify()).boxOffset=t,e.after=!0,e)}}isTransclusion(e,t,n){const i=U.s(t,"hyperlink-processing");if(!i)return!1;const o=i.evaluate(this.context,"hyperlink-processing");return!!o&&o.toString()==n}nextInTree(e,t){let n=this.nextPositionInTree(e);if(!n||n.after)return W.d(n);const i=W.c("nextInTree");return this.setCurrent(n,!0,t).then(e=>{n.viewNode&&e||((n=n.modify()).after=!0,n.viewNode||(n.inline=!0)),this.dispatchEvent({type:"nextInTree",nodeContext:n}),i.finish(n)}),i.result()}addImageFetchers(e){if(e instanceof G.b){const t=e.values;for(let e=0;e<t.length;e++)this.addImageFetchers(t[e])}else if(e instanceof G.l){const t=e.url;this.page.fetchers.push(Vt.b(new Image,t))}}applyComputedStyles(e,t){const n=t["background-image"];n&&this.addImageFetchers(n);const i=t.position===G.t.relative;for(const n in t){if(Ei[n])continue;let o=t[n];(o=o.visit(new O.a(this.xmldoc.url,this.documentURLTransformer))).isNumeric()&&k.O(o.unit)&&(o=G.n(o,this.context)),X.s[n]||i&&X.t[n]?this.page.delayedItems.push(new X.d(e,n,o)):w.F(e,n,o.toString())}}applyPseudoelementStyle(e,t,n){if(e.after)return;const i=this.sourceNode;let o=(e.shadowContext?e.shadowContext.styler:this.styler).getStyle(i,!1);const s=U.u(o,"_pseudos");if(!s)return;if(!(o=s[t]))return;const r={};e.vertical=this.computeStyle(e.vertical,"rtl"===e.direction,o,r);const a=r.content;X.y(a)&&(a.visit(new X.c(n,this.context,a,this.exprContentListener)),delete r.content),this.applyComputedStyles(n,r)}peelOff(e,t){const n=W.c("peelOff"),i=e.firstPseudo;let o=e.offsetInNode;const s=e.after;if(t>0){const n=e.viewNode.textContent;e.viewNode.textContent=n.substr(0,t),o+=t}else if(!s&&e.viewNode&&0==o){const t=e.viewNode.parentNode;t&&t.removeChild(e.viewNode)}const r=e.boxOffset+t,a=[];for(;e.firstPseudo===i;)a.push(e),e=e.parent;let l=a.pop(),c=l.shadowSibling;const h=this;return n.loop(()=>{for(;a.length>0;){l=a.pop(),e=new X.k(l.sourceNode,e,r),0==a.length&&(e.offsetInNode=o,e.after=s),e.shadowType=l.shadowType,e.shadowContext=l.shadowContext,e.nodeShadow=l.nodeShadow,e.shadowSibling=l.shadowSibling?l.shadowSibling:c,c=null;const t=h.setCurrent(e,!1);if(t.isPending())return t}return W.d(!1)}).then(()=>{n.finish(e)}),n.result()}createElement(e,t){return e==w.a.XHTML?this.document.createElement(t):this.document.createElementNS(e,t)}applyFootnoteStyle(e,t,n){const i={},o=U.u(this.footnoteStyle,"_pseudos");if(e=this.computeStyle(e,t,this.footnoteStyle,i),o&&o.before){const i={},s=this.createElement(w.a.XHTML,"span");hi.f(s,"before"),n.appendChild(s),this.computeStyle(e,t,o.before,i),delete i.content,this.applyComputedStyles(s,i)}return delete i.content,this.applyComputedStyles(n,i),e}processFragmentedBlockEdge(e){e&&e.walkUpBlocks(e=>{const t=e.inheritedProps["box-decoration-break"];if(!t||"slice"===t){const t=e.viewNode;b.a(t instanceof Element),e.vertical?(w.F(t,"padding-left","0"),w.F(t,"border-left","none"),w.F(t,"border-top-left-radius","0"),w.F(t,"border-bottom-left-radius","0")):(w.F(t,"padding-bottom","0"),w.F(t,"border-bottom","none"),w.F(t,"border-bottom-left-radius","0"),w.F(t,"border-bottom-right-radius","0"))}})}convertLengthToPx(e,t,n){const i=e.num,o=e.unit;if(k.J(o)){let i=t;for(;i&&1!==i.nodeType;)i=i.parentNode;b.a(i);const o=parseFloat(n.getElementComputedStyle(i)["font-size"]);return b.a(this.context),U.j(e,o,this.context).num}{const t=this.context.queryUnitSize(o,!1);return t?i*t:e}}isSameNodePositionStep(e,t){if(e.shadowContext){if(!t.shadowContext)return!1;const n=1===e.node.nodeType?e.node:e.node.parentElement,i=1===t.node.nodeType?t.node:t.node.parentElement;return e.shadowContext.owner===t.shadowContext.owner&&hi.d(n)===hi.d(i)}return e.node===t.node}isSameNodePosition(e,t){return e.offsetInNode===t.offsetInNode&&e.after==t.after&&e.steps.length===t.steps.length&&e.steps.every((e,n)=>{const i=t.steps[n];return this.isSameNodePositionStep(e,i)})}isPseudoelement(e){return!!hi.d(e)}}bi.SVG_URL_ATTRIBUTES=["color-profile","clip-path","cursor","filter","marker","marker-start","marker-end","marker-mid","fill","stroke","mask"];const wi={a:"a",sub:"sub",sup:"sup",table:"table",tr:"tr",td:"td",th:"th",code:"code",body:"div",p:"p",v:"p",date:"p",emphasis:"em",strong:"strong",style:"span",strikethrough:"del"},Ei={"box-decoration-break":!0,"float-min-wrap-block":!0,"float-reference":!0,"flow-into":!0,"flow-linger":!0,"flow-options":!0,"flow-priority":!0,"footnote-policy":!0,page:!0};class yi{constructor(e){this.layoutBox=e.layoutBox,this.window=e.window}subtractOffsets(e,t){const n=t.left,i=t.top;return{left:e.left-n,top:e.top-i,right:e.right-n,bottom:e.bottom-i,width:e.width,height:e.height}}getRangeClientRects(e){const t=e.getClientRects(),n=this.layoutBox.getBoundingClientRect();return Array.from(t).map(e=>this.subtractOffsets(e,n))}getElementClientRect(e){const t=e.getBoundingClientRect(),n=this.layoutBox.getBoundingClientRect();return this.subtractOffsets(t,n)}getElementComputedStyle(e){return this.window.getComputedStyle(e,null)}}class Si{constructor(e,t,n,i,o){this.window=e,this.fontSize=t,this.document=e.document,this.root=n||this.document.body;let s=this.root.firstElementChild;s||((s=this.document.createElement("div")).setAttribute("data-vivliostyle-outer-zoom-box","true"),this.root.appendChild(s));let r=s.firstElementChild;r||((r=this.document.createElement("div")).setAttribute("data-vivliostyle-spread-container","true"),s.appendChild(r));let a=s.nextElementSibling;a||((a=this.document.createElement("div")).setAttribute("data-vivliostyle-layout-box","true"),this.root.appendChild(a)),this.outerZoomBox=s,this.contentContainer=r,this.layoutBox=a;const l=new yi(this).getElementComputedStyle(this.root);this.width=i||parseFloat(l.width)||e.innerWidth,this.height=o||parseFloat(l.height)||e.innerHeight}resetZoom(){w.F(this.outerZoomBox,"width",""),w.F(this.outerZoomBox,"height",""),w.F(this.contentContainer,"width",""),w.F(this.contentContainer,"height",""),w.F(this.contentContainer,"transform","")}zoom(e,t,n){w.F(this.outerZoomBox,"width",`${e*n}px`),w.F(this.outerZoomBox,"height",`${t*n}px`),w.F(this.contentContainer,"width",`${e}px`),w.F(this.contentContainer,"height",`${t}px`),w.F(this.contentContainer,"transform",`scale(${n})`)}clear(){const e=this.root;for(;e.lastChild;)e.removeChild(e.lastChild)}}const Ni="data-adapt-eloff";class Ci{constructor(e,t,n){this.store=e,this.url=t,this.document=n,this.lang=null,this.totalOffset=-1,this.lastOffset=1,this.root=n.documentElement;let i=null,o=null;if(this.root.namespaceURI==w.a.XHTML){for(let e=this.root.firstChild;e;e=e.nextSibling){if(1!=e.nodeType)continue;const t=e;if(t.namespaceURI==w.a.XHTML)switch(t.localName){case"head":o=t;break;case"body":i=t}}this.lang=this.root.getAttribute("lang")}else if(this.root.namespaceURI==w.a.FB2){o=this.root;for(let e=this.root.firstChild;e;e=e.nextSibling){if(1!=e.nodeType)continue;const t=e;t.namespaceURI==w.a.FB2&&"body"==t.localName&&(i=t)}const e=this.doc().child("FictionBook").child("description").child("title-info").child("lang").textContent();e.length>0&&(this.lang=e[0])}else if(this.root.namespaceURI==w.a.SSE)for(let e=this.root.firstElementChild;e;e=e.nextElementSibling){const t=e.localName;"meta"===t?o=e:"body"===t&&(i=e)}this.body=i,this.head=o,this.last=this.root,this.last.setAttribute(Ni,"0")}doc(){return new Ai([this.document])}getElementOffset(e){const t=e.getAttribute(Ni);if(t)return parseInt(t,10);let n=this.lastOffset,i=this.last;for(;i!=e;){let e=i.firstChild;if(!e)for(;!(e=i.nextSibling);)if(null==(i=i.parentNode))throw new Error("Internal error");i=e,1==e.nodeType?(e.setAttribute(Ni,n.toString()),++n):n+=e.textContent.length}return this.lastOffset=n,this.last=e,n-1}getNodeOffset(e,t,n){let i=0,o=e,s=null;if(1==o.nodeType){if(!n)return this.getElementOffset(o)}else{if(i=t,!(s=o.previousSibling))return o=o.parentNode,i+=1,this.getElementOffset(o)+i;o=s}for(;;){for(;o.lastChild;)o=o.lastChild;if(1==o.nodeType)break;if(i+=o.textContent.length,!(s=o.previousSibling)){o=o.parentNode;break}o=s}return i+=1,this.getElementOffset(o)+i}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(e){let t;const n=this;let i=this.root;for(;;){if((t=this.getElementOffset(i))>=e)return i;const o=i.children;if(!o)break;const s=w.i(o.length,t=>{const i=o[t];return n.getElementOffset(i)>e});if(0==s)break;i=o[s-1]}let o=t+1,s=i,r=s.firstChild||s.nextSibling,a=null;for(;;){if(r){if(1==r.nodeType)break;if(a=s=r,(o+=r.textContent.length)>e)break}else if(!(s=s.parentNode))break;r=s.nextSibling}return a||i}buildIdMap(e){const t=e.getAttribute("id");t&&!this.idMap[t]&&(this.idMap[t]=e);const n=e.getAttributeNS(w.a.XML,"id");n&&!this.idMap[n]&&(this.idMap[n]=e);for(let t=e.firstElementChild;t;t=t.nextElementSibling)this.buildIdMap(t)}getElement(e){const t=e.match(/([^#]*)#(.+)$/);if(!t||t[1]&&t[1]!=this.url)return null;const n=t[2];let i=this.document.getElementById(n);return!i&&this.document.getElementsByName&&(i=this.document.getElementsByName(n)[0]),i||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),i=this.idMap[n]),i}}var vi;function Ti(e,t,n){const i=n||new DOMParser;let o;try{o=i.parseFromString(e,t)}catch(e){}if(!o)return null;{const e=o.documentElement,t="parsererror";if(e.localName===t)return null;for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(n.localName===t)return null}return o}function xi(e,t){let n=e.responseXML;if(!n){const t=new DOMParser,i=e.responseText;if(i){const o=function(e){const t=e.contentType;if(t){const e=Object.keys(vi);for(let n=0;n<e.length;n++)if(vi[e[n]]===t)return t;if(t.match(/\+xml$/))return vi.APPLICATION_XML}const n=e.url.match(/\.([^./]+)$/);if(n)switch(n[1]){case"html":case"htm":return vi.TEXT_HTML;case"xhtml":case"xht":return vi.APPLICATION_XHTML_XML;case"svg":case"svgz":return vi.IMAGE_SVG_XML;case"opf":case"xml":return vi.APPLICATION_XML}return null}(e);if((n=Ti(i,o||vi.APPLICATION_XML,t))&&!o){const e=n.documentElement;"html"!==e.localName.toLowerCase()||e.namespaceURI?"svg"===e.localName.toLowerCase()&&n.contentType!==vi.IMAGE_SVG_XML&&(n=Ti(i,vi.IMAGE_SVG_XML,t)):n=Ti(i,vi.TEXT_HTML,t)}n||(n=Ti(i,vi.TEXT_HTML,t))}}const i=n?new Ci(t,e.url,n):null;return W.d(i)}!function(e){e.TEXT_HTML="text/html",e.TEXT_XML="text/xml",e.APPLICATION_XML="application/xml",e.APPLICATION_XHTML_XML="application/xhtml_xml",e.IMAGE_SVG_XML="image/svg+xml"}(vi||(vi={}));class Ii{constructor(e){this.fn=e}check(e){return this.fn(e)}withAttribute(e,t){const n=this;return new Ii(i=>n.check(i)&&1==i.nodeType&&i.getAttribute(e)==t)}withChild(e,t){const n=this;return new Ii(i=>{if(!n.check(i))return!1;let o=new Ai([i]);return o=o.child(e),t&&(o=o.predicate(t)),o.size()>0})}}const Pi=new Ii(e=>!0);class Ai{constructor(e){this.nodes=e}asArray(){return this.nodes}size(){return this.nodes.length}predicate(e){const t=[];for(const n of this.nodes)e.check(n)&&t.push(n);return new Ai(t)}forEachNode(e){const t=[],n=e=>{t.push(e)};for(let t=0;t<this.nodes.length;t++)e(this.nodes[t],n);return new Ai(t)}forEach(e){const t=[];for(let n=0;n<this.nodes.length;n++)t.push(e(this.nodes[n]));return t}forEachNonNull(e){const t=[];for(let n=0;n<this.nodes.length;n++){const i=e(this.nodes[n]);null!=i&&t.push(i)}return t}child(e){return this.forEachNode((t,n)=>{for(let i=t.firstChild;i;i=i.nextSibling)1==i.nodeType&&i.localName==e&&n(i)})}childElements(){return this.forEachNode((e,t)=>{for(let n=e.firstChild;n;n=n.nextSibling)1==n.nodeType&&t(n)})}attribute(e){return this.forEachNonNull(t=>1==t.nodeType?t.getAttribute(e):null)}textContent(){return this.forEach(e=>e.textContent)}}var Oi='@namespace html "http://www.w3.org/1999/xhtml";\n@namespace fb2 "http://www.gribuser.ru/xml/fictionbook/2.0";\n\nhtml|body, fb2|body {\n  hyphens: -epubx-expr(pref-hyphenate?"auto":"manual");\n}\n\n@-adapt-footnote-area {\n  display: block;\n  margin-block-start: 0.5em;\n  margin-block-end: 0.5em;\n}\n\n@-adapt-footnote-area ::before {\n  display: block;\n  border-block-start-width: 1px;\n  border-block-start-style: solid;\n  border-block-start-color: black;\n  margin-block-end: 0.4em;\n  margin-inline-start: 0;\n  margin-inline-end: 60%;\n}\n\n/* default page master */\n@-epubx-page-master :background-host {\n  @-epubx-partition :layout-host {\n    -epubx-flow-from: body;\n    top: -epubx-expr(header.margin-bottom-edge);\n    bottom: -epubx-expr(page-height - footer.margin-top-edge);\n    left: 0px;\n    right: 0px;\n    column-width: 25em;\n  }\n  @-epubx-partition footer :oeb-page-foot {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-foot;\n    bottom: 0px;\n    left: 0px;\n    right: 0px;\n  }\n  @-epubx-partition header :oeb-page-head {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-head;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n  }\n}\n\n@page {\n  @top-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @top-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @top-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @left-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @left-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @left-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @right-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @right-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @right-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @bottom-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @bottom-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @bottom-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n}\n\n@media print {\n  @page {\n    margin: 10%;\n  }\n}\n';const ki=new Vt.a(()=>{const e=W.c("uaStylesheetBase"),t=zt(),n=w.C("user-agent-base.css",w.D),i=new U.b(null,null,null,null,null,t,!0);return i.startStylesheet(z.g.USER_AGENT),U.G(i.cascade),z.k('@namespace html "http://www.w3.org/1999/xhtml";\n\nhtml|html, html|address, html|blockquote, html|body, html|dd, html|div,\nhtml|dl, html|dt, html|fieldset, html|form, html|frame, html|frameset,\nhtml|h1, html|h2, html|h3, html|h4, html|h5, html|h6, html|noframes,\nhtml|ol, html|p, html|ul, html|center, html|dir, html|hr, html|menu, html|pre,\nhtml|article, html|section, html|nav, html|aside, html|hgroup, html|footer, html|header,\nhtml|figure, html|figcaption, html|main {\n   display: block;\n   unicode-bidi: normal;\n}\nhtml|li {\n  display: list-item;\n}\nhtml|head {\n  display: none !important;\n}\nhtml|table {\n  display: table;\n}\nhtml|tr {\n  display: table-row;\n}\nhtml|thead {\n  display: table-header-group;\n  break-after: avoid;\n}\nhtml|tbody {\n  display: table-row-group;\n}\nhtml|tfoot {\n  display: table-footer-group;\n  break-before: avoid;\n}\nhtml|col {\n  display: table-column;\n}\nhtml|colgroup {\n  display: table-column-group;\n}\nhtml|td, html|th {\n  display: table-cell;\n}\nhtml|caption {\n  display: table-caption;\n  text-align: center;\n}\nhtml|th {\n  font-weight: bolder;\n  text-align: center;\n}\nhtml|script {\n  display: none;\n}\nhtml|body {\n  margin: 8px;\n}\nhtml|h1 {\n  font-size: 2em;\n  margin-block-start: 0.67em;\n  margin-block-end: 0.67em;\n  margin-inline-start: 0em;\n  margin-inline-end: 0em;\n}\nhtml|h2 {\n  font-size: 1.5em;\n  margin-block-start: 0.75em;\n  margin-block-end: 0.75em;\n  margin-inline-start: 0em;\n  margin-inline-end: 0em;\n}\nhtml|h3 {\n  font-size: 1.17em;\n  margin-block-start: 0.83em;\n  margin-block-end: 0.83em;\n  margin-inline-start: 0em;\n  margin-inline-end: 0em;\n}\nhtml|h4, html|p, html|blockquote, html|ul, html|fieldset,\nhtml|form, html|ol, html|dl, html|dir, html|menu, html|h5, html|h6 {\n  margin-block-start: 1em;\n  margin-block-end: 1em;\n  margin-inline-start: 0em;\n  margin-inline-end: 0em;\n}\nhtml|h5 {\n  font-size: .83em;\n}\nhtml|h6 {\n  font-size: .75em;\n}\nhtml|h1, html|h2, html|h3, html|h4, html|h5, html|h6, html|b, html|strong {\n  font-weight: bolder;\n}\nhtml|h1, html|h2, html|h3, html|h4, html|h5, html|h6 {\n  break-after: avoid;\n}\nhtml|blockquote {\n  margin-block-start: 0px;\n  margin-block-end: 0px;\n  margin-inline-start: 40px;\n  margin-inline-end: 40px;\n}\nhtml|i, html|cite, html|em, html|var, html|address {\n  font-style: italic;\n}\nhtml|pre, html|tt, html|code, html|kbd, html|samp {\n  font-family: monospace;\n}\nhtml|pre {\n  white-space: pre;\n}\nhtml|button, html|textarea, html|input, html|select {\n  display: inline-block;\n}\nhtml|big {\n  font-size: 1.17em;\n}\nhtml|small, html|sub, html|sup {\n  font-size: .83em;\n}\nhtml|sub {\n  vertical-align: sub;\n}\nhtml|sup {\n  vertical-align: super;\n}\nhtml|table {\n  border-spacing: 2px;\n}\nhtml|thead, html|tbody, html|tfoot {\n  vertical-align: middle;\n}\n/* for XHTML tables without tbody */\nhtml|table > html|tr {\n  vertical-align: middle;\n}\nhtml|td, html|th {\n  vertical-align: inherit;\n}\nhtml|s, html|strike, html|del {\n  text-decoration: line-through;\n}\nhtml|hr {\n  border: 1px inset;\n}\nhtml|ol, html|ul, html|dir, html|menu, html|dd {\n  margin: 0px;\n  margin-inline-start: 40px;\n}\nhtml|ol {\n  list-style-type: decimal;\n}\nhtml|ol html|ul, html|ul html|ol, html|ul html|ul, html|ol html|ol {\n  margin-top: 0;\n  margin-bottom: 0;\n}\nhtml|u, html|ins {\n  text-decoration: underline;\n}\nhtml|center {\n  text-align: center;\n}\nhtml|q:before {\n  content: open-quote;\n}\nhtml|q:after {\n  content: close-quote;\n}\n\nhtml|audio, html|video {\n  break-inside: avoid;\n}\n\nhtml|ruby {\n  display: ruby;\n}\nhtml|rp {\n  display: none;\n}\nhtml|rbc {\n  display: ruby-base-container;\n}\nhtml|rtc {\n  display: ruby-text-container;\n}\nhtml|rb {\n  display: ruby-base;\n  white-space: nowrap;\n}\nhtml|rt {\n  display: ruby-text;\n}\nhtml|ruby, html|rb, html|rt, html|rbc, html|rtc {\n  unicode-bidi: isolate;\n}\n\nhtml|rtc, html|rt {\n  font-variant-east-asian: ruby;\n  text-emphasis: none;\n  white-space: nowrap;\n  line-height: 1;\n}\n\nhtml|rtc:lang(zh), html|rt:lang(zh) {\n  ruby-align: center;\n}\n\nhtml|rtc, html|rt {\n  font-size: 50%;\n}\n\nhtml|rtc:lang(zh-TW), html|rt:lang(zh-TW) {\n  font-size: 30%;\n}\n\nhtml|rtc > html|rt, html|rtc > html|rt:lang(zh-TW) {\n  font-size: 100%;\n}\n\n/* Bidi settings */\nhtml|bdo[dir="ltr"] {\n  direction: ltr;\n  unicode-bidi: bidi-override;\n}\nhtml|bdo[dir="rtl"] {\n  direction: rtl;\n  unicode-bidi: bidi-override;\n}\nhtml|*[dir="ltr"] {\n  direction: ltr;\n  unicode-bidi: embed;\n}\nhtml|*[dir="rtl"] {\n  direction: rtl;\n  unicode-bidi: embed;\n}\n\n/*------------------ epub-specific ---------------------*/\n\n@namespace epub "http://www.idpf.org/2007/ops";\n\nhtml|a[epub|type="noteref"] {\n  font-size: 0.75em;\n  vertical-align: super;\n  line-height: 0.01;\n}\n\nhtml|a[epub|type="noteref"]:href-epub-type(footnote) {\n  -adapt-template: url(user-agent.xml#footnote);\n  text-decoration: none;\n}\n\nhtml|aside[epub|type="footnote"] {\n  display: none;\n}\n\nhtml|aside[epub|type="footnote"]:footnote-content {\n  display: block;\n  margin: 0.25em;\n  font-size: 1.2em;\n  line-height: 1.2;\n}\n\nepub|trigger {\n  display: none;\n}\n\nepub|switch {\n  display: inline;\n}\n\nepub|default {\n  display: inline;\n}\n\nepub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] {\n  display: inline;\n}\n\nepub|case[required-namespace::supported] ~ epub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] ~ epub|default {\n  display: none;\n}\n\n/*--------------- ncx and toc ----------------------*/\n\n@namespace ncx "http://www.daisy.org/z3986/2005/ncx/";\n\nncx|ncx {\n  display: block;\n  padding-top: 10px;\n  padding-bottom: 10px;\n}\n\nncx|content {\n  display: none;\n}\n\nbody > * {\n  -adapt-behavior: body-child;\n}\n\n[role=doc-toc], [role=directory], nav, .toc, #toc,\n#table-of-contents, #contents {\n  -adapt-behavior: toc-root;\n}\n\n[role=doc-toc] a,\n[role=directory] a,\nnav a,\n.toc a,\n#toc a,\nncx|navLabel {\n  -adapt-behavior: toc-node-anchor;\n}\n\n[role=doc-toc] li,\n[role=directory] li,\nnav li,\n.toc li,\n#toc li,\nncx|navPoint {\n  -adapt-behavior: toc-node;\n}\n\n[role=doc-toc] li > *:first-child,\n[role=directory] li > *:first-child,\nnav li > *:first-child,\n.toc li > *:first-child,\n#toc li > *:first-child {\n  -adapt-behavior: toc-node-first-child;\n}\n\n[role=doc-toc] ol,\n[role=directory] ol,\nnav ol,\n.toc ol,\n#toc ol,\n[role=doc-toc] ul,\n[role=directory] ul,\nnav ul,\n.toc ul,\n#toc ul,\nol[role=doc-toc],\nol[role=directory],\nol.toc,\nol#toc,\nul[role=doc-toc],\nul[role=directory],\nul.toc,\nul#toc {\n  -adapt-behavior: toc-container;\n}\n\n/*---------------- fb2 ---------------------*/\n\n@namespace fb2 "http://www.gribuser.ru/xml/fictionbook/2.0";\n\nfb2|FictionBook {\n  display: block;\n}\n\nfb2|body {\n  font-family: serif;\n  margin: 8px;\n  column-width: 25em;\n}\n\nfb2|a {\n  line-height: 0.1;\n  vertical-align: super;\n  font-size: 0.7em;\n}\n\nfb2|sub {\n  line-height: 0.1;\n  font-size: 0.7em;\n}\n\nfb2|sup {\n  line-height: 0.1;\n  font-size: 0.7em;\n}\n\nfb2|table {\n  display: table;\n  font-size: 0.8em;\n  font-family: sans-serif;\n  margin: 0.5em;\n  border-collapse: collapse;\n  border: 1px solid black;\n}\n\nfb2|td {\n  border: 1px solid black;\n  padding: 0.3em;\n}\n\nfb2|th {\n  font-weight: bold;\n  text-align: center;\n  border: 1px solid black;\n  background-color: #CEE;\n  padding: 0.3em;\n}\n\nfb2|code {\n  font-family: monospace;\n}\n\nfb2|p {\n  display: block;\n  margin: 0px;\n  text-indent: 1.5em;\n  text-align: justify;\n}\n\nfb2|title fb2|p {\n  margin: 0px 0px 0.5em 0px;\n  text-indent: 0px;\n  text-align: inherit;\n}\n\nfb2|title {\n  font-size: 2.2em;\n  font-weight: bold;\n  break-inside: avoid;\n  break-after: avoid;\n  text-align: center;\n  margin: 1em 0px 0.5em 0px;\n  display: block;\n}\n\nfb2|section {\n  display: block;\n}\n\nfb2|section fb2|title {\n  font-size: 1.8em;\n  text-align: center;\n  margin: 1em 0px 0.5em 0px;\n}\n\nfb2|section fb2|section fb2|title {\n  font-size: 1.5em;\n  text-align: left;\n  margin: 1em 0px 0.5em 1.5625em;\n}\n\nfb2|section fb2|section fb2|section fb2|title {\n  font-size: 1.3em;\n  text-align: left;\n  margin: 1em 0px 0.5em 1.923em;\n}\n\nfb2|section fb2|section fb2|section fb2|section fb2|title {\n  font-size: 1.2em;\n  text-align: left;\n  margin: 1em 0px 0.5em 2.083em;\n}\n\nfb2|section fb2|section fb2|section fb2|section fb2|section fb2|title {\n  font-size: 1.1em;\n  text-align: left;\n  margin: 1em 0px 0.5em 2.272em;\n}\n\nfb2|section fb2|section fb2|section fb2|section fb2|section fb2|section fb2|title {\n  text-align: left;\n  margin: 1em 0px 0.5em 2.5em;\n}\n\nfb2|epigraph {\n  text-align: left;\n  font-style: italic;\n  margin: 1em 1em 2em 30%;\n  display: block;\n}\n\nfb2|image {\n  text-align: center;\n  padding: 3px;\n}\n\nfb2|image::inner {\n  max-width: 95%;\n}\n\nfb2|image::after {\n  display: block;\n  content: attr(title);\n}\n\nfb2|v {\n  text-indent: -1em;\n  padding-left: 1em;\n  margin: 0px;\n  display: block;\n}\nfb2|poem {\n  margin: 0.5em 0px 0.5em 2em;\n  display: block;\n}\nfb2|date {\n  margin: 0.5em 0px 0.5em 50%;\n  font-style: italic;\n  display: block;\n}\nfb2|stanza {\n  margin: 0.5em 0px;\n  break-inside: avoid;\n  display: block;\n}\nfb2|empty-line {\n  height: 1em;\n  margin: 0px;\n  display: block;\n}\nfb2|cite {\n  margin: 0.5em 0px 0.5em 1em;\n  font-size: 0.95em;\n  display: block;\n}\nfb2|subtitle {\n  text-indent: 0px;\n  text-align: center;\n  font-style: italic;\n  font-weight: bold;\n  margin: 0.5em 2em;\n  break-inside: avoid;\n  break-after: avoid;\n  display: block;\n}\nfb2|annotation {\n  margin: 1em 0px 1em 2em;\n  text-indent: 0px;\n  font-style: italic;\n  display: block;\n}\nfb2|text-author {\n  text-indent: 0px;\n  margin: 0.2em 0px 0px 3em;\n  display: block;\n}\nfb2|emphasis {\n  font-style: italic;\n}\nfb2|strong {\n  font-weight: bold;\n}\nfb2|strikethrough {\n  text-decoration: line-through;\n}\nfb2|*.italic {\n  font-style: italic;\n}\nfb2|*.bold {\n  font-weight: bold;\n}\n\nfb2|binary, fb2|description, fb2|stylesheet {\n  display: none;\n}\n\nfb2|a[type="note"] {\n  font-size: 0.75em;\n  vertical-align: super;\n  line-height: 0.01;\n  text-decoration: none;\n  -adapt-template: url(user-agent.xml#footnote);\n}\n\nfb2|body[name="notes"] {\n  display: none;\n}\n\nfb2|body[name="notes"] fb2|title {\n  display: inline;\n  vertical-align: super;\n  line-height: 0.01;\n  text-align: left;\n  font-size: 0.75em;\n  font-weight: bold;\n  margin: 0px;\n}\n\nfb2|body[name="notes"] fb2|p {\n  text-indent: 0px;\n  display: inline;  /* for now */\n}\n\nfb2|body[name="notes"] fb2|p + fb2|p {\n  display: block;\n}\n\nfb2|body[name="notes"] fb2|section {\n  text-indent: 0px;\n  line-height: 1.2;\n  font-size: 1.2em;\n}\n',i,n,null,null).thenFinish(e),e.result()},"uaStylesheetBaseFetcher");class Ri{constructor(e,t,n,i,o,s,r,a,l,c){this.store=e,this.rootScope=t,this.pageScope=n,this.cascade=i,this.rootBox=o,this.fontFaces=s,this.footnoteProps=r,this.flowProps=a,this.viewportProps=l,this.pageProps=c,this.fontDeobfuscator=e.fontDeobfuscator,this.validatorSet=e.validatorSet,this.pageScope.defineBuiltIn("has-content",(function(e){e=e;const t=this.currentLayoutPosition,n=t.firstFlowChunkOfFlow(e);return this.matchPageSide(t.startSideOfFlow(e))&&t.hasContent(e,this.lookupOffset)&&!!n&&!this.flowChunkIsAfterParentFlowForcedBreak(n)})),this.pageScope.defineName("page-number",new k.t(this.pageScope,(function(){return this.pageNumberOffset+this.currentLayoutPosition.page}),"page-number"))}sizeViewport(e,t,n,i){if(this.viewportProps.length){const o=new k.g(this.rootScope,e,t,n),s=U.A(o,this.viewportProps),r=s.width,a=s.height,l=s["text-zoom"];let c=1;if(r&&a||l){const s=k.G.em;if((l?l.evaluate(o,"text-zoom"):null)===G.t.scale&&(c=s/n,n=s,e*=c,t*=c),r&&a){const e=G.x(r.evaluate(o,"width"),o),t=G.x(a.evaluate(o,"height"),o);if(e>0&&t>0)return{width:i&&i.spreadView?2*(e+i.pageBorder):e,height:t,fontSize:n}}}}return{width:e,height:t,fontSize:n}}}class Li extends k.g{constructor(e,t,n,i,o,s,r,a,l,c,h,u){super(e.rootScope,i.width,i.height,i.fontSize),this.style=e,this.xmldoc=t,this.viewport=i,this.clientLayout=o,this.fontMapper=s,this.customRenderer=r,this.fallbackMap=a,this.pageNumberOffset=l,this.documentURLTransformer=c,this.counterStore=h,this.primaryFlows={body:!0},this.rootPageBoxInstance=null,this.styler=null,this.stylerMap=null,this.currentLayoutPosition=null,this.layoutPositionAtPageStart=null,this.lookupOffset=0,this.pageBoxInstances={},this.pageManager=null,this.pageBreaks={},this.pageProgression=null,this.pageSheetSize={},this.pageSheetHeight=0,this.pageSheetWidth=0,this.lang=t.lang||n,this.faces=new jt(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new $.e(null,null,null,null,null,null,null),this.pageProgression=u||null;for(const t in e.flowProps){const n=e.flowProps[t],i=U.s(n,"flow-consume");i&&(i.evaluate(this,"flow-consume")==G.t.all?this.primaryFlows[t]=!0:delete this.primaryFlows[t])}}init(){const e=this,t=W.c("StyleInstance.init"),n=e.counterStore.createCounterListener(e.xmldoc.url),i=e.counterStore.createCounterResolver(e.xmldoc.url,e.style.rootScope,e.style.pageScope);e.styler=new ot(e.xmldoc,e.style.cascade,e.style.rootScope,e,this.primaryFlows,e.style.validatorSet,n,i),i.setStyler(e.styler),e.styler.resetFlowChunkStream(e),e.stylerMap={},e.stylerMap[e.xmldoc.url]=e.styler;const o=e.styler.getTopContainerStyle();e.pageProgression||(e.pageProgression=Tn(o));const s=this.style.rootBox;this.rootPageBoxInstance=new mn(s);const r=this.style.cascade.createInstance(e,n,i,this.lang);this.rootPageBoxInstance.applyCascadeAndInit(r,o),this.rootPageBoxInstance.resolveAutoSizing(e),this.pageManager=new Qn(r,this.style.pageScope,this.rootPageBoxInstance,e,o);const a=[];for(const t of e.style.fontFaces){if(t.condition&&!t.condition.evaluate(e))continue;const n=Wt(t.properties,e),i=new Xt(n);a.push(i)}e.fontMapper.findOrLoadFonts(a,e.faces).thenFinish(t);const l=e.style.pageProps;return Object.keys(l).forEach(e=>{const t=Rn(kn(l[e]),this);this.pageSheetSize[e]={width:t.pageWidth+2*t.cropOffset,height:t.pageHeight+2*t.cropOffset}}),t.result()}getStylerForDoc(e){let t=this.stylerMap[e.url];if(!t){const n=this.style.store.getStyleForDoc(e),i=new k.g(n.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),o=this.counterStore.createCounterListener(e.url),s=this.counterStore.createCounterResolver(e.url,n.rootScope,n.pageScope);t=new ot(e,n.cascade,n.rootScope,i,this.primaryFlows,n.validatorSet,o,s),this.stylerMap[e.url]=t}return t}registerInstance(e,t){this.pageBoxInstances[e]=t}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,t){const n=this.currentLayoutPosition;if(n){n.flows[e.flowName]?t=n.flows[e.flowName]:n.flows[e.flowName]=t;let i=n.flowPositions[e.flowName];i||(i=new X.i,n.flowPositions[e.flowName]=i);const o=X.w(e.element),s=new X.a(o),r=new X.h(s,e);i.positions.push(r)}}getConsumedOffset(e){let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.positions.length;n++){const i=e.positions[n].chunkPosition.primary;let o=i.steps[0].node,s=i.offsetInNode,r=i.after,a=0;for(;o.ownerDocument!=this.xmldoc.document;)a++,o=i.steps[a].node,r=!1,s=0;const l=this.xmldoc.getNodeOffset(o,s,r);l<t&&(t=l)}return t}getPosition(e,t){if(!e)return 0;let n=Number.POSITIVE_INFINITY;for(const i in this.primaryFlows){let o=e.flowPositions[i];if(t||o&&0!=o.positions.length||!this.currentLayoutPosition||(this.styler.styleUntilFlowIsReached(i),o=this.currentLayoutPosition.flowPositions[i],e!=this.currentLayoutPosition&&o&&(o=o.clone(),e.flowPositions[i]=o)),o){const e=this.getConsumedOffset(o);e<n&&(n=e)}}return n}dumpLocation(e){c.b.debug("Location - page",this.currentLayoutPosition.page),c.b.debug("  current:",e),c.b.debug("  lookup:",this.lookupOffset);for(const e in this.currentLayoutPosition.flowPositions){const t=this.currentLayoutPosition.flowPositions[e];for(const n of t.positions)c.b.debug("  Chunk",`${e}:`,n.flowChunk.startOffset)}}matchPageSide(e){switch(e){case"left":case"right":case"recto":case"verso":return new k.s(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(const t in e.flowPositions){const n=e.flowPositions[t];if(n&&n.positions.length>0){const e=n.positions[0].flowChunk;if(this.getConsumedOffset(n)===e.startOffset){const e=n.positions[0].flowChunk.breakBefore,t=Ve.e(n.startSide);n.startSide=Ve.a(Ve.d(t,e))}}}}selectPageMaster(e){const t=this,n=this.currentLayoutPosition,i=this.getPosition(n);if(i==Number.POSITIVE_INFINITY)return null;const o=this.rootPageBoxInstance.children;let s;for(let r=0;r<o.length;r++){if((s=o[r]).pageBox.pseudoName===Vn)continue;let a=1;const l=s.getProp(t,"utilization");l&&l.isNum()&&(a=l.num);const c=t.queryUnitSize("em",!1),h=t.pageWidth()*t.pageHeight(),u=Math.ceil(a*h/(c*c));this.lookupOffset=this.styler.styleUntil(i,u),b.a(n),this.updateStartSide(n),this.layoutPositionAtPageStart=n.clone(),this.initLingering(),t.clearScope(this.style.pageScope);const d=s.getProp(t,"enabled");if(!d||d===G.t._true)return this.pageManager.getPageRulePageMaster(s,e)}throw new Error("No enabled page masters")}flowChunkIsAfterParentFlowForcedBreak(e){const t=this.layoutPositionAtPageStart.flows,n=t[e.flowName].parentFlowName;if(n){const i=e.startOffset,o=t[n].forcedBreakOffsets;if(!o.length||i<o[0])return!1;const s=w.i(o.length,e=>o[e]>i)-1,r=o[s],a=this.layoutPositionAtPageStart.flowPositions[n],l=this.getConsumedOffset(a);return!(r<l)&&(l<r||!this.matchPageSide(a.startSide))}return!1}setFormattingContextToColumn(e,t){const n=this.currentLayoutPosition.flows[t];n.formattingContext||(n.formattingContext=new J.a(null)),e.flowRootFormattingContext=n.formattingContext}layoutDeferredPageFloats(e){const t=e.pageFloatLayoutContext,n=t.getDeferredPageFloatContinuations(),i=W.c("layoutDeferredPageFloats");let o=!1,s=0;return i.loopWithFrame(i=>{if(s===n.length)return void i.breakLoop();const r=n[s++],a=r.float,l=(new $.f).findByFloat(a),c=l.findPageFloatFragment(a,t);if(!c||!c.hasFloat(a))return t.isForbidden(a)||t.hasPrecedingFloatsDeferredToNext(a)?(t.deferPageFloat(r),void i.breakLoop()):void e.layoutPageFloatInner(r,l,null,c).then(e=>{if(!e)return void i.breakLoop();const n=t.parent.isInvalidated();n?i.breakLoop():(t.isInvalidated()&&!n&&(o=!0,t.validate()),i.continueLoop())});i.continueLoop()}).then(()=>{o&&t.invalidate(),i.finish(!0)}),i.result()}getLastAfterPositionIfDeferredFloatsExists(e,t){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0){if(e.lastAfterPosition){let n;return t?(n=t.clone()).primary=e.lastAfterPosition:n=new X.a(e.lastAfterPosition),n}return b.a("column.lastAfterPosition === null"),null}return null}layoutColumn(e,t){const n=this.currentLayoutPosition.flowPositions[t];if(!n||!this.matchPageSide(n.startSide))return W.d(!0);n.startSide="any",this.setFormattingContextToColumn(e,t),e.init(),this.primaryFlows[t]&&e.bands.length>0&&(e.forceNonfitting=!1);const i=this,o=W.c("layoutColumn");return this.layoutDeferredPageFloats(e).then(()=>{if(e.pageFloatLayoutContext.isInvalidated())return void o.finish(!0);const s=[],r=[];let a=!0;o.loopWithFrame(o=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(t))o.breakLoop();else{for(;n.positions.length-r.length>0;){let t=0;for(;r.includes(t);)t++;let l=n.positions[t];if(l.flowChunk.startOffset>i.lookupOffset||i.flowChunkIsAfterParentFlowForcedBreak(l.flowChunk))break;for(let e=t+1;e<n.positions.length;e++){if(r.includes(e))continue;const o=n.positions[e];if(o.flowChunk.startOffset>i.lookupOffset||i.flowChunkIsAfterParentFlowForcedBreak(o.flowChunk))break;o.flowChunk.isBetter(l.flowChunk)&&(l=o,t=e)}const c=l.flowChunk;let h=!0;if(e.layout(l.chunkPosition,a,n.breakAfter).then(u=>{if(e.pageFloatLayoutContext.isInvalidated())o.breakLoop();else{if(a=!1,l.flowChunk.repeated&&(null===u||c.exclusive)&&s.push(t),c.exclusive)return r.push(t),void o.breakLoop();{const a=!!u||!!e.pageBreakType,c=i.getLastAfterPositionIfDeferredFloatsExists(e,u);if(e.pageBreakType&&c?(l.chunkPosition=c,n.breakAfter=e.pageBreakType,e.pageBreakType=null):(r.push(t),(u||c)&&(l.chunkPosition=u||c,s.push(t)),e.pageBreakType&&(n.startSide=Ve.a(e.pageBreakType))),a)return void o.breakLoop()}e.forceNonfitting=!1,h?h=!1:o.continueLoop()}}),h)return void(h=!1)}o.breakLoop()}}).then(()=>{if(!e.pageFloatLayoutContext.isInvalidated()){n.positions=n.positions.filter((e,t)=>s.includes(t)||!r.includes(t)),"column"===n.breakAfter&&(n.breakAfter=null),e.saveDistanceToBlockEndFloats();const t=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(t)}o.finish(!0)})}),o.result()}createLayoutConstraint(e){const t=this.currentLayoutPosition.page-1,n=this.counterStore.createLayoutConstraint(t);return new qt.a([n].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,t,n,i,o,s,r,a,l,c,h,u,d,p){const f=this,g=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,m=o.element,b=new $.e(a,$.a.COLUMN,null,r,null,null,null),E=f.currentLayoutPosition.clone(),y=W.c("createAndLayoutColumn");let S;return y.loopWithFrame(e=>{const y=f.createLayoutConstraint(b);if(l>1){const e=f.viewport.document.createElement("div");if(w.F(e,"position","absolute"),m.appendChild(e),(S=new qt.b(e,d,f.clientLayout,y,b)).forceNonfitting=p,S.vertical=o.vertical,S.snapHeight=o.snapHeight,S.snapWidth=o.snapWidth,o.vertical){const e=s*(h+c)+o.paddingTop;S.setHorizontalPosition(o.paddingLeft,o.width),S.setVerticalPosition(e,h)}else{const e=s*(h+c)+o.paddingLeft;S.setVerticalPosition(o.paddingTop,o.height),S.setHorizontalPosition(e,h)}S.originX=t,S.originY=n}else(S=new qt.b(m,d,f.clientLayout,y,b)).copyFrom(o);S.exclusions=g?[]:i.concat(),S.innerShape=u,b.setContainer(S),S.width>=0?f.layoutColumn(S,r).then(()=>{b.isInvalidated()||b.finish(),S.pageFloatLayoutContext.isInvalidated()&&!a.isInvalidated()?(S.pageFloatLayoutContext.validate(),f.currentLayoutPosition=E.clone(),S.element!==m&&m.removeChild(S.element),e.continueLoop()):e.breakLoop()}):(b.finish(),e.breakLoop())}).then(()=>{y.finish(S)}),y.result()}setPagePageFloatLayoutContextContainer(e,t,n){(t instanceof Yn||t instanceof bn&&!(t instanceof Xn))&&e.setContainer(n)}getRegionPageFloatLayoutContext(e,t,n,i){b.a(t instanceof En);const o=t.getProp(this,"writing-mode")||null,s=t.getProp(this,"direction")||null;return new $.e(e,$.a.REGION,n,i,null,o,s)}layoutFlowColumnsWithBalancing(e,t,n,i,o,s,r,a,l){const c=this,h=c.currentLayoutPosition.clone(),u=c.getRegionPageFloatLayoutContext(s,t,r,a);let d=!0;function p(){return c.currentLayoutPosition=h.clone(),c.layoutFlowColumns(e,t,n,i,o,s,u,r,a,l,d).thenAsync(e=>e?W.d({columns:e,position:c.currentLayoutPosition}):W.d(null))}return p().thenAsync(e=>{if(!e)return W.d(null);if(l<=1)return W.d(e.columns);const n=t.getProp(c,"column-fill")||G.t.balance,i=c.currentLayoutPosition.flowPositions[a];b.a(i);const o=function(e,t,n,i,o,s,r){if(t===G.t.auto)return null;{const a=0===r.positions.length,l=s[s.length-1],c=!(!l||!l.pageBreakType);return a||c?new Ye(n,i,o,e):t===G.t.balance_all?new Qe(n,i,o):(b.a(t===G.t.balance),null)}}(l,n,p,u,r,e.columns,i);return o?(d=!1,s.lock(),u.lock(),o.balanceColumns(e).thenAsync(e=>(s.unlock(),s.validate(),u.unlock(),c.currentLayoutPosition=e.position,W.d(e.columns)))):W.d(e.columns)})}layoutFlowColumns(e,t,n,i,o,s,r,a,l,c,h){const u=this,d=W.c("layoutFlowColumns"),p=u.currentLayoutPosition.clone(),f=t.getPropAsNumber(u,"column-gap"),g=c>1?t.getPropAsNumber(u,"column-width"):a.width,m=t.getActiveRegions(u),b=t.getProp(u,"shape-inside"),w=O.e(b,0,0,a.width,a.height,u),E=new bi(l,u,u.viewport,u.styler,m,u.xmldoc,u.faces,u.style.footnoteProps,u,e,u.customRenderer,u.fallbackMap,this.documentURLTransformer);let y=0,S=null,N=[];return d.loopWithFrame(e=>{u.createAndLayoutColumn(t,n,i,o,a,y++,l,r,c,f,g,w,E,h).then(t=>s.isInvalidated()?(N=null,void e.breakLoop()):(!(t.pageBreakType&&"column"!==t.pageBreakType)&&y!==c||r.isInvalidated()||r.finish(),r.isInvalidated()?(y=0,u.currentLayoutPosition=p.clone(),r.validate(),void(r.isLocked()?(N=null,e.breakLoop()):e.continueLoop())):(S=t,N[y-1]=S,S.pageBreakType&&"column"!=S.pageBreakType&&(y=c,"region"!=S.pageBreakType&&(u.pageBreaks[l]=!0)),void(y<c?e.continueLoop():e.breakLoop()))))}).then(()=>{d.finish(N)}),d.result()}layoutContainer(e,t,n,i,o,s,r){const a=this;t.reset();const l=t.getProp(a,"enabled");if(l&&l!==G.t._true)return W.d(!0);const c=W.c("layoutContainer"),h=t.getProp(a,"wrap-flow")===G.t.auto,u=t.getProp(a,"flow-from"),d=a.viewport.document.createElement("div"),p=t.getProp(a,"position");w.F(d,"position",p?p.name:"absolute"),n.insertBefore(d,n.firstChild);let f,g=new X.b(d);g.vertical=t.vertical,g.exclusions=s,t.prepareContainer(a,g,e,a.faces,a.clientLayout),g.originX=i,g.originY=o,i+=g.left+g.marginLeft+g.borderLeft,o+=g.top+g.marginTop+g.borderTop,this.setPagePageFloatLayoutContextContainer(r,t,g);let m=!1;if(u&&u.isIdent())if(a.pageBreaks[u.toString()])r.isInvalidated()||t.finishContainer(a,g,e,null,1,a.clientLayout,a.faces),f=W.d(!0);else{const n=W.c("layoutContainer.inner"),l=u.toString(),c=t.getPropAsNumber(a,"column-count");a.layoutFlowColumnsWithBalancing(e,t,i,o,s,r,g,l,c).then(i=>{if(!r.isInvalidated()){const n=i[0];b.a(n),n.element===d&&(g=n),g.computedBlockSize=Math.max.apply(null,i.map(e=>e.computedBlockSize)),t.finishContainer(a,g,e,n,c,a.clientLayout,a.faces);const o=a.currentLayoutPosition.flowPositions[l];o&&"region"===o.breakAfter&&(o.breakAfter=null)}n.finish(!0)}),f=n.result()}else{const i=t.getProp(a,"content");if(i&&X.y(i)){let n="span";i.url&&(n="img");const o=a.viewport.document.createElement(n);i.visit(new X.c(o,a,i,a.counterStore.getExprContentListener())),d.appendChild(o),"img"==n&&t.transferSinglUriContentProps(a,o,a.faces),t.transferContentProps(a,g,e,a.faces)}else t.suppressEmptyBoxGeneration&&(n.removeChild(d),m=!0);m||t.finishContainer(a,g,e,null,1,a.clientLayout,a.faces),f=W.d(!0)}return f.then(()=>{if(r.isInvalidated())return void c.finish(!0);if(!t.isAutoHeight||Math.floor(g.computedBlockSize)>0){if(!m&&!h){const e=t.getProp(a,"shape-outside"),n=g.getOuterShape(e,a);s.push(n)}}else if(0==t.children.length)return n.removeChild(d),void c.finish(!0);let l=t.children.length-1;c.loop(()=>{for(;l>=0;){const n=t.children[l--],c=a.layoutContainer(e,n,d,i,o,s,r);if(c.isPending())return c.thenAsync(()=>W.d(!r.isInvalidated()));if(r.isInvalidated())break}return W.d(!1)}).then(()=>{c.finish(!0)})}),c.result()}processLinger(){const e=this.currentLayoutPosition.page;for(const t in this.currentLayoutPosition.flowPositions){const n=this.currentLayoutPosition.flowPositions[t];for(let t=n.positions.length-1;t>=0;t--){const i=n.positions[t];i.flowChunk.startPage>=0&&i.flowChunk.startPage+i.flowChunk.linger-1<=e&&n.positions.splice(t,1)}}}initLingering(){const e=this.currentLayoutPosition.page;for(const t in this.currentLayoutPosition.flowPositions){const n=this.currentLayoutPosition.flowPositions[t];for(let t=n.positions.length-1;t>=0;t--){const i=n.positions[t];i.flowChunk.startPage<0&&i.flowChunk.startOffset<this.lookupOffset&&(i.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(const t in this.primaryFlows){const n=e.flowPositions[t];if(n&&n.positions.length>0)return!1}return!0}layoutNextPage(e,t){const n=this,i=e.container===e.bleedBox;n.pageBreaks={},t?(n.currentLayoutPosition=t.clone(),n.styler.replayFlowElementsFromOffset(t.highestSeenOffset)):(n.currentLayoutPosition=new X.j,n.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute("lang",this.lang),(t=n.currentLayoutPosition).page++,n.clearScope(n.style.pageScope),n.layoutPositionAtPageStart=t.clone();const o=i?{}:n.pageManager.getCascadedPageStyle(),r=n.selectPageMaster(o);if(!r)return W.d(null);let a=0;if(!i){e.setAutoPageWidth(r.pageBox.specified.width.value===G.q),e.setAutoPageHeight(r.pageBox.specified.height.value===G.p),n.counterStore.setCurrentPage(e),n.counterStore.updatePageCounters(o,n);const t=Rn(kn(o),this);n.setPageSizeAndBleed(t,e),function(e,t,n,i){let o=!1,s=!1;const r=e.marks;if(r){const e=r.value;e.isSpaceList()?e.values.forEach(e=>{e===G.t.crop?o=!0:e===G.t.cross&&(s=!0)}):e===G.t.crop?o=!0:e===G.t.cross&&(s=!0)}if(!o&&!s)return;const a=n.container,l=a.ownerDocument;b.a(l);const c=t.bleed,h=G.x(In,i),u=G.x(Pn,i),d=G.x(An,i);if(c){const t=e["background-color"];t&&t.value&&(n.bleedBox.style.backgroundColor=t.value.stringValue())}o&&Object.keys(Dn).forEach(e=>{const t=Dn[e],n=function(e,t,n,i,o,s){let r=i;r<=o+2*k.G.mm&&(r=o+i/2);const a=Math.max(i,r),l=o+a+n/2,c=Ln(e,l,l);let h=[[0,o+i],[i,o+i],[i,o+i-r]],u=h.map(e=>[e[1],e[0]]);t!==Dn.TOP_RIGHT&&t!==Dn.BOTTOM_RIGHT||(h=h.map(e=>[o+a-e[0],e[1]]),u=u.map(e=>[o+a-e[0],e[1]])),t!==Dn.BOTTOM_LEFT&&t!==Dn.BOTTOM_RIGHT||(h=h.map(e=>[e[0],o+a-e[1]]),u=u.map(e=>[e[0],o+a-e[1]]));const d=Fn(e,n);d.setAttribute("points",h.map(e=>e.join(",")).join(" ")),c.appendChild(d);const p=Fn(e,n);return p.setAttribute("points",u.map(e=>e.join(",")).join(" ")),c.appendChild(p),t.split(" ").forEach(e=>{c.style[e]=`${s}px`}),c}(l,t,h,d,c,u);a.appendChild(n)}),s&&Object.keys(_n).forEach(e=>{const t=_n[e],n=function(e,t,n,i,o){const s=2*i;let r,a;t===_n.TOP||t===_n.BOTTOM?(r=s,a=i):(r=i,a=s);const l=Ln(e,r,a),c=Fn(e,n);c.setAttribute("points",`0,${a/2} ${r},${a/2}`),l.appendChild(c);const h=Fn(e,n);h.setAttribute("points",`${r/2},0 ${r/2},${a}`),l.appendChild(h);const u=Fn(e,n,"circle");let d;switch(u.setAttribute("cx",r/2),u.setAttribute("cy",a/2),u.setAttribute("r",i/4),l.appendChild(u),t){case _n.TOP:d=_n.BOTTOM;break;case _n.BOTTOM:d=_n.TOP;break;case _n.LEFT:d=_n.RIGHT;break;case _n.RIGHT:d=_n.LEFT}return Object.keys(_n).forEach(e=>{const n=_n[e];n===t?l.style[n]=`${o}px`:n!==d&&(l.style[n]="0",l.style[`margin-${n}`]="auto")}),l}(l,t,h,d,u);a.appendChild(n)})}(o,t,e,this),a=t.bleedOffset+t.bleed}const l=!i&&r.getProp(n,"writing-mode")||G.t.horizontal_tb;this.pageVertical=l!=G.t.horizontal_tb;const c=r.getProp(n,"direction")||G.t.ltr,h=new $.e(n.rootPageFloatLayoutContext,$.a.PAGE,null,null,null,l,c),u=W.c("layoutNextPage");return u.loopWithFrame(t=>{n.layoutContainer(e,r,e.bleedBox,a,a,[],h).then(()=>{h.isInvalidated()||h.finish(),h.isInvalidated()?(n.currentLayoutPosition=n.layoutPositionAtPageStart.clone(),h.validate(),t.continueLoop()):t.breakLoop()})}).then(()=>{if(r.adjustPageLayout(n,e,n.clientLayout),!i){const i=new k.s(r.pageBox.scope,"left-page");e.side=i.evaluate(n)?s.LEFT:s.RIGHT,n.processLinger(),t=n.currentLayoutPosition,Object.keys(t.flowPositions).forEach(e=>{const i=t.flowPositions[e],o=i.breakAfter;!o||"page"!==o&&n.matchPageSide(o)||(i.breakAfter=null)})}n.currentLayoutPosition=n.layoutPositionAtPageStart=null,t.highestSeenOffset=n.styler.getReachedOffset();const o=n.style.store.getTriggersForDoc(n.xmldoc);e.finish(o,n.clientLayout),n.noMorePrimaryFlows(t)&&(t=null),u.finish(t)}),u.result()}setPageSizeAndBleed(e,t){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+2*e.cropOffset,this.pageSheetHeight=e.pageHeight+2*e.cropOffset,t.container.style.width=`${this.pageSheetWidth}px`,t.container.style.height=`${this.pageSheetHeight}px`,t.bleedBox.style.left=`${e.bleedOffset}px`,t.bleedBox.style.right=`${e.bleedOffset}px`,t.bleedBox.style.top=`${e.bleedOffset}px`,t.bleedBox.style.bottom=`${e.bleedOffset}px`,t.bleedBox.style.padding=`${e.bleed}px`,t.bleedBox.style.paddingTop=`${e.bleed+.01}px`}}class Fi extends U.b{constructor(e,t,n,i){super(e.rootScope,e,t,n,i,e.validatorSet,!n),this.masterHandler=e,this.insideRegion=!1}startPageTemplateRule(){}startPageMasterRule(e,t,n){const i=new en(this.masterHandler.pageScope,e,t,n,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new Cn(i.scope,this.masterHandler,i,this.validatorSet))}startWhenRule(e){let t=e.expr;null!=this.condition&&(t=k.D(this.scope,this.condition,t)),this.masterHandler.pushHandler(new Fi(this.masterHandler,t,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new U.f(this.scope,this.owner))}startFontFaceRule(){const e={};this.masterHandler.fontFaces.push({properties:e,condition:this.condition}),this.masterHandler.pushHandler(new U.h(this.scope,this.owner,null,e,this.masterHandler.validatorSet))}startFlowRule(e){let t=this.masterHandler.flowProps[e];t||(t={},this.masterHandler.flowProps[e]=t),this.masterHandler.pushHandler(new U.h(this.scope,this.owner,null,t,this.masterHandler.validatorSet))}startViewportRule(){const e={};this.masterHandler.viewportProps.push(e),this.masterHandler.pushHandler(new U.h(this.scope,this.owner,this.condition,e,this.masterHandler.validatorSet))}startFootnoteRule(e){let t=this.masterHandler.footnoteProps;if(e){const n=U.q(t,"_pseudos");(t=n[e])||(t={},n[e]=t)}this.masterHandler.pushHandler(new U.h(this.scope,this.owner,null,t,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){const e=new ri(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(e),e.startPageRule()}startRuleBody(){if(U.b.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;const e=`R${this.masterHandler.regionCount++}`;this.special("region-id",G.r(e)),this.endRule();const t=new Fi(this.masterHandler,this.condition,this,e);this.masterHandler.pushHandler(t),t.startRuleBody()}}}function Di(e){let t=e.getAttribute("content");if(!t)return"";const n={};let i;for(;null!=(i=t.match(/^,?\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\s*=\s*([-+A-Za-z_0-9.]*)\s*/));)t=t.substr(i[0].length),n[i[1]]=i[2];const o=n.width-0,s=n.height-0;return o&&s?`@-epubx-viewport{width:${o}px;height:${s}px;}`:""}class _i extends z.a{constructor(e){super(),this.validatorSet=e,this.regionCount=0,this.fontFaces=[],this.footnoteProps={},this.flowProps={},this.viewportProps=[],this.pageProps={},this.rootScope=new k.m(null),this.pageScope=new k.m(this.rootScope),this.rootBox=new Qt(this.rootScope),this.cascadeParserHandler=new Fi(this,null,null,null),this.slave=this.cascadeParserHandler}error(e,t){c.b.warn("CSS parser:",e)}}function Bi(e,t){return t.parseOPSResource(e)}class Mi extends H.a{constructor(e){super(Bi,H.b.DOCUMENT),this.fontDeobfuscator=e,this.styleByKey={},this.styleFetcherByKey={},this.styleByDocURL={},this.triggersByDocURL={},this.validatorSet=null,this.styleSheets=[],this.triggerSingleDocumentPreprocessing=!1}init(e,t){this.setStyleSheets(e,t);const n=w.C("user-agent.xml",w.D),i=W.c("OPSDocStore.init");return this.validatorSet=zt(),ki.get().then(()=>{this.load(n).then(()=>{this.triggerSingleDocumentPreprocessing=!0,i.finish(!0)})}),i.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,t){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),t&&t.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let t=e.url;t&&(t=w.C(w.n(t),w.h)),this.styleSheets.push({url:t,text:e.text,flavor:z.g.AUTHOR,classes:null,media:null})}addUserStyleSheet(e){let t=e.url;t&&(t=w.C(w.n(t),w.h)),this.styleSheets.push({url:t,text:e.text,flavor:z.g.USER,classes:null,media:null})}parseOPSResource(e){const t=W.c("OPSDocStore.load"),n=this,i=e.url,o=i.endsWith("?viv-toc-box");return xi(e,n).then(e=>{if(!e)return void t.finish(null);if(n.triggerSingleDocumentPreprocessing){const t=l.b(l.a.PREPROCESS_SINGLE_DOCUMENT);for(let n=0;n<t.length;n++)try{t[n](e.document)}catch(e){c.b.warn("Error during single document preprocessing:",e)}}const s=[],r=e.document.getElementsByTagNameNS(w.a.epub,"trigger");for(let e=0;e<r.length;e++){const t=r[e],n=t.getAttributeNS(w.a.EV,"observer"),i=t.getAttributeNS(w.a.EV,"event"),o=t.getAttribute("action"),a=t.getAttribute("ref");n&&i&&o&&a&&s.push({observer:n,event:i,action:o,ref:a})}n.triggersByDocURL[i]=s;const a=[],h=w.C("user-agent-page.css",w.D);a.push({url:h,text:Oi,flavor:z.g.USER_AGENT,classes:null,media:null});const u=e.head;if(!o&&u)for(let e=u.firstChild;e;e=e.nextSibling){if(1!=e.nodeType)continue;const t=e,n=t.namespaceURI,o=t.localName;if(n==w.a.XHTML)if("style"==o){const e=t.getAttribute("class"),n=t.getAttribute("media"),o=t.getAttribute("title");a.push({url:i,text:t.textContent,flavor:z.g.AUTHOR,classes:o?e:null,media:n})}else if("link"==o){const e=t.getAttribute("rel"),n=t.getAttribute("class"),o=t.getAttribute("media");if("stylesheet"==e||"alternate stylesheet"==e&&n){let e=t.getAttribute("href");e=w.C(e,i);const s=t.getAttribute("title");a.push({url:e,text:null,classes:s?n:null,media:o,flavor:z.g.AUTHOR})}}else"meta"==o&&"viewport"==t.getAttribute("name")&&a.push({url:i,text:Di(t),flavor:z.g.AUTHOR,classes:null,media:null});else if(n==w.a.FB2)"stylesheet"==o&&"text/css"==t.getAttribute("type")&&a.push({url:i,text:t.textContent,flavor:z.g.AUTHOR,classes:null,media:null});else if(n==w.a.SSE&&"property"===o){const e=t.getElementsByTagName("name")[0];if(e&&"stylesheet"===e.textContent){const e=t.getElementsByTagName("value")[0];if(e){const t=w.C(e.textContent,i);a.push({url:t,text:null,classes:null,media:null,flavor:z.g.AUTHOR})}}}}if(!o)for(let e=0;e<n.styleSheets.length;e++)a.push(n.styleSheets[e]);let d="";for(let e=0;e<a.length;e++)d+=a[e].url,d+="^",a[e].text&&(d+=a[e].text),d+="^";let p=n.styleByKey[d];if(p)return n.styleByDocURL[i]=p,void t.finish(e);let f=n.styleFetcherByKey[d];f||(f=new Vt.a(()=>{const e=W.c("fetchStylesheet");let t=0;const i=new _i(n.validatorSet);return e.loop(()=>{if(t<a.length){const e=a[t++];return i.startStylesheet(e.flavor),null!==e.text?z.k(e.text,i,e.url,e.classes,e.media).thenReturn(!0):z.l(e.url,i,e.classes,e.media)}return W.d(!1)}).then(()=>{const t=i.cascadeParserHandler.finish();p=new Ri(n,i.rootScope,i.pageScope,t,i.rootBox,i.fontFaces,i.footnoteProps,i.flowProps,i.viewportProps,i.pageProps),n.styleByKey[d]=p,delete n.styleFetcherByKey[d],e.finish(p)}),e.result()},`FetchStylesheet ${i}`),n.styleFetcherByKey[d]=f,f.start()),f.get().then(o=>{n.styleByDocURL[i]=o,t.finish(e)})}),t.result()}}function Ui(e){return String.fromCharCode(e>>>24&255,e>>>16&255,e>>>8&255,255&e)}function zi(e){return(255&e.charCodeAt(0))<<24|(255&e.charCodeAt(1))<<16|(255&e.charCodeAt(2))<<8|255&e.charCodeAt(3)}function Vi(e){const t=new w.d;t.append(e);let n=55-e.length&63;for(t.append("");n>0;)n--,t.append("\0");t.append("\0\0\0\0"),t.append(Ui(8*e.length)),e=t.toString();const i=[1732584193,4023233417,2562383102,271733878,3285377520],o=[];let s;for(let t=0;t<e.length;t+=64){for(s=0;s<16;s++)o[s]=zi(e.substr(t+4*s,4));for(;s<80;s++){const e=o[s-3]^o[s-8]^o[s-14]^o[s-16];o[s]=e<<1|e>>>31}let n,r=i[0],a=i[1],l=i[2],c=i[3],h=i[4];for(s=0;s<80;s++)n=s<20?1518500249+(a&l|~a&c):s<40?1859775393+(a^l^c):s<60?2400959708+(a&l|a&c|l&c):3395469782+(a^l^c),n+=(r<<5|r>>>27)+h+o[s],h=c,c=l,l=a<<30|a>>>2,a=r,r=n;i[0]=i[0]+r|0,i[1]=i[1]+a|0,i[2]=i[2]+l|0,i[3]=i[3]+c|0,i[4]=i[4]+h|0}return i}const Hi="▸",Gi="▾",$i="▹";class Wi{constructor(e,t,n,i,o,s,r,a,l,c){this.store=e,this.url=t,this.lang=n,this.clientLayout=i,this.fontMapper=o,this.rendererFactory=r,this.fallbackMap=a,this.documentURLTransformer=l,this.counterStore=c,this.page=null,this.instance=null,this.pref=k.E(s),this.pref.spreadView=!1}setAutoHeight(e,t){if(0!=t--)for(let n=e.firstChild;n;n=n.nextSibling)if(1==n.nodeType){const e=n;"auto"!=w.t(e,"height","auto")&&(w.F(e,"height","auto"),this.setAutoHeight(e,t)),"absolute"==w.t(e,"position","static")&&(w.F(e,"position","relative"),this.setAutoHeight(e,t))}}makeCustomRenderer(e){const t=this.rendererFactory.makeCustomRenderer(e);return(e,n,i)=>{const o=i.behavior;if(o)switch(o.toString()){case"body-child":e.parentElement.getAttribute("data-vivliostyle-primary-entry")&&(e.querySelector("[role=doc-toc], [role=directory], nav li a, .toc, #toc")||(i.display=G.t.none));break;case"toc-node-anchor":i.color=G.t.inherit,i["text-decoration"]=G.t.none;break;case"toc-node":i.display=G.t.block,i.margin=G.u,i.padding=G.u,i["padding-inline-start"]=new G.i(1.25,"em");break;case"toc-node-first-child":i.display=G.t.inline_block,i.margin=new G.i(.2,"em"),i["vertical-align"]=G.t.top,i.color=G.t.inherit,i["text-decoration"]=G.t.none}if(!o||"toc-node"!=o.toString()&&"toc-container"!=o.toString())return t(e,n,i);const s=e.firstChild;s&&1!==s.nodeType&&""===s.textContent.trim()&&e.replaceChild(e.ownerDocument.createComment(s.textContent),s);const r=n.getAttribute("data-adapt-class");if("toc-node"==r){const e=n.firstChild;e.textContent!=Hi&&(e.textContent=Hi,w.F(e,"cursor","pointer"),e.addEventListener("click",Xi,!1),e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),n.setAttribute("aria-expanded","false"),"0px"!==n.style.height&&(e.tabIndex=0))}const a=n.ownerDocument.createElement("div");if(a.setAttribute("data-adapt-process-children","true"),"toc-node"==o.toString()){const t=n.ownerDocument.createElement("div");if(t.textContent=$i,w.F(t,"margin","0.2em 0 0 -1em"),w.F(t,"margin-inline-start","-1em"),w.F(t,"margin-inline-end","0"),w.F(t,"display","inline-block"),w.F(t,"width","1em"),w.F(t,"text-align","center"),w.F(t,"vertical-align","top"),w.F(t,"cursor","default"),w.F(t,"font-family","Menlo,sans-serif"),a.appendChild(t),w.F(a,"overflow","hidden"),a.setAttribute("data-adapt-class","toc-node"),a.setAttribute("role","treeitem"),"toc-node"==r||"toc-container"==r){w.F(a,"height","0px");const t=e.firstElementChild;t&&"a"===t.localName&&(t.tabIndex=-1)}else n.setAttribute("role","tree")}else"toc-node"==r&&(a.setAttribute("data-adapt-class","toc-container"),a.setAttribute("role","group"),a.setAttribute("aria-hidden","true"));return W.d(a)}}showTOC(e,t,n,i,o){if(this.page)return W.d(this.page);const s=this,r=W.c("showTOC"),a=new X.l(e,e);this.page=a;const l=this.url+"?viv-toc-box";return this.store.load(l).then(i=>{const l=this.store.resources[this.url];l&&l.body&&l.body.getAttribute("data-vivliostyle-primary-entry")&&i.body.setAttribute("data-vivliostyle-primary-entry",!0);const c=s.store.getStyleForDoc(i),h=c.sizeViewport(n,1e5,o);t=new Si(t.window,h.fontSize,t.root,h.width,h.height);const u=s.makeCustomRenderer(i),d=new Li(c,i,s.lang,t,s.clientLayout,s.fontMapper,u,s.fallbackMap,0,s.documentURLTransformer,s.counterStore);s.instance=d,d.pref=s.pref,d.init().then(()=>{d.layoutNextPage(a,null).then(()=>{Array.from(a.container.querySelectorAll("[data-vivliostyle-toc-box]>*>*>*>*>*[style*='display: none']")).forEach(e=>{e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","hidden")}),s.setAutoHeight(e,2),r.finish(a)})})}),r.result()}hideTOC(){this.page&&(this.page.container.style.visibility="hidden",this.page.container.setAttribute("aria-hidden","true"))}isTOCVisible(){return!!this.page&&"visible"===this.page.container.style.visibility}}function Xi(e){const t=e.target,n=t.textContent==Hi;t.textContent=n?Gi:Hi;const i=t.parentNode;t.setAttribute("aria-expanded",n?"true":"false"),i.setAttribute("aria-expanded",n?"true":"false");let o=i.firstChild;for(;o;){if(1===o.nodeType){const e=o,t=e.getAttribute("data-adapt-class");if("toc-container"===t){if(e.setAttribute("aria-hidden",n?"false":"true"),e.firstChild){o=e.firstChild;continue}}else if("toc-node"===t&&(e.style.height=n?"auto":"0px",e.children.length>=2&&(e.children[1].tabIndex=n?0:-1),e.children.length>=3&&(e.children[0].tabIndex=n?0:-1,!n))){const t=e.children[0];if(t.textContent==Gi){t.textContent=Hi,t.setAttribute("aria-expanded","false"),e.setAttribute("aria-expanded","false"),o=e.children[2];continue}}}for(;!o.nextSibling&&o.parentNode!==i;)o=o.parentNode;o=o.nextSibling}e.stopPropagation()}class ji extends Mi{constructor(){super(null),this.opfByURL={},this.primaryOPFByEPubURL={},this.deobfuscators={},this.documents={},this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=new H.a(xi,H.b.DOCUMENT),this.jsonStore=H.f()}makeDeobfuscatorFactory(){const e=this;return t=>e.deobfuscators[t]}loadAsPlainXML(e,t,n){return this.plainXMLStore.load(e,t,n)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,t,n){return this.jsonStore.load(e,t,n)}startLoadingAsJSON(e){this.jsonStore.fetch(e)}loadPubDoc(e,t){const n=W.c("loadPubDoc");return H.c(e,null,"HEAD").then(i=>{if(i.status>=400)this.loadEPUBDoc(e,t).then(t=>{t?n.finish(t):(c.b.error(`Failed to fetch a source document from ${e} (${i.status}${i.statusText?" "+i.statusText:""})`),n.finish(null))});else if(i.status||i.responseXML||i.responseText||i.responseBlob||i.contentType||/\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,"/$1")),"application/oebps-package+xml"==i.contentType||/\.opf(?:[#?]|$)/.test(e)){const[,i,o]=e.match(/^((?:.*\/)?)([^/]*)$/);this.loadOPF(i,o,t).thenFinish(n)}else"application/ld+json"==i.contentType||"application/webpub+json"==i.contentType||"application/audiobook+json"==i.contentType||"application/json"==i.contentType||/\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then(t=>{if(!t)return c.b.error(`Received an empty response for ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`),void n.finish(null);const i=new oo(this,e);i.initWithWebPubManifest(t).then(()=>{n.finish(i)})}):this.loadWebPub(e).then(i=>{i?n.finish(i):this.loadEPUBDoc(e,t).then(t=>{t?n.finish(t):(c.b.error(`Failed to load ${e}.`),n.finish(null))})})}),n.result()}loadEPUBDoc(e,t){const n=W.c("loadEPUBDoc");e.endsWith("/")||(e+="/"),t&&this.startLoadingAsJSON(e+"?r=list"),this.startLoadingAsPlainXML(e+"META-INF/encryption.xml");const i=e+"META-INF/container.xml";return this.loadAsPlainXML(i).then(i=>{if(i){const o=i.doc().child("container").child("rootfiles").child("rootfile").attribute("full-path");for(const i of o)if(i)return void this.loadOPF(e,i,t).thenFinish(n);n.finish(null)}}),n.result()}loadOPF(e,t,n){const i=this,o=e+t;let s=i.opfByURL[o];if(s)return W.d(s);const r=W.c("loadOPF");return i.loadAsPlainXML(o,!0,`Failed to fetch EPUB OPF ${o}`).then(t=>{t?i.loadAsPlainXML(`${e}META-INF/encryption.xml`).then(a=>{(n?i.loadAsJSON(`${e}?r=list`):W.d(null)).then(n=>{(s=new oo(i,e)).initWithXMLDoc(t,a,n,`${e}?r=manifest`).then(()=>{i.opfByURL[o]=s,i.primaryOPFByEPubURL[e]=s,r.finish(s)})})}):c.b.error(`Received an empty response for EPUB OPF ${o}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`)}),r.result()}loadWebPub(e){const t=W.c("loadWebPub");return this.load(e).then(n=>{if(n)if(n.document.querySelector("a[href='META-INF/'],a[href$='/META-INF/']"))t.finish(null);else{const i=n.document,o=new oo(this,e);i.body&&i.body.setAttribute("data-vivliostyle-primary-entry",!0);const s=i.querySelector("link[rel='publication'],link[rel='manifest'][type='application/webpub+json']");if(s){const n=s.getAttribute("href");if(/^#/.test(n)){const e=w.H(i.getElementById(n.substr(1)).textContent);o.initWithWebPubManifest(e,i).then(()=>{t.finish(o)})}else this.loadAsJSON(w.C(s.getAttribute("href"),e)).then(e=>{o.initWithWebPubManifest(e,i).then(()=>{t.finish(o)})})}else o.initWithWebPubManifest({},i).then(()=>{o.xhtmlToc&&o.xhtmlToc.src===n.url&&(i.querySelector("[role=doc-toc], [role=directory], nav, .toc, #toc")||(o.xhtmlToc=null)),t.finish(o)})}else c.b.error(`Received an empty response for ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`)}),t.result()}addDocument(e,t){const n=W.c("EPUBDocStore.load"),i=w.I(e);return(this.documents[i]=this.parseOPSResource({status:200,statusText:"",url:i,contentType:t.contentType,responseText:null,responseXML:t,responseBlob:null})).thenFinish(n),n.result()}load(e){const t=w.I(e);let n=this.documents[t];if(n)return n.isPending()?n:W.d(n.get());{const e=W.c("EPUBDocStore.load");return(n=super.load(t,!0,`Failed to fetch a source document from ${t}`)).then(n=>{n?e.finish(n):t.startsWith("data:")?c.b.error(`Failed to load ${t}. Invalid data.`):t.startsWith("http:")&&w.h.startsWith("https:")?c.b.error(`Failed to load ${t}. Mixed Content ("http:" content on "https:" context) is not allowed.`):c.b.error(`Received an empty response for ${t}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`)}),e.result()}}}class Ki{constructor(){this.id=null,this.src="",this.mediaType=null,this.title=null,this.itemRefElement=null,this.spineIndex=-1,this.compressedSize=0,this.compressed=null,this.epage=0,this.epageCount=0,this.startPage=null,this.skipPagesBefore=null,this.itemProperties=w.o}initWithElement(e,t){this.id=e.getAttribute("id"),this.src=w.C(e.getAttribute("href"),t),this.mediaType=e.getAttribute("media-type");const n=e.getAttribute("properties");n&&(this.itemProperties=w.f(n.split(/\s+/)))}initWithParam(e){this.spineIndex=e.index,this.id=`item${e.index+1}`,this.src=e.url,this.startPage=e.startPage,this.skipPagesBefore=e.skipPagesBefore}}function qi(e){return e.id}function Yi(e){return`1040:${function(e){const t=function(e){const t=Vi(e),n=new w.d;for(let e=0;e<t.length;e++)n.append(Ui(t[e]));return n.toString()}(e),n=new w.d;for(let e=0;e<t.length;e++)n.append((256|t.charCodeAt(e)).toString(16).substr(1));return n.toString()}(e)}`}const Zi={dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",rendition:"http://www.idpf.org/vocab/rendition/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",xsd:"http://www.w3.org/2001/XMLSchema#"},Qi="http://idpf.org/epub/vocab/package/#",Ji={language:`${Zi.dcterms}language`,title:`${Zi.dcterms}title`,creator:`${Zi.dcterms}creator`,layout:`${Zi.rendition}layout`,titleType:`${Qi}title-type`,displaySeq:`${Qi}display-seq`,alternateScript:`${Qi}alternate-script`};function eo(e,t){const n={};return(i,o)=>{let s,r;const a=i.r||n,l=o.r||n;if(e==Ji.title&&(s="main"==a[Ji.titleType])!=(r="main"==l[Ji.titleType]))return s?-1:1;let c=parseInt(a[Ji.displaySeq],10);isNaN(c)&&(c=Number.MAX_VALUE);let h=parseInt(l[Ji.displaySeq],10);return isNaN(h)&&(h=Number.MAX_VALUE),c!=h?c-h:e!=Ji.language&&t&&(s=(a[Ji.language]||a[Ji.alternateScript])==t)!=(r=(l[Ji.language]||l[Ji.alternateScript])==t)?s?-1:1:i.o-o.o}}function to(){const e=window.MathJax;return e?e.Hub:null}const no={"application/xhtml+xml":!0,"image/jpeg":!0,"image/png":!0,"image/svg+xml":!0,"image/gif":!0,"audio/mp3":!0},io="viv-id-";class oo{constructor(e,t){this.store=e,this.pubURL=t,this.opfXML=null,this.encXML=null,this.items=null,this.spine=null,this.itemMap=null,this.itemMapByPath=null,this.uid=null,this.bindings={},this.lang=null,this.epageCount=0,this.prePaginated=!1,this.epageIsRenderedPage=!0,this.epageCountCallback=null,this.metadata={},this.ncxToc=null,this.xhtmlToc=null,this.cover=null,this.fallbackMap={},this.pageProgression=null,this.documentURLTransformer=this.createDocumentURLTransformer(),to()&&(U.H[w.a.MATHML]=!0)}createDocumentURLTransformer(){const e=this;return new class{transformFragment(e,t){const n=t+(e?`#${e}`:"");return io+w.r(n,":")}transformURL(t,n){const i=t.match(/^([^#]*)#?(.*)$/);if(i){const t=i[1]||n,o=i[2];if(t&&e.items.some(e=>e.src===t))return`#${this.transformFragment(o,t)}`}return t}restoreURL(e){"#"===e.charAt(0)&&(e=e.substring(1)),0===e.indexOf(io)&&(e=e.substring(io.length));const t=w.J(e,":").match(/^([^#]*)#?(.*)$/);return t?[t[1],t[2]]:[]}}}getMetadata(){return this.metadata}getPathFromURL(e){if(e.startsWith("data:"))return e===this.pubURL?"":e;if(this.pubURL){let t=w.C("",this.pubURL);return e===t||e+"/"===t?"":("/"!=t.charAt(t.length-1)&&(t+="/"),e.substr(0,t.length)==t?decodeURI(e.substr(t.length)):null)}return e}initWithXMLDoc(e,t,n,i){const s=this;this.opfXML=e,this.encXML=t;const r=e.doc().child("package"),a=r.attribute("unique-identifier")[0];if(a){const t=e.getElement(`${e.url}#${a}`);t&&(this.uid=t.textContent.replace(/[ \n\r\t]/g,""))}const l={};this.items=r.child("manifest").child("item").asArray().map(t=>{const n=new Ki,i=t;n.initWithElement(i,e.url);const o=i.getAttribute("fallback");return o&&!no[n.mediaType]&&(l[n.src]=o),!s.xhtmlToc&&n.itemProperties.nav&&(s.xhtmlToc=n),!s.cover&&n.itemProperties["cover-image"]&&(s.cover=n),n}),this.itemMap=w.w(this.items,qi),this.itemMapByPath=w.w(this.items,e=>s.getPathFromURL(e.src));for(const e in l){let t=e;for(;;){const n=this.itemMap[l[t]];if(!n)break;if(no[n.mediaType]){this.fallbackMap[e]=n.src;break}t=n.src}}this.spine=r.child("spine").child("itemref").asArray().map((e,t)=>{const n=e,i=n.getAttribute("idref"),o=s.itemMap[i];return o&&(o.itemRefElement=n,o.spineIndex=t),o});const c=r.child("spine").attribute("toc")[0];c&&(this.ncxToc=this.itemMap[c]);const h=r.child("spine").attribute("page-progression-direction")[0];h&&(this.pageProgression=function(e){switch(e){case"ltr":return o.LTR;case"rtl":return o.RTL;default:throw new Error(`unknown PageProgression: ${e}`)}}(h));const u=t?t.doc().child("encryption").child("EncryptedData").predicate(Pi.withChild("EncryptionMethod",Pi.withAttribute("Algorithm","http://www.idpf.org/2008/embedding"))).child("CipherData").child("CipherReference").attribute("URI"):[],d=r.child("bindings").child("mediaType").asArray();for(let e=0;e<d.length;e++){const t=d[e].getAttribute("handler"),n=d[e].getAttribute("media-type");n&&t&&this.itemMap[t]&&(this.bindings[n]=this.itemMap[t].src)}if(this.metadata=function(e,t){let n;if(t){n={};for(const e in Zi)n[e]=Zi[e];let e;for(;null!=(e=t.match(/^\s*([A-Z_a-z\u007F-\uFFFF][-.A-Z_a-z0-9\u007F-\uFFFF]*):\s*(\S+)/));)t=t.substr(e[0].length),n[e[1]]=e[2]}else n=Zi;const i=e=>{if(e){const t=e.match(/^\s*(([^:]*):)?(\S+)\s*$/);if(t){const e=t[2]?n[t[2]]:Qi;if(e)return e+t[3]}}return null};let o=1;const s=e.childElements().forEachNonNull(e=>{if("meta"==e.localName){const t=i(e.getAttribute("property"));if(t)return{name:t,value:e.textContent,id:e.getAttribute("id"),order:o++,refines:e.getAttribute("refines"),lang:null,scheme:i(e.getAttribute("scheme"))}}else if(e.namespaceURI==w.a.DC)return{name:Zi.dcterms+e.localName,order:o++,lang:e.getAttribute("xml:lang"),value:e.textContent,id:e.getAttribute("id"),refines:null,scheme:null};return null}),r=w.A(s,e=>e.refines),a=e=>w.z(e,(e,t)=>e.map(e=>{const t={v:e.value,o:e.order};if(e.schema&&(t.s=e.scheme),e.id||e.lang){let n=r[e.id];if(n||e.lang){if(e.lang){const t={name:Ji.language,value:e.lang,lang:null,id:null,refines:e.id,scheme:null,order:e.order};n?n.push(t):n=[t]}const i=w.A(n,e=>e.name);t.r=a(i)}}return t})),l=a(w.A(s,e=>e.refines?null:e.name));let c=null;l[Ji.language]&&(c=l[Ji.language][0].v);const h=e=>{for(const t in e){const n=e[t];n.sort(eo(t,c));for(let e=0;e<n.length;e++){const t=n[e].r;t&&h(t)}}};return h(l),l}(r.child("metadata"),r.attribute("prefix")[0]),this.metadata[Ji.language]&&(this.lang=this.metadata[Ji.language][0].v),this.metadata[Ji.layout]&&(this.prePaginated="pre-paginated"===this.metadata[Ji.layout][0].v),!n){if(u.length>0&&this.uid){const e=function(e){const t=function(e){const t=Vi(e),n=[];for(const e of t)n.push(e>>>24&255,e>>>16&255,e>>>8&255,255&e);return n}(e);return e=>{const n=W.c("deobfuscator");let i,o;return e.slice?(i=e.slice(0,1040),o=e.slice(1040,e.size)):(i=e.webkitSlice(0,1040),o=e.webkitSlice(1040,e.size-1040)),H.g(i).then(e=>{const i=new DataView(e);for(let e=0;e<i.byteLength;e++){let n=i.getUint8(e);n^=t[e%20],i.setUint8(e,n)}n.finish(H.e([i,o]))}),n.result()}}(this.uid);for(let t=0;t<u.length;t++)this.store.deobfuscators[this.pubURL+u[t]]=e}return this.prePaginated&&this.assignAutoPages(),W.d(!0)}const p=new w.d,f={};if(u.length>0&&this.uid){const e=Yi(this.uid);for(let t=0;t<u.length;t++)f[u[t]]=e}for(let e=0;e<n.length;e++){const t=n[e],i=t.n;if(i){const e=decodeURI(i),n=this.itemMapByPath[e];let o=null;n&&(n.compressed=0!=t.m,n.compressedSize=t.c,n.mediaType&&(o=n.mediaType.replace(/\s+/g,"")));const s=f[e];(o||s)&&(p.append(i),p.append(" "),p.append(o||"application/octet-stream"),s&&(p.append(" "),p.append(s)),p.append("\n"))}}return s.assignAutoPages(),H.c(i,H.b.DEFAULT,"POST",p.toString(),"text/plain")}assignAutoPages(){let e=0;for(const t of this.spine){const n=this.prePaginated?1:Math.ceil(t.compressedSize/1024);t.epage=e,t.epageCount=n,e+=n}this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(e){this.epageIsRenderedPage=e||this.prePaginated}countEPages(e){if(this.epageCountCallback=e,this.epageIsRenderedPage)return this.prePaginated&&0==this.epageCount&&this.assignAutoPages(),W.d(!0);let t=0,n=0;const i=W.c("countEPages");return i.loopWithFrame(e=>{if(n===this.spine.length)return void e.breakLoop();const i=this.spine[n++];i.epage=t,this.store.load(i.src).then(n=>{let o=1800;const s=n.lang||this.lang;s&&s.match(/^(ja|ko|zh)/)&&(o/=3),i.epageCount=Math.ceil(n.getTotalOffset()/o),t+=i.epageCount,this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount),e.continueLoop()})}).thenFinish(i),i.result()}initWithChapters(e,t){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;const n=this.opfXML=new Ci(null,"",(new DOMParser).parseFromString("<spine></spine>","text/xml"));return e.forEach(e=>{const t=new Ki;t.initWithParam(e),b.a(t.id);const i=n.document.createElement("itemref");i.setAttribute("idref",t.id),n.root.appendChild(i),t.itemRefElement=i,this.itemMap[t.id]=t;let o=this.getPathFromURL(e.url);null==o&&(o=e.url),this.itemMapByPath[o]=t,this.items.push(t)}),t?this.store.addDocument(e[0].url,t):W.d(null)}initWithWebPubManifest(e,t){e.readingProgression&&(this.pageProgression=e.readingProgression),void 0===this.metadata&&(this.metadata={});const n=t&&t.title||e.name||e.metadata&&e.metadata.title;n&&(this.metadata[Ji.title]=[{v:n}]);const i=this.getPathFromURL(this.pubURL);if(!e.readingOrder&&t&&null!==i){e.readingOrder=[encodeURI(i)];const n="[role=doc-toc] a[href],[role=directory] a[href],nav li a[href],.toc a[href],#toc a[href]";Array.from(t.querySelectorAll(n)).forEach(t=>{const n=w.I(w.C(t.getAttribute("href"),this.pubURL)),i=this.getPathFromURL(n),o=null!==i?encodeURI(i):n;-1==e.readingOrder.indexOf(o)&&e.readingOrder.push(o)})}const o=[];let s=0,r=-1;[e.readingOrder,e.resources].forEach(t=>{t instanceof Array&&t.forEach(t=>{const n=e.readingOrder.includes(t),i="string"==typeof t?t:t.url||t.href,a="string"==typeof t?"":t.encodingFormat||t.href&&t.type||"";if(n||"text/html"===a||"application/xhtml+xml"===a||/(^|\/)([^/]+\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(i)){const e={url:w.C(w.n(i),this.pubURL),index:s++,startPage:null,skipPagesBefore:null};"contents"===t.rel&&-1===r&&(r=e.index),o.push(e)}})});const a=W.c("initWithWebPubManifest");return this.initWithChapters(o).then(()=>{-1!==r&&(this.xhtmlToc=this.items[r]),this.xhtmlToc||(this.xhtmlToc=this.itemMapByPath[i]),a.finish(!0)}),a.result()}getCFI(e,t){const n=this.spine[e],i=W.c("getCFI");return this.store.load(n.src).then(e=>{const o=e.getNodeByOffset(t);let s=null;if(o){const i=e.getNodeOffset(o,0,!1),r=t-i,a=new A;a.prependPathFromNode(o,r,!1,null),n.itemRefElement&&a.prependPathFromNode(n.itemRefElement,0,!1,null),s=a.toString()}i.finish(s)}),i.result()}resolveFragment(e){const t=this;return W.b("resolveFragment",n=>{if(!e)return void n.finish(null);let i,o=new A;if(o.fromString(e),t.opfXML){const e=o.navigate(t.opfXML.document);if(1!=e.node.nodeType||e.after||!e.ref)return void n.finish(null);const s=e.node,r=s.getAttribute("idref");if("itemref"!=s.localName||!r||!t.itemMap[r])return void n.finish(null);i=t.itemMap[r],o=e.ref}else i=t.spine[0];t.store.load(i.src).then(e=>{const t=o.navigate(e.document),s=e.getNodeOffset(t.node,t.offset,t.after);n.finish({spineIndex:i.spineIndex,offsetInItem:s,pageIndex:-1})})},(t,n)=>{c.b.warn(n,"Cannot resolve fragment:",e),t.finish(null)})}resolveEPage(e){const t=this;return W.b("resolveEPage",n=>{if(e<=0)return void n.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});if(t.epageIsRenderedPage){let i=t.spine.findIndex(t=>0==t.epage&&0==t.epageCount||t.epage<=e&&t.epage+t.epageCount>e);-1==i&&(i=t.spine.length-1);let o=t.spine[i];o&&0!=o.epageCount||(o=t.spine[--i]);const s=Math.floor(e-o.epage);return void n.finish({spineIndex:i,offsetInItem:-1,pageIndex:s})}let i=w.i(t.spine.length,n=>{const i=t.spine[n];return i.epage+i.epageCount>e});i==t.spine.length&&i--;const o=t.spine[i];t.store.load(o.src).then(t=>{(e-=o.epage)>o.epageCount&&(e=o.epageCount);let s=0;if(e>0){const n=t.getTotalOffset();(s=Math.round(n*e/o.epageCount))==n&&s--}n.finish({spineIndex:i,offsetInItem:s,pageIndex:-1})})},(t,n)=>{c.b.warn(n,"Cannot resolve epage:",e),t.finish(null)})}getEPageFromPosition(e){const t=this.spine[e.spineIndex];if(this.epageIsRenderedPage){const n=t.epage+e.pageIndex;return W.d(n)}if(e.offsetInItem<=0)return W.d(t.epage);const n=W.c("getEPage");return this.store.load(t.src).then(i=>{const o=i.getTotalOffset(),s=Math.min(o,e.offsetInItem);n.finish(t.epage+s*t.epageCount/o)}),n.result()}}const so=(e,t)=>({page:e,position:{spineIndex:e.spineIndex,pageIndex:t,offsetInItem:e.offset}});class ro{constructor(e,t,n,i,o){this.opf=e,this.viewport=t,this.fontMapper=n,this.pageSheetSizeReporter=o,this.spineItems=[],this.spineItemLoadingContinuations=[],this.tocAutohide=!1,this.pref=k.E(i),this.clientLayout=new yi(t),this.counterStore=new _(e.documentURLTransformer)}getPage(e){const t=this.spineItems[e.spineIndex];return t?t.pages[e.pageIndex]:null}getCurrentPageProgression(e){if(this.opf.pageProgression)return this.opf.pageProgression;{const t=this.spineItems[e?e.spineIndex:0];return t?t.instance.pageProgression:null}}finishPageContainer(e,t,n){t.container.style.display="none",t.container.style.visibility="visible",t.container.style.position="",t.container.style.top="",t.container.style.left="",t.container.setAttribute("data-vivliostyle-page-side",t.side);const i=e.pages[n];if(t.isFirstPage=0==e.item.spineIndex&&0==n,e.pages[n]=t,this.opf.epageIsRenderedPage){if(0==n&&e.item.spineIndex>0){const t=this.opf.spine[e.item.spineIndex-1];e.item.epage=t.epage+t.epageCount}e.item.epageCount=e.pages.length,this.opf.epageCount=this.opf.spine.reduce((e,t)=>e+t.epageCount,0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(i)e.instance.viewport.contentContainer.replaceChild(t.container,i.container),i.dispatchEvent({type:"replaced",target:null,currentTarget:null,preventDefault:null,newPage:t});else{let i=null;if(n>0)i=e.pages[n-1].container.nextElementSibling;else for(let t=e.item.spineIndex+1;t<this.spineItems.length;t++){const e=this.spineItems[t];if(e&&e.pages[0]){i=e.pages[0].container;break}}e.instance.viewport.contentContainer.insertBefore(t.container,i)}this.pageSheetSizeReporter({width:e.instance.pageSheetWidth,height:e.instance.pageSheetHeight},e.instance.pageSheetSize,e.item.spineIndex,e.instance.pageNumberOffset+n)}renderSinglePage(e,t){const n=W.c("renderSinglePage");let i=this.makePage(e,t);const o=this;return e.instance.layoutNextPage(i,t).then(s=>{const r=(t=s)?t.page-1:e.layoutPositions.length-1;o.finishPageContainer(e,i,r),o.counterStore.finishPage(i.spineIndex,r);let a=null;if(t){const n=e.layoutPositions[t.page];e.layoutPositions[t.page]=t,n&&e.pages[t.page]&&(t.isSamePosition(n)||(a=o.renderSinglePage(e,t)))}a||(a=W.d(!0)),a.then(()=>{const s=o.counterStore.getUnresolvedRefsToPage(i);let a=0;n.loopWithFrame(e=>{if(++a>s.length)return void e.breakLoop();const t=s[a-1];t.refs=t.refs.filter(e=>!e.isResolved()),0!==t.refs.length?o.getPageViewItem(t.spineIndex).then(n=>{if(!n)return void e.continueLoop();o.counterStore.pushPageCounters(t.pageCounters),o.counterStore.pushReferencesToSolve(t.refs);const s=n.layoutPositions[t.pageIndex];o.renderSinglePage(n,s).then(t=>{o.counterStore.popPageCounters(),o.counterStore.popReferencesToSolve();const n=t.pageAndPosition.position;n.spineIndex===i.spineIndex&&n.pageIndex===r&&(i=t.pageAndPosition.page),e.continueLoop()})}):e.continueLoop()}).then(()=>{i.container.parentElement||(i=e.pages[r]),i.isLastPage=!t&&e.item.spineIndex===o.opf.spine.length-1,i.isLastPage&&(b.a(o.viewport),o.counterStore.finishLastPage(o.viewport)),n.finish({pageAndPosition:so(i,r),nextLayoutPosition:t})})})}),n.result()}normalizeSeekPosition(e,t){let n=e.pageIndex,i=-1;if(n<0){i=e.offsetInItem;const o=w.i(t.layoutPositions.length,e=>t.instance.getPosition(t.layoutPositions[e],!0)>i);n=o===t.layoutPositions.length?t.complete?t.layoutPositions.length-1:Number.POSITIVE_INFINITY:o-1}else n===Number.POSITIVE_INFINITY&&-1!==e.offsetInItem&&(i=e.offsetInItem);return{spineIndex:e.spineIndex,pageIndex:n,offsetInItem:i}}findPage(e,t){const n=this,i=W.c("findPage");return n.getPageViewItem(e.spineIndex).then(o=>{if(!o)return void i.finish(null);let s,r=null;i.loopWithFrame(a=>{const l=n.normalizeSeekPosition(e,o);s=l.pageIndex,(r=o.pages[s])?a.breakLoop():o.complete?(s=o.layoutPositions.length-1,r=o.pages[s],a.breakLoop()):t?n.renderPage(l).then(e=>{e&&(r=e.page,s=e.position.pageIndex),a.breakLoop()}):i.sleep(100).then(()=>{a.continueLoop()})}).then(()=>{b.a(r),i.finish(so(r,s))})}),i.result()}renderPage(e){const t=this,n=W.c("renderPage");return t.getPageViewItem(e.spineIndex).then(i=>{if(!i)return void n.finish(null);const o=t.normalizeSeekPosition(e,i);let s=o.pageIndex;const r=o.offsetInItem;let a=i.pages[s];a?n.finish(so(a,s)):n.loopWithFrame(e=>{if(s<i.layoutPositions.length)return void e.breakLoop();if(i.complete)return s=i.layoutPositions.length-1,void e.breakLoop();let n=i.layoutPositions[i.layoutPositions.length-1];t.renderSinglePage(i,n).then(t=>{const o=t.pageAndPosition.page;if(n=t.nextLayoutPosition){if(r>=0&&i.instance.getPosition(n)>r)return a=o,s=i.layoutPositions.length-2,void e.breakLoop();e.continueLoop()}else a=o,s=t.pageAndPosition.position.pageIndex,i.complete=!0,e.breakLoop()})}).then(()=>{a=a||i.pages[s];const e=i.layoutPositions[s];a?n.finish(so(a,s)):t.renderSinglePage(i,e).then(e=>{e.nextLayoutPosition||(i.complete=!0),n.finish(e.pageAndPosition)})})}),n.result()}renderAllPages(){return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1)}renderPagesUpto(e,t){const n=this,i=W.c("renderPagesUpto");e||(e={spineIndex:0,pageIndex:0,offsetInItem:0});const o=e.spineIndex,s=e.pageIndex;let r,a=0;return t&&(a=o),i.loopWithFrame(t=>{const i={spineIndex:a,pageIndex:a===o?s:Number.POSITIVE_INFINITY,offsetInItem:a===o?e.offsetInItem:-1};n.renderPage(i).then(e=>{r=e,++a>o?t.breakLoop():t.continueLoop()})}).then(()=>{i.finish(r)}),i.result()}firstPage(e,t){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},t)}lastPage(e,t){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},t)}nextPage(e,t){const n=this;let i=e.spineIndex,o=e.pageIndex;const s=W.c("nextPage");return n.getPageViewItem(i).then(e=>{if(e){if(e.complete&&o==e.layoutPositions.length-1){if(i>=n.opf.spine.length-1)return void s.finish(null);i++,o=0;const t=this.spineItems[i],r=t&&t.pages[0],a=e.pages[e.pages.length-1];r&&a&&r.side==a.side&&(t.pages.forEach(e=>{e.container&&e.container.remove()}),this.spineItems[i]=null,this.spineItemLoadingContinuations[i]=null)}else o++;n.findPage({spineIndex:i,pageIndex:o,offsetInItem:-1},t).thenFinish(s)}else s.finish(null)}),s.result()}previousPage(e,t){let n=e.spineIndex,i=e.pageIndex;if(0==i){if(0==n)return W.d(null);n--,i=Number.POSITIVE_INFINITY}else i--;return this.findPage({spineIndex:n,pageIndex:i,offsetInItem:-1},t)}isRectoPage(e,t){const n=e.side===s.LEFT,i=this.getCurrentPageProgression(t)===o.LTR;return!n&&i||n&&!i}getSpread(e,t){const n=W.c("getCurrentSpread"),i=this.getPage(e);if(!i)return W.d({left:null,right:null});const o=i.side===s.LEFT;let r;return(r=this.isRectoPage(i,e)?this.previousPage(e,t):this.nextPage(e,t)).then(t=>{const i=this.getPage(e);let s=t&&t.page;s&&s.side===i.side&&(s=null),o?n.finish({left:i,right:s}):n.finish({left:s,right:i})}),n.result()}nextSpread(e,t){const n=this.getPage(e);if(!n)return W.d(null);const i=this.isRectoPage(n,e),o=this.nextPage(e,t);if(i)return o;{const e=this;return o.thenAsync(i=>{if(i){if(i.page.side===n.side)return o;const s=e.nextPage(i.position,t);return s.thenAsync(e=>e?s:o)}return W.d(null)})}}previousSpread(e,t){const n=this.getPage(e);if(!n)return W.d(null);const i=this.isRectoPage(n,e),o=this.previousPage(e,t),s=n.container.previousElementSibling;if(i){const e=this;return o.thenAsync(i=>i?i.page.side===n.side?o:i.page.container!==s?o:e.previousPage(i.position,t):W.d(null))}return o}navigateToEPage(e,t,n){const i=W.c("navigateToEPage"),o=this;return this.opf.resolveEPage(e).then(e=>{e?o.findPage(e,n).thenFinish(i):i.finish(null)}),i.result()}navigateToFragment(e,t,n){const i=W.c("navigateToCFI"),o=this;return o.opf.resolveFragment(e).then(e=>{e?o.findPage(e,n).thenFinish(i):i.finish(null)}),i.result()}navigateTo(e,t,n){c.b.debug("Navigate to",e);let i=this.opf.getPathFromURL(w.I(e));if(!i){if(this.opf.opfXML&&e.match(/^#epubcfi\(/))i=this.opf.getPathFromURL(this.opf.opfXML.url);else if("#"===e.charAt(0)){const t=this.opf.documentURLTransformer.restoreURL(e);this.opf.opfXML?null==(i=this.opf.getPathFromURL(t[0]))&&(i=t[0]):i=t[0],e=t[0]+(t[1]?`#${t[1]}`:"")}if(null==i)return W.d(null)}const o=this.opf.itemMapByPath[i];if(!o){if(this.opf.opfXML&&i==this.opf.getPathFromURL(this.opf.opfXML.url)){const i=e.indexOf("#");if(i>=0)return this.navigateToFragment(e.substr(i+1),t,n)}return W.d(null)}const s=W.c("navigateTo"),r=this;return r.getPageViewItem(o.spineIndex).then(i=>{if(!i)return void s.finish(null);const a=i.xmldoc.getElement(e);a?r.findPage({spineIndex:o.spineIndex,pageIndex:-1,offsetInItem:i.xmldoc.getElementOffset(a)},n).thenFinish(s):t.spineIndex!==o.spineIndex?r.findPage({spineIndex:o.spineIndex,pageIndex:0,offsetInItem:-1},n).thenFinish(s):s.finish(null)}),s.result()}makePage(e,t){const n=e.instance.viewport,o=n.document.createElement("div");o.setAttribute("data-vivliostyle-page-container","true"),o.setAttribute("role","region"),o.style.position="absolute",o.style.top="0",o.style.left="0",i||(o.style.visibility="hidden",o.setAttribute("aria-hidden","true")),n.layoutBox.appendChild(o);const s=n.document.createElement("div");s.setAttribute("data-vivliostyle-bleed-box","true"),o.appendChild(s);const r=new X.l(o,s);if(r.spineIndex=e.item.spineIndex,r.position=t,r.offset=e.instance.getPosition(t),0===r.offset){const t=this.opf.documentURLTransformer.transformFragment("",e.item.src);s.setAttribute("id",t),r.registerElementWithId(s,t)}if(n!==this.viewport){const e=k.L(this.viewport.width,this.viewport.height,n.width,n.height),t=z.m(null,new V.b(e,null),"");r.delayedItems.push(new X.d(o,"transform",t))}return r}makeObjectView(e,t,n,i){let o=t.getAttribute("data"),s=null;if(o){o=w.C(o,e.url);let n=t.getAttribute("media-type");if(!n){const e=this.opf.getPathFromURL(o);if(e){const t=this.opf.itemMapByPath[e];t&&(n=t.mediaType)}}if(n){const e=this.opf.bindings[n];if(e){(s=this.viewport.document.createElement("iframe")).style.border="none";const i=w.y(o),r=w.y(n),a=new w.d;a.append(e),a.append("?src="),a.append(i),a.append("&type="),a.append(r);for(let e=t.firstChild;e;e=e.nextSibling)if(1==e.nodeType){const t=e;if("param"==t.localName&&t.namespaceURI==w.a.XHTML){const e=t.getAttribute("name"),n=t.getAttribute("value");e&&n&&(a.append("&"),a.append(encodeURIComponent(e)),a.append("="),a.append(encodeURIComponent(n)))}}s.setAttribute("src",a.toString());const l=t.getAttribute("width");l&&s.setAttribute("width",l);const c=t.getAttribute("height");c&&s.setAttribute("height",c)}}}return s||(s=this.viewport.document.createElement("span")).setAttribute("data-adapt-process-children","true"),W.d(s)}makeMathJaxView(e,t,n,i){const o=to();if(o){const i=n.ownerDocument,s=i.createElement("span");n.appendChild(s);const r=i.importNode(t,!0);this.resolveURLsInMathML(r,e),s.appendChild(r);const a=o.queue;a.Push(["Typeset",o,s]);const l=W.c("makeMathJaxView"),c=l.suspend();return a.Push(()=>{c.schedule(s)}),l.result()}return W.d(null)}resolveURLsInMathML(e,t){if(null!=e){if(1===e.nodeType&&"mglyph"===e.tagName){const n=Array.from(e.attributes);for(const i of n){if("src"!==i.name)continue;const n=w.C(i.nodeValue,t.url);i.namespaceURI?e.setAttributeNS(i.namespaceURI,i.name,n):e.setAttribute(i.name,n)}}e.firstChild&&this.resolveURLsInMathML(e.firstChild,t),e.nextSibling&&this.resolveURLsInMathML(e.nextSibling,t)}}makeSSEView(e,t,n,i){const o=n?n.ownerDocument:this.viewport.document,s=t.localName;let r;switch(s){case"t":case"tab":case"ec":case"nt":case"fraction":case"comment":case"mark":r="span";break;case"ruby":case"rp":case"rt":r=s;break;default:r="div"}const a=o.createElement(r);return a.setAttribute("data-adapt-process-children","true"),W.d(a)}makeCustomRenderer(e){const t=this;return(n,i,o)=>"object"==n.localName&&n.namespaceURI==w.a.XHTML?t.makeObjectView(e,n,i,o):n.namespaceURI==w.a.MATHML?t.makeMathJaxView(e,n,i,o):n.namespaceURI==w.a.SSE?t.makeSSEView(e,n,i,o):n.dataset&&"true"==n.dataset.mathTypeset?t.makeMathJaxView(e,n,i,o):W.d(null)}getPageViewItem(e){const t=this;if(-1===e||e>=t.opf.spine.length)return W.d(null);let n=t.spineItems[e];if(n)return W.d(n);const i=W.c("getPageViewItem");let o=this.spineItemLoadingContinuations[e];if(o){const e=i.suspend();return o.push(e),i.result()}o=this.spineItemLoadingContinuations[e]=[];const s=t.opf.spine[e],r=t.opf.store;return r.load(s.src).then(a=>{s.title=a.document.title;const l=r.getStyleForDoc(a),c=t.makeCustomRenderer(a);let h=t.viewport;const u=l.sizeViewport(h.width,h.height,h.fontSize,t.pref);u.width==h.width&&u.height==h.height&&u.fontSize==h.fontSize||(h=new Si(h.window,u.fontSize,h.root,u.width,u.height));const d=t.spineItems[e-1];let p;null!==s.startPage?p=s.startPage-1:(!(e>0)||d&&d.complete?p=d?d.instance.pageNumberOffset+d.pages.length:0:(p=s.epage||e,t.opf.prePaginated||p%2!=0||p++),null!==s.skipPagesBefore&&(p+=s.skipPagesBefore)),t.counterStore.forceSetPageCounter(p);const f=new Li(l,a,t.opf.lang,h,t.clientLayout,t.fontMapper,c,t.opf.fallbackMap,p,t.opf.documentURLTransformer,t.counterStore,t.opf.pageProgression);f.pref=t.pref;const g=t.opf.metadata&&t.opf.metadata[Ji.title];f.pubTitle=g&&g[0]&&g[0].v||"",f.docTitle=s.title||"",f.init().then(()=>{n={item:s,xmldoc:a,instance:f,layoutPositions:[null],pages:[],complete:!1},t.spineItems[e]=n,i.finish(n),o.forEach(e=>{e.schedule(n)})})}),i.result()}removeRenderedPages(){const e=this.spineItems;for(const t of e)t&&t.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){const e=this.spineItems;for(const t of e)if(t){const e=t.pages;for(const t of e)if(t.isAutoPageWidth&&t.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some(e=>e&&e.pages.length>0)}showTOC(e){const t=this.opf,n=t.xhtmlToc||t.ncxToc;if(this.tocAutohide=e,!n)return W.d(null);if(this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility="visible",this.tocView.page.container.setAttribute("aria-hidden","false"),W.d(this.tocView.page);const i=W.c("showTOC");this.tocView||(this.tocView=new Wi(t.store,n.src,t.lang,this.clientLayout,this.fontMapper,this.pref,this,t.fallbackMap,t.documentURLTransformer,this.counterStore));const o=this.viewport,s=Math.min(350,Math.round(.67*o.width)-16),r=o.height-6,a=o.document.createElement("div");return o.root.appendChild(a),a.style.visibility="hidden",a.style.width=`${s+10}px`,a.style.maxHeight=`${r}px`,a.setAttribute("data-vivliostyle-toc-box","true"),a.setAttribute("role","navigation"),this.tocView.showTOC(a,o,s,r,this.viewport.fontSize).then(e=>{a.style.visibility="visible",a.setAttribute("aria-hidden","false"),i.finish(e)}),i.result()}hideTOC(){this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return!!this.tocView&&this.tocView.isTOCVisible()}}const ao="data-vivliostyle-viewer-status",lo="data-vivliostyle-spread-view";var co,ho;!function(e){e.SINGLE_PAGE="singlePage",e.SPREAD="spread",e.AUTO_SPREAD="autoSpread"}(co||(co={}));class uo{constructor(e,t,n,o){this.window=e,this.viewportElement=t,this.instanceId=n,this.callbackFn=o,this.pageSheetSizeAlreadySet=!1,this.renderTask=null;const s=this;t.setAttribute("data-vivliostyle-viewer-viewport",!0),i&&t.setAttribute("data-vivliostyle-debug",!0),t.setAttribute(ao,"loading");const r=e.document;this.fontMapper=new Kt(r.head,t),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{s.needResize=!0,s.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=e=>{},this.pageRuleStyleElement=r.getElementById("vivliostyle-page-rules"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState=r.LOADING,this.packageURL=[],this.opf=null,this.haveZipMetadata=!1,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode=co.SINGLE_PAGE,this.waitForLoading=!1,this.renderAllPages=!0,this.pref=k.F(),this.pageSizes=[]}addLogListeners(){const e=c.a;c.b.addListener(e.DEBUG,e=>{this.callback({t:"debug",content:e})}),c.b.addListener(e.INFO,e=>{this.callback({t:"info",content:e})}),c.b.addListener(e.WARN,e=>{this.callback({t:"warn",content:e})}),c.b.addListener(e.ERROR,e=>{this.callback({t:"error",content:e})})}callback(e){e.i=this.instanceId,this.callbackFn(e)}setReadyState(e){this.readyState!==e&&(this.readyState=e,this.viewportElement.setAttribute(ao,e),this.callback({t:"readystatechange"}))}loadPublication(e){g.registerStartTiming("beforeRender"),this.setReadyState(r.LOADING);const t=e.url,n=e.fragment,i=!!e.zipmeta,o=e.authorStyleSheet,s=e.userStyleSheet;this.viewport=null;const a=W.c("loadPublication"),l=this;return l.configure(e).then(()=>{const e=new ji;e.init(o,s).then(()=>{const o=w.C(w.n(t),l.window.location.href);l.packageURL=[o],e.loadPubDoc(o,i).then(e=>{e?(l.opf=e,l.render(n).then(()=>{a.finish(!0)})):a.finish(!1)})})}),a.result()}loadXML(e){g.registerStartTiming("beforeRender"),this.setReadyState(r.LOADING);const t=e.url,n=e.document,i=e.fragment,o=e.authorStyleSheet,s=e.userStyleSheet;this.viewport=null;const a=W.c("loadXML"),l=this;return l.configure(e).then(()=>{const e=new ji;e.init(o,s).then(()=>{const o=t.map((e,t)=>({url:w.C(w.n(e.url),l.window.location.href),index:t,startPage:e.startPage,skipPagesBefore:e.skipPagesBefore}));l.packageURL=o.map(e=>e.url),l.opf=new oo(e,""),l.opf.initWithChapters(o,n).then(()=>{l.render(i).then(()=>{a.finish(!0)})})})}),a.result()}render(e){this.cancelRenderingTask();const t=this;let n;return(n=e?this.opf.resolveFragment(e).thenAsync(e=>(t.pagePosition=e,W.d(!0))):W.d(!0)).thenAsync(()=>(g.registerEndTiming("beforeRender"),t.resize()))}resolveLength(e){const t=parseFloat(e);let n;if("string"==typeof e&&(n=e.match(/[a-z]+$/))){const e=n[0];if("em"===e||"rem"===e)return t*this.fontSize;if("ex"===e)return t*k.G.ex*this.fontSize/k.G.em;const i=k.G[e];if(i)return t*i}return t}configure(e){if("boolean"==typeof e.autoresize&&(e.autoresize?(this.viewportSize=null,this.window.addEventListener("resize",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener("resize",this.resizeListener,!1)),"number"==typeof e.fontSize){const t=e.fontSize;t>=5&&t<=72&&this.fontSize!=t&&(this.fontSize=t,this.needResize=!0)}if("object"==typeof e.viewport&&e.viewport){const t=e.viewport,n={marginLeft:this.resolveLength(t["margin-left"])||0,marginRight:this.resolveLength(t["margin-right"])||0,marginTop:this.resolveLength(t["margin-top"])||0,marginBottom:this.resolveLength(t["margin-bottom"])||0,width:this.resolveLength(t.width)||0,height:this.resolveLength(t.height)||0};(n.width>=200||n.height>=200)&&(this.window.removeEventListener("resize",this.resizeListener,!1),this.viewportSize=n,this.needResize=!0)}return"boolean"==typeof e.hyphenate&&(this.pref.hyphenate=e.hyphenate,this.needResize=!0),"boolean"==typeof e.horizontal&&(this.pref.horizontal=e.horizontal,this.needResize=!0),"boolean"==typeof e.nightMode&&(this.pref.nightMode=e.nightMode,this.needResize=!0),"number"==typeof e.lineHeight&&(this.pref.lineHeight=e.lineHeight,this.needResize=!0),"number"==typeof e.columnWidth&&(this.pref.columnWidth=e.columnWidth,this.needResize=!0),"string"==typeof e.fontFamily&&(this.pref.fontFamily=e.fontFamily,this.needResize=!0),"boolean"==typeof e.load&&(this.waitForLoading=e.load),"boolean"==typeof e.renderAllPages&&(this.renderAllPages=e.renderAllPages),"string"==typeof e.userAgentRootURL&&(w.E(e.userAgentRootURL.replace(/resources\/?$/,"")),w.G(e.userAgentRootURL)),"string"==typeof e.rootURL&&(w.E(e.rootURL),w.G(`${w.h}resources/`)),"string"==typeof e.pageViewMode&&e.pageViewMode!==this.pageViewMode&&(this.pageViewMode=e.pageViewMode,this.needResize=!0),"number"==typeof e.pageBorder&&e.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=e.pageBorder,this.needResize=!0),"number"==typeof e.zoom&&e.zoom!==this.zoom&&(this.zoom=e.zoom,this.needRefresh=!0),"boolean"==typeof e.fitToScreen&&e.fitToScreen!==this.fitToScreen&&(this.fitToScreen=e.fitToScreen,this.needRefresh=!0),"object"==typeof e.defaultPaperSize&&"number"==typeof e.defaultPaperSize.width&&"number"==typeof e.defaultPaperSize.height&&(this.viewport=null,this.pref.defaultPaperSize=e.defaultPaperSize,this.needResize=!0),this.configurePlugins(e),W.d(!0)}configurePlugins(e){l.b(l.a.CONFIGURATION).forEach(t=>{const n=t(e);this.needResize=n.needResize||this.needResize,this.needRefresh=n.needRefresh||this.needRefresh})}pageReplacedListener(e){const t=this.currentPage,n=this.currentSpread,i=e.target;n?n.left!==i&&n.right!==i||this.showCurrent(e.newPage):t===e.target&&this.showCurrent(e.newPage)}forCurrentPages(e){const t=[];this.currentPage&&t.push(this.currentPage),this.currentSpread&&(t.push(this.currentSpread.left),t.push(this.currentSpread.right)),t.forEach(t=>{t&&e(t)})}removePageListeners(){this.forCurrentPages(e=>{e.removeEventListener("hyperlink",this.hyperlinkListener,!1),e.removeEventListener("replaced",this.pageReplacedListener,!1)})}hidePages(){this.removePageListeners(),this.forCurrentPages(e=>{w.F(e.container,"display","none"),e.container.setAttribute("aria-hidden","true")}),this.currentPage=null,this.currentSpread=null}showSinglePage(e){e.addEventListener("hyperlink",this.hyperlinkListener,!1),e.addEventListener("replaced",this.pageReplacedListener,!1),w.F(e.container,"visibility","visible"),w.F(e.container,"display","block"),e.container.setAttribute("aria-hidden","false")}showPage(e){this.hidePages(),this.currentPage=e,e.container.style.marginLeft="",e.container.style.marginRight="",this.showSinglePage(e)}showSpread(e){if(this.hidePages(),this.currentSpread=e,e.left&&e.right){let t=parseFloat(e.left.container.style.width),n=parseFloat(e.right.container.style.width);t&&n&&t!==n&&(t<n?e.left.container.style.marginLeft=`${n-t}px`:e.right.container.style.marginRight=`${t-n}px`)}e.left&&(this.showSinglePage(e.left),e.right?e.left.container.removeAttribute("data-vivliostyle-unpaired-page"):e.left.container.setAttribute("data-vivliostyle-unpaired-page",!0)),e.right&&(this.showSinglePage(e.right),e.left?e.right.container.removeAttribute("data-vivliostyle-unpaired-page"):e.right.container.setAttribute("data-vivliostyle-unpaired-page",!0))}reportPosition(){const e=W.c("reportPosition"),t=this;return b.a(t.pagePosition),t.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then(n=>{const i=t.currentPage;(t.waitForLoading&&i.fetchers.length>0?Vt.c(i.fetchers):W.d(!0)).then(()=>{t.sendLocationNotification(i,n).thenFinish(e)})}),e.result()}createViewport(){const e=this.viewportElement;if(this.viewportSize){const t=this.viewportSize;return e.style.marginLeft=`${t.marginLeft}px`,e.style.marginRight=`${t.marginRight}px`,e.style.marginTop=`${t.marginTop}px`,e.style.marginBottom=`${t.marginBottom}px`,new Si(this.window,this.fontSize,e,t.width,t.height)}return new Si(this.window,this.fontSize,e)}resolveSpreadView(e){switch(this.pageViewMode){case co.SINGLE_PAGE:return!1;case co.SPREAD:return!0;case co.AUTO_SPREAD:default:return e.width/e.height>=1.45&&e.width>800}}updateSpreadView(e){this.pref.spreadView=e,this.viewportElement.setAttribute(lo,e.toString())}sizeIsGood(){const e=this.createViewport(),t=this.resolveSpreadView(e),n=this.pref.spreadView!==t;return this.updateSpreadView(t),!(this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize||(n||e.width!=this.viewport.width||e.height!=this.viewport.height)&&(n||e.width!=this.viewport.width||e.height==this.viewport.height||!/Android|iPhone|iPad|iPod/.test(navigator.userAgent))&&(!this.opfView||!this.opfView.hasPages()||this.opfView.hasAutoSizedPages()||(this.viewport.width=e.width,this.viewport.height=e.height,this.needRefresh=!0,0)))}setPageSize(e,t,n,i){this.pageSizes[i]=e,this.setPageSizePageRules(t,n,i)}setPageSizePageRules(e,t,n){if(!this.pageSheetSizeAlreadySet&&this.pageRuleStyleElement){let t="";Object.keys(e).forEach(n=>{t+=`@page ${n}{margin:0;size:`;const i=e[n];t+=`${i.width}px ${i.height}px;}`}),this.pageRuleStyleElement.textContent=t,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent="",this.pageSheetSizeAlreadySet=!1)}reset(){let e=!1,t=!1;this.opfView&&(e=this.opfView.isTOCVisible(),t=this.opfView.tocAutohide,this.opfView.hideTOC(),this.opfView.removeRenderedPages()),this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new ro(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),e&&this.sendCommand({a:"toc",v:"show",autohide:t})}showCurrent(e,t){this.needRefresh=!1,this.removePageListeners();const n=this;return this.pref.spreadView?this.opfView.getSpread(this.pagePosition,t).thenAsync(t=>(n.showSpread(t),n.setSpreadZoom(t),n.currentPage=e,W.d(null))):(this.showPage(e),this.setPageZoom(e),this.currentPage=e,W.d(null))}setPageZoom(e){const t=this.getAdjustedZoomFactor(e.dimensions);this.viewport.zoom(e.dimensions.width,e.dimensions.height,t)}setSpreadZoom(e){const t=this.getSpreadDimensions(e);this.viewport.zoom(t.width,t.height,this.getAdjustedZoomFactor(t))}getAdjustedZoomFactor(e){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(e):this.zoom}getSpreadDimensions(e){let t=0,n=0;return e.left&&(t+=e.left.dimensions.width,n=e.left.dimensions.height),e.right&&(t+=e.right.dimensions.width,n=Math.max(n,e.right.dimensions.height)),e.left&&e.right&&(t+=2*this.pref.pageBorder,t+=Math.abs(e.left.dimensions.width-e.right.dimensions.width)),{width:t,height:n}}queryZoomFactor(e){if(!this.currentPage)throw new Error("no page exists.");switch(e){case ho.FIT_INSIDE_VIEWPORT:{let e;return this.pref.spreadView?(b.a(this.currentSpread),e=this.getSpreadDimensions(this.currentSpread)):e=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(e)}default:throw new Error(`unknown zoom type: ${e}`)}}calculateZoomFactorToFitInsideViewPort(e){const t=this.viewport.width/e.width,n=this.viewport.height/e.height;return Math.min(t,n)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new po),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return W.d(!0);const e=this;this.setReadyState(r.LOADING),this.cancelRenderingTask();const t=W.a().getScheduler().run(()=>W.b("resize",n=>{e.opf?(e.renderTask=t,g.registerStartTiming("render (resize)"),e.reset(),e.pagePosition&&(0==e.pagePosition.pageIndex&&0==e.pagePosition.offsetInItem||(e.pagePosition.pageIndex=-1)),e.opf.setEPageCountMode(e.renderAllPages),e.opfView.renderPagesUpto(e.pagePosition,!e.renderAllPages).then(i=>{i?(e.pagePosition=i.position,e.showCurrent(i.page,!0).then(()=>{e.setReadyState(r.INTERACTIVE),e.opf.countEPages(t=>{const n={t:"nav",epageCount:t,first:e.currentPage.isFirstPage,last:e.currentPage.isLastPage,metadata:e.opf.metadata,docTitle:e.opf.spine[e.pagePosition.spineIndex].title};(e.currentPage.isFirstPage||0==e.pagePosition.pageIndex&&e.opf.spine[e.pagePosition.spineIndex].epage)&&(n.epage=e.opf.spine[e.pagePosition.spineIndex].epage),e.callback(n)}).then(()=>{e.reportPosition().then(i=>{(e.renderAllPages?e.opfView.renderAllPages():W.d(null)).then(()=>{e.renderTask===t&&(e.renderTask=null),g.registerEndTiming("render (resize)"),e.renderAllPages&&e.setReadyState(r.COMPLETE),e.callback({t:"loaded"}),n.finish(i)})})})})):n.finish(!1)})):n.finish(!1)},(e,t)=>{if(!(t instanceof po))throw t;g.registerEndTiming("render (resize)"),c.b.debug(t.message)}));return W.d(!0)}sendLocationNotification(e,t){const n=W.c("sendLocationNotification"),i={t:"nav",first:e.isFirstPage,last:e.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[e.spineIndex].title},o=this;return this.opf.getEPageFromPosition(o.pagePosition).then(e=>{i.epage=e,i.epageCount=o.opf.epageCount,t&&(i.cfi=t),o.callback(i),n.finish(!0)}),n.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(e){let t;const n=this;if(this.readyState!==r.COMPLETE&&"next"!==e.where&&this.setReadyState(r.LOADING),"string"==typeof e.where){let i;switch(e.where){case"next":i=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case"previous":i=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case"last":i=this.opfView.lastPage;break;case"first":i=this.opfView.firstPage;break;default:return W.d(!0)}i&&(t=()=>i.call(n.opfView,n.pagePosition,!n.renderAllPages))}else if("number"==typeof e.epage){const i=e.epage;t=()=>n.opfView.navigateToEPage(i,n.pagePosition,!n.renderAllPages)}else{if("string"!=typeof e.url)return W.d(!0);{const i=e.url;t=()=>n.opfView.navigateTo(i,n.pagePosition,!n.renderAllPages)}}const i=W.c("moveTo");return t.call(n.opfView).then(e=>{let t;if(e){n.pagePosition=e.position;const i=W.c("moveTo.showCurrent");t=i.result(),n.showCurrent(e.page,!n.renderAllPages).then(()=>{n.reportPosition().thenFinish(i)})}else t=W.d(!0);t.then(e=>{n.readyState===r.LOADING&&n.setReadyState(r.INTERACTIVE),i.finish(e)})}),i.result()}showTOC(e){const t=!!e.autohide,n=e.v,i=this.opfView.isTOCVisible(),o=t!=this.opfView.tocAutohide&&"hide"!=n;if(i){if("show"==n&&!o)return W.d(!0)}else if("hide"==n)return W.d(!0);if(i&&"show"!=n)return this.opfView.hideTOC(),W.d(!0);{const e=this,n=W.c("showTOC");return this.opfView.showTOC(t).then(i=>{if(i){if(o&&(i.listeners={}),t){const t=()=>{e.opfView.hideTOC()};i.addEventListener("hyperlink",t,!1)}i.addEventListener("hyperlink",e.hyperlinkListener,!1)}n.finish(!0)}),n.result()}}runCommand(e){const t=this,n=e.a||"";return W.b("runCommand",i=>{const o=t.actions[n];o?o.call(t,e).then(()=>{t.callback({t:"done",a:n}),i.finish(!0)}):(c.b.error("No such action:",n),i.finish(!0))},(e,t)=>{c.b.error(t,"Error during action:",n),e.finish(!0)})}initEmbed(e){let t=fo(e),n=null;const i=this;W.e(()=>{const e=W.c("commandLoop"),o=W.a().getScheduler();return i.hyperlinkListener=e=>{const t=e,n="#"===t.href.charAt(0)||i.packageURL.some(e=>t.href.substr(0,e.length)==e);if(n){e.preventDefault();const s={t:"hyperlink",href:t.href,internal:n};o.run(()=>(i.callback(s),W.d(!0)))}},e.loopWithFrame(e=>{if(i.needResize)i.resize().then(()=>{e.continueLoop()});else if(i.needRefresh)i.currentPage&&i.showCurrent(i.currentPage).then(()=>{e.continueLoop()});else if(t){const n=t;t=null,i.runCommand(n).then(()=>{e.continueLoop()})}else{const t=W.c("waitForCommand");n=t.suspend(self),t.result().then(()=>{e.continueLoop()})}}).thenFinish(e),e.result()}),i.kick=()=>{const e=n;e&&(n=null,e.schedule(!0))},i.sendCommand=e=>!t&&(t=fo(e),i.kick(),!0),this.window.adapt_command=i.sendCommand}}!function(e){e.FIT_INSIDE_VIEWPORT="fit inside viewport"}(ho||(ho={}));class po extends Error{constructor(){super(),this.name="RenderingCanceledError",this.message="Page rendering has been canceled",Object.setPrototypeOf(this,po.prototype),this.stack=(new Error).stack}}function fo(e){return"string"==typeof e?w.H(e):e}const go=o;function mo(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];switch(n){case"autoResize":t.autoresize=i;break;case"pageBorderWidth":t.pageBorder=i;break;default:t[n]=i}}),t}function bo(e){function t(e){return"number"==typeof e?e:null}function n(e){return"string"==typeof e?{url:e,startPage:null,skipPagesBefore:null}:{url:e.url,startPage:t(e.startPage),skipPagesBefore:t(e.skipPagesBefore)}}return Array.isArray(e)?e.map(n):e?[n(e)]:null}var wo;!function(e){e.PREVIOUS="previous",e.NEXT="next",e.LEFT="left",e.RIGHT="right",e.FIRST="first",e.LAST="last",e.EPAGE="epage"}(wo||(wo={}));const Eo=co,yo={Viewer:class{constructor(e,t){var n;this.settings=e,this.initialized=!1,n=e.debug,i=n,this.viewer_=new uo(e.window||window,e.viewportElement,"main",this.dispatcher.bind(this)),this.options={autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:Eo.AUTO_SPREAD,zoom:1,fitToScreen:!1,defaultPaperSize:void 0},t&&this.setOptions(t),this.eventTarget=new w.c,Object.defineProperty(this,"readyState",{get(){return this.viewer_.readyState}})}setOptions(e){const t=Object.assign({a:"configure"},mo(e));this.viewer_.sendCommand(t),Object.assign(this.options,e)}dispatcher(e){const t={type:e.t},n=e;Object.keys(n).forEach(e=>{"t"!==e&&(t[e]=n[e])}),this.eventTarget.dispatchEvent(t)}addListener(e,t){this.eventTarget.addEventListener(e,t,!1)}removeListener(e,t){this.eventTarget.removeEventListener(e,t,!1)}loadDocument(e,t,n){e||this.eventTarget.dispatchEvent({type:"error",content:"No URL specified"}),this.loadDocumentOrPublication(e,null,t,n)}loadPublication(e,t,n){e||this.eventTarget.dispatchEvent({type:"error",content:"No URL specified"}),this.loadDocumentOrPublication(null,e,t,n)}loadDocumentOrPublication(e,t,n,i){const o=n||{};function s(e){return e?e.map(e=>({url:e.url||null,text:e.text||null})):void 0}const r=s(o.authorStyleSheet),a=s(o.userStyleSheet);i&&Object.assign(this.options,i);const l=Object.assign({a:e?"loadXML":"loadPublication",userAgentRootURL:this.settings.userAgentRootURL,url:bo(e)||t,document:o.documentObject,fragment:o.fragment,authorStyleSheet:r,userStyleSheet:a},mo(this.options));this.initialized?this.viewer_.sendCommand(l):(this.initialized=!0,this.viewer_.initEmbed(l))}getCurrentPageProgression(){return this.viewer_.getCurrentPageProgression()}resolveNavigation(e){switch(e){case wo.LEFT:return this.getCurrentPageProgression()===go.LTR?wo.PREVIOUS:wo.NEXT;case wo.RIGHT:return this.getCurrentPageProgression()===go.LTR?wo.NEXT:wo.PREVIOUS;default:return e}}navigateToPage(e,t){e===wo.EPAGE?this.viewer_.sendCommand({a:"moveTo",epage:t}):this.viewer_.sendCommand({a:"moveTo",where:this.resolveNavigation(e)})}navigateToInternalUrl(e){this.viewer_.sendCommand({a:"moveTo",url:e})}isTOCVisible(){return this.viewer_.opfView&&this.viewer_.opfView.opf&&(this.viewer_.opfView.opf.xhtmlToc||this.viewer_.opfView.opf.ncxToc)?!!this.viewer_.opfView.isTOCVisible():null}showTOC(e,t){const n=null==e?"toggle":e?"show":"hide";this.viewer_.sendCommand({a:"toc",v:n,autohide:t})}queryZoomFactor(e){return this.viewer_.queryZoomFactor(e)}getPageSizes(){return this.viewer_.pageSizes}},PageViewMode:Eo,ZoomType:ho};g.forceRegisterEndTiming("load_vivliostyle"),t.default={constants:a,plugin:l.c,profile:m,viewer:yo}}]).default},function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i);var s=new class{constructor(){this.viewer=null,this.constants=null,this.profile=null}setInstance(e){this.viewer=e.viewer,this.constants=e.constants,this.profile=e.profile}},r=n(0),a=n.n(r),l={escapeUnicodeChar:e=>`\\u${(65536|e.charCodeAt(0)).toString(16).substring(1)}`,escapeUnicodeString(e){return e.replace(/[^-a-zA-Z0-9_]/g,this.escapeUnicodeChar)},percentEncodeAmpersandAndUnencodedPercent:e=>e.replace(/%(?![0-9A-Fa-f]{2})/g,"%25").replace(/&/g,"%26"),percentEncodeAmpersandAndPercent:e=>e.replace(/%/g,"%25").replace(/&/g,"%26"),percentDecodeAmpersandAndPercent:e=>e.replace(/%26/g,"&").replace(/%25/g,"%"),percentEncodeForDataURI:e=>encodeURI(e).replace(/#/g,"%23").replace(/&/g,"%26")};function c(e){return new RegExp(`[#&]${l.escapeUnicodeString(e)}=([^&]*)`,"g")}var h,u=new class{constructor(){this.history=window?window.history:null,this.location=window?window.location:{href:""},this.storedUrl=this.location.href}getBaseURL(){let e=this.location.href;return e=e.replace(/#.*$/,""),e.replace(/\/[^/]*$/,"/")}hasParameter(e){const t=this.location.href;return c(e).test(t)}getParameter(e){const t=this.location.href,n=c(e),i=[];let o;for(;o=n.exec(t);)i.push(o[1]);return i}setParameter(e,t,n){const i=this.location.href;let o;const s=c(e);let r=s.exec(i);if(r&&n)for(;n-- >=1;)r=s.exec(i);if(r){const e=r[1].length,n=r.index+r[0].length-e;o=i.substring(0,n)+t+i.substring(n+e)}else o=`${i+(i.match(/[#&]$/)?"":i.match(/#/)?"&":"#")+e}=${t}`;null!==this.history&&this.history.replaceState?this.history.replaceState(null,"",o):this.location.href=o,this.storedUrl=o}removeParameter(e,t){const n=this.location.href;let i;const o=c(e);let s=o.exec(n);if(s&&t&&(s=o.exec(n)),s){for(i=n;s;s=o.exec(i)){const e=s.index+s[0].length;i="#"==s[0].charAt(0)?i.substring(0,s.index+1)+i.substring(e+1):i.substring(0,s.index)+i.substring(e),o.lastIndex-=s[0].length}i=i.replace(/^(.*?)[#&]$/,"$1"),null!==this.history&&this.history.replaceState?this.history.replaceState(null,"",i):this.location.href=i}this.storedUrl=i}};!function(e){e.Default="",e.Auto="auto",e.Preset="preset",e.Custom="custom",e.Zero="0"}(h||(h={}));const d=[{name:"A5",description:"A5"},{name:"A4",description:"A4"},{name:"A3",description:"A3"},{name:"B5",description:"B5 (ISO)"},{name:"B4",description:"B4 (ISO)"},{name:"JIS-B5",description:"B5 (JIS)"},{name:"JIS-B4",description:"B4 (JIS)"},{name:"letter",description:"letter"},{name:"legal",description:"legal"},{name:"ledger",description:"ledger"}],p={customWidth:"210mm",customHeight:"297mm",customMargin:"10%",baseFontSize:"12pt",baseLineHeight:"1.2",baseFontFamily:"serif",viewerFontSize:16};class f{constructor(e){this.PresetSize=f.PresetSize,this.pageSizeMode=a.a.observable(h.Default),this.presetSize=a.a.observable(d[1]),this.isLandscape=a.a.observable(!1),this.customWidth=a.a.observable(p.customWidth),this.customHeight=a.a.observable(p.customHeight),this.pageSizeImportant=a.a.observable(!1),this.pageMarginMode=a.a.observable(h.Default),this.customMargin=a.a.observable(p.customMargin),this.pageMarginImportant=a.a.observable(!1),this.firstPageMarginZero=a.a.observable(!1),this.firstPageMarginZeroImportant=a.a.observable(!1),this.forceHtmlBodyMarginZero=a.a.observable(!1),this.widowsOrphans=a.a.observable(""),this.widowsOrphansImportant=a.a.observable(!1),this.imageMaxSizeToFitPage=a.a.observable(!1),this.imageMaxSizeToFitPageImportant=a.a.observable(!1),this.imageKeepAspectRatio=a.a.observable(!1),this.imageKeepAspectRatioImportant=a.a.observable(!1),this.baseFontSize=a.a.observable(p.baseFontSize),this.baseFontSizeSpecified=a.a.observable(!1),this.baseFontSizeImportant=a.a.observable(!1),this.baseLineHeight=a.a.observable(p.baseLineHeight),this.baseLineHeightSpecified=a.a.observable(!1),this.baseLineHeightImportant=a.a.observable(!1),this.baseFontFamily=a.a.observable(p.baseFontFamily),this.baseFontFamilySpecified=a.a.observable(!1),this.baseFontFamilyImportant=a.a.observable(!1),this.allImportant=a.a.observable(!1),this.pageOtherStyle=a.a.observable(""),this.firstPageOtherStyle=a.a.observable(""),this.rootOtherStyle=a.a.observable(""),this.beforeOtherStyle=a.a.observable(""),this.afterOtherStyle=a.a.observable(""),this.viewerFontSize=null,this.setViewerFontSizeObservable=e=>{this.viewerFontSize=e;const t=document.getElementsByName("vivliostyle-settings_viewer-font-size")[0];t&&(t.value=this.fontSizePxToPercent(Number(e()),100,5).toString())},this.viewerFontSizePercent=a.a.pureComputed({read(){if(!this.viewerFontSize)return 100;return this.fontSizePxToPercent(Number(this.viewerFontSize()),100,5)},write(e){if(!this.viewerFontSize)return;const t=parseFloat(String(e));let n=t&&this.fontSizePercentToPx(t);if(!n||n<5||n>72){const e=document.getElementsByName("vivliostyle-settings_viewer-font-size")[0];e&&(e.value="100"),n=p.viewerFontSize}this.viewerFontSize(Number(n))},owner:this}),this.cssText=a.a.pureComputed({read:this.toCSSText,write:this.fromCSSText,owner:this}),this.allImportant.subscribe(e=>{this.pageSizeImportant(e),this.pageMarginImportant(e),this.firstPageMarginZeroImportant(e),this.widowsOrphansImportant(e),this.imageMaxSizeToFitPageImportant(e),this.imageKeepAspectRatioImportant(e),this.baseFontSizeImportant(e),this.baseLineHeightImportant(e),this.baseFontFamilyImportant(e)}),this.pageStyleRegExp=new RegExp("^((?:\\n|.)*?)\\/\\*<viewer>\\*\\/\\s*(?:@page\\s*\\{\\s*(?:size:\\s*([^\\s!;{}]+)(?:\\s+([^\\s!;{}]+))?\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:margin:\\s*([^\\s!;{}]+(?:\\s+[^\\s!;{}]+)?(?:\\s+[^\\s!;{}]+)?(?:\\s+[^\\s!;{}]+)?)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?((?:[^{}]+|\\{[^{}]*\\})*)\\}\\s*)?(?:@page\\s*:first\\s*\\{\\s*(margin:\\s*0(?:\\w+|%)?\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?((?:[^{}]+|\\{[^{}]*\\})*)\\}\\s*)?((?:html|:root),\\s*body\\s*\\{\\s*margin:\\s*0(?:\\w+|%)?\\s*!important(?:;|(?=[\\s{}]))\\s*\\}\\s*)?(?:(?:html|:root)\\s*\\{\\s*(?:font-size:\\s*(calc\\([^()]+\\)|[^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:line-height:\\s*([^\\s!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?(?:font-family:\\s*([^!;{}]+)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?([^{}]*)\\}\\s*)?(?:body\\s*\\{\\s*(?:[-\\w]+:\\s*inherit\\s*!important(?:;|(?=[\\s{}]))\\s*)+\\}\\s*)?(?:\\*\\s*\\{\\s*widows:\\s*(1|999)\\s*(!important)?(?:;|(?=[\\s{}]))\\s*orphans:\\s*\\19\\s*\\20(?:;|(?=[\\s{}]))\\s*\\}\\s*)?(?:img,\\s*svg\\s*\\{\\s*(max-inline-size:\\s*100%\\s*(!important)?(?:;|(?=[\\s{}]))\\s*max-block-size:\\s*100vb\\s*\\22(?:;|(?=[\\s{}]))\\s*)?(object-fit:\\s*contain\\s*(!important)?(?:;|(?=[\\s{}]))\\s*)?\\}\\s*)?((?:\\n|.)*)$"),e&&this.copyFrom(e)}fontSizePxToPercent(e,t,n){let i=e/p.viewerFontSize*(t||100);return n&&(i=i.toPrecision(n).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),i}fontSizePercentToPx(e,t,n){let i=e/(t||100)*p.viewerFontSize;return n&&(i=i.toPrecision(n).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),i}fromCSSText(e){const t=this.pageStyleRegExp.exec(e);if(t){const[,e,n,i,o,s,r,a,l,c,u,p,f,g,m,b,w,E,y,S,N,C,v,T,x,I]=t;let P=I,A=w,O=f,k=u,R=a,L=y,F=n,D=i,_=0,B=0;if(this.beforeOtherStyle(e),"landscape"==F||"portrait"==F?(this.isLandscape("landscape"==F),F=D,D=null):"landscape"!=D&&"portrait"!=D||(this.isLandscape("landscape"==D),D=null),null!=F){if(null==D)if("auto"==F)this.pageSizeMode(h.Auto);else{const e=d.find(e=>e.name.toLowerCase()==F.toLowerCase());e?(this.pageSizeMode(h.Preset),this.presetSize(e)):(this.pageSizeMode(h.Custom),this.customWidth(F),this.customHeight(F))}else this.pageSizeMode(h.Custom),this.customWidth(F),this.customHeight(D);this.pageSizeImportant(!!o),o?_++:B++}else this.pageSizeMode(h.Default);null!=s?(this.pageMarginMode("0"==s?h.Zero:h.Custom),"0"==s?this.pageMarginMode(h.Zero):(this.pageMarginMode(h.Custom),this.customMargin(s)),this.pageMarginImportant(!!r),r?_++:B++):this.pageMarginMode(h.Default),R=R||"",this.pageOtherStyle(R),l?(this.firstPageMarginZero(!0),this.firstPageMarginZeroImportant(!!c),c?_++:B++):this.firstPageMarginZero(!1),k=k||"",this.firstPageOtherStyle(k),p?this.forceHtmlBodyMarginZero(!0):this.forceHtmlBodyMarginZero(!1),null!=O?(O=O.replace(/^\s*calc\([.\d]+\s*\*\s*([.\d]+\w+)\)\s*$/,"$1"),this.baseFontSizeSpecified(!0),this.baseFontSize(O),this.baseFontSizeImportant(!!g),g?_++:B++):this.baseFontSizeSpecified(!1),null!=m?(this.baseLineHeightSpecified(!0),this.baseLineHeight(m),this.baseLineHeightImportant(!!b),b?_++:B++):this.baseLineHeightSpecified(!1),null!=A?(A=A.trim(),this.baseFontFamilySpecified(!0),this.baseFontFamily(A),this.baseFontFamilyImportant(!!E),E?_++:B++):this.baseFontFamilySpecified(!1),L=L||"",this.rootOtherStyle(L),null!=S?(this.widowsOrphans(S),this.widowsOrphansImportant(!!N),N?_++:B++):this.widowsOrphans(h.Default),C?(this.imageMaxSizeToFitPage(!0),this.imageMaxSizeToFitPageImportant(!!v),v?_++:B++):this.imageMaxSizeToFitPage(!1),T?(this.imageKeepAspectRatio(!0),this.imageKeepAspectRatioImportant(!!x),x?_++:B++):this.imageKeepAspectRatio(!1),P=P.replace(/\/\*<\/?viewer>\*\/\n?/g,"")||"",this.afterOtherStyle(P),this.allImportant(_>0&&0==B)}else{const t=e.replace(/\/\*<\/?viewer>\*\/\n?/g,"")||"";this.afterOtherStyle(t)}}toCSSText(){function e(e){return e?" !important":""}let t=this.beforeOtherStyle();if(t+="/*<viewer>*/\n",this.pageSizeMode()!=h.Default||this.pageMarginMode()!=h.Default||this.pageOtherStyle()){if(t+="@page { ",this.pageSizeMode()!=h.Default){switch(t+="size: ",this.pageSizeMode()){case h.Auto:t+="auto";break;case h.Preset:t+=this.presetSize().name,this.isLandscape()&&(t+=" landscape");break;case h.Custom:t+=`${this.customWidth()} ${this.customHeight()}`;break;default:throw new Error(`Unknown pageSizeMode ${this.pageSizeMode()}`)}t+=`${e(this.pageSizeImportant())}; `}if(this.pageMarginMode()!=h.Default){switch(t+="margin: ",this.pageMarginMode()){case h.Auto:t+="auto";break;case h.Zero:t+="0";break;case h.Custom:t+=`${this.customMargin()}`;break;default:throw new Error(`Unknown pageMarginMode ${this.pageMarginMode()}`)}t+=`${e(this.pageMarginImportant())}; `}t+=this.pageOtherStyle(),t+="}\n"}if((this.firstPageMarginZero()||this.firstPageOtherStyle())&&(t+="@page :first { ",this.firstPageMarginZero()&&(t+=`margin: 0${e(this.firstPageMarginZeroImportant())}; `),t+=this.firstPageOtherStyle(),t+="}\n"),this.forceHtmlBodyMarginZero()&&(t+=":root, body { margin: 0 !important; }\n"),this.baseFontSizeSpecified()||this.baseLineHeightSpecified()||this.baseFontFamilySpecified()||this.rootOtherStyle()){t+=":root { ";const n=this.baseFontSize();if(this.baseFontSizeSpecified())if(this.viewerFontSize&&this.viewerFontSize()!=p.viewerFontSize&&!n.endsWith("%")){t+=`font-size: calc(${this.fontSizePxToPercent(Number(this.viewerFontSize()),1,5)} * ${n})${e(this.baseFontSizeImportant())}; `}else t+=`font-size: ${this.baseFontSize()}${e(this.baseFontSizeImportant())}; `;this.baseLineHeightSpecified()&&(t+=`line-height: ${this.baseLineHeight()}${e(this.baseLineHeightImportant())}; `),this.baseFontFamilySpecified()&&(t+=`font-family: ${this.baseFontFamily()}${e(this.baseFontFamilyImportant())}; `),t+=this.rootOtherStyle(),t+="}\n"}return(this.baseFontSizeSpecified()&&this.baseFontSizeImportant()||this.baseLineHeightSpecified()&&this.baseLineHeightImportant()||this.baseFontFamilySpecified()&&this.baseFontFamilyImportant())&&(t+="body { ",this.baseFontSizeSpecified()&&this.baseFontSizeImportant()&&(t+="font-size: inherit !important; "),this.baseLineHeightSpecified()&&this.baseLineHeightImportant()&&(t+="line-height: inherit !important; "),this.baseFontFamilySpecified()&&this.baseFontFamilyImportant()&&(t+="font-family: inherit !important; "),t+="}\n"),this.widowsOrphans()&&(t+="* { ",t+=`widows: ${this.widowsOrphans()}${e(this.widowsOrphansImportant())}; `,t+=`orphans: ${this.widowsOrphans()}${e(this.widowsOrphansImportant())}; `,t+="}\n"),(this.imageMaxSizeToFitPage()||this.imageKeepAspectRatio())&&(t+="img, svg { ",this.imageMaxSizeToFitPage()&&(t+=`max-inline-size: 100%${e(this.imageMaxSizeToFitPageImportant())}; `,t+=`max-block-size: 100vb${e(this.imageMaxSizeToFitPageImportant())}; `),this.imageKeepAspectRatio()&&(t+=`object-fit: contain${e(this.imageKeepAspectRatioImportant())}; `),t+="}\n"),t+="/*</viewer>*/\n",t+=this.afterOtherStyle(),t}copyFrom(e){this.pageSizeMode(e.pageSizeMode()),this.presetSize(e.presetSize()),this.isLandscape(e.isLandscape()),this.customWidth(e.customWidth()),this.customHeight(e.customHeight()),this.pageSizeImportant(e.pageSizeImportant()),this.pageMarginMode(e.pageMarginMode()),this.customMargin(e.customMargin()),this.pageMarginImportant(e.pageMarginImportant()),this.firstPageMarginZero(e.firstPageMarginZero()),this.firstPageMarginZeroImportant(e.firstPageMarginZeroImportant()),this.forceHtmlBodyMarginZero(e.forceHtmlBodyMarginZero()),this.widowsOrphans(e.widowsOrphans()),this.widowsOrphansImportant(e.widowsOrphansImportant()),this.imageMaxSizeToFitPage(e.imageMaxSizeToFitPage()),this.imageMaxSizeToFitPageImportant(e.imageMaxSizeToFitPageImportant()),this.imageKeepAspectRatio(e.imageKeepAspectRatio()),this.imageKeepAspectRatioImportant(e.imageKeepAspectRatioImportant()),this.baseFontSize(e.baseFontSize()),this.baseFontSizeSpecified(e.baseFontSizeSpecified()),this.baseFontSizeImportant(e.baseFontSizeImportant()),this.baseLineHeight(e.baseLineHeight()),this.baseLineHeightSpecified(e.baseLineHeightSpecified()),this.baseLineHeightImportant(e.baseLineHeightImportant()),this.baseFontFamily(e.baseFontFamily()),this.baseFontFamilySpecified(e.baseFontFamilySpecified()),this.baseFontFamilyImportant(e.baseFontFamilyImportant()),this.allImportant(e.allImportant()),this.pageOtherStyle(e.pageOtherStyle()),this.firstPageOtherStyle(e.firstPageOtherStyle()),this.rootOtherStyle(e.rootOtherStyle()),this.beforeOtherStyle(e.beforeOtherStyle()),this.afterOtherStyle(e.afterOtherStyle()),this.viewerFontSize&&e.viewerFontSize&&this.viewerFontSize(e.viewerFontSize())}equivalentTo(e){return this.pageSizeMode()===e.pageSizeMode()&&((this.pageSizeMode()!==h.Preset||this.presetSize()===e.presetSize())&&((this.pageSizeMode()!==h.Preset||this.isLandscape()===e.isLandscape())&&((this.pageSizeMode()!==h.Custom||this.customWidth()===e.customWidth())&&((this.pageSizeMode()!==h.Custom||this.customHeight()===e.customHeight())&&(this.pageSizeImportant()===e.pageSizeImportant()&&(this.pageMarginMode()===e.pageMarginMode()&&((this.pageMarginMode()!==h.Custom||this.customMargin()===e.customMargin())&&(this.pageMarginImportant()===e.pageMarginImportant()&&(this.firstPageMarginZero()===e.firstPageMarginZero()&&(this.firstPageMarginZeroImportant()===e.firstPageMarginZeroImportant()&&(this.forceHtmlBodyMarginZero()===e.forceHtmlBodyMarginZero()&&(this.widowsOrphans()===e.widowsOrphans()&&(this.widowsOrphansImportant()===e.widowsOrphansImportant()&&(this.imageMaxSizeToFitPage()===e.imageMaxSizeToFitPage()&&(this.imageMaxSizeToFitPageImportant()===e.imageMaxSizeToFitPageImportant()&&(this.imageKeepAspectRatio()===e.imageKeepAspectRatio()&&(this.imageKeepAspectRatioImportant()===e.imageKeepAspectRatioImportant()&&(this.baseFontSizeSpecified()===e.baseFontSizeSpecified()&&((!this.baseFontSizeSpecified()||this.baseFontSize()===e.baseFontSize())&&(this.baseFontSizeImportant()===e.baseFontSizeImportant()&&(this.baseLineHeightSpecified()===e.baseLineHeightSpecified()&&((!this.baseLineHeightSpecified()||this.baseLineHeight()===e.baseLineHeight())&&(this.baseLineHeightImportant()===e.baseLineHeightImportant()&&(this.baseFontFamilySpecified()===e.baseFontFamilySpecified()&&((!this.baseFontFamilySpecified()||this.baseFontFamily()===e.baseFontFamily())&&(this.baseFontFamilyImportant()===e.baseFontFamilyImportant()&&(this.allImportant()===e.allImportant()&&(this.pageOtherStyle()===e.pageOtherStyle()&&(this.firstPageOtherStyle()===e.firstPageOtherStyle()&&(this.rootOtherStyle()===e.rootOtherStyle()&&(this.beforeOtherStyle()===e.beforeOtherStyle()&&(this.afterOtherStyle()===e.afterOtherStyle()&&!(!this.viewerFontSize!=!e.viewerFontSize||this.viewerFontSize&&this.viewerFontSize()!==e.viewerFontSize())))))))))))))))))))))))))))))))))}}f.Mode=h,f.Constants=p,f.PresetSize=d;var g=f;var m=class{constructor(){const e=function(){const e=u.getParameter("b"),t=u.getParameter("x"),n=u.getParameter("f"),i=u.getParameter("style"),o=u.getParameter("userStyle");return{bookUrl:e[0]||null,xUrl:!e[0]&&t.length&&t[0]?t:null,fragment:n[0]||null,authorStyleSheet:i.length?i:[],userStyleSheet:o.length?o:[]}}();this.bookUrl=a.a.observable(e.bookUrl||""),this.xUrl=a.a.observable(e.xUrl||null),this.fragment=a.a.observable(e.fragment||""),this.authorStyleSheet=a.a.observable(e.authorStyleSheet),this.userStyleSheet=a.a.observable(e.userStyleSheet),this.pageStyle=new g,this.dataUserStyleIndex=-1,this.fragment.subscribe(e=>{if(/^epubcfi\(\/([246]\/)?2!\)/.test(e))u.removeParameter("f");else{const t=e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent);u.setParameter("f",t)}}),e.userStyleSheet.find((e,t)=>{if(/^data:,.*?\/\*(?:<|%3C)viewer(?:>|%3E)\*\//.test(e)){this.dataUserStyleIndex=t;const n=e.replace(/^data:,/,"").replace(/%(?![0-9A-Fa-f]{2})/g,"%25"),i=decodeURIComponent(n);return this.pageStyle.cssText(i),!0}return!1}),this.pageStyle.cssText.subscribe(e=>{this.updateUserStyleSheetFromCSSText(e)})}toObject(){function e(e){return e.map(e=>({url:e}))}const t=e(this.userStyleSheet());return this.pageStyle.pageSizeMode()==g.Mode.Default&&t.unshift({text:"@page{size:auto}"}),{fragment:this.fragment(),authorStyleSheet:e(this.authorStyleSheet()),userStyleSheet:t}}updateUserStyleSheetFromCSSText(e){null==e&&(e=this.pageStyle.toCSSText());const t=this.userStyleSheet();if((!e||/^\s*(\/\*.*?\*\/\s*)*$/.test(e))&&t.length<=(-1==this.dataUserStyleIndex?0:1))return t.pop(),this.dataUserStyleIndex=-1,this.userStyleSheet(t),void u.removeParameter("userStyle");const n="data:,"+l.percentEncodeForDataURI(e.trim());-1==this.dataUserStyleIndex?(t.push(n),this.dataUserStyleIndex=t.length-1):t[this.dataUserStyleIndex]=n,this.userStyleSheet(t),u.setParameter("userStyle",n,this.dataUserStyleIndex)}};class b{toSpreadViewString(){switch(this){case w.SPREAD:return"true";case w.SINGLE_PAGE:return"false";case w.AUTO_SPREAD:return"auto";default:throw new Error("Invalid PageViewMode")}}toString(){switch(this){case w.SPREAD:return"spread";case w.SINGLE_PAGE:return"singlePage";case w.AUTO_SPREAD:return"autoSpread";default:throw new Error("Invalid PageViewMode")}}}const w={AUTO_SPREAD:new b,SINGLE_PAGE:new b,SPREAD:new b,defaultMode(){return this.AUTO_SPREAD},fromSpreadViewString(e){switch(e){case"true":return this.SPREAD;case"false":return this.SINGLE_PAGE;case"auto":default:return this.AUTO_SPREAD}},of(e){switch(e){case s.viewer.PageViewMode.SPREAD:return this.SPREAD;case s.viewer.PageViewMode.SINGLE_PAGE:return this.SINGLE_PAGE;case s.viewer.PageViewMode.AUTO_SPREAD:return this.AUTO_SPREAD;default:throw new Error(`Invalid PageViewMode name: ${e}`)}}};var E=w;class y{constructor(e){this.zoom=e}get fitToScreen(){return null}getCurrentZoomFactor(e){return 1}toggleFitToScreen(){return new y(1)}zoomIn(e){return new N(1.25*this.getCurrentZoomFactor(e))}zoomOut(e){return new N(.8*this.getCurrentZoomFactor(e))}zoomToActualSize(){return new N(1)}static createDefaultOptions(){return new S}static createFromZoomFactor(e){return new N(e)}}class S extends y{constructor(){super(1)}get fitToScreen(){return!0}toggleFitToScreen(){return new N(1)}getCurrentZoomFactor(e){return e.queryZoomFactor(s.viewer.ZoomType.FIT_INSIDE_VIEWPORT)}}class N extends y{get fitToScreen(){return!1}toggleFitToScreen(){return new S}getCurrentZoomFactor(){return this.zoom}}var C=y;function v(){return{renderAllPages:u.hasParameter("x"),fontSize:16,profile:!1,pageViewMode:E.defaultMode(),zoom:C.createDefaultOptions()}}class T{constructor(e){if(this.renderAllPages=a.a.observable(),this.fontSize=a.a.observable(),this.profile=a.a.observable(),this.pageViewMode=a.a.observable(),this.zoom=a.a.observable(),e)this.copyFrom(e);else{const e=v(),t=function(){const e=u.getParameter("renderAllPages")[0],t=u.getParameter("fontSize")[0],n=/^([\d.]+)(?:(%25|%)|\/([\d.]+))?$/.exec(t);let i=null;if(n){const[,e,t,o]=n;i=parseFloat(e),(t||o)&&(i=16*i/(t?100:parseFloat(o))),i<5&&(i=5),i>72&&(i=72)}return{renderAllPages:"true"===e||"false"!==e&&null,fontSize:i,profile:"true"===u.getParameter("profile")[0],pageViewMode:E.fromSpreadViewString(u.getParameter("spread")[0])}}();this.renderAllPages(null!==t.renderAllPages?t.renderAllPages:e.renderAllPages),this.fontSize(t.fontSize||e.fontSize),this.profile(t.profile||e.profile),this.pageViewMode(t.pageViewMode||e.pageViewMode),this.zoom(e.zoom),this.pageViewMode.subscribe(t=>{t===e.pageViewMode?u.removeParameter("spread"):u.setParameter("spread",t.toSpreadViewString())}),this.renderAllPages.subscribe(t=>{t===e.renderAllPages?u.removeParameter("renderAllPages"):u.setParameter("renderAllPages",t.toString())}),this.fontSize.subscribe(t=>{"number"==typeof t&&(t=t.toPrecision(10).replace(/(?:\.0*|(\.\d*?)0+)$/,"$1")),Number(t)==e.fontSize?u.removeParameter("fontSize"):u.setParameter("fontSize",`${t}/${e.fontSize}`)})}}copyFrom(e){this.renderAllPages(e.renderAllPages()),this.fontSize(e.fontSize()),this.profile(e.profile()),this.pageViewMode(e.pageViewMode()),this.zoom(e.zoom())}toObject(){return{renderAllPages:this.renderAllPages(),fontSize:this.fontSize(),pageViewMode:this.pageViewMode().toString(),zoom:this.zoom().zoom,fitToScreen:this.zoom().fitToScreen}}}T.getDefaultValues=v;var x=T;var I=a.a.observableArray();var P,A={readonlyObservable(e){const t=a.a.observable(e);return{getter:a.a.pureComputed(()=>t()),value:t}}};!function(e){e.Debug="debug",e.Info="info",e.Warn="warn",e.Error="error"}(P||(P={}));class O{constructor(){this.logLevel=P.Error}static getLogger(){return new O}setLogLevel(e){this.logLevel=e}debug(e){this.logLevel===P.Debug&&I.push({type:"debug",content:e})}info(e){this.logLevel!==P.Debug&&this.logLevel!==P.Info||I.push({type:"info",content:e})}warn(e){this.logLevel!==P.Debug&&this.logLevel!==P.Info&&this.logLevel!==P.Warn||I.push({type:"warn",content:e})}error(e){this.logLevel!==P.Debug&&this.logLevel!==P.Info&&this.logLevel!==P.Warn&&this.logLevel!==P.Error||I.push({type:"error",content:e})}}var k=class{constructor(e,t){this.viewerOptions_=t,this.documentOptions_=null,this.viewer_=new s.viewer.Viewer(e,t.toObject());const n=this.state_={status:A.readonlyObservable(s.constants.ReadyState.LOADING),pageProgression:A.readonlyObservable(s.constants.PageProgression.LTR)};this.state={status:n.status.getter.extend({rateLimit:{timeout:100,method:"notifyWhenChangesStop"},notify:"always"}),navigatable:a.a.pureComputed(()=>n.status.value()&&n.status.value()!==s.constants.ReadyState.LOADING),pageProgression:n.pageProgression.getter},this.epage=a.a.observable(),this.epageCount=a.a.observable(),this.firstPage=a.a.observable(),this.lastPage=a.a.observable(),this.tocVisible=a.a.observable(),this.tocPinned=a.a.observable(),this.inputUrl=a.a.observable(""),this.setupViewerEventHandler(),this.setupViewerOptionSubscriptions()}setupViewerEventHandler(){const e=O.getLogger();this.viewer_.addListener("debug",t=>{e.debug(t.content)}),this.viewer_.addListener("info",t=>{e.info(t.content)}),this.viewer_.addListener("warn",t=>{e.warn(t.content)}),this.viewer_.addListener("error",t=>{e.error(t.content)}),this.viewer_.addListener("readystatechange",()=>{const e=this.viewer_.readyState;e!==s.constants.ReadyState.INTERACTIVE&&e!==s.constants.ReadyState.COMPLETE||this.state_.pageProgression.value(this.viewer_.getCurrentPageProgression()),this.state_.status.value(e)}),this.viewer_.addListener("loaded",()=>{this.viewerOptions_.profile()&&s.profile.profiler.printTimings()}),this.viewer_.addListener("nav",e=>{const{cfi:t,first:n,last:i,epage:o,epageCount:s,metadata:r,docTitle:a}=e;if(t&&this.documentOptions_.fragment(t),void 0!==n&&this.firstPage(n),void 0!==i&&this.lastPage(i),void 0!==o&&this.epage(o),void 0!==s&&this.epageCount(s),r||a){const e=r&&r["http://purl.org/dc/terms/title"],t=e&&e[0]&&e[0].v;t?!a||a===t||this.firstPage()||/\.xhtml$/.test(a)?document.title=t:document.title=`${a} | ${t}`:document.title=a||"Vivliostyle Viewer"}const l=this.tocVisible(),c=this.viewer_.isTOCVisible();l&&!c||this.tocVisible(c)}),this.viewer_.addListener("hyperlink",e=>{e.internal?(this.navigateToInternalUrl(e.href),this.tocVisible()&&this.tocVisible(!1),document.getElementById("vivliostyle-viewer-viewport").focus()):window.location.href=e.href})}setupViewerOptionSubscriptions(){a.a.computed((function(){const e=this.viewerOptions_.toObject();this.viewer_.setOptions(e)}),this).extend({rateLimit:0})}loadDocument(e,t){this.state_.status.value(s.constants.ReadyState.LOADING),t&&this.viewerOptions_.copyFrom(t),this.documentOptions_=e,e.xUrl()?this.viewer_.loadDocument(e.xUrl(),e.toObject(),this.viewerOptions_.toObject()):e.bookUrl()?this.viewer_.loadPublication?this.viewer_.loadPublication(e.bookUrl(),e.toObject(),this.viewerOptions_.toObject()):this.viewer_.loadEPUB(e.bookUrl(),e.toObject(),this.viewerOptions_.toObject()):this.state_.status.value("")}navigateToPrevious(){this.viewer_.navigateToPage("previous")}navigateToNext(){this.viewer_.navigateToPage("next")}navigateToLeft(){this.viewer_.navigateToPage("left")}navigateToRight(){this.viewer_.navigateToPage("right")}navigateToFirst(){this.viewer_.navigateToPage("first")}navigateToLast(){this.viewer_.navigateToPage("last")}navigateToEPage(e){this.viewer_.navigateToPage("epage",e)}navigateToInternalUrl(e){this.viewer_.navigateToInternalUrl(e)}queryZoomFactor(e){return this.viewer_.queryZoomFactor(e)}epageToPageNumber(e){if(!e&&0!=e)return;return Math.round(e+1)}epageFromPageNumber(e){if(!e&&0!=e)return;return e-1}showTOC(e,t){if(null==this.viewer_.isTOCVisible())return;const n=null==e?!this.tocVisible():e;this.tocVisible(n),this.tocPinned(!!n&&!t),this.viewer_.showTOC(n,t)}};const R={Unidentified:"Unidentified",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",Home:"Home",End:"End",PageDown:"PageDown",PageUp:"PageUp",Escape:"Escape",Enter:"Enter",Space:" "};var L={Keys:R,identifyKeyFromEvent:function(e){const t=e.key,n=e.keyIdentifier,i=e.location;return t===R.ArrowDown||"Down"===t||"Down"===n?e.metaKey?R.End:R.ArrowDown:t===R.ArrowLeft||"Left"===t||"Left"===n?R.ArrowLeft:t===R.ArrowRight||"Right"===t||"Right"===n?R.ArrowRight:t===R.ArrowUp||"Up"===t||"Up"===n?e.metaKey?R.Home:R.ArrowUp:t===R.Escape||"Esc"===t||"U+001B"===n?R.Escape:t===R.Enter||"Enter"===n?R.Enter:t===R.Space||"U+0020"===n?R.Space:"0"===t||"U+0030"===n?"0":"+"===t||"Add"===t||"U+002B"===n||"U+00BB"===n||"U+004B"===n&&i===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD?"+":"-"===t||"Subtract"===t||"U+002D"===n||"U+00BD"===n||"U+004D"===n&&i===KeyboardEvent.DOM_KEY_LOCATION_NUMPAD?"-":t||n||R.Unidentified}};const{Keys:F}=L;var D=class{constructor(e,t,n,i){this.viewerOptions_=e,this.viewer_=t,this.settingsPanel_=n,this.justClicked=!1,this.isDisabled=a.a.pureComputed(()=>this.settingsPanel_.opened()&&!this.settingsPanel_.pinned()||!this.viewer_.state.navigatable());const o=a.a.pureComputed(()=>i.disablePageNavigation||this.isDisabled());o.subscribe(e=>{const t=document.getElementById("vivliostyle-page-number");t&&(t.disabled=e)}),this.isPageNumberDisabled=a.a.pureComputed(()=>o()),this.isNavigateToPreviousDisabled=a.a.pureComputed(()=>!!o()||void 0!==this.viewer_.state.status&&this.viewer_.firstPage()),this.isNavigateToNextDisabled=a.a.pureComputed(()=>!!o()||void 0!==this.viewer_.state.status&&((!this.viewerOptions_.renderAllPages()||this.viewer_.state.status()==s.constants.ReadyState.COMPLETE)&&this.viewer_.lastPage())),this.isNavigateToLeftDisabled=a.a.pureComputed(()=>!!o()||void 0!==this.viewer_.state.pageProgression&&(this.viewer_.state.pageProgression()===s.constants.PageProgression.LTR?this.isNavigateToPreviousDisabled():this.isNavigateToNextDisabled())),this.isNavigateToRightDisabled=a.a.pureComputed(()=>!!o()||void 0!==this.viewer_.state.pageProgression&&(this.viewer_.state.pageProgression()===s.constants.PageProgression.LTR?this.isNavigateToNextDisabled():this.isNavigateToPreviousDisabled())),this.isNavigateToFirstDisabled=this.isNavigateToPreviousDisabled,this.isNavigateToLastDisabled=a.a.pureComputed(()=>!!o()||void 0!==this.viewer_.state.status&&(!(!this.viewerOptions_.renderAllPages()||this.viewer_.state.status()==s.constants.ReadyState.COMPLETE)||this.viewer_.lastPage())),this.hidePageNavigation=!!i.disablePageNavigation;const r=a.a.pureComputed(()=>i.disableZoom||this.isDisabled());this.isZoomOutDisabled=r,this.isZoomInDisabled=r,this.isZoomToActualSizeDisabled=r,this.isToggleFitToScreenDisabled=r,this.hideZoom=!!i.disableZoom,this.fitToScreen=a.a.pureComputed(()=>e.zoom().fitToScreen);const l=a.a.pureComputed(()=>i.disableFontSizeChange||this.isDisabled());this.isIncreaseFontSizeDisabled=a.a.pureComputed(()=>!!l()||this.viewerOptions_.fontSize()>=72),this.isDecreaseFontSizeDisabled=a.a.pureComputed(()=>!!l()||this.viewerOptions_.fontSize()<=5),this.isDefaultFontSizeDisabled=l,this.hideFontSizeChange=!!i.disableFontSizeChange,this.isTOCToggleDisabled=a.a.pureComputed(()=>i.disableTOCNavigation||this.isDisabled()||null==this.viewer_.tocVisible()),this.hideTOCNavigation=!!i.disableTOCNavigation,this.pageNumber=a.a.pureComputed({read(){return this.viewer_.epageToPageNumber(this.viewer_.epage())},write(e){const t=this.viewer_.epage(),n=this.viewer_.epageToPageNumber(t);let i=parseFloat(e.toString().replace(/[０-９]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)))||0;if(/^[-+]/.test(e.toString())&&(i=n+i),i<1)i=1;else{const e=this.viewer_.epageCount();this.viewerOptions_.renderAllPages()?i>e&&(i=e):i>e+1&&(i=e+1)}const o=this.viewer_.epageFromPageNumber(i),r=document.getElementById("vivliostyle-page-number");r.value=i.toString(),this.viewer_.navigateToEPage(o),setTimeout(()=>{this.viewer_.state.status()!=s.constants.ReadyState.LOADING&&this.viewer_.epage()===t&&(r.value=n.toString()),document.getElementById("vivliostyle-viewer-viewport").focus()},10)},owner:this}),this.totalPages=a.a.pureComputed(()=>{let e=this.viewer_.epageCount();if(!e)return e;const t=Number(this.pageNumber());return this.viewer_.lastPage()?e=t:t>=e&&e++,e}),["navigateToPrevious","navigateToNext","navigateToLeft","navigateToRight","navigateToFirst","navigateToLast","zoomIn","zoomOut","zoomToActualSize","toggleFitToScreen","increaseFontSize","decreaseFontSize","defaultFontSize","onclickViewport","toggleTOC"].forEach(e=>{this[e]=this[e].bind(this)})}navigateToPrevious(){return!this.isNavigateToPreviousDisabled()&&(this.viewer_.navigateToPrevious(),!0)}navigateToNext(){return!this.isNavigateToNextDisabled()&&(this.viewer_.navigateToNext(),!0)}navigateToLeft(){return!this.isNavigateToLeftDisabled()&&(this.viewer_.navigateToLeft(),!0)}navigateToRight(){return!this.isNavigateToRightDisabled()&&(this.viewer_.navigateToRight(),!0)}navigateToFirst(){return!this.isNavigateToFirstDisabled()&&(this.viewer_.navigateToFirst(),!0)}navigateToLast(){return!this.isNavigateToLastDisabled()&&(this.viewer_.navigateToLast(),!0)}zoomIn(){if(this.isZoomInDisabled())return!1;{const e=this.viewerOptions_.zoom();return this.viewerOptions_.zoom(e.zoomIn(this.viewer_)),!0}}zoomOut(){if(this.isZoomOutDisabled())return!1;{const e=this.viewerOptions_.zoom();return this.viewerOptions_.zoom(e.zoomOut(this.viewer_)),!0}}zoomToActualSize(){if(this.isZoomToActualSizeDisabled())return!1;{const e=this.viewerOptions_.zoom();return this.viewerOptions_.zoom(e.zoomToActualSize()),!0}}toggleFitToScreen(){if(this.isToggleFitToScreenDisabled())return!1;{const e=this.viewerOptions_.zoom();return this.viewerOptions_.zoom(e.toggleFitToScreen()),!0}}increaseFontSize(){if(this.isIncreaseFontSizeDisabled())return!1;{let e=Number(this.viewerOptions_.fontSize());return e=e<10?Math.floor(e)+1:e<20?2*(Math.floor(e/2)+1):e<40?4*(Math.floor(e/4)+1):e<72?8*(Math.floor(e/8)+1):72,this.viewerOptions_.fontSize(e),this.updateFontSizeSettings(),!0}}decreaseFontSize(){if(this.isDecreaseFontSizeDisabled())return!1;{let e=Number(this.viewerOptions_.fontSize());return e=e>40?8*(Math.ceil(e/8)-1):e>20?4*(Math.ceil(e/4)-1):e>10?2*(Math.ceil(e/2)-1):e>5?Math.ceil(e)-1:5,this.viewerOptions_.fontSize(e),this.updateFontSizeSettings(),!0}}defaultFontSize(){if(this.isDefaultFontSizeDisabled())return!1;{const e=x.getDefaultValues().fontSize;return this.viewerOptions_.fontSize(e),this.updateFontSizeSettings(),!0}}updateFontSizeSettings(){this.settingsPanel_.state.viewerOptions.fontSize(this.viewerOptions_.fontSize()),this.viewer_.documentOptions_.pageStyle.baseFontSizeSpecified()&&(this.viewer_.documentOptions_.updateUserStyleSheetFromCSSText(),this.viewer_.loadDocument(this.viewer_.documentOptions_,this.viewerOptions_))}onclickViewport(){if(this.settingsPanel_.justClicked)return!0;if(this.viewer_.tocVisible()&&!this.viewer_.tocPinned()){const e=document.querySelector("[data-vivliostyle-toc-box]");e&&!e.contains(document.activeElement)&&this.toggleTOC()}return this.settingsPanel_.opened()&&!this.settingsPanel_.pinned()&&this.settingsPanel_.close(),!0}toggleTOC(){if(this.isTOCToggleDisabled())return!1;{let e=null;return this.viewer_.tocVisible()?this.justClicked?(this.viewer_.showTOC(!0,!1),this.justClicked=!1):(null!==e&&(clearInterval(e),e=null),this.viewer_.showTOC(!1),this.justClicked=!0,setTimeout(()=>{this.justClicked&&(document.getElementById("vivliostyle-viewer-viewport").focus(),this.justClicked=!1)},300)):(this.justClicked?(this.viewer_.showTOC(!0,!1),this.justClicked=!1):(this.viewer_.showTOC(!0,!0),this.justClicked=!0),e=setInterval(()=>{const t=document.querySelector("[data-vivliostyle-toc-box]");t&&"visible"===t.style.visibility&&(t.tabIndex=0,t.focus(),clearInterval(e),e=null),this.justClicked=!1},300)),!0}}navigateTOC(e){const t=Array.from(document.querySelectorAll("[data-vivliostyle-toc-box]>*>*>*>*>*:not([hidden]) [tabindex='0'],[data-vivliostyle-toc-box]>*>*>*>*>*:not([hidden]) a[href]:not([tabindex='-1'])"));let n=t.indexOf(document.activeElement);const i=e=>t[e]&&"button"===t[e].getAttribute("role"),o=e=>t[e]&&"true"===t[e].getAttribute("aria-expanded");switch(e){case F.ArrowLeft:if(-1==n){n=t.length-1;break}if(!i(n)&&i(n-1)&&n--,i(n)&&o(n))t[n].click();else for(let e=n-1;e>=0;e--)if(i(e)&&t[e].parentElement.contains(t[n])){n=e;break}break;case F.ArrowRight:if(-1==n){n=0;break}!i(n)&&i(n-1)&&n--,i(n)&&(o(n)?n+=2:t[n].click());break;case F.ArrowDown:n++;break;case F.ArrowUp:if(-1==n){n=t.length-1;break}n>0&&i(--n)&&n--;break;case F.Home:n=0;break;case F.End:n=t.length-1;break;case F.Space:!i(n)&&i(n-1)&&n--,i(n)&&t[n].click()}return i(n)&&n++,t[n]&&t[n].focus(),!0}handleKey(e){if(this.settingsPanel_.opened()&&this.settingsPanel_.settingsToggle.contains(document.activeElement))return!0;const t=document.getElementById("vivliostyle-page-number"),n=document.getElementById("vivliostyle-viewer-viewport"),i=n.scrollWidth>n.clientWidth,o=n.scrollHeight>n.clientHeight,s=t===document.activeElement,r=this.viewer_.tocVisible()&&!s&&n!=document.activeElement;switch(e){case"+":return s||!this.increaseFontSize();case"-":return s||!this.decreaseFontSize();case"0":return s||!this.defaultFontSize();case"1":return s||!this.zoomToActualSize();case F.ArrowLeft:return r?!this.navigateTOC(e):s||i||!this.navigateToLeft();case F.ArrowRight:return r?!this.navigateTOC(e):s||i||!this.navigateToRight();case F.ArrowDown:return r?!this.navigateTOC(e):(n.focus(),o||!this.navigateToNext());case F.ArrowUp:return r?!this.navigateTOC(e):(n.focus(),o||!this.navigateToPrevious());case F.PageDown:return!!r||(n.focus(),!this.navigateToNext());case F.PageUp:return!!r||(n.focus(),!this.navigateToPrevious());case F.Home:return r?!this.navigateTOC(e):(n.focus(),!this.navigateToFirst());case F.End:return r?!this.navigateTOC(e):(n.focus(),!this.navigateToLast());case"o":case"O":return n.focus(),!this.zoomOut();case"i":case"I":return n.focus(),!this.zoomIn();case"f":case"F":return n.focus(),!this.toggleFitToScreen();case"g":case"G":return t.focus(),!1;case"t":case"T":return n.focus(),!this.toggleTOC();case F.Escape:return this.viewer_.tocVisible()?!this.toggleTOC():(n.focus(),!0);case F.Space:return r?!this.navigateTOC(e):"button"!==document.activeElement.getAttribute("role")||(document.activeElement.click(),!1);default:return!0}}};const{Keys:_}=L;var B=class{constructor(e,t,n,i,o){this.viewerOptions_=e,this.documentOptions_=t,this.viewer_=n,this.isPageStyleChangeDisabled=!!o.disablePageStyleChange,this.isOverrideDocumentStyleSheetDisabled=this.isPageStyleChangeDisabled,this.isPageViewModeChangeDisabled=!!o.disablePageViewModeChange,this.isRenderAllPagesChangeDisabled=!!o.disableRenderAllPagesChange,this.justClicked=!1,this.settingsToggle=document.getElementById("vivliostyle-menu-item_settings-toggle"),this.opened=a.a.observable(!1),this.pinned=a.a.observable(!1),this.state={viewerOptions:new x(e),pageStyle:new g(t.pageStyle),pageViewMode:a.a.pureComputed({read:()=>this.state.viewerOptions.pageViewMode().toString(),write:e=>{this.state.viewerOptions.pageViewMode(E.of(e))}}),renderAllPages:a.a.pureComputed({read:()=>this.state.viewerOptions.renderAllPages(),write:e=>{this.state.viewerOptions.renderAllPages(e)}})},this.state.pageStyle.setViewerFontSizeObservable(this.state.viewerOptions.fontSize),this.defaultPageStyle=new g,["close","toggle","apply","cancel","resetUserStyle"].forEach((function(e){this[e]=this[e].bind(this)}),this),i.visible.subscribe((function(e){e&&this.close()}),this)}close(){this.opened(!1),this.pinned(!1);const e=document.getElementById("vivliostyle-viewer-viewport");return e&&e.focus(),!0}toggle(){this.opened()?this.justClicked?(this.justClicked=!1,this.pinned(!0)):(this.close(),this.justClicked=!0,setTimeout(()=>{this.justClicked=!1},300)):(this.viewer_.tocPinned()||this.viewer_.showTOC(!1),this.opened(!0),this.justClicked?(this.justClicked=!1,this.pinned(!0)):(this.pinned(!1),this.justClicked=!0,this.focusToFirstItem(),setTimeout(()=>{this.justClicked=!1},300)))}apply(){this.state.renderAllPages()===this.viewerOptions_.renderAllPages()&&this.state.pageStyle.equivalentTo(this.documentOptions_.pageStyle)?this.viewerOptions_.copyFrom(this.state.viewerOptions):(this.documentOptions_.pageStyle.copyFrom(this.state.pageStyle),this.documentOptions_.pageStyle.baseFontSizeSpecified()&&this.documentOptions_.updateUserStyleSheetFromCSSText(),this.viewer_.loadDocument(this.documentOptions_,this.state.viewerOptions)),this.pinned()?this.focusToFirstItem():this.close()}cancel(){this.state.viewerOptions.copyFrom(this.viewerOptions_),this.state.pageStyle.copyFrom(this.documentOptions_.pageStyle),this.close()}resetUserStyle(){return this.state.pageStyle.copyFrom(this.defaultPageStyle),this.state.viewerOptions.fontSize(x.getDefaultValues().fontSize),setTimeout(()=>{document.getElementsByName("vivliostyle-settings_reset-user-style")[0].checked=!1},200),!0}focusToFirstItem(e){const t=e||this.settingsToggle,n=["input","textarea","summary"].includes(t.localName)?t:Array.from(t.getElementsByTagName("input")).find(e=>!e.disabled&&("radio"!=e.type||e.checked));if(n){for(let e=n.parentElement;e&&e!=this.settingsToggle;e=e.parentElement)"details"==e.localName&&(e.open=!0);n.focus()}}handleKey(e){const t=this.opened()&&this.settingsToggle.contains(document.activeElement),n=t&&("text"==document.activeElement.type||"select"==document.activeElement.localName),i=t&&"textarea"==document.activeElement.localName,o=t&&!n&&!i;switch(e){case _.Escape:return this.opened()&&(this.cancel(),this.close()),!0;case"s":case"S":return!(!this.opened()||o||!t)||(this.toggle(),!1);case"p":case"P":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-view-and-rendering").firstElementChild),!1);case"v":case"V":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-view-mode")),!1);case"a":case"A":return!o||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_render-all-pages")[0]),!1);case"u":case"U":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_user-style").firstElementChild),!1);case"z":case"Z":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-size")),!1);case"m":case"M":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-margin")),!1);case"b":case"B":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_page-breaks")),!1);case"i":case"I":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_images")),!1);case"t":case"T":return!o||(this.focusToFirstItem(document.getElementById("vivliostyle-settings_text")),!1);case"o":case"O":return!o||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_override-document-stylesheets")[0]),!1);case"c":case"C":return!o||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_css-details")[0]),!1);case"r":case"R":return!o||(this.focusToFirstItem(document.getElementsByName("vivliostyle-settings_reset-user-style")[0]),!1);case _.Enter:return!(n||o&&"vivliostyle-menu-button_apply"!==document.activeElement.id&&"vivliostyle-menu-button_reset"!==document.activeElement.id)||(document.getElementById("vivliostyle-menu-button_apply").focus(),!1);default:return!0}}};var M=class{constructor(e){this.list=e,this.visible=a.a.pureComputed(()=>e().length>0)}getDisplayMessage(e){const t=e.error;let n=t&&(t.toString()||t.frameTrace||t.stack);return n&&(n=n.split("\n",1)[0]),n||(n=e.messages.join("\n")),n}};var U=function(){this.documentOptions=new m,this.viewerOptions=new x,this.documentOptions.pageStyle.setViewerFontSizeObservable(this.viewerOptions.fontSize),this.viewerOptions.profile()&&s.profile.profiler.enable(),this.isDebug="true"===u.getParameter("debug")[0],this.viewerSettings={userAgentRootURL:`${u.getBaseURL()}resources/`,viewportElement:document.getElementById("vivliostyle-viewer-viewport"),debug:this.isDebug},u.getParameter("b")[0]&&(u.removeParameter("b",!0),u.removeParameter("x")),u.removeParameter("f",!0),u.removeParameter("spread",!0),u.removeParameter("renderAllPages",!0),u.removeParameter("fontSize",!0),u.removeParameter("profile",!0),u.removeParameter("debug",!0),this.viewer=new k(this.viewerSettings,this.viewerOptions),this.viewer.inputUrl.subscribe(e=>{""!=e?(u.hasParameter("b")||u.history.pushState&&u.history.pushState(null,""),e=e.startsWith("<")?"data:,"+l.percentEncodeForDataURI(e):l.percentEncodeAmpersandAndUnencodedPercent(e),u.setParameter("b",e)):u.removeParameter("b")}),this.messageDialog=new M(I),this.settingsPanel=new B(this.viewerOptions,this.documentOptions,this.viewer,this.messageDialog,{disablePageStyleChange:!1,disablePageViewModeChange:!1,disableRenderAllPagesChange:!1}),this.navigation=new D(this.viewerOptions,this.viewer,this.settingsPanel,{disableTOCNavigation:!1,disablePageNavigation:!1,disableZoom:!1,disableFontSizeChange:!1}),this.handleKey=(e,t)=>{const n=L.identifyKeyFromEvent(t);if("vivliostyle-input-url"===document.activeElement.id)return"Enter"!==n||13!==t.keyCode||(this.documentOptions.bookUrl(u.getParameter("b")[0]),this.viewer.loadDocument(this.documentOptions),!1);if("Home"!==n&&"End"!==n&&(t.ctrlKey||t.metaKey)||t.altKey||t.shiftKey)return!0;let i=this.settingsPanel.handleKey(n);return i&&(i=this.navigation.handleKey(n)),i},this.viewer.loadDocument(this.documentOptions),window.onhashchange=()=>{window.location.href!=u.storedUrl&&window.location.reload()}};const z="ontouchstart"in window;a.a.bindingHandlers.menuButton={init(e,t){a.a.unwrap(t())&&(z?(e.addEventListener("touchstart",()=>{a.a.utils.toggleDomNodeCssClass(e,"hover active",!0)}),e.addEventListener("touchend",()=>{a.a.utils.toggleDomNodeCssClass(e,"hover active",!1)})):(e.addEventListener("mouseover",()=>{a.a.utils.toggleDomNodeCssClass(e,"hover",!0)}),e.addEventListener("mousedown",()=>{a.a.utils.toggleDomNodeCssClass(e,"active",!0)}),e.addEventListener("mouseup",()=>{a.a.utils.toggleDomNodeCssClass(e,"active",!1)}),e.addEventListener("mouseout",()=>{a.a.utils.toggleDomNodeCssClass(e,"hover",!1),a.a.utils.toggleDomNodeCssClass(e,"active",!1),window.getSelection().removeAllRanges()})))}};const V="ontouchstart"in window;let H=null,G=null,$=null;a.a.bindingHandlers.swipePages={init(e,t){V&&a.a.unwrap(t())&&(e.addEventListener("touchstart",e=>{if(e.touches.length>1)return;if(window.visualViewport&&window.visualViewport.scale>1)return;const t=document.getElementById("vivliostyle-viewer-viewport");t&&t.scrollWidth>t.clientWidth||(H=e.touches[0].clientX,G=e.touches[0].clientY)}),e.addEventListener("touchmove",e=>{if(!(e.touches.length>1)&&null!==H&&null!==G){const t=e.touches[0].clientX-H,n=e.touches[0].clientY-G;Math.abs(t)>Math.abs(n)&&($=t<0?document.getElementById("vivliostyle-page-navigation-right"):document.getElementById("vivliostyle-page-navigation-left")),Math.abs(t)+Math.abs(n)>=16&&($&&($.click(),a.a.utils.toggleDomNodeCssClass($,"active",!0)),H=null,G=null)}}),e.addEventListener("touchend",()=>{$&&a.a.utils.toggleDomNodeCssClass($,"active",!1),$=null,H=null,G=null}))}};var W={start(){function e(){a.a.applyBindings(new U)}window.__loaded?e():window.onload=e}};s.setInstance(o.a),W.start()}]).default}));
//# sourceMappingURL=vivliostyle-ui.min.js.map